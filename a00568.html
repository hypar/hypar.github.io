<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>HyPar: src/Simulation/SolvePETSc.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_html_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">HyPar
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">Finite-Difference Hyperbolic-Parabolic PDE Solver on Cartesian Grids</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('a00568.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">SolvePETSc.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Integrate in time using PETSc.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;math.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;<a class="el" href="a00220_source.html">basic.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="a00228_source.html">io_cpp.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="a00238_source.html">petscinterface.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="a00210_source.html">simulation_object.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="a00229_source.html">librom_interface.h</a>&gt;</code><br/>
</div>
<p><a href="a00568_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ae60511a9aa5cbf216a00a1bb81006bc5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00568.html#ae60511a9aa5cbf216a00a1bb81006bc5">__FUNCT__</a>&#160;&#160;&#160;&quot;SolvePETSc&quot;</td></tr>
<tr class="separator:ae60511a9aa5cbf216a00a1bb81006bc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a116876aaf447559b6cc9fff36a501843"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00568.html#a116876aaf447559b6cc9fff36a501843">CalculateError</a> (void *, void *)</td></tr>
<tr class="separator:a116876aaf447559b6cc9fff36a501843"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5981de613724cb667e98aa872157534e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00568.html#a5981de613724cb667e98aa872157534e">OutputSolution</a> (void *, int)</td></tr>
<tr class="separator:a5981de613724cb667e98aa872157534e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abf45c2d1c16e7b6f6f48ffd421c68c7c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00568.html#abf45c2d1c16e7b6f6f48ffd421c68c7c">ResetFilenameIndex</a> (char *, int)</td></tr>
<tr class="separator:abf45c2d1c16e7b6f6f48ffd421c68c7c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa0fa2c66e04e9f6d84039bedc6400765"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00568.html#aa0fa2c66e04e9f6d84039bedc6400765">CalculateROMDiff</a> (void *, void *)</td></tr>
<tr class="separator:aa0fa2c66e04e9f6d84039bedc6400765"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0f058c8fed21156da5f1f64c828b5b39"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00568.html#a0f058c8fed21156da5f1f64c828b5b39">OutputROMSolution</a> (void *, int)</td></tr>
<tr class="separator:a0f058c8fed21156da5f1f64c828b5b39"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a63727f86c19e70bc897c86edd5015b75"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00568.html#a63727f86c19e70bc897c86edd5015b75">SolvePETSc</a> (void *s, int nsims, int rank, int nproc)</td></tr>
<tr class="memdesc:a63727f86c19e70bc897c86edd5015b75"><td class="mdescLeft">&#160;</td><td class="mdescRight">Integrate in time with PETSc.  <a href="#a63727f86c19e70bc897c86edd5015b75">More...</a><br/></td></tr>
<tr class="separator:a63727f86c19e70bc897c86edd5015b75"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Integrate in time using PETSc. </p>
<dl class="section author"><dt>Author</dt><dd>Debojyoti Ghosh</dd></dl>
<p>Integrate the spatially discretized system in time using PETSc's TS module.<br/>
(<a href="https://petsc.org/release/docs/manualpages/TS/index.html">https://petsc.org/release/docs/manualpages/TS/index.html</a>) </p>

<p>Definition in file <a class="el" href="a00568_source.html">SolvePETSc.cpp</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="ae60511a9aa5cbf216a00a1bb81006bc5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define __FUNCT__&#160;&#160;&#160;&quot;SolvePETSc&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00568_source.html#l00025">25</a> of file <a class="el" href="a00568_source.html">SolvePETSc.cpp</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a116876aaf447559b6cc9fff36a501843"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int CalculateError </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>m</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Calculate the error in the final solution</p>
<p>Calculates the error in the solution if the exact solution is available. If the exact solution is not available, the errors are reported as zero. The exact solution should be provided in the file "exact.inp" in the same format as the initial solution. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>Solver object of type <a class="el" href="a00196.html" title="Structure containing all solver-specific variables and functions. ">HyPar</a> </td></tr>
    <tr><td class="paramname">m</td><td>MPI object of type <a class="el" href="a00199.html#a00625" title="Structure of MPI-related variables. ">MPIVariables</a> </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00288_source.html#l00025">25</a> of file <a class="el" href="a00288_source.html">CalculateError.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;{</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  <a class="code" href="a00196.html">HyPar</a>         *solver     = (<a class="code" href="a00196.html">HyPar</a>*)        s;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  <a class="code" href="a00199.html#a00625">MPIVariables</a>  *mpi        = (<a class="code" href="a00199.html#a00625">MPIVariables</a>*) m;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  <span class="keywordtype">int</span>           exact_flag  = 0, i, size;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  <span class="keywordtype">double</span>        <a class="code" href="a00608.html#aca1295e3cf52d990f4cd1d5872f1385a">sum</a>         = 0, global_sum = 0;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <span class="keywordtype">double</span>        *uex        = NULL;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  <a class="code" href="a00220.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a>;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  size = solver-&gt;<a class="code" href="a00196.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; solver-&gt;<a class="code" href="a00196.html#a484873c74138512e41bc50d17b7d955a">ndims</a>; i++) </div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    size *= (solver-&gt;<a class="code" href="a00196.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>[i]+2*solver-&gt;<a class="code" href="a00196.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>);</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  uex = (<span class="keywordtype">double</span>*) calloc (size, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  <span class="keywordtype">char</span> fname_root[<a class="code" href="a00220.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>] = <span class="stringliteral">&quot;exact&quot;</span>;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  <span class="keywordflow">if</span> (solver-&gt;<a class="code" href="a00196.html#a9a0e87291e0e8b9c1445e5482e814c92">nsims</a> &gt; 1) {</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="keywordtype">char</span> index[<a class="code" href="a00220.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>];</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <a class="code" href="a00222.html#a3e3ad5aed581d9ae563190c365dadc41">GetStringFromInteger</a>(solver-&gt;<a class="code" href="a00196.html#a34488172a8ec6e0aaa03cbea46092d3a">my_idx</a>, index, (<span class="keywordtype">int</span>)log10(solver-&gt;<a class="code" href="a00196.html#a9a0e87291e0e8b9c1445e5482e814c92">nsims</a>)+1);</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    strcat(fname_root, <span class="stringliteral">&quot;_&quot;</span>);</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    strcat(fname_root, index);</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  }</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> tolerance = 1e-15;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <a class="code" href="a00220.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00288.html#aef6e3464d167cab9e23a9eacb8f62882">ExactSolution</a>( solver,</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;                      mpi,</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;                      uex,</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;                      fname_root,</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;                      &amp;exact_flag ); <a class="code" href="a00220.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <span class="keywordflow">if</span> (!exact_flag) {</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="comment">/* No exact solution */</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <a class="code" href="a00220.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00252.html#aacd05babc2fa0650f3047f955c38319c">TimeError</a>(solver,mpi,NULL); <a class="code" href="a00220.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    solver-&gt;<a class="code" href="a00196.html#aa40f27cb2afa2db0f0468962be8b3679">error</a>[0] = solver-&gt;<a class="code" href="a00196.html#aa40f27cb2afa2db0f0468962be8b3679">error</a>[1] = solver-&gt;<a class="code" href="a00196.html#aa40f27cb2afa2db0f0468962be8b3679">error</a>[2] = -1;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <a class="code" href="a00220.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00252.html#aacd05babc2fa0650f3047f955c38319c">TimeError</a>(solver,mpi,uex); <a class="code" href="a00220.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="comment">/* calculate solution norms (for relative error) */</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="keywordtype">double</span> solution_norm[3] = {0.0,0.0,0.0};</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="comment">/* L1 */</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    sum = <a class="code" href="a00219.html#a60a3d838d95d860a21de20936f7bb910">ArraySumAbsnD</a>   (solver-&gt;<a class="code" href="a00196.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00196.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00196.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;                           solver-&gt;<a class="code" href="a00196.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,solver-&gt;<a class="code" href="a00196.html#a95e9e0f8a692321b83a2e0ce2789c485">index</a>,uex);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    global_sum = 0; <a class="code" href="a00236.html#abd61f932b070ee84262d9d98b6dd854f">MPISum_double</a>(&amp;global_sum,&amp;sum,1,&amp;mpi-&gt;<a class="code" href="a00199.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    solution_norm[0] = global_sum/((double)solver-&gt;<a class="code" href="a00196.html#a4e67f54563a3c4ff005dfaf0130f957c">npoints_global</a>);</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="comment">/* L2 */</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    sum = <a class="code" href="a00219.html#a8c279db0af78d8ff386cf1a023a405dd">ArraySumSquarenD</a>(solver-&gt;<a class="code" href="a00196.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00196.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00196.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                           solver-&gt;<a class="code" href="a00196.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,solver-&gt;<a class="code" href="a00196.html#a95e9e0f8a692321b83a2e0ce2789c485">index</a>,uex);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    global_sum = 0; <a class="code" href="a00236.html#abd61f932b070ee84262d9d98b6dd854f">MPISum_double</a>(&amp;global_sum,&amp;sum,1,&amp;mpi-&gt;<a class="code" href="a00199.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    solution_norm[1] = sqrt(global_sum/((<span class="keywordtype">double</span>)solver-&gt;<a class="code" href="a00196.html#a4e67f54563a3c4ff005dfaf0130f957c">npoints_global</a>));</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="comment">/* Linf */</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    sum = <a class="code" href="a00219.html#ac20bd4916c6169956e5bf80777c6ab8f">ArrayMaxnD</a>      (solver-&gt;<a class="code" href="a00196.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00196.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00196.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                           solver-&gt;<a class="code" href="a00196.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,solver-&gt;<a class="code" href="a00196.html#a95e9e0f8a692321b83a2e0ce2789c485">index</a>,uex);</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    global_sum = 0; <a class="code" href="a00236.html#a33aa37e0050ec72dadb8d63851df51ec">MPIMax_double</a>(&amp;global_sum,&amp;sum,1,&amp;mpi-&gt;<a class="code" href="a00199.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    solution_norm[2] = global_sum;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="comment">/* compute error = difference between exact and numerical solution */</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <a class="code" href="a00219.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00196.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>,-1.0,uex,size);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="comment">/* calculate L1 norm of error */</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    sum = <a class="code" href="a00219.html#a60a3d838d95d860a21de20936f7bb910">ArraySumAbsnD</a>   (solver-&gt;<a class="code" href="a00196.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00196.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00196.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                           solver-&gt;<a class="code" href="a00196.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,solver-&gt;<a class="code" href="a00196.html#a95e9e0f8a692321b83a2e0ce2789c485">index</a>,uex);</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    global_sum = 0; <a class="code" href="a00236.html#abd61f932b070ee84262d9d98b6dd854f">MPISum_double</a>(&amp;global_sum,&amp;sum,1,&amp;mpi-&gt;<a class="code" href="a00199.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    solver-&gt;<a class="code" href="a00196.html#aa40f27cb2afa2db0f0468962be8b3679">error</a>[0] = global_sum/((double)solver-&gt;<a class="code" href="a00196.html#a4e67f54563a3c4ff005dfaf0130f957c">npoints_global</a>);</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="comment">/* calculate L2 norm of error */</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    sum = <a class="code" href="a00219.html#a8c279db0af78d8ff386cf1a023a405dd">ArraySumSquarenD</a>(solver-&gt;<a class="code" href="a00196.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00196.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00196.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                           solver-&gt;<a class="code" href="a00196.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,solver-&gt;<a class="code" href="a00196.html#a95e9e0f8a692321b83a2e0ce2789c485">index</a>,uex);</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    global_sum = 0; <a class="code" href="a00236.html#abd61f932b070ee84262d9d98b6dd854f">MPISum_double</a>(&amp;global_sum,&amp;sum,1,&amp;mpi-&gt;<a class="code" href="a00199.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    solver-&gt;<a class="code" href="a00196.html#aa40f27cb2afa2db0f0468962be8b3679">error</a>[1] = sqrt(global_sum/((<span class="keywordtype">double</span>)solver-&gt;<a class="code" href="a00196.html#a4e67f54563a3c4ff005dfaf0130f957c">npoints_global</a>));</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="comment">/* calculate Linf norm of error */</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    sum = <a class="code" href="a00219.html#ac20bd4916c6169956e5bf80777c6ab8f">ArrayMaxnD</a>      (solver-&gt;<a class="code" href="a00196.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00196.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00196.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                           solver-&gt;<a class="code" href="a00196.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,solver-&gt;<a class="code" href="a00196.html#a95e9e0f8a692321b83a2e0ce2789c485">index</a>,uex);</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    global_sum = 0; <a class="code" href="a00236.html#a33aa37e0050ec72dadb8d63851df51ec">MPIMax_double</a>(&amp;global_sum,&amp;sum,1,&amp;mpi-&gt;<a class="code" href="a00199.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    solver-&gt;<a class="code" href="a00196.html#aa40f27cb2afa2db0f0468962be8b3679">error</a>[2] = global_sum;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="comment">/* </span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">      decide whether to normalize and report relative errors, </span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">      or report absolute errors.</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">    */</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="keywordflow">if</span> (    (solution_norm[0] &gt; tolerance) </div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        &amp;&amp;  (solution_norm[1] &gt; tolerance) </div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        &amp;&amp;  (solution_norm[2] &gt; tolerance) ) {</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;      solver-&gt;<a class="code" href="a00196.html#aa40f27cb2afa2db0f0468962be8b3679">error</a>[0] /= solution_norm[0];</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;      solver-&gt;<a class="code" href="a00196.html#aa40f27cb2afa2db0f0468962be8b3679">error</a>[1] /= solution_norm[1];</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;      solver-&gt;<a class="code" href="a00196.html#aa40f27cb2afa2db0f0468962be8b3679">error</a>[2] /= solution_norm[2];</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    }</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  }</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  free(uex);</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;}</div>
<div class="ttc" id="a00196_html_a4e67f54563a3c4ff005dfaf0130f957c"><div class="ttname"><a href="a00196.html#a4e67f54563a3c4ff005dfaf0130f957c">HyPar::npoints_global</a></div><div class="ttdeci">int npoints_global</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00038">hypar.h:38</a></div></div>
<div class="ttc" id="a00222_html_a3e3ad5aed581d9ae563190c365dadc41"><div class="ttname"><a href="a00222.html#a3e3ad5aed581d9ae563190c365dadc41">GetStringFromInteger</a></div><div class="ttdeci">void GetStringFromInteger(int, char *, int)</div><div class="ttdef"><b>Definition:</b> <a href="a00280_source.html#l00015">CommonFunctions.c:15</a></div></div>
<div class="ttc" id="a00196_html_a38e0371f331cecbe63a77fa03e202afe"><div class="ttname"><a href="a00196.html#a38e0371f331cecbe63a77fa03e202afe">HyPar::dim_local</a></div><div class="ttdeci">int * dim_local</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00035">hypar.h:35</a></div></div>
<div class="ttc" id="a00219_html_ac20bd4916c6169956e5bf80777c6ab8f"><div class="ttname"><a href="a00219.html#ac20bd4916c6169956e5bf80777c6ab8f">ArrayMaxnD</a></div><div class="ttdeci">INLINE double ArrayMaxnD(int, int, int *, int, int *, double *)</div><div class="ttdef"><b>Definition:</b> <a href="a00219_source.html#l00483">arrayfunctions.h:483</a></div></div>
<div class="ttc" id="a00196_html_a95e9e0f8a692321b83a2e0ce2789c485"><div class="ttname"><a href="a00196.html#a95e9e0f8a692321b83a2e0ce2789c485">HyPar::index</a></div><div class="ttdeci">int * index</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00094">hypar.h:94</a></div></div>
<div class="ttc" id="a00220_html_a51efea86a4d76d1259893f606b776573"><div class="ttname"><a href="a00220.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a></div><div class="ttdeci">#define _MAX_STRING_SIZE_</div><div class="ttdef"><b>Definition:</b> <a href="a00220_source.html#l00010">basic.h:10</a></div></div>
<div class="ttc" id="a00196_html_a34488172a8ec6e0aaa03cbea46092d3a"><div class="ttname"><a href="a00196.html#a34488172a8ec6e0aaa03cbea46092d3a">HyPar::my_idx</a></div><div class="ttdeci">int my_idx</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00053">hypar.h:53</a></div></div>
<div class="ttc" id="a00219_html_a8c279db0af78d8ff386cf1a023a405dd"><div class="ttname"><a href="a00219.html#a8c279db0af78d8ff386cf1a023a405dd">ArraySumSquarenD</a></div><div class="ttdeci">INLINE double ArraySumSquarenD(int, int, int *, int, int *, double *)</div><div class="ttdef"><b>Definition:</b> <a href="a00219_source.html#l00526">arrayfunctions.h:526</a></div></div>
<div class="ttc" id="a00196_html"><div class="ttname"><a href="a00196.html">HyPar</a></div><div class="ttdoc">Structure containing all solver-specific variables and functions. </div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00023">hypar.h:23</a></div></div>
<div class="ttc" id="a00608_html_aca1295e3cf52d990f4cd1d5872f1385a"><div class="ttname"><a href="a00608.html#aca1295e3cf52d990f4cd1d5872f1385a">StdVecOps::sum</a></div><div class="ttdeci">long sum(const std::vector&lt; int &gt; &amp;a_iv)</div><div class="ttdef"><b>Definition:</b> <a href="a00251_source.html#l00018">std_vec_ops.h:18</a></div></div>
<div class="ttc" id="a00220_html_a68f50121fb9a7daeaf60e50cdef82ef3"><div class="ttname"><a href="a00220.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a></div><div class="ttdeci">#define _DECLARE_IERR_</div><div class="ttdef"><b>Definition:</b> <a href="a00220_source.html#l00013">basic.h:13</a></div></div>
<div class="ttc" id="a00199_html_adad7a6f85831f3ac84d854b6c80aef43"><div class="ttname"><a href="a00199.html#adad7a6f85831f3ac84d854b6c80aef43">MPIVariables::world</a></div><div class="ttdeci">MPI_Comm world</div><div class="ttdef"><b>Definition:</b> <a href="a00199_source.html#l00037">mpivars_struct.h:37</a></div></div>
<div class="ttc" id="a00236_html_abd61f932b070ee84262d9d98b6dd854f"><div class="ttname"><a href="a00236.html#abd61f932b070ee84262d9d98b6dd854f">MPISum_double</a></div><div class="ttdeci">int MPISum_double(double *, double *, int, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00375_source.html#l00039">MPISum.c:39</a></div></div>
<div class="ttc" id="a00199_html_a00625"><div class="ttname"><a href="a00199.html#a00625">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a00199_source.html#l00024">mpivars_struct.h:24</a></div></div>
<div class="ttc" id="a00220_html_add9cf96ae374934d245a1dc1ab697a42"><div class="ttname"><a href="a00220.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a></div><div class="ttdeci">#define CHECKERR(ierr)</div><div class="ttdef"><b>Definition:</b> <a href="a00220_source.html#l00014">basic.h:14</a></div></div>
<div class="ttc" id="a00220_html_ad6ab74942c9de13cf0b4c12eb0d91780"><div class="ttname"><a href="a00220.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a></div><div class="ttdeci">#define IERR</div><div class="ttdef"><b>Definition:</b> <a href="a00220_source.html#l00012">basic.h:12</a></div></div>
<div class="ttc" id="a00252_html_aacd05babc2fa0650f3047f955c38319c"><div class="ttname"><a href="a00252.html#aacd05babc2fa0650f3047f955c38319c">TimeError</a></div><div class="ttdeci">int TimeError(void *, void *, double *)</div><div class="ttdef"><b>Definition:</b> <a href="a00586_source.html#l00027">TimeError.c:27</a></div></div>
<div class="ttc" id="a00196_html_aa40f27cb2afa2db0f0468962be8b3679"><div class="ttname"><a href="a00196.html#aa40f27cb2afa2db0f0468962be8b3679">HyPar::error</a></div><div class="ttdeci">double error[3]</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00352">hypar.h:352</a></div></div>
<div class="ttc" id="a00288_html_aef6e3464d167cab9e23a9eacb8f62882"><div class="ttname"><a href="a00288.html#aef6e3464d167cab9e23a9eacb8f62882">ExactSolution</a></div><div class="ttdeci">int ExactSolution(void *, void *, double *, char *, int *)</div><div class="ttdef"><b>Definition:</b> <a href="a00291_source.html#l00016">ExactSolution.c:16</a></div></div>
<div class="ttc" id="a00196_html_a3b6b999a764f1e2ea94bb5f28c7a558c"><div class="ttname"><a href="a00196.html#a3b6b999a764f1e2ea94bb5f28c7a558c">HyPar::u</a></div><div class="ttdeci">double * u</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00108">hypar.h:108</a></div></div>
<div class="ttc" id="a00196_html_a484873c74138512e41bc50d17b7d955a"><div class="ttname"><a href="a00196.html#a484873c74138512e41bc50d17b7d955a">HyPar::ndims</a></div><div class="ttdeci">int ndims</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00026">hypar.h:26</a></div></div>
<div class="ttc" id="a00196_html_aafc992b5fa79d5a4036024615d03bce6"><div class="ttname"><a href="a00196.html#aafc992b5fa79d5a4036024615d03bce6">HyPar::ghosts</a></div><div class="ttdeci">int ghosts</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00044">hypar.h:44</a></div></div>
<div class="ttc" id="a00196_html_ae8f6d2fd6490d3153cb4133bf183a404"><div class="ttname"><a href="a00196.html#ae8f6d2fd6490d3153cb4133bf183a404">HyPar::nvars</a></div><div class="ttdeci">int nvars</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00029">hypar.h:29</a></div></div>
<div class="ttc" id="a00196_html_a9a0e87291e0e8b9c1445e5482e814c92"><div class="ttname"><a href="a00196.html#a9a0e87291e0e8b9c1445e5482e814c92">HyPar::nsims</a></div><div class="ttdeci">int nsims</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00056">hypar.h:56</a></div></div>
<div class="ttc" id="a00219_html_a4cd66304bc41a7751842230af3063b62"><div class="ttname"><a href="a00219.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a></div><div class="ttdeci">#define _ArrayAXPY_(x, a, y, size)</div><div class="ttdef"><b>Definition:</b> <a href="a00219_source.html#l00270">arrayfunctions.h:270</a></div></div>
<div class="ttc" id="a00219_html_a60a3d838d95d860a21de20936f7bb910"><div class="ttname"><a href="a00219.html#a60a3d838d95d860a21de20936f7bb910">ArraySumAbsnD</a></div><div class="ttdeci">INLINE double ArraySumAbsnD(int, int, int *, int, int *, double *)</div><div class="ttdef"><b>Definition:</b> <a href="a00219_source.html#l00507">arrayfunctions.h:507</a></div></div>
<div class="ttc" id="a00236_html_a33aa37e0050ec72dadb8d63851df51ec"><div class="ttname"><a href="a00236.html#a33aa37e0050ec72dadb8d63851df51ec">MPIMax_double</a></div><div class="ttdeci">int MPIMax_double(double *, double *, int, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00368_source.html#l00038">MPIMax.c:38</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5981de613724cb667e98aa872157534e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int OutputSolution </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nsims</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Write solutions to file</p>
<p>Write out the solution to file </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>Array of simulation objects of type <a class="el" href="a00210.html#a00629" title="Structure defining a simulation. ">SimulationObject</a> </td></tr>
    <tr><td class="paramname">nsims</td><td>Number of simulation objects </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00563_source.html#l00022">22</a> of file <a class="el" href="a00563_source.html">OutputSolution.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;{</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;  <a class="code" href="a00210.html#a00629">SimulationObject</a>* simobj = (<a class="code" href="a00210.html#a00629">SimulationObject</a>*) s;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  <span class="keywordtype">int</span> ns;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  <a class="code" href="a00220.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a>;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  <span class="keywordflow">for</span> (ns = 0; ns &lt; nsims; ns++) {</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <a class="code" href="a00196.html">HyPar</a>*        solver = &amp;(simobj[ns].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>);</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <a class="code" href="a00199.html#a00625">MPIVariables</a>* mpi    = &amp;(simobj[ns].<a class="code" href="a00210.html#a4afd2c7b3eb8fda452474ebdbe71c8c0">mpi</a>);</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    </div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="comment">/* if WriteOutput() is NULL, then return */</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="keywordflow">if</span> (!solver-&gt;<a class="code" href="a00196.html#a9018a1befab4079332620f40375a9661">WriteOutput</a>) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  </div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <span class="comment">/* time integration module may have auxiliary arrays to write out, so get them */</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="keywordtype">int</span> NSolutions = 0;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <a class="code" href="a00220.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00252.html#a9bff7fe5ca4249dd82bfad78a1fa09dd">TimeGetAuxSolutions</a>(&amp;NSolutions,NULL,solver,-1,ns); <a class="code" href="a00220.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="keywordflow">if</span> (NSolutions &gt; 10) NSolutions = 10;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  </div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="keywordtype">int</span>  nu;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="keywordtype">char</span> fname_root[<a class="code" href="a00220.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>];</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="keywordtype">char</span> aux_fname_root[<a class="code" href="a00220.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>];</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    strcpy(fname_root, solver-&gt;<a class="code" href="a00196.html#a2f63f9a875bb76e6107cb2e7c725d935">op_fname_root</a>);</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    strcpy(aux_fname_root, solver-&gt;<a class="code" href="a00196.html#a5d741833915983fdcb695f262a73ae7e">aux_op_fname_root</a>);</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="keywordflow">if</span> (nsims &gt; 1) {</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;      <span class="keywordtype">char</span> index[<a class="code" href="a00220.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>];</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;      <a class="code" href="a00222.html#a3e3ad5aed581d9ae563190c365dadc41">GetStringFromInteger</a>(ns, index, (<span class="keywordtype">int</span>)log10(nsims)+1);</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;      strcat(fname_root, <span class="stringliteral">&quot;_&quot;</span>);</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;      strcat(fname_root, index);</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;      strcat(aux_fname_root, <span class="stringliteral">&quot;_&quot;</span>);</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;      strcat(aux_fname_root, index);</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    }</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  </div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="keywordflow">for</span> (nu=0; nu&lt;NSolutions; nu++) {</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;      <span class="keywordtype">double</span>  *uaux = NULL;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;      <a class="code" href="a00220.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00252.html#a9bff7fe5ca4249dd82bfad78a1fa09dd">TimeGetAuxSolutions</a>(&amp;NSolutions,&amp;uaux,solver,nu,ns); <a class="code" href="a00220.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;      <a class="code" href="a00220.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00227.html#aaf888c739c5200d9c58a7154347069b0">WriteArray</a>(  solver-&gt;<a class="code" href="a00196.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;                        solver-&gt;<a class="code" href="a00196.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;                        solver-&gt;<a class="code" href="a00196.html#aa989ebb755986852177779cdf7bd8c85">dim_global</a>,</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;                        solver-&gt;<a class="code" href="a00196.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;                        solver-&gt;<a class="code" href="a00196.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;                        solver-&gt;<a class="code" href="a00196.html#a711aad4cbe735871dd9e91ab575c878b">x</a>,</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;                        uaux,</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;                        solver,</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;                        mpi,</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;                        aux_fname_root ); <a class="code" href="a00220.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;      aux_fname_root[2]++;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    }</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    </div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <a class="code" href="a00220.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00227.html#aaf888c739c5200d9c58a7154347069b0">WriteArray</a>(  solver-&gt;<a class="code" href="a00196.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;                      solver-&gt;<a class="code" href="a00196.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;                      solver-&gt;<a class="code" href="a00196.html#aa989ebb755986852177779cdf7bd8c85">dim_global</a>,</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;                      solver-&gt;<a class="code" href="a00196.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                      solver-&gt;<a class="code" href="a00196.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;                      solver-&gt;<a class="code" href="a00196.html#a711aad4cbe735871dd9e91ab575c878b">x</a>,</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;                      solver-&gt;<a class="code" href="a00196.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>,</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                      solver,</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;                      mpi,</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;                      fname_root ); <a class="code" href="a00220.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  </div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="comment">/* increment the index string, if required */</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="keywordflow">if</span> ((!strcmp(solver-&gt;<a class="code" href="a00196.html#a5f89e286a9eaffdb66d966fa6a290d3f">output_mode</a>,<span class="stringliteral">&quot;serial&quot;</span>)) &amp;&amp; (!strcmp(solver-&gt;<a class="code" href="a00196.html#a4e93cb107e180ef982b74cef7726b70f">op_overwrite</a>,<span class="stringliteral">&quot;no&quot;</span>))) {</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;      <a class="code" href="a00293.html#a9fda82ed752188f3af821e2c30f63c21">IncrementFilenameIndex</a>(solver-&gt;<a class="code" href="a00196.html#a0805db42e429173752189696c3c96909">filename_index</a>,solver-&gt;<a class="code" href="a00196.html#af474ca4577de91b658e4399ad0a6d7b3">index_length</a>);</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    }</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  }</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  </div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;}</div>
<div class="ttc" id="a00222_html_a3e3ad5aed581d9ae563190c365dadc41"><div class="ttname"><a href="a00222.html#a3e3ad5aed581d9ae563190c365dadc41">GetStringFromInteger</a></div><div class="ttdeci">void GetStringFromInteger(int, char *, int)</div><div class="ttdef"><b>Definition:</b> <a href="a00280_source.html#l00015">CommonFunctions.c:15</a></div></div>
<div class="ttc" id="a00196_html_a38e0371f331cecbe63a77fa03e202afe"><div class="ttname"><a href="a00196.html#a38e0371f331cecbe63a77fa03e202afe">HyPar::dim_local</a></div><div class="ttdeci">int * dim_local</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00035">hypar.h:35</a></div></div>
<div class="ttc" id="a00196_html_af474ca4577de91b658e4399ad0a6d7b3"><div class="ttname"><a href="a00196.html#af474ca4577de91b658e4399ad0a6d7b3">HyPar::index_length</a></div><div class="ttdeci">int index_length</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00188">hypar.h:188</a></div></div>
<div class="ttc" id="a00220_html_a51efea86a4d76d1259893f606b776573"><div class="ttname"><a href="a00220.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a></div><div class="ttdeci">#define _MAX_STRING_SIZE_</div><div class="ttdef"><b>Definition:</b> <a href="a00220_source.html#l00010">basic.h:10</a></div></div>
<div class="ttc" id="a00196_html_aa989ebb755986852177779cdf7bd8c85"><div class="ttname"><a href="a00196.html#aa989ebb755986852177779cdf7bd8c85">HyPar::dim_global</a></div><div class="ttdeci">int * dim_global</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00032">hypar.h:32</a></div></div>
<div class="ttc" id="a00210_html_a523947ce4fa7128c4c767163953253b9"><div class="ttname"><a href="a00210.html#a523947ce4fa7128c4c767163953253b9">SimulationObject::solver</a></div><div class="ttdeci">HyPar solver</div><div class="ttdef"><b>Definition:</b> <a href="a00210_source.html#l00026">simulation_object.h:26</a></div></div>
<div class="ttc" id="a00196_html_a2f63f9a875bb76e6107cb2e7c725d935"><div class="ttname"><a href="a00196.html#a2f63f9a875bb76e6107cb2e7c725d935">HyPar::op_fname_root</a></div><div class="ttdeci">char op_fname_root[_MAX_STRING_SIZE_]</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00193">hypar.h:193</a></div></div>
<div class="ttc" id="a00196_html"><div class="ttname"><a href="a00196.html">HyPar</a></div><div class="ttdoc">Structure containing all solver-specific variables and functions. </div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00023">hypar.h:23</a></div></div>
<div class="ttc" id="a00220_html_a68f50121fb9a7daeaf60e50cdef82ef3"><div class="ttname"><a href="a00220.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a></div><div class="ttdeci">#define _DECLARE_IERR_</div><div class="ttdef"><b>Definition:</b> <a href="a00220_source.html#l00013">basic.h:13</a></div></div>
<div class="ttc" id="a00196_html_a9018a1befab4079332620f40375a9661"><div class="ttname"><a href="a00196.html#a9018a1befab4079332620f40375a9661">HyPar::WriteOutput</a></div><div class="ttdeci">int(* WriteOutput)(int, int, int *, double *, double *, char *, int *)</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00198">hypar.h:198</a></div></div>
<div class="ttc" id="a00196_html_a0805db42e429173752189696c3c96909"><div class="ttname"><a href="a00196.html#a0805db42e429173752189696c3c96909">HyPar::filename_index</a></div><div class="ttdeci">char * filename_index</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00186">hypar.h:186</a></div></div>
<div class="ttc" id="a00252_html_a9bff7fe5ca4249dd82bfad78a1fa09dd"><div class="ttname"><a href="a00252.html#a9bff7fe5ca4249dd82bfad78a1fa09dd">TimeGetAuxSolutions</a></div><div class="ttdeci">int TimeGetAuxSolutions(int *, double **, void *, int, int)</div><div class="ttdef"><b>Definition:</b> <a href="a00590_source.html#l00029">TimeGetAuxSolutions.c:29</a></div></div>
<div class="ttc" id="a00227_html_aaf888c739c5200d9c58a7154347069b0"><div class="ttname"><a href="a00227.html#aaf888c739c5200d9c58a7154347069b0">WriteArray</a></div><div class="ttdeci">int WriteArray(int, int, int *, int *, int, double *, double *, void *, void *, char *)</div><div class="ttdef"><b>Definition:</b> <a href="a00344_source.html#l00027">WriteArray.c:27</a></div></div>
<div class="ttc" id="a00199_html_a00625"><div class="ttname"><a href="a00199.html#a00625">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a00199_source.html#l00024">mpivars_struct.h:24</a></div></div>
<div class="ttc" id="a00220_html_add9cf96ae374934d245a1dc1ab697a42"><div class="ttname"><a href="a00220.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a></div><div class="ttdeci">#define CHECKERR(ierr)</div><div class="ttdef"><b>Definition:</b> <a href="a00220_source.html#l00014">basic.h:14</a></div></div>
<div class="ttc" id="a00220_html_ad6ab74942c9de13cf0b4c12eb0d91780"><div class="ttname"><a href="a00220.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a></div><div class="ttdeci">#define IERR</div><div class="ttdef"><b>Definition:</b> <a href="a00220_source.html#l00012">basic.h:12</a></div></div>
<div class="ttc" id="a00196_html_a5f89e286a9eaffdb66d966fa6a290d3f"><div class="ttname"><a href="a00196.html#a5f89e286a9eaffdb66d966fa6a290d3f">HyPar::output_mode</a></div><div class="ttdeci">char output_mode[_MAX_STRING_SIZE_]</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00175">hypar.h:175</a></div></div>
<div class="ttc" id="a00210_html_a4afd2c7b3eb8fda452474ebdbe71c8c0"><div class="ttname"><a href="a00210.html#a4afd2c7b3eb8fda452474ebdbe71c8c0">SimulationObject::mpi</a></div><div class="ttdeci">MPIVariables mpi</div><div class="ttdef"><b>Definition:</b> <a href="a00210_source.html#l00025">simulation_object.h:25</a></div></div>
<div class="ttc" id="a00196_html_a711aad4cbe735871dd9e91ab575c878b"><div class="ttname"><a href="a00196.html#a711aad4cbe735871dd9e91ab575c878b">HyPar::x</a></div><div class="ttdeci">double * x</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00099">hypar.h:99</a></div></div>
<div class="ttc" id="a00196_html_a3b6b999a764f1e2ea94bb5f28c7a558c"><div class="ttname"><a href="a00196.html#a3b6b999a764f1e2ea94bb5f28c7a558c">HyPar::u</a></div><div class="ttdeci">double * u</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00108">hypar.h:108</a></div></div>
<div class="ttc" id="a00196_html_a484873c74138512e41bc50d17b7d955a"><div class="ttname"><a href="a00196.html#a484873c74138512e41bc50d17b7d955a">HyPar::ndims</a></div><div class="ttdeci">int ndims</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00026">hypar.h:26</a></div></div>
<div class="ttc" id="a00196_html_aafc992b5fa79d5a4036024615d03bce6"><div class="ttname"><a href="a00196.html#aafc992b5fa79d5a4036024615d03bce6">HyPar::ghosts</a></div><div class="ttdeci">int ghosts</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00044">hypar.h:44</a></div></div>
<div class="ttc" id="a00196_html_ae8f6d2fd6490d3153cb4133bf183a404"><div class="ttname"><a href="a00196.html#ae8f6d2fd6490d3153cb4133bf183a404">HyPar::nvars</a></div><div class="ttdeci">int nvars</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00029">hypar.h:29</a></div></div>
<div class="ttc" id="a00196_html_a5d741833915983fdcb695f262a73ae7e"><div class="ttname"><a href="a00196.html#a5d741833915983fdcb695f262a73ae7e">HyPar::aux_op_fname_root</a></div><div class="ttdeci">char aux_op_fname_root[_MAX_STRING_SIZE_]</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00195">hypar.h:195</a></div></div>
<div class="ttc" id="a00210_html_a00629"><div class="ttname"><a href="a00210.html#a00629">SimulationObject</a></div><div class="ttdoc">Structure defining a simulation. </div><div class="ttdef"><b>Definition:</b> <a href="a00210_source.html#l00023">simulation_object.h:23</a></div></div>
<div class="ttc" id="a00196_html_a4e93cb107e180ef982b74cef7726b70f"><div class="ttname"><a href="a00196.html#a4e93cb107e180ef982b74cef7726b70f">HyPar::op_overwrite</a></div><div class="ttdeci">char op_overwrite[_MAX_STRING_SIZE_]</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00183">hypar.h:183</a></div></div>
<div class="ttc" id="a00293_html_a9fda82ed752188f3af821e2c30f63c21"><div class="ttname"><a href="a00293.html#a9fda82ed752188f3af821e2c30f63c21">IncrementFilenameIndex</a></div><div class="ttdeci">void IncrementFilenameIndex(char *f, int len)</div><div class="ttdef"><b>Definition:</b> <a href="a00293_source.html#l00046">IncrementFilename.c:46</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="abf45c2d1c16e7b6f6f48ffd421c68c7c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ResetFilenameIndex </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>f</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Reset filename index</p>
<p>Resets the index to "0000..." of a desired length. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">f</td><td>Character string representing the integer </td></tr>
    <tr><td class="paramname">len</td><td>Length of the string </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00293_source.html#l00064">64</a> of file <a class="el" href="a00293_source.html">IncrementFilename.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;{</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; len; i++) {</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    f[i] = <span class="charliteral">&#39;0&#39;</span>;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  }</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aa0fa2c66e04e9f6d84039bedc6400765"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int CalculateROMDiff </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>m</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Calculate the diff of PDE and ROM solutions</p>
<p>Calculates the L1, L2, &amp; Linf norms of the diff between the PDE solution and the predicted solution by libROM. error in the solution if the exact solution is </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>Solver object of type <a class="el" href="a00196.html" title="Structure containing all solver-specific variables and functions. ">HyPar</a> </td></tr>
    <tr><td class="paramname">m</td><td>MPI object of type <a class="el" href="a00199.html#a00625" title="Structure of MPI-related variables. ">MPIVariables</a> </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00289_source.html#l00024">24</a> of file <a class="el" href="a00289_source.html">CalculateROMDiff.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;{</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  <a class="code" href="a00196.html">HyPar</a>* solver = (<a class="code" href="a00196.html">HyPar</a>*) s;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  <a class="code" href="a00199.html#a00625">MPIVariables</a>* mpi = (<a class="code" href="a00199.html#a00625">MPIVariables</a>*) m;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  <span class="keywordtype">double</span> <a class="code" href="a00608.html#aca1295e3cf52d990f4cd1d5872f1385a">sum</a> = 0, global_sum = 0;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> tolerance = 1e-15;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  <span class="keywordtype">int</span> size = solver-&gt;<a class="code" href="a00196.html#a20ee1fd00a220b98513127884a5558cf">npoints_local_wghosts</a> * solver-&gt;<a class="code" href="a00196.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <span class="keywordtype">double</span>* u_diff = (<span class="keywordtype">double</span>*) calloc (size, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  <span class="comment">/* calculate solution norms (for relative error) */</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  <span class="keywordtype">double</span> solution_norm[3] = {0.0,0.0,0.0};</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <span class="comment">/* L1 */</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  sum = <a class="code" href="a00219.html#a60a3d838d95d860a21de20936f7bb910">ArraySumAbsnD</a> ( solver-&gt;<a class="code" href="a00196.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;                        solver-&gt;<a class="code" href="a00196.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;                        solver-&gt;<a class="code" href="a00196.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;                        solver-&gt;<a class="code" href="a00196.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;                        solver-&gt;<a class="code" href="a00196.html#a95e9e0f8a692321b83a2e0ce2789c485">index</a>,</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;                        solver-&gt;<a class="code" href="a00196.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a> );</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  global_sum = 0; <a class="code" href="a00236.html#abd61f932b070ee84262d9d98b6dd854f">MPISum_double</a>(&amp;global_sum,&amp;sum,1,&amp;mpi-&gt;<a class="code" href="a00199.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  solution_norm[0] = global_sum/((double)solver-&gt;<a class="code" href="a00196.html#a4e67f54563a3c4ff005dfaf0130f957c">npoints_global</a>);</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  <span class="comment">/* L2 */</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  sum = <a class="code" href="a00219.html#a8c279db0af78d8ff386cf1a023a405dd">ArraySumSquarenD</a>  ( solver-&gt;<a class="code" href="a00196.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;                            solver-&gt;<a class="code" href="a00196.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;                            solver-&gt;<a class="code" href="a00196.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;                            solver-&gt;<a class="code" href="a00196.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;                            solver-&gt;<a class="code" href="a00196.html#a95e9e0f8a692321b83a2e0ce2789c485">index</a>,</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;                            solver-&gt;<a class="code" href="a00196.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a> );</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  global_sum = 0; <a class="code" href="a00236.html#abd61f932b070ee84262d9d98b6dd854f">MPISum_double</a>(&amp;global_sum,&amp;sum,1,&amp;mpi-&gt;<a class="code" href="a00199.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  solution_norm[1] = sqrt(global_sum/((<span class="keywordtype">double</span>)solver-&gt;<a class="code" href="a00196.html#a4e67f54563a3c4ff005dfaf0130f957c">npoints_global</a>));</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <span class="comment">/* Linf */</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  sum = <a class="code" href="a00219.html#ac20bd4916c6169956e5bf80777c6ab8f">ArrayMaxnD</a>  ( solver-&gt;<a class="code" href="a00196.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;                      solver-&gt;<a class="code" href="a00196.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;                      solver-&gt;<a class="code" href="a00196.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;                      solver-&gt;<a class="code" href="a00196.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;                      solver-&gt;<a class="code" href="a00196.html#a95e9e0f8a692321b83a2e0ce2789c485">index</a></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;                      ,solver-&gt;<a class="code" href="a00196.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>  );</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  global_sum = 0; <a class="code" href="a00236.html#a33aa37e0050ec72dadb8d63851df51ec">MPIMax_double</a>(&amp;global_sum,&amp;sum,1,&amp;mpi-&gt;<a class="code" href="a00199.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  solution_norm[2] = global_sum;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  <span class="comment">/* set u_diff to PDE solution */</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <a class="code" href="a00219.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>(solver-&gt;<a class="code" href="a00196.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>, u_diff, size);</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <span class="comment">/* subtract the ROM solutions */</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  <a class="code" href="a00219.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00196.html#aac11b2a653ffaeac4b35057431f1b981">u_rom_predicted</a>, -1.0, u_diff, size);</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <span class="comment">/* calculate L1 norm of error */</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  sum = <a class="code" href="a00219.html#a60a3d838d95d860a21de20936f7bb910">ArraySumAbsnD</a> ( solver-&gt;<a class="code" href="a00196.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;                        solver-&gt;<a class="code" href="a00196.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                        solver-&gt;<a class="code" href="a00196.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;                        solver-&gt;<a class="code" href="a00196.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                        solver-&gt;<a class="code" href="a00196.html#a95e9e0f8a692321b83a2e0ce2789c485">index</a>,</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;                        u_diff  );</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  global_sum = 0; <a class="code" href="a00236.html#abd61f932b070ee84262d9d98b6dd854f">MPISum_double</a>(&amp;global_sum,&amp;sum,1,&amp;mpi-&gt;<a class="code" href="a00199.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  solver-&gt;<a class="code" href="a00196.html#aaacee284a041d53cf335ae299d5eb929">rom_diff_norms</a>[0] = global_sum/((double)solver-&gt;<a class="code" href="a00196.html#a4e67f54563a3c4ff005dfaf0130f957c">npoints_global</a>);</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <span class="comment">/* calculate L2 norm of error */</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  sum = <a class="code" href="a00219.html#a8c279db0af78d8ff386cf1a023a405dd">ArraySumSquarenD</a>  ( solver-&gt;<a class="code" href="a00196.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;                            solver-&gt;<a class="code" href="a00196.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                            solver-&gt;<a class="code" href="a00196.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;                            solver-&gt;<a class="code" href="a00196.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;                            solver-&gt;<a class="code" href="a00196.html#a95e9e0f8a692321b83a2e0ce2789c485">index</a>,</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;                            u_diff  );</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  global_sum = 0; <a class="code" href="a00236.html#abd61f932b070ee84262d9d98b6dd854f">MPISum_double</a>(&amp;global_sum,&amp;sum,1,&amp;mpi-&gt;<a class="code" href="a00199.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  solver-&gt;<a class="code" href="a00196.html#aaacee284a041d53cf335ae299d5eb929">rom_diff_norms</a>[1] = sqrt(global_sum/((<span class="keywordtype">double</span>)solver-&gt;<a class="code" href="a00196.html#a4e67f54563a3c4ff005dfaf0130f957c">npoints_global</a>));</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <span class="comment">/* calculate Linf norm of error */</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  sum = <a class="code" href="a00219.html#ac20bd4916c6169956e5bf80777c6ab8f">ArrayMaxnD</a>  ( solver-&gt;<a class="code" href="a00196.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;                      solver-&gt;<a class="code" href="a00196.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                      solver-&gt;<a class="code" href="a00196.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                      solver-&gt;<a class="code" href="a00196.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                      solver-&gt;<a class="code" href="a00196.html#a95e9e0f8a692321b83a2e0ce2789c485">index</a>,</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;                      u_diff  );</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  global_sum = 0; <a class="code" href="a00236.html#a33aa37e0050ec72dadb8d63851df51ec">MPIMax_double</a>(&amp;global_sum,&amp;sum,1,&amp;mpi-&gt;<a class="code" href="a00199.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  solver-&gt;<a class="code" href="a00196.html#aaacee284a041d53cf335ae299d5eb929">rom_diff_norms</a>[2] = global_sum;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <span class="comment">/* decide whether to normalize and report relative diff norms, </span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">    or report absolute diff norms. */</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <span class="keywordflow">if</span> (    (solution_norm[0] &gt; tolerance) </div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;      &amp;&amp;  (solution_norm[1] &gt; tolerance) </div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;      &amp;&amp;  (solution_norm[2] &gt; tolerance) ) {</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    solver-&gt;<a class="code" href="a00196.html#aaacee284a041d53cf335ae299d5eb929">rom_diff_norms</a>[0] /= solution_norm[0];</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    solver-&gt;<a class="code" href="a00196.html#aaacee284a041d53cf335ae299d5eb929">rom_diff_norms</a>[1] /= solution_norm[1];</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    solver-&gt;<a class="code" href="a00196.html#aaacee284a041d53cf335ae299d5eb929">rom_diff_norms</a>[2] /= solution_norm[2];</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  }</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  free(u_diff);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;}</div>
<div class="ttc" id="a00196_html_a4e67f54563a3c4ff005dfaf0130f957c"><div class="ttname"><a href="a00196.html#a4e67f54563a3c4ff005dfaf0130f957c">HyPar::npoints_global</a></div><div class="ttdeci">int npoints_global</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00038">hypar.h:38</a></div></div>
<div class="ttc" id="a00196_html_a38e0371f331cecbe63a77fa03e202afe"><div class="ttname"><a href="a00196.html#a38e0371f331cecbe63a77fa03e202afe">HyPar::dim_local</a></div><div class="ttdeci">int * dim_local</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00035">hypar.h:35</a></div></div>
<div class="ttc" id="a00219_html_ac20bd4916c6169956e5bf80777c6ab8f"><div class="ttname"><a href="a00219.html#ac20bd4916c6169956e5bf80777c6ab8f">ArrayMaxnD</a></div><div class="ttdeci">INLINE double ArrayMaxnD(int, int, int *, int, int *, double *)</div><div class="ttdef"><b>Definition:</b> <a href="a00219_source.html#l00483">arrayfunctions.h:483</a></div></div>
<div class="ttc" id="a00196_html_a95e9e0f8a692321b83a2e0ce2789c485"><div class="ttname"><a href="a00196.html#a95e9e0f8a692321b83a2e0ce2789c485">HyPar::index</a></div><div class="ttdeci">int * index</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00094">hypar.h:94</a></div></div>
<div class="ttc" id="a00219_html_a8c279db0af78d8ff386cf1a023a405dd"><div class="ttname"><a href="a00219.html#a8c279db0af78d8ff386cf1a023a405dd">ArraySumSquarenD</a></div><div class="ttdeci">INLINE double ArraySumSquarenD(int, int, int *, int, int *, double *)</div><div class="ttdef"><b>Definition:</b> <a href="a00219_source.html#l00526">arrayfunctions.h:526</a></div></div>
<div class="ttc" id="a00196_html"><div class="ttname"><a href="a00196.html">HyPar</a></div><div class="ttdoc">Structure containing all solver-specific variables and functions. </div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00023">hypar.h:23</a></div></div>
<div class="ttc" id="a00608_html_aca1295e3cf52d990f4cd1d5872f1385a"><div class="ttname"><a href="a00608.html#aca1295e3cf52d990f4cd1d5872f1385a">StdVecOps::sum</a></div><div class="ttdeci">long sum(const std::vector&lt; int &gt; &amp;a_iv)</div><div class="ttdef"><b>Definition:</b> <a href="a00251_source.html#l00018">std_vec_ops.h:18</a></div></div>
<div class="ttc" id="a00199_html_adad7a6f85831f3ac84d854b6c80aef43"><div class="ttname"><a href="a00199.html#adad7a6f85831f3ac84d854b6c80aef43">MPIVariables::world</a></div><div class="ttdeci">MPI_Comm world</div><div class="ttdef"><b>Definition:</b> <a href="a00199_source.html#l00037">mpivars_struct.h:37</a></div></div>
<div class="ttc" id="a00236_html_abd61f932b070ee84262d9d98b6dd854f"><div class="ttname"><a href="a00236.html#abd61f932b070ee84262d9d98b6dd854f">MPISum_double</a></div><div class="ttdeci">int MPISum_double(double *, double *, int, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00375_source.html#l00039">MPISum.c:39</a></div></div>
<div class="ttc" id="a00199_html_a00625"><div class="ttname"><a href="a00199.html#a00625">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a00199_source.html#l00024">mpivars_struct.h:24</a></div></div>
<div class="ttc" id="a00196_html_aaacee284a041d53cf335ae299d5eb929"><div class="ttname"><a href="a00196.html#aaacee284a041d53cf335ae299d5eb929">HyPar::rom_diff_norms</a></div><div class="ttdeci">double rom_diff_norms[3]</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00386">hypar.h:386</a></div></div>
<div class="ttc" id="a00196_html_a3b6b999a764f1e2ea94bb5f28c7a558c"><div class="ttname"><a href="a00196.html#a3b6b999a764f1e2ea94bb5f28c7a558c">HyPar::u</a></div><div class="ttdeci">double * u</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00108">hypar.h:108</a></div></div>
<div class="ttc" id="a00196_html_a484873c74138512e41bc50d17b7d955a"><div class="ttname"><a href="a00196.html#a484873c74138512e41bc50d17b7d955a">HyPar::ndims</a></div><div class="ttdeci">int ndims</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00026">hypar.h:26</a></div></div>
<div class="ttc" id="a00196_html_aac11b2a653ffaeac4b35057431f1b981"><div class="ttname"><a href="a00196.html#aac11b2a653ffaeac4b35057431f1b981">HyPar::u_rom_predicted</a></div><div class="ttdeci">double * u_rom_predicted</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00384">hypar.h:384</a></div></div>
<div class="ttc" id="a00196_html_aafc992b5fa79d5a4036024615d03bce6"><div class="ttname"><a href="a00196.html#aafc992b5fa79d5a4036024615d03bce6">HyPar::ghosts</a></div><div class="ttdeci">int ghosts</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00044">hypar.h:44</a></div></div>
<div class="ttc" id="a00196_html_ae8f6d2fd6490d3153cb4133bf183a404"><div class="ttname"><a href="a00196.html#ae8f6d2fd6490d3153cb4133bf183a404">HyPar::nvars</a></div><div class="ttdeci">int nvars</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00029">hypar.h:29</a></div></div>
<div class="ttc" id="a00196_html_a20ee1fd00a220b98513127884a5558cf"><div class="ttname"><a href="a00196.html#a20ee1fd00a220b98513127884a5558cf">HyPar::npoints_local_wghosts</a></div><div class="ttdeci">int npoints_local_wghosts</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00040">hypar.h:40</a></div></div>
<div class="ttc" id="a00219_html_a4cd66304bc41a7751842230af3063b62"><div class="ttname"><a href="a00219.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a></div><div class="ttdeci">#define _ArrayAXPY_(x, a, y, size)</div><div class="ttdef"><b>Definition:</b> <a href="a00219_source.html#l00270">arrayfunctions.h:270</a></div></div>
<div class="ttc" id="a00219_html_a89e8330d9e06dd0666c50833628a125c"><div class="ttname"><a href="a00219.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a></div><div class="ttdeci">#define _ArrayCopy1D_(x, y, size)</div><div class="ttdef"><b>Definition:</b> <a href="a00219_source.html#l00318">arrayfunctions.h:318</a></div></div>
<div class="ttc" id="a00219_html_a60a3d838d95d860a21de20936f7bb910"><div class="ttname"><a href="a00219.html#a60a3d838d95d860a21de20936f7bb910">ArraySumAbsnD</a></div><div class="ttdeci">INLINE double ArraySumAbsnD(int, int, int *, int, int *, double *)</div><div class="ttdef"><b>Definition:</b> <a href="a00219_source.html#l00507">arrayfunctions.h:507</a></div></div>
<div class="ttc" id="a00236_html_a33aa37e0050ec72dadb8d63851df51ec"><div class="ttname"><a href="a00236.html#a33aa37e0050ec72dadb8d63851df51ec">MPIMax_double</a></div><div class="ttdeci">int MPIMax_double(double *, double *, int, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00368_source.html#l00038">MPIMax.c:38</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a0f058c8fed21156da5f1f64c828b5b39"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int OutputROMSolution </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nsims</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Write ROM solutions to file</p>
<p>Write out the ROM solution to file </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>Array of simulation objects of type <a class="el" href="a00210.html#a00629" title="Structure defining a simulation. ">SimulationObject</a> </td></tr>
    <tr><td class="paramname">nsims</td><td>Number of simulation objects </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00562_source.html#l00024">24</a> of file <a class="el" href="a00562_source.html">OutputROMSolution.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;{</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  <a class="code" href="a00210.html#a00629">SimulationObject</a>* simobj = (<a class="code" href="a00210.html#a00629">SimulationObject</a>*) s;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  <span class="keywordtype">int</span> ns;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  <span class="keywordflow">for</span> (ns = 0; ns &lt; nsims; ns++) {</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <a class="code" href="a00196.html">HyPar</a>*        solver = &amp;(simobj[ns].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>);</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <a class="code" href="a00199.html#a00625">MPIVariables</a>* mpi    = &amp;(simobj[ns].<a class="code" href="a00210.html#a4afd2c7b3eb8fda452474ebdbe71c8c0">mpi</a>);</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    </div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="comment">/* if WriteOutput() is NULL, then return */</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="keywordflow">if</span> (!solver-&gt;<a class="code" href="a00196.html#a9018a1befab4079332620f40375a9661">WriteOutput</a>) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  </div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <span class="keywordtype">char</span> fname_root[<a class="code" href="a00220.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>];</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    strcpy(fname_root, solver-&gt;<a class="code" href="a00196.html#af5db0aad0268af0ba82e1281d44bb73a">op_rom_fname_root</a>);</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="keywordflow">if</span> (nsims &gt; 1) {</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;      <span class="keywordtype">char</span> index[<a class="code" href="a00220.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>];</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;      <a class="code" href="a00222.html#a3e3ad5aed581d9ae563190c365dadc41">GetStringFromInteger</a>(ns, index, (<span class="keywordtype">int</span>)log10(nsims)+1);</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;      strcat(fname_root, <span class="stringliteral">&quot;_&quot;</span>);</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;      strcat(fname_root, index);</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    }</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  </div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <a class="code" href="a00227.html#aaf888c739c5200d9c58a7154347069b0">WriteArray</a>( solver-&gt;<a class="code" href="a00196.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;                solver-&gt;<a class="code" href="a00196.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;                solver-&gt;<a class="code" href="a00196.html#aa989ebb755986852177779cdf7bd8c85">dim_global</a>,</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;                solver-&gt;<a class="code" href="a00196.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;                solver-&gt;<a class="code" href="a00196.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;                solver-&gt;<a class="code" href="a00196.html#a711aad4cbe735871dd9e91ab575c878b">x</a>,</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;                solver-&gt;<a class="code" href="a00196.html#aac11b2a653ffaeac4b35057431f1b981">u_rom_predicted</a>,</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;                solver,</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;                mpi,</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;                fname_root );</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="comment">/* increment the index string, if required */</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="keywordflow">if</span> ((!strcmp(solver-&gt;<a class="code" href="a00196.html#a5f89e286a9eaffdb66d966fa6a290d3f">output_mode</a>,<span class="stringliteral">&quot;serial&quot;</span>)) &amp;&amp; (!strcmp(solver-&gt;<a class="code" href="a00196.html#a4e93cb107e180ef982b74cef7726b70f">op_overwrite</a>,<span class="stringliteral">&quot;no&quot;</span>))) {</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;      <a class="code" href="a00293.html#a9fda82ed752188f3af821e2c30f63c21">IncrementFilenameIndex</a>(solver-&gt;<a class="code" href="a00196.html#a0805db42e429173752189696c3c96909">filename_index</a>,solver-&gt;<a class="code" href="a00196.html#af474ca4577de91b658e4399ad0a6d7b3">index_length</a>);</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    }</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  }</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  </div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;}</div>
<div class="ttc" id="a00222_html_a3e3ad5aed581d9ae563190c365dadc41"><div class="ttname"><a href="a00222.html#a3e3ad5aed581d9ae563190c365dadc41">GetStringFromInteger</a></div><div class="ttdeci">void GetStringFromInteger(int, char *, int)</div><div class="ttdef"><b>Definition:</b> <a href="a00280_source.html#l00015">CommonFunctions.c:15</a></div></div>
<div class="ttc" id="a00196_html_a38e0371f331cecbe63a77fa03e202afe"><div class="ttname"><a href="a00196.html#a38e0371f331cecbe63a77fa03e202afe">HyPar::dim_local</a></div><div class="ttdeci">int * dim_local</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00035">hypar.h:35</a></div></div>
<div class="ttc" id="a00196_html_af474ca4577de91b658e4399ad0a6d7b3"><div class="ttname"><a href="a00196.html#af474ca4577de91b658e4399ad0a6d7b3">HyPar::index_length</a></div><div class="ttdeci">int index_length</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00188">hypar.h:188</a></div></div>
<div class="ttc" id="a00196_html_af5db0aad0268af0ba82e1281d44bb73a"><div class="ttname"><a href="a00196.html#af5db0aad0268af0ba82e1281d44bb73a">HyPar::op_rom_fname_root</a></div><div class="ttdeci">char op_rom_fname_root[_MAX_STRING_SIZE_]</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00388">hypar.h:388</a></div></div>
<div class="ttc" id="a00220_html_a51efea86a4d76d1259893f606b776573"><div class="ttname"><a href="a00220.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a></div><div class="ttdeci">#define _MAX_STRING_SIZE_</div><div class="ttdef"><b>Definition:</b> <a href="a00220_source.html#l00010">basic.h:10</a></div></div>
<div class="ttc" id="a00196_html_aa989ebb755986852177779cdf7bd8c85"><div class="ttname"><a href="a00196.html#aa989ebb755986852177779cdf7bd8c85">HyPar::dim_global</a></div><div class="ttdeci">int * dim_global</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00032">hypar.h:32</a></div></div>
<div class="ttc" id="a00210_html_a523947ce4fa7128c4c767163953253b9"><div class="ttname"><a href="a00210.html#a523947ce4fa7128c4c767163953253b9">SimulationObject::solver</a></div><div class="ttdeci">HyPar solver</div><div class="ttdef"><b>Definition:</b> <a href="a00210_source.html#l00026">simulation_object.h:26</a></div></div>
<div class="ttc" id="a00196_html"><div class="ttname"><a href="a00196.html">HyPar</a></div><div class="ttdoc">Structure containing all solver-specific variables and functions. </div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00023">hypar.h:23</a></div></div>
<div class="ttc" id="a00196_html_a9018a1befab4079332620f40375a9661"><div class="ttname"><a href="a00196.html#a9018a1befab4079332620f40375a9661">HyPar::WriteOutput</a></div><div class="ttdeci">int(* WriteOutput)(int, int, int *, double *, double *, char *, int *)</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00198">hypar.h:198</a></div></div>
<div class="ttc" id="a00196_html_a0805db42e429173752189696c3c96909"><div class="ttname"><a href="a00196.html#a0805db42e429173752189696c3c96909">HyPar::filename_index</a></div><div class="ttdeci">char * filename_index</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00186">hypar.h:186</a></div></div>
<div class="ttc" id="a00227_html_aaf888c739c5200d9c58a7154347069b0"><div class="ttname"><a href="a00227.html#aaf888c739c5200d9c58a7154347069b0">WriteArray</a></div><div class="ttdeci">int WriteArray(int, int, int *, int *, int, double *, double *, void *, void *, char *)</div><div class="ttdef"><b>Definition:</b> <a href="a00344_source.html#l00027">WriteArray.c:27</a></div></div>
<div class="ttc" id="a00199_html_a00625"><div class="ttname"><a href="a00199.html#a00625">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a00199_source.html#l00024">mpivars_struct.h:24</a></div></div>
<div class="ttc" id="a00196_html_a5f89e286a9eaffdb66d966fa6a290d3f"><div class="ttname"><a href="a00196.html#a5f89e286a9eaffdb66d966fa6a290d3f">HyPar::output_mode</a></div><div class="ttdeci">char output_mode[_MAX_STRING_SIZE_]</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00175">hypar.h:175</a></div></div>
<div class="ttc" id="a00210_html_a4afd2c7b3eb8fda452474ebdbe71c8c0"><div class="ttname"><a href="a00210.html#a4afd2c7b3eb8fda452474ebdbe71c8c0">SimulationObject::mpi</a></div><div class="ttdeci">MPIVariables mpi</div><div class="ttdef"><b>Definition:</b> <a href="a00210_source.html#l00025">simulation_object.h:25</a></div></div>
<div class="ttc" id="a00196_html_a711aad4cbe735871dd9e91ab575c878b"><div class="ttname"><a href="a00196.html#a711aad4cbe735871dd9e91ab575c878b">HyPar::x</a></div><div class="ttdeci">double * x</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00099">hypar.h:99</a></div></div>
<div class="ttc" id="a00196_html_a484873c74138512e41bc50d17b7d955a"><div class="ttname"><a href="a00196.html#a484873c74138512e41bc50d17b7d955a">HyPar::ndims</a></div><div class="ttdeci">int ndims</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00026">hypar.h:26</a></div></div>
<div class="ttc" id="a00196_html_aac11b2a653ffaeac4b35057431f1b981"><div class="ttname"><a href="a00196.html#aac11b2a653ffaeac4b35057431f1b981">HyPar::u_rom_predicted</a></div><div class="ttdeci">double * u_rom_predicted</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00384">hypar.h:384</a></div></div>
<div class="ttc" id="a00196_html_aafc992b5fa79d5a4036024615d03bce6"><div class="ttname"><a href="a00196.html#aafc992b5fa79d5a4036024615d03bce6">HyPar::ghosts</a></div><div class="ttdeci">int ghosts</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00044">hypar.h:44</a></div></div>
<div class="ttc" id="a00196_html_ae8f6d2fd6490d3153cb4133bf183a404"><div class="ttname"><a href="a00196.html#ae8f6d2fd6490d3153cb4133bf183a404">HyPar::nvars</a></div><div class="ttdeci">int nvars</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00029">hypar.h:29</a></div></div>
<div class="ttc" id="a00210_html_a00629"><div class="ttname"><a href="a00210.html#a00629">SimulationObject</a></div><div class="ttdoc">Structure defining a simulation. </div><div class="ttdef"><b>Definition:</b> <a href="a00210_source.html#l00023">simulation_object.h:23</a></div></div>
<div class="ttc" id="a00196_html_a4e93cb107e180ef982b74cef7726b70f"><div class="ttname"><a href="a00196.html#a4e93cb107e180ef982b74cef7726b70f">HyPar::op_overwrite</a></div><div class="ttdeci">char op_overwrite[_MAX_STRING_SIZE_]</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00183">hypar.h:183</a></div></div>
<div class="ttc" id="a00293_html_a9fda82ed752188f3af821e2c30f63c21"><div class="ttname"><a href="a00293.html#a9fda82ed752188f3af821e2c30f63c21">IncrementFilenameIndex</a></div><div class="ttdeci">void IncrementFilenameIndex(char *f, int len)</div><div class="ttdef"><b>Definition:</b> <a href="a00293_source.html#l00046">IncrementFilename.c:46</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a63727f86c19e70bc897c86edd5015b75"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int SolvePETSc </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nsims</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>rank</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nproc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Integrate in time with PETSc. </p>
<p>This function integrates the semi-discrete ODE (obtained from discretizing the PDE in space) using the time-integration module of PETSc (<a href="https://petsc.org/release/docs/manualpages/TS/index.html">https://petsc.org/release/docs/manualpages/TS/index.html</a>). The time-integration context is set up using the parameters specified in the input file. However, they can also be specified using PETSc's command line inputs.<br/>
<br/>
See PETSc's documentation and examples for more details on how to use its TS module. All functions and data types whose names start with Vec, Mat, PC, KSP, SNES, and TS are PETSc functions - refer to the PETSc documentation (usually googling with the function name shows the man page for that function on PETSc's website). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>Array of simulation objects of type <a class="el" href="a00210.html#a00629" title="Structure defining a simulation. ">SimulationObject</a> </td></tr>
    <tr><td class="paramname">nsims</td><td>number of simulation objects </td></tr>
    <tr><td class="paramname">rank</td><td>MPI rank of this process </td></tr>
    <tr><td class="paramname">nproc</td><td>Number of MPI processes </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00568_source.html#l00050">50</a> of file <a class="el" href="a00568_source.html">SolvePETSc.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;{</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  <a class="code" href="a00210.html#a00629">SimulationObject</a>* sim = (<a class="code" href="a00210.html#a00629">SimulationObject</a>*) s;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  DM              dm; <span class="comment">/* data management object */</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  TS              ts; <span class="comment">/* time integration object */</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  Vec             Y,Z; <span class="comment">/* PETSc solution vectors */</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  Mat             A, B; <span class="comment">/* Jacobian and preconditioning matrices */</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  MatFDColoring   fdcoloring; <span class="comment">/* coloring for sparse Jacobian computation */</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  TSType          time_scheme; <span class="comment">/* time integration method */</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  TSProblemType   ptype; <span class="comment">/* problem type - nonlinear or linear */</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  <span class="keywordtype">int</span> flag_mat_a = 0, </div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;      flag_mat_b = 0, </div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;      flag_fdcoloring = 0,</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;      iAuxSize = 0, i;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  PetscFunctionBegin;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <span class="comment">/* Register custom time-integration methods, if specified */</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <a class="code" href="a00238.html#a005fac516715e5fb65baa1540a79c82c">PetscRegisterTIMethods</a>(rank);</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <span class="keywordflow">if</span>(!rank) printf(<span class="stringliteral">&quot;Setting up PETSc time integration... \n&quot;</span>);</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  <span class="comment">/* create and set a PETSc context */</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  <a class="code" href="a00205.html#a00628">PETScContext</a> context;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  context.<a class="code" href="a00205.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a> = rank;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  context.<a class="code" href="a00205.html#ae68326adc3b3862f1162832f70727b06">nproc</a> = nproc;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  context.<a class="code" href="a00205.html#a4e2f35037563217c8dc84c095af9e35f">simobj</a> = sim;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  context.<a class="code" href="a00205.html#a9a0e87291e0e8b9c1445e5482e814c92">nsims</a> = nsims;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="comment">/* default: everything explicit */</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  context.<a class="code" href="a00205.html#a376b6b34e162357d201827d01a5aa2a4">flag_hyperbolic</a>     = <a class="code" href="a00205.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>; </div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  context.<a class="code" href="a00205.html#a6a0edd627a2b2cc687d1031e3884dd6a">flag_hyperbolic_f</a>   = <a class="code" href="a00205.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>; </div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  context.<a class="code" href="a00205.html#a21b4785029b7597816341479bc3260b4">flag_hyperbolic_df</a>  = <a class="code" href="a00205.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>; </div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  context.<a class="code" href="a00205.html#ac48ad2561e5e125d2789133e848db1d9">flag_parabolic</a>      = <a class="code" href="a00205.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>; </div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  context.<a class="code" href="a00205.html#a54c0451c4ae9650a54f54246f1f8823b">flag_source</a>         = <a class="code" href="a00205.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>; </div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  context.<a class="code" href="a00205.html#a34cbd56d5136d5e8b5ea2cbb901c04cd">tic</a> = 0;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  context.<a class="code" href="a00205.html#a200f63fcca813d56a5cf3209546cedb2">flag_is_linear</a> = 0;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  context.<a class="code" href="a00205.html#a15d26af821c0659b0c602303c371405e">globalDOF</a>.clear();</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  context.<a class="code" href="a00205.html#a3968caf0290e18143989738dd36f2623">points</a>.clear();</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  context.<a class="code" href="a00205.html#afdccc5dc654297cee401e0938ffb7985">ti_runtime</a> = 0.0;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  context.<a class="code" href="a00205.html#a28e4e78c0bf258662bef21d26c51fc0b">waqt</a> = 0.0;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  context.<a class="code" href="a00205.html#a03e28be41881b703c836edbfe9b51b17">dt</a> = sim[0].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00196.html#a03e28be41881b703c836edbfe9b51b17">dt</a>;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  context.<a class="code" href="a00205.html#a22ceb3bed48bc42e41131982f61a839f">stage_times</a>.clear();</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  context.<a class="code" href="a00205.html#ad55778d618804ddb359e18c9312c1454">stage_index</a> = 0;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="preprocessor">#ifdef with_librom</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span> (!rank) printf(<span class="stringliteral">&quot;Setting up libROM interface.\n&quot;</span>);</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  context.<a class="code" href="a00205.html#af8049501def09c2e14fbec0a72c8c66c">rom_interface</a> = <span class="keyword">new</span> <a class="code" href="a00197.html">libROMInterface</a>( sim, </div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                                               nsims, </div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                                               rank, </div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                                               nproc, </div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                                               sim[0].solver.dt );</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  context.<a class="code" href="a00205.html#ae1766c1c76f0ef119388c4fa8a6d64f4">rom_mode</a> = ((<a class="code" href="a00197.html">libROMInterface</a>*)context.<a class="code" href="a00205.html#af8049501def09c2e14fbec0a72c8c66c">rom_interface</a>)-&gt;mode();</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  context.<a class="code" href="a00205.html#aac65a15cdd8e87c5c788db46e1ca0347">op_times_arr</a>.clear();</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="preprocessor">#ifdef with_librom</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span> (      (context.<a class="code" href="a00205.html#ae1766c1c76f0ef119388c4fa8a6d64f4">rom_mode</a> == <a class="code" href="a00229.html#a8d7f058ce028038a98a49ad28176390e">_ROM_MODE_TRAIN_</a>) </div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        ||  (context.<a class="code" href="a00205.html#ae1766c1c76f0ef119388c4fa8a6d64f4">rom_mode</a> == <a class="code" href="a00229.html#acc2b61eb7c1bad16328d8f4be63b70f3">_ROM_MODE_INITIAL_GUESS_</a> )</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        ||  (context.<a class="code" href="a00205.html#ae1766c1c76f0ef119388c4fa8a6d64f4">rom_mode</a> == <a class="code" href="a00229.html#a28e9ddc4d69c4a09fda0f0f39726ba16">_ROM_MODE_NONE_</a> ) ) {</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="keywordflow">if</span> (context.<a class="code" href="a00205.html#ae1766c1c76f0ef119388c4fa8a6d64f4">rom_mode</a> == <a class="code" href="a00229.html#acc2b61eb7c1bad16328d8f4be63b70f3">_ROM_MODE_INITIAL_GUESS_</a>) {</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;      ((<a class="code" href="a00197.html">libROMInterface</a>*)context.<a class="code" href="a00205.html#af8049501def09c2e14fbec0a72c8c66c">rom_interface</a>)-&gt;loadROM();</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;      ((<a class="code" href="a00197.html">libROMInterface</a>*)context.<a class="code" href="a00205.html#af8049501def09c2e14fbec0a72c8c66c">rom_interface</a>)-&gt;projectInitialSolution(sim);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    }</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="preprocessor"></span>    <a class="code" href="a00238.html#ae4a99505d5f322bfc1c590e3d31fcc0b">PetscCreatePointList</a>(&amp;context);</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  </div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="comment">/* create and initialize PETSc solution vector and other parameters */</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="comment">/* PETSc solution vector does not have ghost points */</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    VecCreate(MPI_COMM_WORLD,&amp;Y);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    VecSetSizes(Y,context.<a class="code" href="a00205.html#a578ef595dcbe28b2bde5c152c50f85e7">ndofs</a>,PETSC_DECIDE);</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    VecSetUp(Y);</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  </div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="comment">/* copy initial solution to PETSc&#39;s vector */</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ns = 0; ns &lt; nsims; ns++) {</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;      <a class="code" href="a00238.html#a6c64bea980c3a8b0a752113bbeb40cf3">TransferVecToPETSc</a>( sim[ns].solver.u,</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                          Y,</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                          &amp;context,</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                          ns,</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;                          context.<a class="code" href="a00205.html#ad2182a08b22eed3bb3b0728725841875">offsets</a>[ns] );</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    }</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  </div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="comment">/* Create the global DOF mapping for all the grid points */</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <a class="code" href="a00238.html#ae4815491f5992839fdb3949e5dedec8e">PetscGlobalDOF</a>(&amp;context);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  </div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="comment">/* Define and initialize the time-integration object */</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    TSCreate(MPI_COMM_WORLD,&amp;ts);</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    TSSetMaxSteps(ts,sim[0].solver.n_iter);</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    TSSetMaxTime(ts,sim[0].solver.dt*sim[0].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00196.html#af0d8e0d5d3de3869b941b66b6caaf964">n_iter</a>);</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    TSSetTimeStep(ts,sim[0].solver.dt);</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    TSSetTime(ts,context.<a class="code" href="a00205.html#a28e4e78c0bf258662bef21d26c51fc0b">waqt</a>);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    TSSetExactFinalTime(ts,TS_EXACTFINALTIME_MATCHSTEP);</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    TSSetType(ts,TSBEULER);</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  </div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="comment">/* set default time step adaptivity to none */</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    TSAdapt adapt;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    TSAdaptType adapt_type = TSADAPTNONE;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    TSGetAdapt(ts,&amp;adapt);</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    TSAdaptSetType(adapt,adapt_type);</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  </div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="comment">/* set options from input */</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    TSSetFromOptions(ts);</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="comment">/* create DM */</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    DMShellCreate(MPI_COMM_WORLD, &amp;dm);</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    DMShellSetGlobalVector(dm, Y);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    TSSetDM(ts, dm);</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  </div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="preprocessor">#ifdef with_librom</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="preprocessor"></span>    TSAdaptGetType(adapt,&amp;adapt_type);</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="keywordflow">if</span> (strcmp(adapt_type, TSADAPTNONE)) {</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;      <span class="keywordflow">if</span> (!rank) printf(<span class="stringliteral">&quot;Warning: libROM interface not yet implemented for adaptive timestepping.\n&quot;</span>);</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    }</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="preprocessor"></span>  </div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="comment">/* Define the right and left -hand side functions for each time-integration scheme */</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    TSGetType(ts,&amp;time_scheme);</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    TSGetProblemType(ts,&amp;ptype);</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="keywordflow">if</span> (!strcmp(time_scheme,TSARKIMEX)) {</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  </div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;      <span class="comment">/* implicit - explicit time integration */</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  </div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;      TSSetRHSFunction(ts,PETSC_NULL,<a class="code" href="a00238.html#ac7d9b0a219eb22bfd37482b741bd79c9">PetscRHSFunctionIMEX</a>,&amp;context);</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      TSSetIFunction  (ts,PETSC_NULL,<a class="code" href="a00238.html#a9d093c3140369a1178dd5b9589a926b1">PetscIFunctionIMEX</a>,  &amp;context);</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  </div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;      SNES     snes;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;      KSP      ksp;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;      PC       pc;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;      SNESType snestype;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;      TSGetSNES(ts,&amp;snes);</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;      SNESGetType(snes,&amp;snestype);</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="preprocessor">#ifdef with_librom</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="preprocessor"></span>      <span class="keywordflow">if</span> (context.<a class="code" href="a00205.html#ae1766c1c76f0ef119388c4fa8a6d64f4">rom_mode</a> == <a class="code" href="a00229.html#acc2b61eb7c1bad16328d8f4be63b70f3">_ROM_MODE_INITIAL_GUESS_</a>) {</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        SNESSetComputeInitialGuess(snes, <a class="code" href="a00238.html#ac08ff8a5b9eaa1841e573df91789801e">PetscSetInitialGuessROM</a>, &amp;context);</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      }</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="preprocessor"></span>  </div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      context.<a class="code" href="a00205.html#a271fbbfea71118710d4a2fb13eb4c1cc">flag_use_precon</a> = 0;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;      PetscOptionsGetBool(  PETSC_NULL,PETSC_NULL,</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                            <span class="stringliteral">&quot;-with_pc&quot;</span>,</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                            (PetscBool*)(&amp;context.<a class="code" href="a00205.html#a271fbbfea71118710d4a2fb13eb4c1cc">flag_use_precon</a>),</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                            PETSC_NULL );</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  </div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;      <span class="keywordtype">char</span> precon_mat_type_c_st[<a class="code" href="a00220.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>] = <span class="stringliteral">&quot;default&quot;</span>;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;      PetscOptionsGetString(  PETSC_NULL,</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                              PETSC_NULL,</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                              <span class="stringliteral">&quot;-pc_matrix_type&quot;</span>,</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                              precon_mat_type_c_st,</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                              <a class="code" href="a00220.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>,</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                              PETSC_NULL );</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;      context.<a class="code" href="a00205.html#ad54b96724204427ea885f308738485d0">precon_matrix_type</a> = std::string(precon_mat_type_c_st);</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  </div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      <span class="keywordflow">if</span> (context.<a class="code" href="a00205.html#a271fbbfea71118710d4a2fb13eb4c1cc">flag_use_precon</a>) {</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        <span class="keywordflow">if</span> (context.<a class="code" href="a00205.html#ad54b96724204427ea885f308738485d0">precon_matrix_type</a> == <span class="stringliteral">&quot;default&quot;</span>) {</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;          <span class="comment">/* Matrix-free representation of the Jacobian */</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;          flag_mat_a = 1;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;          MatCreateShell( MPI_COMM_WORLD,</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                          context.<a class="code" href="a00205.html#a578ef595dcbe28b2bde5c152c50f85e7">ndofs</a>,</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                          context.<a class="code" href="a00205.html#a578ef595dcbe28b2bde5c152c50f85e7">ndofs</a>,</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                          PETSC_DETERMINE,</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                          PETSC_DETERMINE,</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                          &amp;context,</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                          &amp;A);</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;          <span class="keywordflow">if</span> ((!strcmp(snestype,SNESKSPONLY)) || (ptype == TS_LINEAR)) {</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            <span class="comment">/* linear problem */</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;            context.<a class="code" href="a00205.html#a200f63fcca813d56a5cf3209546cedb2">flag_is_linear</a> = 1;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;            MatShellSetOperation(A,MATOP_MULT,(<span class="keywordtype">void</span> (*)(<span class="keywordtype">void</span>))<a class="code" href="a00238.html#a8778c346e27f42f0583c63909c2ea544">PetscJacobianFunctionIMEX_Linear</a>);</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;            SNESSetType(snes,SNESKSPONLY);</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;            <span class="comment">/* nonlinear problem */</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;            context.<a class="code" href="a00205.html#a200f63fcca813d56a5cf3209546cedb2">flag_is_linear</a> = 0;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;            context.<a class="code" href="a00205.html#ad62e14c19e38497048380c4a7fe10e12">jfnk_eps</a> = 1e-7;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;            PetscOptionsGetReal(NULL,NULL,<span class="stringliteral">&quot;-jfnk_epsilon&quot;</span>,&amp;context.<a class="code" href="a00205.html#ad62e14c19e38497048380c4a7fe10e12">jfnk_eps</a>,NULL);</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;            MatShellSetOperation(A,MATOP_MULT,(<span class="keywordtype">void</span> (*)(<span class="keywordtype">void</span>))<a class="code" href="a00238.html#a4edf057726501be3e8fe54e16fafe07b">PetscJacobianFunctionIMEX_JFNK</a>);</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;          }</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;          MatSetUp(A);</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;          <span class="comment">/* check if Jacobian of the physical model is defined */</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ns = 0; ns &lt; nsims; ns++) {</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;            <span class="keywordflow">if</span> ((!sim[ns].solver.JFunction) &amp;&amp; (!sim[ns].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00196.html#afb6ab1b6429dfa7e026d5a21607f2270">KFunction</a>)) {</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;              <span class="keywordflow">if</span> (!rank) {</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                fprintf(stderr,<span class="stringliteral">&quot;Error in SolvePETSc(): solver-&gt;JFunction  or solver-&gt;KFunction &quot;</span>);</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                fprintf(stderr,<span class="stringliteral">&quot;(point-wise Jacobians for hyperbolic or parabolic terms) must &quot;</span>);</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                fprintf(stderr,<span class="stringliteral">&quot;be defined for preconditioning.\n&quot;</span>);</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;              }</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;              PetscFunctionReturn(1);</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;            }</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;          }</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;          <span class="comment">/* Set up preconditioner matrix */</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;          flag_mat_b = 1;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;          MatCreateAIJ( MPI_COMM_WORLD,</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                        context.<a class="code" href="a00205.html#a578ef595dcbe28b2bde5c152c50f85e7">ndofs</a>, </div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                        context.<a class="code" href="a00205.html#a578ef595dcbe28b2bde5c152c50f85e7">ndofs</a>,</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                        PETSC_DETERMINE, </div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                        PETSC_DETERMINE,</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                        (sim[0].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00196.html#a484873c74138512e41bc50d17b7d955a">ndims</a>*2+1)*sim[0].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00196.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>, NULL,</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                        2*sim[0].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00196.html#a484873c74138512e41bc50d17b7d955a">ndims</a>*sim[0].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00196.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>, NULL,</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                        &amp;B );</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;          MatSetBlockSize(B,sim[0].solver.nvars);</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;          <span class="comment">/* Set the IJacobian function for TS */</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;          TSSetIJacobian(ts,A,B,<a class="code" href="a00238.html#a82aacb94c1481144ce3e43d40d1f04d4">PetscIJacobianIMEX</a>,&amp;context);</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (context.<a class="code" href="a00205.html#ad54b96724204427ea885f308738485d0">precon_matrix_type</a> == <span class="stringliteral">&quot;fd&quot;</span>) {</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;          flag_mat_a = 1;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;          MatCreateSNESMF(snes,&amp;A);</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;          flag_mat_b = 1;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;          MatCreateAIJ( MPI_COMM_WORLD,</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                        context.<a class="code" href="a00205.html#a578ef595dcbe28b2bde5c152c50f85e7">ndofs</a>,</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                        context.<a class="code" href="a00205.html#a578ef595dcbe28b2bde5c152c50f85e7">ndofs</a>,</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                        PETSC_DETERMINE,</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                        PETSC_DETERMINE,</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                        (sim[0].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00196.html#a484873c74138512e41bc50d17b7d955a">ndims</a>*2+1)*sim[0].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00196.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>, NULL,</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                        2*sim[0].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00196.html#a484873c74138512e41bc50d17b7d955a">ndims</a>*sim[0].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00196.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>, NULL,</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                        &amp;B);</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;          MatSetOption(B, MAT_NEW_NONZERO_ALLOCATION_ERR, PETSC_FALSE);</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;          <span class="comment">/* Set the Jacobian function for SNES */</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;          SNESSetJacobian(snes, A, B, SNESComputeJacobianDefault, NULL);</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (context.<a class="code" href="a00205.html#ad54b96724204427ea885f308738485d0">precon_matrix_type</a> == <span class="stringliteral">&quot;colored_fd&quot;</span>) {</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;          <span class="keywordtype">int</span> stencil_width = 1;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;          PetscOptionsGetInt( NULL,</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                              NULL,</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                              <span class="stringliteral">&quot;-pc_matrix_colored_fd_stencil_width&quot;</span>,</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                              &amp;stencil_width,</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                              NULL );</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;          flag_mat_a = 1;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;          MatCreateSNESMF(snes,&amp;A);</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;          flag_mat_b = 1;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;          MatCreateAIJ( MPI_COMM_WORLD,</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                        context.<a class="code" href="a00205.html#a578ef595dcbe28b2bde5c152c50f85e7">ndofs</a>,</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                        context.<a class="code" href="a00205.html#a578ef595dcbe28b2bde5c152c50f85e7">ndofs</a>,</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                        PETSC_DETERMINE,</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                        PETSC_DETERMINE,</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                        (sim[0].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00196.html#a484873c74138512e41bc50d17b7d955a">ndims</a>*2+1)*sim[0].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00196.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>, NULL,</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                        2*sim[0].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00196.html#a484873c74138512e41bc50d17b7d955a">ndims</a>*sim[0].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00196.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>, NULL,</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                        &amp;B);</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;          MatSetOption(B, MAT_NEW_NONZERO_ALLOCATION_ERR, PETSC_FALSE);</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;          <span class="keywordflow">if</span> (!rank) {</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;            printf(<span class="stringliteral">&quot;PETSc:    Setting Jacobian non-zero pattern (stencil width %d).\n&quot;</span>,</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                    stencil_width );</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;          }</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;          <a class="code" href="a00238.html#afc8c8d52959e73d04492f881ddeee22f">PetscJacobianMatNonzeroEntriesImpl</a>(B, stencil_width, &amp;context);</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;          <span class="comment">/* Set the Jacobian function for SNES */</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;          SNESSetJacobian(snes, A, B, SNESComputeJacobianDefaultColor, NULL);</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;          <span class="keywordflow">if</span> (!rank) {</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;            fprintf(  stderr,<span class="stringliteral">&quot;Invalid input for \&quot;-pc_matrix_type\&quot;: %s.\n&quot;</span>, </div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                      context.<a class="code" href="a00205.html#ad54b96724204427ea885f308738485d0">precon_matrix_type</a>.c_str());</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;          }</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;          PetscFunctionReturn(0);</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        }</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        <span class="comment">/* set PC side to right */</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        SNESGetKSP(snes,&amp;ksp);</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        KSPSetPCSide(ksp, PC_RIGHT);</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        <span class="comment">/* Matrix-free representation of the Jacobian */</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        flag_mat_a = 1;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        MatCreateShell( MPI_COMM_WORLD,</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                        context.<a class="code" href="a00205.html#a578ef595dcbe28b2bde5c152c50f85e7">ndofs</a>,</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                        context.<a class="code" href="a00205.html#a578ef595dcbe28b2bde5c152c50f85e7">ndofs</a>,</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;                        PETSC_DETERMINE,</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                        PETSC_DETERMINE,</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                        &amp;context,</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                        &amp;A);</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        <span class="keywordflow">if</span> ((!strcmp(snestype,SNESKSPONLY)) || (ptype == TS_LINEAR)) {</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;          <span class="comment">/* linear problem */</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;          context.<a class="code" href="a00205.html#a200f63fcca813d56a5cf3209546cedb2">flag_is_linear</a> = 1;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;          MatShellSetOperation(A,MATOP_MULT,(<span class="keywordtype">void</span> (*)(<span class="keywordtype">void</span>))<a class="code" href="a00238.html#a8778c346e27f42f0583c63909c2ea544">PetscJacobianFunctionIMEX_Linear</a>);</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;          SNESSetType(snes,SNESKSPONLY);</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;          <span class="comment">/* nonlinear problem */</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;          context.<a class="code" href="a00205.html#a200f63fcca813d56a5cf3209546cedb2">flag_is_linear</a> = 0;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;          context.<a class="code" href="a00205.html#ad62e14c19e38497048380c4a7fe10e12">jfnk_eps</a> = 1e-7;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;          PetscOptionsGetReal(NULL,NULL,<span class="stringliteral">&quot;-jfnk_epsilon&quot;</span>,&amp;context.<a class="code" href="a00205.html#ad62e14c19e38497048380c4a7fe10e12">jfnk_eps</a>,NULL);</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;          MatShellSetOperation(A,MATOP_MULT,(<span class="keywordtype">void</span> (*)(<span class="keywordtype">void</span>))<a class="code" href="a00238.html#a4edf057726501be3e8fe54e16fafe07b">PetscJacobianFunctionIMEX_JFNK</a>);</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        }</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        MatSetUp(A);</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        <span class="comment">/* Set the RHSJacobian function for TS */</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        TSSetIJacobian(ts,A,A,<a class="code" href="a00238.html#a82aacb94c1481144ce3e43d40d1f04d4">PetscIJacobianIMEX</a>,&amp;context);</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        <span class="comment">/* Set PC (preconditioner) to none */</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        SNESGetKSP(snes,&amp;ksp);</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        KSPGetPC(ksp,&amp;pc);</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        PCSetType(pc,PCNONE);</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;      }</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;      <span class="comment">/* read the implicit/explicit flags for each of the terms for IMEX schemes */</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;      <span class="comment">/* default -&gt; hyperbolic - explicit, parabolic and source - implicit       */</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;      PetscBool flag = PETSC_FALSE;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  </div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;      context.<a class="code" href="a00205.html#a376b6b34e162357d201827d01a5aa2a4">flag_hyperbolic</a>     = <a class="code" href="a00205.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>; </div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;      context.<a class="code" href="a00205.html#a6a0edd627a2b2cc687d1031e3884dd6a">flag_hyperbolic_f</a>   = <a class="code" href="a00205.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>; </div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;      context.<a class="code" href="a00205.html#a21b4785029b7597816341479bc3260b4">flag_hyperbolic_df</a>  = <a class="code" href="a00205.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>; </div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;      context.<a class="code" href="a00205.html#ac48ad2561e5e125d2789133e848db1d9">flag_parabolic</a>      = <a class="code" href="a00205.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>; </div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;      context.<a class="code" href="a00205.html#a54c0451c4ae9650a54f54246f1f8823b">flag_source</a>         = <a class="code" href="a00205.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>; </div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  </div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;      <span class="keywordflow">if</span> (!strcmp(sim[0].solver.SplitHyperbolicFlux,<span class="stringliteral">&quot;yes&quot;</span>)) {</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  </div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        flag = PETSC_FALSE; </div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        PetscOptionsGetBool(PETSC_NULL,PETSC_NULL,<span class="stringliteral">&quot;-hyperbolic_f_explicit&quot;</span>,&amp;flag,PETSC_NULL);</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        <span class="keywordflow">if</span> (flag == PETSC_TRUE) context.<a class="code" href="a00205.html#a6a0edd627a2b2cc687d1031e3884dd6a">flag_hyperbolic_f</a> = <a class="code" href="a00205.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>; </div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        flag = PETSC_FALSE; </div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        PetscOptionsGetBool(PETSC_NULL,PETSC_NULL,<span class="stringliteral">&quot;-hyperbolic_f_implicit&quot;</span>,&amp;flag,PETSC_NULL);</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        <span class="keywordflow">if</span> (flag == PETSC_TRUE) context.<a class="code" href="a00205.html#a6a0edd627a2b2cc687d1031e3884dd6a">flag_hyperbolic_f</a> = <a class="code" href="a00205.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>; </div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  </div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        flag = PETSC_FALSE; </div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        PetscOptionsGetBool(PETSC_NULL,PETSC_NULL,<span class="stringliteral">&quot;-hyperbolic_df_explicit&quot;</span>,&amp;flag,PETSC_NULL);</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        <span class="keywordflow">if</span> (flag == PETSC_TRUE) context.<a class="code" href="a00205.html#a21b4785029b7597816341479bc3260b4">flag_hyperbolic_df</a> = <a class="code" href="a00205.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>; </div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        flag = PETSC_FALSE; </div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        PetscOptionsGetBool(PETSC_NULL,PETSC_NULL,<span class="stringliteral">&quot;-hyperbolic_df_implicit&quot;</span>,&amp;flag,PETSC_NULL);</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        <span class="keywordflow">if</span> (flag == PETSC_TRUE) context.<a class="code" href="a00205.html#a21b4785029b7597816341479bc3260b4">flag_hyperbolic_df</a> = <a class="code" href="a00205.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>; </div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  </div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  </div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        flag = PETSC_FALSE; </div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        PetscOptionsGetBool(PETSC_NULL,PETSC_NULL,<span class="stringliteral">&quot;-hyperbolic_explicit&quot;</span>,&amp;flag,PETSC_NULL);</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        <span class="keywordflow">if</span> (flag == PETSC_TRUE) context.<a class="code" href="a00205.html#a376b6b34e162357d201827d01a5aa2a4">flag_hyperbolic</a> = <a class="code" href="a00205.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>; </div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        flag = PETSC_FALSE; </div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        PetscOptionsGetBool(PETSC_NULL,PETSC_NULL,<span class="stringliteral">&quot;-hyperbolic_implicit&quot;</span>,&amp;flag,PETSC_NULL);</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        <span class="keywordflow">if</span> (flag == PETSC_TRUE) context.<a class="code" href="a00205.html#a376b6b34e162357d201827d01a5aa2a4">flag_hyperbolic</a> = <a class="code" href="a00205.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>; </div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  </div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;      }</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  </div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;      flag = PETSC_FALSE; </div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;      PetscOptionsGetBool(PETSC_NULL,PETSC_NULL,<span class="stringliteral">&quot;-parabolic_explicit&quot;</span>,&amp;flag,PETSC_NULL);</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;      <span class="keywordflow">if</span> (flag == PETSC_TRUE) context.<a class="code" href="a00205.html#ac48ad2561e5e125d2789133e848db1d9">flag_parabolic</a> = <a class="code" href="a00205.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>; </div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;      flag = PETSC_FALSE; </div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;      PetscOptionsGetBool(PETSC_NULL,PETSC_NULL,<span class="stringliteral">&quot;-parabolic_implicit&quot;</span>,&amp;flag,PETSC_NULL);</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;      <span class="keywordflow">if</span> (flag == PETSC_TRUE) context.<a class="code" href="a00205.html#ac48ad2561e5e125d2789133e848db1d9">flag_parabolic</a> = <a class="code" href="a00205.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>; </div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  </div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;      flag = PETSC_FALSE; </div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;      PetscOptionsGetBool(PETSC_NULL,PETSC_NULL,<span class="stringliteral">&quot;-source_explicit&quot;</span>,&amp;flag,PETSC_NULL);</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;      <span class="keywordflow">if</span> (flag == PETSC_TRUE) context.<a class="code" href="a00205.html#a54c0451c4ae9650a54f54246f1f8823b">flag_source</a> = <a class="code" href="a00205.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>; </div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;      flag = PETSC_FALSE; </div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;      PetscOptionsGetBool(PETSC_NULL,PETSC_NULL,<span class="stringliteral">&quot;-source_implicit&quot;</span>,&amp;flag,PETSC_NULL);</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;      <span class="keywordflow">if</span> (flag == PETSC_TRUE) context.<a class="code" href="a00205.html#a54c0451c4ae9650a54f54246f1f8823b">flag_source</a> = <a class="code" href="a00205.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>; </div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  </div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;      flag = PETSC_FALSE;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;      PetscOptionsGetBool(PETSC_NULL,PETSC_NULL,<span class="stringliteral">&quot;-ts_arkimex_fully_implicit&quot;</span>,&amp;flag,PETSC_NULL);</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;      <span class="keywordflow">if</span> (flag == PETSC_TRUE) {</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        context.<a class="code" href="a00205.html#a6a0edd627a2b2cc687d1031e3884dd6a">flag_hyperbolic_f</a>   = <a class="code" href="a00205.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        context.<a class="code" href="a00205.html#a21b4785029b7597816341479bc3260b4">flag_hyperbolic_df</a>  = <a class="code" href="a00205.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        context.<a class="code" href="a00205.html#a376b6b34e162357d201827d01a5aa2a4">flag_hyperbolic</a>     = <a class="code" href="a00205.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>;</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        context.<a class="code" href="a00205.html#ac48ad2561e5e125d2789133e848db1d9">flag_parabolic</a>      = <a class="code" href="a00205.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        context.<a class="code" href="a00205.html#a54c0451c4ae9650a54f54246f1f8823b">flag_source</a>         = <a class="code" href="a00205.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;      }</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  </div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;      <span class="comment">/* print out a summary of the treatment of each term */</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;      <span class="keywordflow">if</span> (!rank) {</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        printf(<span class="stringliteral">&quot;Implicit-Explicit time-integration:-\n&quot;</span>);</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        <span class="keywordflow">if</span> (!strcmp(sim[0].solver.SplitHyperbolicFlux,<span class="stringliteral">&quot;yes&quot;</span>)) {</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;          <span class="keywordflow">if</span> (context.<a class="code" href="a00205.html#a6a0edd627a2b2cc687d1031e3884dd6a">flag_hyperbolic_f</a> == <a class="code" href="a00205.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>)  printf(<span class="stringliteral">&quot;Hyperbolic (f-df) term: Explicit\n&quot;</span>);</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;          <span class="keywordflow">else</span>                                          printf(<span class="stringliteral">&quot;Hyperbolic (f-df) term: Implicit\n&quot;</span>);</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;          <span class="keywordflow">if</span> (context.<a class="code" href="a00205.html#a21b4785029b7597816341479bc3260b4">flag_hyperbolic_df</a> == <a class="code" href="a00205.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>) printf(<span class="stringliteral">&quot;Hyperbolic (df)   term: Explicit\n&quot;</span>);</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;          <span class="keywordflow">else</span>                                          printf(<span class="stringliteral">&quot;Hyperbolic (df)   term: Implicit\n&quot;</span>);</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;          <span class="keywordflow">if</span> (context.<a class="code" href="a00205.html#a376b6b34e162357d201827d01a5aa2a4">flag_hyperbolic</a> == <a class="code" href="a00205.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>)    printf(<span class="stringliteral">&quot;Hyperbolic        term: Explicit\n&quot;</span>);</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;          <span class="keywordflow">else</span>                                          printf(<span class="stringliteral">&quot;Hyperbolic        term: Implicit\n&quot;</span>);</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        }</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;        <span class="keywordflow">if</span> (context.<a class="code" href="a00205.html#ac48ad2561e5e125d2789133e848db1d9">flag_parabolic</a> == <a class="code" href="a00205.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>)       printf(<span class="stringliteral">&quot;Parabolic         term: Explicit\n&quot;</span>);</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        <span class="keywordflow">else</span>                                            printf(<span class="stringliteral">&quot;Parabolic         term: Implicit\n&quot;</span>);</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;        <span class="keywordflow">if</span> (context.<a class="code" href="a00205.html#a54c0451c4ae9650a54f54246f1f8823b">flag_source</a>    == <a class="code" href="a00205.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>)       printf(<span class="stringliteral">&quot;Source            term: Explicit\n&quot;</span>);</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        <span class="keywordflow">else</span>                                            printf(<span class="stringliteral">&quot;Source            term: Implicit\n&quot;</span>);</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;      }</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  </div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (     (!strcmp(time_scheme,TSEULER)) </div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;                ||  (!strcmp(time_scheme,TSRK   )) </div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                ||  (!strcmp(time_scheme,TSSSP  )) ) {</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;  </div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;      <span class="comment">/* Explicit time integration */</span>    </div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;      TSSetRHSFunction(ts,PETSC_NULL,<a class="code" href="a00238.html#ac67533553372ed2b44b32d095c775f5c">PetscRHSFunctionExpl</a>,&amp;context);</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  </div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (     (!strcmp(time_scheme,TSCN)) </div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                ||  (!strcmp(time_scheme,TSBEULER )) ) {</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  </div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  </div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;      <span class="comment">/* Implicit time integration */</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;  </div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;      TSSetIFunction(ts,PETSC_NULL,<a class="code" href="a00238.html#ab816b9eb288130e9343b070f93c813cd">PetscIFunctionImpl</a>,&amp;context);</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  </div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;      SNES     snes;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;      KSP      ksp;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;      PC       pc;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;      SNESType snestype;</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;      TSGetSNES(ts,&amp;snes);</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;      SNESGetType(snes,&amp;snestype);</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  </div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="preprocessor">#ifdef with_librom</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="preprocessor"></span>      <span class="keywordflow">if</span> (context.<a class="code" href="a00205.html#ae1766c1c76f0ef119388c4fa8a6d64f4">rom_mode</a> == <a class="code" href="a00229.html#acc2b61eb7c1bad16328d8f4be63b70f3">_ROM_MODE_INITIAL_GUESS_</a>) {</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        SNESSetComputeInitialGuess(snes, <a class="code" href="a00238.html#ac08ff8a5b9eaa1841e573df91789801e">PetscSetInitialGuessROM</a>, &amp;context);</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;      }</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="preprocessor"></span>  </div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;      context.<a class="code" href="a00205.html#a271fbbfea71118710d4a2fb13eb4c1cc">flag_use_precon</a> = 0;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;      PetscOptionsGetBool(  PETSC_NULL,</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                            PETSC_NULL,</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                            <span class="stringliteral">&quot;-with_pc&quot;</span>,</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                            (PetscBool*)(&amp;context.<a class="code" href="a00205.html#a271fbbfea71118710d4a2fb13eb4c1cc">flag_use_precon</a>),</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                            PETSC_NULL );</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  </div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;      <span class="keywordtype">char</span> precon_mat_type_c_st[<a class="code" href="a00220.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>] = <span class="stringliteral">&quot;default&quot;</span>;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;      PetscOptionsGetString(  PETSC_NULL,</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                              PETSC_NULL,</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;                              <span class="stringliteral">&quot;-pc_matrix_type&quot;</span>,</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;                              precon_mat_type_c_st,</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                              <a class="code" href="a00220.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>,</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;                              PETSC_NULL );</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;      context.<a class="code" href="a00205.html#ad54b96724204427ea885f308738485d0">precon_matrix_type</a> = std::string(precon_mat_type_c_st);</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  </div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;      <span class="keywordflow">if</span> (context.<a class="code" href="a00205.html#a271fbbfea71118710d4a2fb13eb4c1cc">flag_use_precon</a>) {</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        <span class="keywordflow">if</span> (context.<a class="code" href="a00205.html#ad54b96724204427ea885f308738485d0">precon_matrix_type</a> == <span class="stringliteral">&quot;default&quot;</span>) {</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;          <span class="comment">/* Matrix-free representation of the Jacobian */</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;          flag_mat_a = 1;</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;          MatCreateShell( MPI_COMM_WORLD,</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;                          context.<a class="code" href="a00205.html#a578ef595dcbe28b2bde5c152c50f85e7">ndofs</a>,</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                          context.<a class="code" href="a00205.html#a578ef595dcbe28b2bde5c152c50f85e7">ndofs</a>,</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;                          PETSC_DETERMINE,</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;                          PETSC_DETERMINE,</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;                          &amp;context,</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;                          &amp;A);</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;          <span class="keywordflow">if</span> ((!strcmp(snestype,SNESKSPONLY)) || (ptype == TS_LINEAR)) {</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;            <span class="comment">/* linear problem */</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;            context.<a class="code" href="a00205.html#a200f63fcca813d56a5cf3209546cedb2">flag_is_linear</a> = 1;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;            MatShellSetOperation(A,MATOP_MULT,(<span class="keywordtype">void</span> (*)(<span class="keywordtype">void</span>))<a class="code" href="a00238.html#abed41de2efef801be98f8338aa2672f2">PetscJacobianFunction_Linear</a>);</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;            SNESSetType(snes,SNESKSPONLY);</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;            <span class="comment">/* nonlinear problem */</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;            context.<a class="code" href="a00205.html#a200f63fcca813d56a5cf3209546cedb2">flag_is_linear</a> = 0;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;            context.<a class="code" href="a00205.html#ad62e14c19e38497048380c4a7fe10e12">jfnk_eps</a> = 1e-7;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;            PetscOptionsGetReal(NULL,NULL,<span class="stringliteral">&quot;-jfnk_epsilon&quot;</span>,&amp;context.<a class="code" href="a00205.html#ad62e14c19e38497048380c4a7fe10e12">jfnk_eps</a>,NULL);</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;            MatShellSetOperation(A,MATOP_MULT,(<span class="keywordtype">void</span> (*)(<span class="keywordtype">void</span>))<a class="code" href="a00238.html#a68f5a93a79d56fcb964224f649af4ac9">PetscJacobianFunction_JFNK</a>);</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;          }</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;          MatSetUp(A);</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;          <span class="comment">/* check if Jacobian of the physical model is defined */</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ns = 0; ns &lt; nsims; ns++) {</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;            <span class="keywordflow">if</span> ((!sim[ns].solver.JFunction) &amp;&amp; (!sim[ns].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00196.html#afb6ab1b6429dfa7e026d5a21607f2270">KFunction</a>)) {</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;              <span class="keywordflow">if</span> (!rank) {</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;                fprintf(stderr,<span class="stringliteral">&quot;Error in SolvePETSc(): solver-&gt;JFunction  or solver-&gt;KFunction &quot;</span>);</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;                fprintf(stderr,<span class="stringliteral">&quot;(point-wise Jacobians for hyperbolic or parabolic terms) must &quot;</span>);</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                fprintf(stderr,<span class="stringliteral">&quot;be defined for preconditioning.\n&quot;</span>);</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;              }</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;              PetscFunctionReturn(1);</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;            }</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;          }</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;          <span class="comment">/* Set up preconditioner matrix */</span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;          flag_mat_b = 1;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;          MatCreateAIJ( MPI_COMM_WORLD,</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;                        context.<a class="code" href="a00205.html#a578ef595dcbe28b2bde5c152c50f85e7">ndofs</a>, </div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;                        context.<a class="code" href="a00205.html#a578ef595dcbe28b2bde5c152c50f85e7">ndofs</a>,</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;                        PETSC_DETERMINE, </div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;                        PETSC_DETERMINE,</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                        (sim[0].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00196.html#a484873c74138512e41bc50d17b7d955a">ndims</a>*2+1)*sim[0].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00196.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>, NULL,</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;                        2*sim[0].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00196.html#a484873c74138512e41bc50d17b7d955a">ndims</a>*sim[0].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00196.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>, NULL,</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;                        &amp;B );</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;          MatSetBlockSize(B,sim[0].solver.nvars);</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;          <span class="comment">/* Set the IJacobian function for TS */</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;          TSSetIJacobian(ts,A,B,<a class="code" href="a00238.html#a3d6a695a879ec54937525109ac912355">PetscIJacobian</a>,&amp;context);</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (context.<a class="code" href="a00205.html#ad54b96724204427ea885f308738485d0">precon_matrix_type</a> == <span class="stringliteral">&quot;fd&quot;</span>) {</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;          flag_mat_a = 1;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;          MatCreateSNESMF(snes,&amp;A);</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;          flag_mat_b = 1;</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;          MatCreateAIJ( MPI_COMM_WORLD,</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                        context.<a class="code" href="a00205.html#a578ef595dcbe28b2bde5c152c50f85e7">ndofs</a>,</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;                        context.<a class="code" href="a00205.html#a578ef595dcbe28b2bde5c152c50f85e7">ndofs</a>,</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                        PETSC_DETERMINE,</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                        PETSC_DETERMINE,</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;                        (sim[0].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00196.html#a484873c74138512e41bc50d17b7d955a">ndims</a>*2+1)*sim[0].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00196.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>, NULL,</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                        2*sim[0].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00196.html#a484873c74138512e41bc50d17b7d955a">ndims</a>*sim[0].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00196.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>, NULL,</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;                        &amp;B);</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;          MatSetOption(B, MAT_NEW_NONZERO_ALLOCATION_ERR, PETSC_FALSE);</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;          <span class="comment">/* Set the Jacobian function for SNES */</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;          SNESSetJacobian(snes, A, B, SNESComputeJacobianDefault, NULL);</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (context.<a class="code" href="a00205.html#ad54b96724204427ea885f308738485d0">precon_matrix_type</a> == <span class="stringliteral">&quot;colored_fd&quot;</span>) {</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;          <span class="keywordtype">int</span> stencil_width = 1;</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;          PetscOptionsGetInt( NULL,</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;                              NULL,</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;                              <span class="stringliteral">&quot;-pc_matrix_colored_fd_stencil_width&quot;</span>,</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;                              &amp;stencil_width,</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;                              NULL );</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;          flag_mat_a = 1;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;          MatCreateSNESMF(snes,&amp;A);</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;          flag_mat_b = 1;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;          MatCreateAIJ( MPI_COMM_WORLD,</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;                        context.<a class="code" href="a00205.html#a578ef595dcbe28b2bde5c152c50f85e7">ndofs</a>,</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;                        context.<a class="code" href="a00205.html#a578ef595dcbe28b2bde5c152c50f85e7">ndofs</a>,</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                        PETSC_DETERMINE,</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                        PETSC_DETERMINE,</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                        (sim[0].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00196.html#a484873c74138512e41bc50d17b7d955a">ndims</a>*2+1)*sim[0].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00196.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>, NULL,</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                        2*sim[0].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00196.html#a484873c74138512e41bc50d17b7d955a">ndims</a>*sim[0].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00196.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>, NULL,</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;                        &amp;B);</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;          MatSetOption(B, MAT_NEW_NONZERO_ALLOCATION_ERR, PETSC_FALSE);</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;          <span class="keywordflow">if</span> (!rank) {</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;            printf(<span class="stringliteral">&quot;PETSc:    Setting Jacobian non-zero pattern (stencil width %d).\n&quot;</span>,</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;                    stencil_width );</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;          }</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;          <a class="code" href="a00238.html#afc8c8d52959e73d04492f881ddeee22f">PetscJacobianMatNonzeroEntriesImpl</a>(B, stencil_width, &amp;context);</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;          <span class="comment">/* Set the Jacobian function for SNES */</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;          SNESSetJacobian(snes, A, B, SNESComputeJacobianDefaultColor, NULL);</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;          <span class="keywordflow">if</span> (!rank) {</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;            fprintf(  stderr,<span class="stringliteral">&quot;Invalid input for \&quot;-pc_matrix_type\&quot;: %s.\n&quot;</span>, </div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;                      context.<a class="code" href="a00205.html#ad54b96724204427ea885f308738485d0">precon_matrix_type</a>.c_str());</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;          }</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;          PetscFunctionReturn(0);</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        }</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;        <span class="comment">/* set PC side to right */</span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        SNESGetKSP(snes,&amp;ksp);</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;        KSPSetPCSide(ksp, PC_RIGHT);</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;        <span class="comment">/* Matrix-free representation of the Jacobian */</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        flag_mat_a = 1;</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;        MatCreateShell( MPI_COMM_WORLD,</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;                        context.<a class="code" href="a00205.html#a578ef595dcbe28b2bde5c152c50f85e7">ndofs</a>,</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;                        context.<a class="code" href="a00205.html#a578ef595dcbe28b2bde5c152c50f85e7">ndofs</a>,</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;                        PETSC_DETERMINE,</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;                        PETSC_DETERMINE,</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;                        &amp;context,</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;                        &amp;A);</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        <span class="keywordflow">if</span> ((!strcmp(snestype,SNESKSPONLY)) || (ptype == TS_LINEAR)) {</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;          <span class="comment">/* linear problem */</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;          context.<a class="code" href="a00205.html#a200f63fcca813d56a5cf3209546cedb2">flag_is_linear</a> = 1;</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;          MatShellSetOperation(A,MATOP_MULT,(<span class="keywordtype">void</span> (*)(<span class="keywordtype">void</span>))<a class="code" href="a00238.html#abed41de2efef801be98f8338aa2672f2">PetscJacobianFunction_Linear</a>);</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;          SNESSetType(snes,SNESKSPONLY);</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;          <span class="comment">/* nonlinear problem */</span></div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;          context.<a class="code" href="a00205.html#a200f63fcca813d56a5cf3209546cedb2">flag_is_linear</a> = 0;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;          context.<a class="code" href="a00205.html#ad62e14c19e38497048380c4a7fe10e12">jfnk_eps</a> = 1e-7;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;          PetscOptionsGetReal(NULL,NULL,<span class="stringliteral">&quot;-jfnk_epsilon&quot;</span>,&amp;context.<a class="code" href="a00205.html#ad62e14c19e38497048380c4a7fe10e12">jfnk_eps</a>,NULL);</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;          MatShellSetOperation(A,MATOP_MULT,(<span class="keywordtype">void</span> (*)(<span class="keywordtype">void</span>))<a class="code" href="a00238.html#a68f5a93a79d56fcb964224f649af4ac9">PetscJacobianFunction_JFNK</a>);</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        }</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;        MatSetUp(A);</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        <span class="comment">/* Set the RHSJacobian function for TS */</span></div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;        TSSetIJacobian(ts,A,A,<a class="code" href="a00238.html#a3d6a695a879ec54937525109ac912355">PetscIJacobian</a>,&amp;context);</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;        <span class="comment">/* Set PC (preconditioner) to none */</span></div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        SNESGetKSP(snes,&amp;ksp);</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        KSPGetPC(ksp,&amp;pc);</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        PCSetType(pc,PCNONE);</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;      }</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;  </div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;      <span class="keywordflow">if</span> (!rank) {</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;        fprintf(stderr, <span class="stringliteral">&quot;Time integration type %s is not yet supported.\n&quot;</span>, time_scheme);</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;      }</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;      PetscFunctionReturn(0);</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    }</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;  </div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    <span class="comment">/* Set pre/post-stage and post-timestep function */</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    TSSetPreStep (ts,<a class="code" href="a00238.html#ace222db5eadd0e0bd27229641e43fa9b">PetscPreTimeStep</a> );</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    TSSetPreStage(ts,<a class="code" href="a00238.html#aa52bad03c15488a2119b794d0e70deed">PetscPreStage</a>    );</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    TSSetPostStage(ts,<a class="code" href="a00238.html#ad1f357f94c228ba9ff45275064ca162b">PetscPostStage</a>  );</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    TSSetPostStep(ts,<a class="code" href="a00238.html#a3f7397f8cd5e90306fb7f02edecb3782">PetscPostTimeStep</a>);</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    <span class="comment">/* Set solution vector for TS */</span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    TSSetSolution(ts,Y);</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    <span class="comment">/* Set it all up */</span></div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    TSSetUp(ts);</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <span class="comment">/* Set application context */</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    TSSetApplicationContext(ts,&amp;context);</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;  </div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    <span class="keywordflow">if</span> (!rank) {</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;      <span class="keywordflow">if</span> (context.<a class="code" href="a00205.html#a200f63fcca813d56a5cf3209546cedb2">flag_is_linear</a>) printf(<span class="stringliteral">&quot;SolvePETSc(): Problem type is linear.\n&quot;</span>);</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;      <span class="keywordflow">else</span>                        printf(<span class="stringliteral">&quot;SolvePETSc(): Problem type is nonlinear.\n&quot;</span>);</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    }</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;  </div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    <span class="keywordflow">if</span> (!rank) printf(<span class="stringliteral">&quot;** Starting PETSc time integration **\n&quot;</span>);</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    context.<a class="code" href="a00205.html#afdccc5dc654297cee401e0938ffb7985">ti_runtime</a> = 0.0;</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    TSSolve(ts,Y);</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    <span class="keywordflow">if</span> (!rank) {</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;      printf(<span class="stringliteral">&quot;** Completed PETSc time integration (Final time: %f), total wctime: %f (seconds) **\n&quot;</span>,</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;              context.<a class="code" href="a00205.html#a28e4e78c0bf258662bef21d26c51fc0b">waqt</a>, context.<a class="code" href="a00205.html#afdccc5dc654297cee401e0938ffb7985">ti_runtime</a> );</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    }</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;  </div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    <span class="comment">/* Get the number of time steps */</span></div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ns = 0; ns &lt; nsims; ns++) {</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;      TSGetStepNumber(ts,&amp;(sim[ns].solver.n_iter));</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    }</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;  </div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    <span class="comment">/* get and write to file any auxiliary solutions */</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    <span class="keywordtype">char</span> aux_fname_root[4] = <span class="stringliteral">&quot;ts0&quot;</span>;</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    TSGetSolutionComponents(ts,&amp;iAuxSize,NULL);</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    <span class="keywordflow">if</span> (iAuxSize) {</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;      <span class="keywordflow">if</span> (iAuxSize &gt; 10) iAuxSize = 10;</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;      <span class="keywordflow">if</span> (!rank) printf(<span class="stringliteral">&quot;Number of auxiliary solutions from time integration: %d\n&quot;</span>,iAuxSize);</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;      VecDuplicate(Y,&amp;Z);</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;      <span class="keywordflow">for</span> (i=0; i&lt;iAuxSize; i++) {</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        TSGetSolutionComponents(ts,&amp;i,&amp;Z);</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ns = 0; ns &lt; nsims; ns++) {</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;          <a class="code" href="a00238.html#a9f443ff08a9a8852ab1e9cabb793ddaa">TransferVecFromPETSc</a>(sim[ns].solver.u,Z,&amp;context,ns,context.<a class="code" href="a00205.html#ad2182a08b22eed3bb3b0728725841875">offsets</a>[ns]);</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;          <a class="code" href="a00227.html#aaf888c739c5200d9c58a7154347069b0">WriteArray</a>( sim[ns].solver.ndims,</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;                      sim[ns].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00196.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;                      sim[ns].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00196.html#aa989ebb755986852177779cdf7bd8c85">dim_global</a>,</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;                      sim[ns].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00196.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;                      sim[ns].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00196.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;                      sim[ns].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00196.html#a711aad4cbe735871dd9e91ab575c878b">x</a>,</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;                      sim[ns].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00196.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>,</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;                      &amp;(sim[ns].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>),</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;                      &amp;(sim[ns].<a class="code" href="a00210.html#a4afd2c7b3eb8fda452474ebdbe71c8c0">mpi</a>),</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;                      aux_fname_root );</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;        }</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;        aux_fname_root[2]++;</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;      }</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;      VecDestroy(&amp;Z);</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    }</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;  </div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    <span class="comment">/* if available, get error estimates */</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    <a class="code" href="a00238.html#ab501847c597b0c20dff03d95a663b9b4">PetscTimeError</a>(ts);</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;  </div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    <span class="comment">/* copy final solution from PETSc&#39;s vector */</span></div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ns = 0; ns &lt; nsims; ns++) {</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;      <a class="code" href="a00238.html#a9f443ff08a9a8852ab1e9cabb793ddaa">TransferVecFromPETSc</a>(sim[ns].solver.u,Y,&amp;context,ns,context.<a class="code" href="a00205.html#ad2182a08b22eed3bb3b0728725841875">offsets</a>[ns]);</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    }</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;  </div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    <span class="comment">/* clean up */</span></div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    VecDestroy(&amp;Y);</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    <span class="keywordflow">if</span> (flag_mat_a) { MatDestroy(&amp;A); }</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    <span class="keywordflow">if</span> (flag_mat_b) { MatDestroy(&amp;B); }</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <span class="keywordflow">if</span> (flag_fdcoloring) { MatFDColoringDestroy(&amp;fdcoloring); }</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    TSDestroy(&amp;ts);</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    DMDestroy(&amp;dm);</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;  </div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    <span class="comment">/* write a final solution file, if last iteration did not write one */</span></div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    <span class="keywordflow">if</span> (context.<a class="code" href="a00205.html#a34cbd56d5136d5e8b5ea2cbb901c04cd">tic</a>) { </div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ns = 0; ns &lt; nsims; ns++) {</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;        <a class="code" href="a00196.html">HyPar</a>* solver = &amp;(sim[ns].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>);</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;        <a class="code" href="a00199.html#a00625">MPIVariables</a>* mpi = &amp;(sim[ns].<a class="code" href="a00210.html#a4afd2c7b3eb8fda452474ebdbe71c8c0">mpi</a>);</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;        <span class="keywordflow">if</span> (solver-&gt;<a class="code" href="a00196.html#ab4c55736e92f7d72f04b8a957d82b054">PhysicsOutput</a>) {</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;          solver-&gt;<a class="code" href="a00196.html#ab4c55736e92f7d72f04b8a957d82b054">PhysicsOutput</a>(solver,mpi);</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;        }</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;        <a class="code" href="a00288.html#a52e8c83d9dad55f9a6b967e63dc5f4bc">CalculateError</a>(solver,mpi);</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;      }</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;      <a class="code" href="a00388.html#a5981de613724cb667e98aa872157534e">OutputSolution</a>(sim, nsims); </div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    }</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    <span class="comment">/* calculate error if exact solution has been provided */</span></div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ns = 0; ns &lt; nsims; ns++) {</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;      <a class="code" href="a00288.html#a52e8c83d9dad55f9a6b967e63dc5f4bc">CalculateError</a>(&amp;(sim[ns].solver), &amp;(sim[ns].mpi));</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    }</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;  </div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    <a class="code" href="a00238.html#a52781b615afd6404c69c93dd0aa82924">PetscCleanup</a>(&amp;context);</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;<span class="preprocessor">#ifdef with_librom</span></div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;<span class="preprocessor"></span>    context.<a class="code" href="a00205.html#aac65a15cdd8e87c5c788db46e1ca0347">op_times_arr</a>.push_back(context.<a class="code" href="a00205.html#a28e4e78c0bf258662bef21d26c51fc0b">waqt</a>);</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ns = 0; ns &lt; nsims; ns++) {</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;      <a class="code" href="a00293.html#ad22799259c966d7dcc526452eaf7e855">ResetFilenameIndex</a>( sim[ns].solver.<a class="code" href="a00196.html#a0805db42e429173752189696c3c96909">filename_index</a>, </div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;                          sim[ns].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00196.html#af474ca4577de91b658e4399ad0a6d7b3">index_length</a> );</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    }</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;  </div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    <span class="keywordflow">if</span> (((<a class="code" href="a00197.html">libROMInterface</a>*)context.<a class="code" href="a00205.html#af8049501def09c2e14fbec0a72c8c66c">rom_interface</a>)-&gt;mode() == <a class="code" href="a00229.html#a8d7f058ce028038a98a49ad28176390e">_ROM_MODE_TRAIN_</a>) {</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;  </div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;      ((<a class="code" href="a00197.html">libROMInterface</a>*)context.<a class="code" href="a00205.html#af8049501def09c2e14fbec0a72c8c66c">rom_interface</a>)-&gt;train();</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;      <span class="keywordflow">if</span> (!rank) printf(<span class="stringliteral">&quot;libROM: total training wallclock time: %f (seconds).\n&quot;</span>, </div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;                        ((<a class="code" href="a00197.html">libROMInterface</a>*)context.<a class="code" href="a00205.html#af8049501def09c2e14fbec0a72c8c66c">rom_interface</a>)-&gt;trainWallclockTime() );</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;      <span class="keywordtype">double</span> total_rom_predict_time = 0;</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iter = 0; iter &lt; context.<a class="code" href="a00205.html#aac65a15cdd8e87c5c788db46e1ca0347">op_times_arr</a>.size(); iter++) {</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;  </div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;        <span class="keywordtype">double</span> waqt = context.<a class="code" href="a00205.html#aac65a15cdd8e87c5c788db46e1ca0347">op_times_arr</a>[iter];</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;  </div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;        ((<a class="code" href="a00197.html">libROMInterface</a>*)context.<a class="code" href="a00205.html#af8049501def09c2e14fbec0a72c8c66c">rom_interface</a>)-&gt;predict(sim, waqt);</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        <span class="keywordflow">if</span> (!rank) printf(  <span class="stringliteral">&quot;libROM: Predicted solution at time %1.4e using ROM, wallclock time: %f.\n&quot;</span>, </div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;                            waqt, ((<a class="code" href="a00197.html">libROMInterface</a>*)context.<a class="code" href="a00205.html#af8049501def09c2e14fbec0a72c8c66c">rom_interface</a>)-&gt;predictWallclockTime() );</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;        total_rom_predict_time += ((<a class="code" href="a00197.html">libROMInterface</a>*)context.<a class="code" href="a00205.html#af8049501def09c2e14fbec0a72c8c66c">rom_interface</a>)-&gt;predictWallclockTime();</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;  </div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;        <span class="comment">/* calculate diff between ROM and PDE solutions */</span></div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;        <span class="keywordflow">if</span> (iter == (context.<a class="code" href="a00205.html#aac65a15cdd8e87c5c788db46e1ca0347">op_times_arr</a>.size()-1)) {</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;          <span class="keywordflow">if</span> (!rank) printf(<span class="stringliteral">&quot;libROM:   Calculating diff between PDE and ROM solutions.\n&quot;</span>);</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ns = 0; ns &lt; nsims; ns++) {</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;            <a class="code" href="a00289.html#accb3d8778a793486e72e06f817ef16fc">CalculateROMDiff</a>(  &amp;(sim[ns].solver),</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;                               &amp;(sim[ns].mpi) );</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;          }</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;        }</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;        <span class="comment">/* write the ROM solution to file */</span></div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;        <a class="code" href="a00562.html#a11343894048fd842093253bbbb407700">OutputROMSolution</a>(sim, nsims); </div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;  </div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;      }</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;      <span class="keywordflow">if</span> (!rank) {</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;        printf( <span class="stringliteral">&quot;libROM: total prediction/query wallclock time: %f (seconds).\n&quot;</span>,</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;                total_rom_predict_time );</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;      }</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;      ((<a class="code" href="a00197.html">libROMInterface</a>*)context.<a class="code" href="a00205.html#af8049501def09c2e14fbec0a72c8c66c">rom_interface</a>)-&gt;saveROM();</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ns = 0; ns &lt; nsims; ns++) {</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;        sim[ns].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00196.html#aaacee284a041d53cf335ae299d5eb929">rom_diff_norms</a>[0]</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;          = sim[ns].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00196.html#aaacee284a041d53cf335ae299d5eb929">rom_diff_norms</a>[1]</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;          = sim[ns].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00196.html#aaacee284a041d53cf335ae299d5eb929">rom_diff_norms</a>[2]</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;          = -1;</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;      }</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    }</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (context.<a class="code" href="a00205.html#ae1766c1c76f0ef119388c4fa8a6d64f4">rom_mode</a> == <a class="code" href="a00229.html#a3035c57e07a432c8274e63259a0d506d">_ROM_MODE_PREDICT_</a>) {</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ns = 0; ns &lt; nsims; ns++) {</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;      sim[ns].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00196.html#aaacee284a041d53cf335ae299d5eb929">rom_diff_norms</a>[0]</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;        = sim[ns].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00196.html#aaacee284a041d53cf335ae299d5eb929">rom_diff_norms</a>[1]</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        = sim[ns].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00196.html#aaacee284a041d53cf335ae299d5eb929">rom_diff_norms</a>[2]</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;        = -1;</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;      strcpy(sim[ns].solver.<a class="code" href="a00196.html#ac92c34fe456d92c694eacd2231f5a7b1">ConservationCheck</a>,<span class="stringliteral">&quot;no&quot;</span>);</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    }</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    ((<a class="code" href="a00197.html">libROMInterface</a>*)context.<a class="code" href="a00205.html#af8049501def09c2e14fbec0a72c8c66c">rom_interface</a>)-&gt;loadROM();</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    ((<a class="code" href="a00197.html">libROMInterface</a>*)context.<a class="code" href="a00205.html#af8049501def09c2e14fbec0a72c8c66c">rom_interface</a>)-&gt;projectInitialSolution(sim);</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    {</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;      <span class="keywordtype">int</span> start_iter = sim[0].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00196.html#aafb41b96563d9966e8e9f458751f2960">restart_iter</a>;</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;      <span class="keywordtype">int</span> n_iter = sim[0].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00196.html#af0d8e0d5d3de3869b941b66b6caaf964">n_iter</a>;</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;      <span class="keywordtype">double</span> dt = sim[0].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00196.html#a03e28be41881b703c836edbfe9b51b17">dt</a>;</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;  </div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;      <span class="keywordtype">double</span> cur_time = start_iter * dt;</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;      context.<a class="code" href="a00205.html#aac65a15cdd8e87c5c788db46e1ca0347">op_times_arr</a>.push_back(cur_time);</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;  </div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iter = start_iter; iter &lt; n_iter; iter++) {</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;        cur_time += dt;</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;        <span class="keywordflow">if</span> (    ( (iter+1)%sim[0].solver.<a class="code" href="a00196.html#a6ff746b30ee55a3bbb9f3306c145f27a">file_op_iter</a> == 0)</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;            &amp;&amp;  ( (iter+1) &lt; n_iter) ) {</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;          context.<a class="code" href="a00205.html#aac65a15cdd8e87c5c788db46e1ca0347">op_times_arr</a>.push_back(cur_time);</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;        }</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;      }</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;  </div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;      <span class="keywordtype">double</span> t_final = n_iter*dt;</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;      context.<a class="code" href="a00205.html#aac65a15cdd8e87c5c788db46e1ca0347">op_times_arr</a>.push_back(t_final);</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;    }</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    <span class="keywordtype">double</span> total_rom_predict_time = 0;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iter = 0; iter &lt; context.<a class="code" href="a00205.html#aac65a15cdd8e87c5c788db46e1ca0347">op_times_arr</a>.size(); iter++) {</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;  </div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;      <span class="keywordtype">double</span> waqt = context.<a class="code" href="a00205.html#aac65a15cdd8e87c5c788db46e1ca0347">op_times_arr</a>[iter];</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;  </div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;      ((<a class="code" href="a00197.html">libROMInterface</a>*)context.<a class="code" href="a00205.html#af8049501def09c2e14fbec0a72c8c66c">rom_interface</a>)-&gt;predict(sim, waqt);</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;      <span class="keywordflow">if</span> (!rank) printf(  <span class="stringliteral">&quot;libROM: Predicted solution at time %1.4e using ROM, wallclock time: %f.\n&quot;</span>, </div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;                          waqt, ((<a class="code" href="a00197.html">libROMInterface</a>*)context.<a class="code" href="a00205.html#af8049501def09c2e14fbec0a72c8c66c">rom_interface</a>)-&gt;predictWallclockTime() );</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;      total_rom_predict_time += ((<a class="code" href="a00197.html">libROMInterface</a>*)context.<a class="code" href="a00205.html#af8049501def09c2e14fbec0a72c8c66c">rom_interface</a>)-&gt;predictWallclockTime();</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;  </div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;      <span class="comment">/* write the solution to file */</span></div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ns = 0; ns &lt; nsims; ns++) {</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;        <span class="keywordflow">if</span> (sim[ns].solver.<a class="code" href="a00196.html#ab4c55736e92f7d72f04b8a957d82b054">PhysicsOutput</a>) {</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;          sim[ns].<a class="code" href="a00210.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00196.html#ab4c55736e92f7d72f04b8a957d82b054">PhysicsOutput</a>( &amp;(sim[ns].solver),</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;                                        &amp;(sim[ns].mpi) );</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;        }</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;      }</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;      <a class="code" href="a00388.html#a5981de613724cb667e98aa872157534e">OutputSolution</a>(sim, nsims); </div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;  </div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    }</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    <span class="comment">/* calculate error if exact solution has been provided */</span></div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ns = 0; ns &lt; nsims; ns++) {</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;      <a class="code" href="a00288.html#a52e8c83d9dad55f9a6b967e63dc5f4bc">CalculateError</a>(&amp;(sim[ns].solver),</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;                     &amp;(sim[ns].mpi) );</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    }</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    <span class="keywordflow">if</span> (!rank) {</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;      printf( <span class="stringliteral">&quot;libROM: total prediction/query wallclock time: %f (seconds).\n&quot;</span>,</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;              total_rom_predict_time );</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    }</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;  }</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;  <span class="keyword">delete</span> ((<a class="code" href="a00197.html">libROMInterface</a>*)context.<a class="code" href="a00205.html#af8049501def09c2e14fbec0a72c8c66c">rom_interface</a>);</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;  PetscFunctionReturn(0);</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;}</div>
<div class="ttc" id="a00196_html_a38e0371f331cecbe63a77fa03e202afe"><div class="ttname"><a href="a00196.html#a38e0371f331cecbe63a77fa03e202afe">HyPar::dim_local</a></div><div class="ttdeci">int * dim_local</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00035">hypar.h:35</a></div></div>
<div class="ttc" id="a00205_html_a28e4e78c0bf258662bef21d26c51fc0b"><div class="ttname"><a href="a00205.html#a28e4e78c0bf258662bef21d26c51fc0b">PETScContext::waqt</a></div><div class="ttdeci">double waqt</div><div class="ttdef"><b>Definition:</b> <a href="a00205_source.html#l00060">petscinterface_struct.h:60</a></div></div>
<div class="ttc" id="a00196_html_af474ca4577de91b658e4399ad0a6d7b3"><div class="ttname"><a href="a00196.html#af474ca4577de91b658e4399ad0a6d7b3">HyPar::index_length</a></div><div class="ttdeci">int index_length</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00188">hypar.h:188</a></div></div>
<div class="ttc" id="a00205_html_a200f63fcca813d56a5cf3209546cedb2"><div class="ttname"><a href="a00205.html#a200f63fcca813d56a5cf3209546cedb2">PETScContext::flag_is_linear</a></div><div class="ttdeci">int flag_is_linear</div><div class="ttdef"><b>Definition:</b> <a href="a00205_source.html#l00113">petscinterface_struct.h:113</a></div></div>
<div class="ttc" id="a00229_html_a3035c57e07a432c8274e63259a0d506d"><div class="ttname"><a href="a00229.html#a3035c57e07a432c8274e63259a0d506d">_ROM_MODE_PREDICT_</a></div><div class="ttdeci">#define _ROM_MODE_PREDICT_</div><div class="ttdef"><b>Definition:</b> <a href="a00229_source.html#l00016">librom_interface.h:16</a></div></div>
<div class="ttc" id="a00238_html_ae4a99505d5f322bfc1c590e3d31fcc0b"><div class="ttname"><a href="a00238.html#ae4a99505d5f322bfc1c590e3d31fcc0b">PetscCreatePointList</a></div><div class="ttdeci">int PetscCreatePointList(void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00379_source.html#l00025">PetscCreatePointList.cpp:25</a></div></div>
<div class="ttc" id="a00238_html_ab501847c597b0c20dff03d95a663b9b4"><div class="ttname"><a href="a00238.html#ab501847c597b0c20dff03d95a663b9b4">PetscTimeError</a></div><div class="ttdeci">PetscErrorCode PetscTimeError(TS)</div><div class="ttdef"><b>Definition:</b> <a href="a00380_source.html#l00020">PetscError.cpp:20</a></div></div>
<div class="ttc" id="a00205_html_afdccc5dc654297cee401e0938ffb7985"><div class="ttname"><a href="a00205.html#afdccc5dc654297cee401e0938ffb7985">PETScContext::ti_runtime</a></div><div class="ttdeci">double ti_runtime</div><div class="ttdef"><b>Definition:</b> <a href="a00205_source.html#l00133">petscinterface_struct.h:133</a></div></div>
<div class="ttc" id="a00238_html_afc8c8d52959e73d04492f881ddeee22f"><div class="ttname"><a href="a00238.html#afc8c8d52959e73d04492f881ddeee22f">PetscJacobianMatNonzeroEntriesImpl</a></div><div class="ttdeci">int PetscJacobianMatNonzeroEntriesImpl(Mat, int, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00386_source.html#l00038">PetscJacobianMatNonzeroEntriesImpl.cpp:38</a></div></div>
<div class="ttc" id="a00205_html_ad55778d618804ddb359e18c9312c1454"><div class="ttname"><a href="a00205.html#ad55778d618804ddb359e18c9312c1454">PETScContext::stage_index</a></div><div class="ttdeci">int stage_index</div><div class="ttdef"><b>Definition:</b> <a href="a00205_source.html#l00072">petscinterface_struct.h:72</a></div></div>
<div class="ttc" id="a00220_html_a51efea86a4d76d1259893f606b776573"><div class="ttname"><a href="a00220.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a></div><div class="ttdeci">#define _MAX_STRING_SIZE_</div><div class="ttdef"><b>Definition:</b> <a href="a00220_source.html#l00010">basic.h:10</a></div></div>
<div class="ttc" id="a00238_html_a3d6a695a879ec54937525109ac912355"><div class="ttname"><a href="a00238.html#a3d6a695a879ec54937525109ac912355">PetscIJacobian</a></div><div class="ttdeci">PetscErrorCode PetscIJacobian(TS, PetscReal, Vec, Vec, PetscReal, Mat, Mat, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00384_source.html#l00052">PetscIJacobian.cpp:52</a></div></div>
<div class="ttc" id="a00229_html_acc2b61eb7c1bad16328d8f4be63b70f3"><div class="ttname"><a href="a00229.html#acc2b61eb7c1bad16328d8f4be63b70f3">_ROM_MODE_INITIAL_GUESS_</a></div><div class="ttdeci">#define _ROM_MODE_INITIAL_GUESS_</div><div class="ttdef"><b>Definition:</b> <a href="a00229_source.html#l00019">librom_interface.h:19</a></div></div>
<div class="ttc" id="a00205_html_a271fbbfea71118710d4a2fb13eb4c1cc"><div class="ttname"><a href="a00205.html#a271fbbfea71118710d4a2fb13eb4c1cc">PETScContext::flag_use_precon</a></div><div class="ttdeci">int flag_use_precon</div><div class="ttdef"><b>Definition:</b> <a href="a00205_source.html#l00107">petscinterface_struct.h:107</a></div></div>
<div class="ttc" id="a00196_html_aafb41b96563d9966e8e9f458751f2960"><div class="ttname"><a href="a00196.html#aafb41b96563d9966e8e9f458751f2960">HyPar::restart_iter</a></div><div class="ttdeci">int restart_iter</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00050">hypar.h:50</a></div></div>
<div class="ttc" id="a00205_html_a376b6b34e162357d201827d01a5aa2a4"><div class="ttname"><a href="a00205.html#a376b6b34e162357d201827d01a5aa2a4">PETScContext::flag_hyperbolic</a></div><div class="ttdeci">int flag_hyperbolic</div><div class="ttdef"><b>Definition:</b> <a href="a00205_source.html#l00096">petscinterface_struct.h:96</a></div></div>
<div class="ttc" id="a00196_html_aa989ebb755986852177779cdf7bd8c85"><div class="ttname"><a href="a00196.html#aa989ebb755986852177779cdf7bd8c85">HyPar::dim_global</a></div><div class="ttdeci">int * dim_global</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00032">hypar.h:32</a></div></div>
<div class="ttc" id="a00205_html_ad62e14c19e38497048380c4a7fe10e12"><div class="ttname"><a href="a00205.html#ad62e14c19e38497048380c4a7fe10e12">PETScContext::jfnk_eps</a></div><div class="ttdeci">double jfnk_eps</div><div class="ttdef"><b>Definition:</b> <a href="a00205_source.html#l00116">petscinterface_struct.h:116</a></div></div>
<div class="ttc" id="a00388_html_a5981de613724cb667e98aa872157534e"><div class="ttname"><a href="a00388.html#a5981de613724cb667e98aa872157534e">OutputSolution</a></div><div class="ttdeci">int OutputSolution(void *, int)</div><div class="ttdef"><b>Definition:</b> <a href="a00563_source.html#l00022">OutputSolution.c:22</a></div></div>
<div class="ttc" id="a00210_html_a523947ce4fa7128c4c767163953253b9"><div class="ttname"><a href="a00210.html#a523947ce4fa7128c4c767163953253b9">SimulationObject::solver</a></div><div class="ttdeci">HyPar solver</div><div class="ttdef"><b>Definition:</b> <a href="a00210_source.html#l00026">simulation_object.h:26</a></div></div>
<div class="ttc" id="a00562_html_a11343894048fd842093253bbbb407700"><div class="ttname"><a href="a00562.html#a11343894048fd842093253bbbb407700">OutputROMSolution</a></div><div class="ttdeci">int OutputROMSolution(void *s, int nsims)</div><div class="ttdef"><b>Definition:</b> <a href="a00562_source.html#l00024">OutputROMSolution.c:24</a></div></div>
<div class="ttc" id="a00205_html_a9a0e87291e0e8b9c1445e5482e814c92"><div class="ttname"><a href="a00205.html#a9a0e87291e0e8b9c1445e5482e814c92">PETScContext::nsims</a></div><div class="ttdeci">int nsims</div><div class="ttdef"><b>Definition:</b> <a href="a00205_source.html#l00054">petscinterface_struct.h:54</a></div></div>
<div class="ttc" id="a00229_html_a8d7f058ce028038a98a49ad28176390e"><div class="ttname"><a href="a00229.html#a8d7f058ce028038a98a49ad28176390e">_ROM_MODE_TRAIN_</a></div><div class="ttdeci">#define _ROM_MODE_TRAIN_</div><div class="ttdef"><b>Definition:</b> <a href="a00229_source.html#l00014">librom_interface.h:14</a></div></div>
<div class="ttc" id="a00205_html_aad212f0cfa337a32e39d307f8708eca7"><div class="ttname"><a href="a00205.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a></div><div class="ttdeci">#define _IMPLICIT_</div><div class="ttdef"><b>Definition:</b> <a href="a00205_source.html#l00029">petscinterface_struct.h:29</a></div></div>
<div class="ttc" id="a00196_html"><div class="ttname"><a href="a00196.html">HyPar</a></div><div class="ttdoc">Structure containing all solver-specific variables and functions. </div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00023">hypar.h:23</a></div></div>
<div class="ttc" id="a00196_html_a03e28be41881b703c836edbfe9b51b17"><div class="ttname"><a href="a00196.html#a03e28be41881b703c836edbfe9b51b17">HyPar::dt</a></div><div class="ttdeci">double dt</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00059">hypar.h:59</a></div></div>
<div class="ttc" id="a00205_html_a54c0451c4ae9650a54f54246f1f8823b"><div class="ttname"><a href="a00205.html#a54c0451c4ae9650a54f54246f1f8823b">PETScContext::flag_source</a></div><div class="ttdeci">int flag_source</div><div class="ttdef"><b>Definition:</b> <a href="a00205_source.html#l00104">petscinterface_struct.h:104</a></div></div>
<div class="ttc" id="a00205_html_ae1766c1c76f0ef119388c4fa8a6d64f4"><div class="ttname"><a href="a00205.html#ae1766c1c76f0ef119388c4fa8a6d64f4">PETScContext::rom_mode</a></div><div class="ttdeci">std::string rom_mode</div><div class="ttdef"><b>Definition:</b> <a href="a00205_source.html#l00139">petscinterface_struct.h:139</a></div></div>
<div class="ttc" id="a00205_html_a578ef595dcbe28b2bde5c152c50f85e7"><div class="ttname"><a href="a00205.html#a578ef595dcbe28b2bde5c152c50f85e7">PETScContext::ndofs</a></div><div class="ttdeci">int ndofs</div><div class="ttdef"><b>Definition:</b> <a href="a00205_source.html#l00083">petscinterface_struct.h:83</a></div></div>
<div class="ttc" id="a00238_html_ac67533553372ed2b44b32d095c775f5c"><div class="ttname"><a href="a00238.html#ac67533553372ed2b44b32d095c775f5c">PetscRHSFunctionExpl</a></div><div class="ttdeci">PetscErrorCode PetscRHSFunctionExpl(TS, PetscReal, Vec, Vec, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00392_source.html#l00036">PetscRHSFunctionExpl.cpp:36</a></div></div>
<div class="ttc" id="a00205_html_a22ceb3bed48bc42e41131982f61a839f"><div class="ttname"><a href="a00205.html#a22ceb3bed48bc42e41131982f61a839f">PETScContext::stage_times</a></div><div class="ttdeci">std::vector&lt; double &gt; stage_times</div><div class="ttdef"><b>Definition:</b> <a href="a00205_source.html#l00069">petscinterface_struct.h:69</a></div></div>
<div class="ttc" id="a00205_html_aac65a15cdd8e87c5c788db46e1ca0347"><div class="ttname"><a href="a00205.html#aac65a15cdd8e87c5c788db46e1ca0347">PETScContext::op_times_arr</a></div><div class="ttdeci">std::vector&lt; double &gt; op_times_arr</div><div class="ttdef"><b>Definition:</b> <a href="a00205_source.html#l00141">petscinterface_struct.h:141</a></div></div>
<div class="ttc" id="a00238_html_ad1f357f94c228ba9ff45275064ca162b"><div class="ttname"><a href="a00238.html#ad1f357f94c228ba9ff45275064ca162b">PetscPostStage</a></div><div class="ttdeci">PetscErrorCode PetscPostStage(TS, PetscReal, PetscInt, Vec *)</div><div class="ttdef"><b>Definition:</b> <a href="a00387_source.html#l00016">PetscPostStage.cpp:16</a></div></div>
<div class="ttc" id="a00196_html_a0805db42e429173752189696c3c96909"><div class="ttname"><a href="a00196.html#a0805db42e429173752189696c3c96909">HyPar::filename_index</a></div><div class="ttdeci">char * filename_index</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00186">hypar.h:186</a></div></div>
<div class="ttc" id="a00205_html_a15d26af821c0659b0c602303c371405e"><div class="ttname"><a href="a00205.html#a15d26af821c0659b0c602303c371405e">PETScContext::globalDOF</a></div><div class="ttdeci">std::vector&lt; double * &gt; globalDOF</div><div class="ttdef"><b>Definition:</b> <a href="a00205_source.html#l00124">petscinterface_struct.h:124</a></div></div>
<div class="ttc" id="a00238_html_abed41de2efef801be98f8338aa2672f2"><div class="ttname"><a href="a00238.html#abed41de2efef801be98f8338aa2672f2">PetscJacobianFunction_Linear</a></div><div class="ttdeci">PetscErrorCode PetscJacobianFunction_Linear(Mat, Vec, Vec)</div><div class="ttdef"><b>Definition:</b> <a href="a00384_source.html#l00236">PetscIJacobian.cpp:236</a></div></div>
<div class="ttc" id="a00227_html_aaf888c739c5200d9c58a7154347069b0"><div class="ttname"><a href="a00227.html#aaf888c739c5200d9c58a7154347069b0">WriteArray</a></div><div class="ttdeci">int WriteArray(int, int, int *, int *, int, double *, double *, void *, void *, char *)</div><div class="ttdef"><b>Definition:</b> <a href="a00344_source.html#l00027">WriteArray.c:27</a></div></div>
<div class="ttc" id="a00205_html_a3968caf0290e18143989738dd36f2623"><div class="ttname"><a href="a00205.html#a3968caf0290e18143989738dd36f2623">PETScContext::points</a></div><div class="ttdeci">std::vector&lt; int * &gt; points</div><div class="ttdef"><b>Definition:</b> <a href="a00205_source.html#l00089">petscinterface_struct.h:89</a></div></div>
<div class="ttc" id="a00238_html_a82aacb94c1481144ce3e43d40d1f04d4"><div class="ttname"><a href="a00238.html#a82aacb94c1481144ce3e43d40d1f04d4">PetscIJacobianIMEX</a></div><div class="ttdeci">PetscErrorCode PetscIJacobianIMEX(TS, PetscReal, Vec, Vec, PetscReal, Mat, Mat, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00385_source.html#l00061">PetscIJacobianIMEX.cpp:61</a></div></div>
<div class="ttc" id="a00205_html_a4e2f35037563217c8dc84c095af9e35f"><div class="ttname"><a href="a00205.html#a4e2f35037563217c8dc84c095af9e35f">PETScContext::simobj</a></div><div class="ttdeci">void * simobj</div><div class="ttdef"><b>Definition:</b> <a href="a00205_source.html#l00051">petscinterface_struct.h:51</a></div></div>
<div class="ttc" id="a00199_html_a00625"><div class="ttname"><a href="a00199.html#a00625">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a00199_source.html#l00024">mpivars_struct.h:24</a></div></div>
<div class="ttc" id="a00205_html_a34cbd56d5136d5e8b5ea2cbb901c04cd"><div class="ttname"><a href="a00205.html#a34cbd56d5136d5e8b5ea2cbb901c04cd">PETScContext::tic</a></div><div class="ttdeci">int tic</div><div class="ttdef"><b>Definition:</b> <a href="a00205_source.html#l00075">petscinterface_struct.h:75</a></div></div>
<div class="ttc" id="a00196_html_ab4c55736e92f7d72f04b8a957d82b054"><div class="ttname"><a href="a00196.html#ab4c55736e92f7d72f04b8a957d82b054">HyPar::PhysicsOutput</a></div><div class="ttdeci">int(* PhysicsOutput)(void *, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00328">hypar.h:328</a></div></div>
<div class="ttc" id="a00238_html_a52781b615afd6404c69c93dd0aa82924"><div class="ttname"><a href="a00238.html#a52781b615afd6404c69c93dd0aa82924">PetscCleanup</a></div><div class="ttdeci">int PetscCleanup(void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00376_source.html#l00012">PetscCleanup.cpp:12</a></div></div>
<div class="ttc" id="a00238_html_a6c64bea980c3a8b0a752113bbeb40cf3"><div class="ttname"><a href="a00238.html#a6c64bea980c3a8b0a752113bbeb40cf3">TransferVecToPETSc</a></div><div class="ttdeci">int TransferVecToPETSc(const double *const, Vec, void *, const int, const int)</div><div class="ttdef"><b>Definition:</b> <a href="a00396_source.html#l00024">TransferToPETSc.cpp:24</a></div></div>
<div class="ttc" id="a00238_html_a9d093c3140369a1178dd5b9589a926b1"><div class="ttname"><a href="a00238.html#a9d093c3140369a1178dd5b9589a926b1">PetscIFunctionIMEX</a></div><div class="ttdeci">PetscErrorCode PetscIFunctionIMEX(TS, PetscReal, Vec, Vec, Vec, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00382_source.html#l00053">PetscIFunctionIMEX.cpp:53</a></div></div>
<div class="ttc" id="a00238_html_ac7d9b0a219eb22bfd37482b741bd79c9"><div class="ttname"><a href="a00238.html#ac7d9b0a219eb22bfd37482b741bd79c9">PetscRHSFunctionIMEX</a></div><div class="ttdeci">PetscErrorCode PetscRHSFunctionIMEX(TS, PetscReal, Vec, Vec, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00393_source.html#l00049">PetscRHSFunctionIMEX.cpp:49</a></div></div>
<div class="ttc" id="a00293_html_ad22799259c966d7dcc526452eaf7e855"><div class="ttname"><a href="a00293.html#ad22799259c966d7dcc526452eaf7e855">ResetFilenameIndex</a></div><div class="ttdeci">void ResetFilenameIndex(char *f, int len)</div><div class="ttdef"><b>Definition:</b> <a href="a00293_source.html#l00064">IncrementFilename.c:64</a></div></div>
<div class="ttc" id="a00205_html_a00628"><div class="ttname"><a href="a00205.html#a00628">PETScContext</a></div><div class="ttdoc">Structure containing the variables for time-integration with PETSc. </div><div class="ttdef"><b>Definition:</b> <a href="a00205_source.html#l00042">petscinterface_struct.h:42</a></div></div>
<div class="ttc" id="a00238_html_a8778c346e27f42f0583c63909c2ea544"><div class="ttname"><a href="a00238.html#a8778c346e27f42f0583c63909c2ea544">PetscJacobianFunctionIMEX_Linear</a></div><div class="ttdeci">PetscErrorCode PetscJacobianFunctionIMEX_Linear(Mat, Vec, Vec)</div><div class="ttdef"><b>Definition:</b> <a href="a00385_source.html#l00290">PetscIJacobianIMEX.cpp:290</a></div></div>
<div class="ttc" id="a00205_html_a21b4785029b7597816341479bc3260b4"><div class="ttname"><a href="a00205.html#a21b4785029b7597816341479bc3260b4">PETScContext::flag_hyperbolic_df</a></div><div class="ttdeci">int flag_hyperbolic_df</div><div class="ttdef"><b>Definition:</b> <a href="a00205_source.html#l00100">petscinterface_struct.h:100</a></div></div>
<div class="ttc" id="a00196_html_aaacee284a041d53cf335ae299d5eb929"><div class="ttname"><a href="a00196.html#aaacee284a041d53cf335ae299d5eb929">HyPar::rom_diff_norms</a></div><div class="ttdeci">double rom_diff_norms[3]</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00386">hypar.h:386</a></div></div>
<div class="ttc" id="a00238_html_ac08ff8a5b9eaa1841e573df91789801e"><div class="ttname"><a href="a00238.html#ac08ff8a5b9eaa1841e573df91789801e">PetscSetInitialGuessROM</a></div><div class="ttdeci">PetscErrorCode PetscSetInitialGuessROM(SNES, Vec, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00394_source.html#l00018">PetscSetInitialGuessROM.cpp:18</a></div></div>
<div class="ttc" id="a00238_html_ace222db5eadd0e0bd27229641e43fa9b"><div class="ttname"><a href="a00238.html#ace222db5eadd0e0bd27229641e43fa9b">PetscPreTimeStep</a></div><div class="ttdeci">PetscErrorCode PetscPreTimeStep(TS)</div><div class="ttdef"><b>Definition:</b> <a href="a00390_source.html#l00024">PetscPreTimeStep.cpp:24</a></div></div>
<div class="ttc" id="a00205_html_ad54b96724204427ea885f308738485d0"><div class="ttname"><a href="a00205.html#ad54b96724204427ea885f308738485d0">PETScContext::precon_matrix_type</a></div><div class="ttdeci">std::string precon_matrix_type</div><div class="ttdef"><b>Definition:</b> <a href="a00205_source.html#l00110">petscinterface_struct.h:110</a></div></div>
<div class="ttc" id="a00210_html_a4afd2c7b3eb8fda452474ebdbe71c8c0"><div class="ttname"><a href="a00210.html#a4afd2c7b3eb8fda452474ebdbe71c8c0">SimulationObject::mpi</a></div><div class="ttdeci">MPIVariables mpi</div><div class="ttdef"><b>Definition:</b> <a href="a00210_source.html#l00025">simulation_object.h:25</a></div></div>
<div class="ttc" id="a00196_html_a711aad4cbe735871dd9e91ab575c878b"><div class="ttname"><a href="a00196.html#a711aad4cbe735871dd9e91ab575c878b">HyPar::x</a></div><div class="ttdeci">double * x</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00099">hypar.h:99</a></div></div>
<div class="ttc" id="a00205_html_a6a0edd627a2b2cc687d1031e3884dd6a"><div class="ttname"><a href="a00205.html#a6a0edd627a2b2cc687d1031e3884dd6a">PETScContext::flag_hyperbolic_f</a></div><div class="ttdeci">int flag_hyperbolic_f</div><div class="ttdef"><b>Definition:</b> <a href="a00205_source.html#l00098">petscinterface_struct.h:98</a></div></div>
<div class="ttc" id="a00196_html_a3b6b999a764f1e2ea94bb5f28c7a558c"><div class="ttname"><a href="a00196.html#a3b6b999a764f1e2ea94bb5f28c7a558c">HyPar::u</a></div><div class="ttdeci">double * u</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00108">hypar.h:108</a></div></div>
<div class="ttc" id="a00196_html_afb6ab1b6429dfa7e026d5a21607f2270"><div class="ttname"><a href="a00196.html#afb6ab1b6429dfa7e026d5a21607f2270">HyPar::KFunction</a></div><div class="ttdeci">int(* KFunction)(double *, double *, void *, int, int)</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00313">hypar.h:313</a></div></div>
<div class="ttc" id="a00196_html_a484873c74138512e41bc50d17b7d955a"><div class="ttname"><a href="a00196.html#a484873c74138512e41bc50d17b7d955a">HyPar::ndims</a></div><div class="ttdeci">int ndims</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00026">hypar.h:26</a></div></div>
<div class="ttc" id="a00238_html_a4edf057726501be3e8fe54e16fafe07b"><div class="ttname"><a href="a00238.html#a4edf057726501be3e8fe54e16fafe07b">PetscJacobianFunctionIMEX_JFNK</a></div><div class="ttdeci">PetscErrorCode PetscJacobianFunctionIMEX_JFNK(Mat, Vec, Vec)</div><div class="ttdef"><b>Definition:</b> <a href="a00385_source.html#l00128">PetscIJacobianIMEX.cpp:128</a></div></div>
<div class="ttc" id="a00196_html_aafc992b5fa79d5a4036024615d03bce6"><div class="ttname"><a href="a00196.html#aafc992b5fa79d5a4036024615d03bce6">HyPar::ghosts</a></div><div class="ttdeci">int ghosts</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00044">hypar.h:44</a></div></div>
<div class="ttc" id="a00205_html_ae68326adc3b3862f1162832f70727b06"><div class="ttname"><a href="a00205.html#ae68326adc3b3862f1162832f70727b06">PETScContext::nproc</a></div><div class="ttdeci">int nproc</div><div class="ttdef"><b>Definition:</b> <a href="a00205_source.html#l00048">petscinterface_struct.h:48</a></div></div>
<div class="ttc" id="a00196_html_ae8f6d2fd6490d3153cb4133bf183a404"><div class="ttname"><a href="a00196.html#ae8f6d2fd6490d3153cb4133bf183a404">HyPar::nvars</a></div><div class="ttdeci">int nvars</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00029">hypar.h:29</a></div></div>
<div class="ttc" id="a00229_html_a28e9ddc4d69c4a09fda0f0f39726ba16"><div class="ttname"><a href="a00229.html#a28e9ddc4d69c4a09fda0f0f39726ba16">_ROM_MODE_NONE_</a></div><div class="ttdeci">#define _ROM_MODE_NONE_</div><div class="ttdef"><b>Definition:</b> <a href="a00229_source.html#l00012">librom_interface.h:12</a></div></div>
<div class="ttc" id="a00210_html_a00629"><div class="ttname"><a href="a00210.html#a00629">SimulationObject</a></div><div class="ttdoc">Structure defining a simulation. </div><div class="ttdef"><b>Definition:</b> <a href="a00210_source.html#l00023">simulation_object.h:23</a></div></div>
<div class="ttc" id="a00238_html_a68f5a93a79d56fcb964224f649af4ac9"><div class="ttname"><a href="a00238.html#a68f5a93a79d56fcb964224f649af4ac9">PetscJacobianFunction_JFNK</a></div><div class="ttdeci">PetscErrorCode PetscJacobianFunction_JFNK(Mat, Vec, Vec)</div><div class="ttdef"><b>Definition:</b> <a href="a00384_source.html#l00111">PetscIJacobian.cpp:111</a></div></div>
<div class="ttc" id="a00205_html_a377d0d14ec878aeb4deed4a0533e213d"><div class="ttname"><a href="a00205.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a></div><div class="ttdeci">#define _EXPLICIT_</div><div class="ttdef"><b>Definition:</b> <a href="a00205_source.html#l00027">petscinterface_struct.h:27</a></div></div>
<div class="ttc" id="a00205_html_ac48ad2561e5e125d2789133e848db1d9"><div class="ttname"><a href="a00205.html#ac48ad2561e5e125d2789133e848db1d9">PETScContext::flag_parabolic</a></div><div class="ttdeci">int flag_parabolic</div><div class="ttdef"><b>Definition:</b> <a href="a00205_source.html#l00102">petscinterface_struct.h:102</a></div></div>
<div class="ttc" id="a00205_html_a6cfd95afd0afebd625b889fb6e58371c"><div class="ttname"><a href="a00205.html#a6cfd95afd0afebd625b889fb6e58371c">PETScContext::rank</a></div><div class="ttdeci">int rank</div><div class="ttdef"><b>Definition:</b> <a href="a00205_source.html#l00045">petscinterface_struct.h:45</a></div></div>
<div class="ttc" id="a00238_html_a3f7397f8cd5e90306fb7f02edecb3782"><div class="ttname"><a href="a00238.html#a3f7397f8cd5e90306fb7f02edecb3782">PetscPostTimeStep</a></div><div class="ttdeci">PetscErrorCode PetscPostTimeStep(TS)</div><div class="ttdef"><b>Definition:</b> <a href="a00388_source.html#l00021">PetscPostTimeStep.cpp:21</a></div></div>
<div class="ttc" id="a00238_html_aa52bad03c15488a2119b794d0e70deed"><div class="ttname"><a href="a00238.html#aa52bad03c15488a2119b794d0e70deed">PetscPreStage</a></div><div class="ttdeci">PetscErrorCode PetscPreStage(TS, PetscReal)</div><div class="ttdef"><b>Definition:</b> <a href="a00389_source.html#l00014">PetscPreStage.cpp:14</a></div></div>
<div class="ttc" id="a00205_html_ad2182a08b22eed3bb3b0728725841875"><div class="ttname"><a href="a00205.html#ad2182a08b22eed3bb3b0728725841875">PETScContext::offsets</a></div><div class="ttdeci">int * offsets</div><div class="ttdef"><b>Definition:</b> <a href="a00205_source.html#l00092">petscinterface_struct.h:92</a></div></div>
<div class="ttc" id="a00205_html_af8049501def09c2e14fbec0a72c8c66c"><div class="ttname"><a href="a00205.html#af8049501def09c2e14fbec0a72c8c66c">PETScContext::rom_interface</a></div><div class="ttdeci">void * rom_interface</div><div class="ttdef"><b>Definition:</b> <a href="a00205_source.html#l00137">petscinterface_struct.h:137</a></div></div>
<div class="ttc" id="a00238_html_a9f443ff08a9a8852ab1e9cabb793ddaa"><div class="ttname"><a href="a00238.html#a9f443ff08a9a8852ab1e9cabb793ddaa">TransferVecFromPETSc</a></div><div class="ttdeci">int TransferVecFromPETSc(double *const, const Vec, void *, const int, const int)</div><div class="ttdef"><b>Definition:</b> <a href="a00395_source.html#l00023">TransferFromPETSc.cpp:23</a></div></div>
<div class="ttc" id="a00238_html_ae4815491f5992839fdb3949e5dedec8e"><div class="ttname"><a href="a00238.html#ae4815491f5992839fdb3949e5dedec8e">PetscGlobalDOF</a></div><div class="ttdeci">int PetscGlobalDOF(void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00381_source.html#l00069">PetscGlobalDOF.cpp:69</a></div></div>
<div class="ttc" id="a00288_html_a52e8c83d9dad55f9a6b967e63dc5f4bc"><div class="ttname"><a href="a00288.html#a52e8c83d9dad55f9a6b967e63dc5f4bc">CalculateError</a></div><div class="ttdeci">int CalculateError(void *s, void *m)</div><div class="ttdef"><b>Definition:</b> <a href="a00288_source.html#l00025">CalculateError.c:25</a></div></div>
<div class="ttc" id="a00196_html_af0d8e0d5d3de3869b941b66b6caaf964"><div class="ttname"><a href="a00196.html#af0d8e0d5d3de3869b941b66b6caaf964">HyPar::n_iter</a></div><div class="ttdeci">int n_iter</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00047">hypar.h:47</a></div></div>
<div class="ttc" id="a00238_html_ab816b9eb288130e9343b070f93c813cd"><div class="ttname"><a href="a00238.html#ab816b9eb288130e9343b070f93c813cd">PetscIFunctionImpl</a></div><div class="ttdeci">PetscErrorCode PetscIFunctionImpl(TS, PetscReal, Vec, Vec, Vec, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00383_source.html#l00037">PetscIFunctionImpl.cpp:37</a></div></div>
<div class="ttc" id="a00197_html"><div class="ttname"><a href="a00197.html">libROMInterface</a></div><div class="ttdoc">Class implementing interface with libROM. </div><div class="ttdef"><b>Definition:</b> <a href="a00229_source.html#l00045">librom_interface.h:45</a></div></div>
<div class="ttc" id="a00238_html_a005fac516715e5fb65baa1540a79c82c"><div class="ttname"><a href="a00238.html#a005fac516715e5fb65baa1540a79c82c">PetscRegisterTIMethods</a></div><div class="ttdeci">int PetscRegisterTIMethods(int)</div><div class="ttdef"><b>Definition:</b> <a href="a00391_source.html#l00046">PetscRegisterTIMethods.cpp:46</a></div></div>
<div class="ttc" id="a00196_html_ac92c34fe456d92c694eacd2231f5a7b1"><div class="ttname"><a href="a00196.html#ac92c34fe456d92c694eacd2231f5a7b1">HyPar::ConservationCheck</a></div><div class="ttdeci">char ConservationCheck[_MAX_STRING_SIZE_]</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00357">hypar.h:357</a></div></div>
<div class="ttc" id="a00205_html_a03e28be41881b703c836edbfe9b51b17"><div class="ttname"><a href="a00205.html#a03e28be41881b703c836edbfe9b51b17">PETScContext::dt</a></div><div class="ttdeci">double dt</div><div class="ttdef"><b>Definition:</b> <a href="a00205_source.html#l00066">petscinterface_struct.h:66</a></div></div>
<div class="ttc" id="a00289_html_accb3d8778a793486e72e06f817ef16fc"><div class="ttname"><a href="a00289.html#accb3d8778a793486e72e06f817ef16fc">CalculateROMDiff</a></div><div class="ttdeci">int CalculateROMDiff(void *s, void *m)</div><div class="ttdef"><b>Definition:</b> <a href="a00289_source.html#l00024">CalculateROMDiff.c:24</a></div></div>
<div class="ttc" id="a00196_html_a6ff746b30ee55a3bbb9f3306c145f27a"><div class="ttname"><a href="a00196.html#a6ff746b30ee55a3bbb9f3306c145f27a">HyPar::file_op_iter</a></div><div class="ttdeci">int file_op_iter</div><div class="ttdef"><b>Definition:</b> <a href="a00226_source.html#l00163">hypar.h:163</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">
var sc_project=10897352; 
var sc_invisible=1; 
var sc_security="83042f57"; 
var scJsHost = (("https:" == document.location.protocol) ?
"https://secure." : "http://www.");
document.write("<sc"+"ript type='text/javascript' src='" +
scJsHost+
"statcounter.com/counter/counter.js'></"+"script>");
</script>
<noscript><div class="statcounter"><a title="website
statistics" href="http://statcounter.com/"
target="_blank"><img class="statcounter"
src="//c.statcounter.com/10897352/0/83042f57/1/"
alt="website statistics"></a></div></noscript>
<!-- End of StatCounter Code for Default Guide -->
