<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>HyPar: include/petscinterface.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_html_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">HyPar
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">Finite-Difference Hyperbolic-Parabolic PDE Solver on Cartesian Grids</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('a00173.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">petscinterface.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Contains variables and function definitions for time integration with PETSc (<a href="http://www.mcs.anl.gov/petsc/">http://www.mcs.anl.gov/petsc/</a>)  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;petscsys.h&gt;</code><br/>
<code>#include &lt;petscvec.h&gt;</code><br/>
<code>#include &lt;petscmat.h&gt;</code><br/>
<code>#include &lt;petscts.h&gt;</code><br/>
</div>
<p><a href="a00173_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:a00591"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00173.html#a00591">PETScContext</a></td></tr>
<tr class="memdesc:a00591"><td class="mdescLeft">&#160;</td><td class="mdescRight">Structure containing the variables for time-integration with PETSc.  <a href="a00173.html#a00591">More...</a><br/></td></tr>
<tr class="separator:a00591"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a51efea86a4d76d1259893f606b776573"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00173.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>&#160;&#160;&#160;500</td></tr>
<tr class="separator:a51efea86a4d76d1259893f606b776573"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a377d0d14ec878aeb4deed4a0533e213d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00173.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>&#160;&#160;&#160;0</td></tr>
<tr class="separator:a377d0d14ec878aeb4deed4a0533e213d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aad212f0cfa337a32e39d307f8708eca7"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00173.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>&#160;&#160;&#160;1</td></tr>
<tr class="separator:aad212f0cfa337a32e39d307f8708eca7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a94499efe0f52b5174ce7105de5ab1a37"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00173.html#a94499efe0f52b5174ce7105de5ab1a37">TransferVecToPETSc</a> (double *, Vec, void *)</td></tr>
<tr class="separator:a94499efe0f52b5174ce7105de5ab1a37"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aba47a541676718cced51875b1c3a4ba6"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00173.html#aba47a541676718cced51875b1c3a4ba6">TransferVecFromPETSc</a> (double *, Vec, void *)</td></tr>
<tr class="separator:aba47a541676718cced51875b1c3a4ba6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae396bbce2aafa76d40c5acb55d4acc1d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00173.html#ae396bbce2aafa76d40c5acb55d4acc1d">TransferMatToPETSc</a> (void *, Mat, void *)</td></tr>
<tr class="separator:ae396bbce2aafa76d40c5acb55d4acc1d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a005fac516715e5fb65baa1540a79c82c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00173.html#a005fac516715e5fb65baa1540a79c82c">PetscRegisterTIMethods</a> (int)</td></tr>
<tr class="separator:a005fac516715e5fb65baa1540a79c82c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac67533553372ed2b44b32d095c775f5c"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00173.html#ac67533553372ed2b44b32d095c775f5c">PetscRHSFunctionExpl</a> (TS, PetscReal, Vec, Vec, void *)</td></tr>
<tr class="separator:ac67533553372ed2b44b32d095c775f5c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a91eb21ee4374b79a74f413d926344d7e"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00173.html#a91eb21ee4374b79a74f413d926344d7e">PetscRHSFunctionImpl</a> (TS, PetscReal, Vec, Vec, void *)</td></tr>
<tr class="separator:a91eb21ee4374b79a74f413d926344d7e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac7d9b0a219eb22bfd37482b741bd79c9"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00173.html#ac7d9b0a219eb22bfd37482b741bd79c9">PetscRHSFunctionIMEX</a> (TS, PetscReal, Vec, Vec, void *)</td></tr>
<tr class="separator:ac7d9b0a219eb22bfd37482b741bd79c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9d093c3140369a1178dd5b9589a926b1"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00173.html#a9d093c3140369a1178dd5b9589a926b1">PetscIFunctionIMEX</a> (TS, PetscReal, Vec, Vec, Vec, void *)</td></tr>
<tr class="separator:a9d093c3140369a1178dd5b9589a926b1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a82aacb94c1481144ce3e43d40d1f04d4"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00173.html#a82aacb94c1481144ce3e43d40d1f04d4">PetscIJacobianIMEX</a> (TS, PetscReal, Vec, Vec, PetscReal, Mat, Mat, void *)</td></tr>
<tr class="separator:a82aacb94c1481144ce3e43d40d1f04d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4edf057726501be3e8fe54e16fafe07b"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00173.html#a4edf057726501be3e8fe54e16fafe07b">PetscJacobianFunctionIMEX_JFNK</a> (Mat, Vec, Vec)</td></tr>
<tr class="separator:a4edf057726501be3e8fe54e16fafe07b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8778c346e27f42f0583c63909c2ea544"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00173.html#a8778c346e27f42f0583c63909c2ea544">PetscJacobianFunctionIMEX_Linear</a> (Mat, Vec, Vec)</td></tr>
<tr class="separator:a8778c346e27f42f0583c63909c2ea544"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3d6a695a879ec54937525109ac912355"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00173.html#a3d6a695a879ec54937525109ac912355">PetscIJacobian</a> (TS, PetscReal, Vec, Vec, PetscReal, Mat, Mat, void *)</td></tr>
<tr class="separator:a3d6a695a879ec54937525109ac912355"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a68f5a93a79d56fcb964224f649af4ac9"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00173.html#a68f5a93a79d56fcb964224f649af4ac9">PetscJacobianFunction_JFNK</a> (Mat, Vec, Vec)</td></tr>
<tr class="separator:a68f5a93a79d56fcb964224f649af4ac9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abed41de2efef801be98f8338aa2672f2"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00173.html#abed41de2efef801be98f8338aa2672f2">PetscJacobianFunction_Linear</a> (Mat, Vec, Vec)</td></tr>
<tr class="separator:abed41de2efef801be98f8338aa2672f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac6ed53fc6bd35636ee50ebba2a4444bb"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00173.html#ac6ed53fc6bd35636ee50ebba2a4444bb">PetscComputePreconMatIMEX</a> (Mat, Vec, void *)</td></tr>
<tr class="separator:ac6ed53fc6bd35636ee50ebba2a4444bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4c77df03a775220fb7bcf6b137ca59b3"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00173.html#a4c77df03a775220fb7bcf6b137ca59b3">PetscComputePreconMatImpl</a> (Mat, Vec, void *)</td></tr>
<tr class="separator:a4c77df03a775220fb7bcf6b137ca59b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae4815491f5992839fdb3949e5dedec8e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00173.html#ae4815491f5992839fdb3949e5dedec8e">PetscGlobalDOF</a> (void *)</td></tr>
<tr class="separator:ae4815491f5992839fdb3949e5dedec8e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a52781b615afd6404c69c93dd0aa82924"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00173.html#a52781b615afd6404c69c93dd0aa82924">PetscCleanup</a> (void *)</td></tr>
<tr class="separator:a52781b615afd6404c69c93dd0aa82924"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae4a99505d5f322bfc1c590e3d31fcc0b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00173.html#ae4a99505d5f322bfc1c590e3d31fcc0b">PetscCreatePointList</a> (void *)</td></tr>
<tr class="separator:ae4a99505d5f322bfc1c590e3d31fcc0b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa52bad03c15488a2119b794d0e70deed"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00173.html#aa52bad03c15488a2119b794d0e70deed">PetscPreStage</a> (TS, PetscReal)</td></tr>
<tr class="separator:aa52bad03c15488a2119b794d0e70deed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad1f357f94c228ba9ff45275064ca162b"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00173.html#ad1f357f94c228ba9ff45275064ca162b">PetscPostStage</a> (TS, PetscReal, PetscInt, Vec *)</td></tr>
<tr class="separator:ad1f357f94c228ba9ff45275064ca162b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ace222db5eadd0e0bd27229641e43fa9b"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00173.html#ace222db5eadd0e0bd27229641e43fa9b">PetscPreTimeStep</a> (TS)</td></tr>
<tr class="separator:ace222db5eadd0e0bd27229641e43fa9b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3f7397f8cd5e90306fb7f02edecb3782"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00173.html#a3f7397f8cd5e90306fb7f02edecb3782">PetscPostTimeStep</a> (TS)</td></tr>
<tr class="separator:a3f7397f8cd5e90306fb7f02edecb3782"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab501847c597b0c20dff03d95a663b9b4"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00173.html#ab501847c597b0c20dff03d95a663b9b4">PetscTimeError</a> (TS)</td></tr>
<tr class="separator:ab501847c597b0c20dff03d95a663b9b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Contains variables and function definitions for time integration with PETSc (<a href="http://www.mcs.anl.gov/petsc/">http://www.mcs.anl.gov/petsc/</a>) </p>
<dl class="section author"><dt>Author</dt><dd>Debojyoti Ghosh </dd></dl>

<p>Definition in file <a class="el" href="a00173_source.html">petscinterface.h</a>.</p>
</div><hr/><h2 class="groupheader">Data Structure Documentation</h2>
<a name="a00591" id="a00591"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct PETScContext</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock"><p>Structure containing the variables for time-integration with PETSc. </p>
<p>This structure contains all the variables needed to integration in time using PETSc's TS module (<a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/index.html">http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/index.html</a>). </p>

<p>Definition at line <a class="el" href="a00173_source.html#l00035">35</a> of file <a class="el" href="a00173_source.html">petscinterface.h</a>.</p>
</div><table class="fieldtable">
<tr><th colspan="3">Data Fields</th></tr>
<tr><td class="fieldtype">
<a class="anchor" id="ade1bc5cad8c6735a891a28f637cbfb06"></a>void *</td>
<td class="fieldname">
solver</td>
<td class="fielddoc">
<p>object of type <a class="el" href="a00164.html" title="Structure containing all solver-specific variables and functions. ">HyPar</a> containing the solver context </p>
</td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="abaa15763a88d05dc68ff230ce570eee9"></a>void *</td>
<td class="fieldname">
mpi</td>
<td class="fielddoc">
<p>object of type <a class="el" href="a00167.html#a00588" title="Structure of MPI-related variables. ">MPIVariables</a> containing the MPI context </p>
</td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="ab057d99becacf205132fd8c235a8488a"></a>PetscReal</td>
<td class="fieldname">
shift</td>
<td class="fielddoc">
<p>The shift variable in implicit time-integration </p>
</td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a28e4e78c0bf258662bef21d26c51fc0b"></a>double</td>
<td class="fieldname">
waqt</td>
<td class="fielddoc">
<p>Current time </p>
</td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a34cbd56d5136d5e8b5ea2cbb901c04cd"></a>int</td>
<td class="fieldname">
tic</td>
<td class="fielddoc">
<p>A counter variable </p>
</td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a515ec0fe2abce5449e37ae520974cf5f"></a>int</td>
<td class="fieldname">
npoints</td>
<td class="fielddoc">
<p>Number of computational points, i.e., total number of grid points not counting the ghost points and blanked out points (for eg, inside immersed bodies) </p>
</td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="ab991f69858c9aada0736623db264237e"></a>int *</td>
<td class="fieldname">
points</td>
<td class="fielddoc">
<p>index list of points whose size is (<a class="el" href="a00164.html#a484873c74138512e41bc50d17b7d955a">HyPar::ndims</a>+1)*<a class="el" href="a00173.html#a515ec0fe2abce5449e37ae520974cf5f">PETScContext::npoints</a>. For each point, it stores its ndims-dimensional index and its 1D index of its location in the array <a class="el" href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">HyPar::u</a>. </p>
</td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a376b6b34e162357d201827d01a5aa2a4"></a>int</td>
<td class="fieldname">
flag_hyperbolic</td>
<td class="fielddoc">
<p>Flag to indicate if hyperbolic term is treated implicitly or explicitly </p>
</td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a6a0edd627a2b2cc687d1031e3884dd6a"></a>int</td>
<td class="fieldname">
flag_hyperbolic_f</td>
<td class="fielddoc">
<p>Flag to indicate if the split hyperbolic term (<em>f</em> - <em>df</em>) is treated implicitly or explicitly </p>
</td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a21b4785029b7597816341479bc3260b4"></a>int</td>
<td class="fieldname">
flag_hyperbolic_df</td>
<td class="fielddoc">
<p>Flag to indicate if the split hyperbolic term <em>df</em> is treated implicitly or explicitly </p>
</td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="ac48ad2561e5e125d2789133e848db1d9"></a>int</td>
<td class="fieldname">
flag_parabolic</td>
<td class="fielddoc">
<p>Flag to indicate if the parabolic term is treated implicitly or explicitly </p>
</td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a54c0451c4ae9650a54f54246f1f8823b"></a>int</td>
<td class="fieldname">
flag_source</td>
<td class="fielddoc">
<p>Flag to indicate if the source term is treated implicitly or explicitly </p>
</td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a271fbbfea71118710d4a2fb13eb4c1cc"></a>int</td>
<td class="fieldname">
flag_use_precon</td>
<td class="fielddoc">
<p>Flag to turn on preconditioning (off by default) </p>
</td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a200f63fcca813d56a5cf3209546cedb2"></a>int</td>
<td class="fieldname">
flag_is_linear</td>
<td class="fielddoc">
<p>Flag to indicate if the system being solved for implicit time-integration is linear/nonlinear. </p>
</td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="ad62e14c19e38497048380c4a7fe10e12"></a>double</td>
<td class="fieldname">
jfnk_eps</td>
<td class="fielddoc">
<p>\(\epsilon\) parameter for the Jacobian-free Newton-Krylov directional derivative computation </p>
</td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a0c5f291f027b0928672b89121f44c0fc"></a>double *</td>
<td class="fieldname">
globalDOF</td>
<td class="fielddoc">
<p>An essentialy integer array of the same size and layout at the solution (with ghost points) containing the global DOF index for each grid point. It is declared as a <em>double</em> type so that its calculation can use functions defined for double-type variables. </p>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="a00173.html#ae4815491f5992839fdb3949e5dedec8e">PetscGlobalDOF()</a> </dd></dl>
</td></tr>
</table>

</div>
</div>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="a51efea86a4d76d1259893f606b776573"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define _MAX_STRING_SIZE_&#160;&#160;&#160;500</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Maximum size of character strings </p>

<p>Definition at line <a class="el" href="a00173_source.html#l00018">18</a> of file <a class="el" href="a00173_source.html">petscinterface.h</a>.</p>

</div>
</div>
<a class="anchor" id="a377d0d14ec878aeb4deed4a0533e213d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define _EXPLICIT_&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Explicit time integration </p>

<p>Definition at line <a class="el" href="a00173_source.html#l00020">20</a> of file <a class="el" href="a00173_source.html">petscinterface.h</a>.</p>

</div>
</div>
<a class="anchor" id="aad212f0cfa337a32e39d307f8708eca7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define _IMPLICIT_&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Implicit time integration </p>

<p>Definition at line <a class="el" href="a00173_source.html#l00022">22</a> of file <a class="el" href="a00173_source.html">petscinterface.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a94499efe0f52b5174ce7105de5ab1a37"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int TransferVecToPETSc </td>
          <td>(</td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Vec&#160;</td>
          <td class="paramname"><em>Y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>ctxt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Copy data to a PETSc vector (used by PETSc time integrators, and with no ghost points) from a <a class="el" href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">HyPar::u</a> array (with ghost points).</p>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="a00173.html#aba47a541676718cced51875b1c3a4ba6">TransferVecFromPETSc()</a> </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">u</td><td><a class="el" href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">HyPar::u</a> array (with ghost points) </td></tr>
    <tr><td class="paramname">Y</td><td>PETSc vector </td></tr>
    <tr><td class="paramname">ctxt</td><td>Object of type <a class="el" href="a00173.html#a00591" title="Structure containing the variables for time-integration with PETSc. ">PETScContext</a> </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00360_source.html#l00023">23</a> of file <a class="el" href="a00360_source.html">TransferToPETSc.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;{</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  <a class="code" href="a00173.html#a00591">PETScContext</a>    *context = (<a class="code" href="a00173.html#a00591">PETScContext</a>*) ctxt;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  <a class="code" href="a00164.html">HyPar</a>           *solver  = (<a class="code" href="a00164.html">HyPar</a>*)        context-&gt;<a class="code" href="a00173.html#ade1bc5cad8c6735a891a28f637cbfb06">solver</a>;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  PetscErrorCode  ierr     = 0;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  <span class="keywordtype">double</span>          *Yarr;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  PetscFunctionBegin;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  <span class="keywordtype">int</span> npoints = context-&gt;<a class="code" href="a00173.html#a515ec0fe2abce5449e37ae520974cf5f">npoints</a>, </div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;      *points = context-&gt;<a class="code" href="a00173.html#ab991f69858c9aada0736623db264237e">points</a>,</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;      nvars   = solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;      ndims   = solver-&gt;<a class="code" href="a00164.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;      nv      = ndims + 1, n;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  ierr = VecGetArray(Y,&amp;Yarr); CHKERRQ(ierr);</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  <span class="keywordflow">for</span> (n = 0; n &lt; npoints; n++) {</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="keywordtype">int</span> p = (points+n*nv)[ndims];</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <a class="code" href="a00187.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>((u+p*nvars),(Yarr+n*nvars),nvars);</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  }</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  ierr = VecRestoreArray(Y,&amp;Yarr); CHKERRQ(ierr);</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  PetscFunctionReturn(0);</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;}</div>
<div class="ttc" id="a00164_html_ae8f6d2fd6490d3153cb4133bf183a404"><div class="ttname"><a href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">HyPar::nvars</a></div><div class="ttdeci">int nvars</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00029">hypar.h:29</a></div></div>
<div class="ttc" id="a00164_html"><div class="ttname"><a href="a00164.html">HyPar</a></div><div class="ttdoc">Structure containing all solver-specific variables and functions. </div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00023">hypar.h:23</a></div></div>
<div class="ttc" id="a00173_html_a515ec0fe2abce5449e37ae520974cf5f"><div class="ttname"><a href="a00173.html#a515ec0fe2abce5449e37ae520974cf5f">PETScContext::npoints</a></div><div class="ttdeci">int npoints</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00051">petscinterface.h:51</a></div></div>
<div class="ttc" id="a00173_html_a00591"><div class="ttname"><a href="a00173.html#a00591">PETScContext</a></div><div class="ttdoc">Structure containing the variables for time-integration with PETSc. </div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00035">petscinterface.h:35</a></div></div>
<div class="ttc" id="a00164_html_a484873c74138512e41bc50d17b7d955a"><div class="ttname"><a href="a00164.html#a484873c74138512e41bc50d17b7d955a">HyPar::ndims</a></div><div class="ttdeci">int ndims</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00026">hypar.h:26</a></div></div>
<div class="ttc" id="a00173_html_ade1bc5cad8c6735a891a28f637cbfb06"><div class="ttname"><a href="a00173.html#ade1bc5cad8c6735a891a28f637cbfb06">PETScContext::solver</a></div><div class="ttdeci">void * solver</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00037">petscinterface.h:37</a></div></div>
<div class="ttc" id="a00187_html_a89e8330d9e06dd0666c50833628a125c"><div class="ttname"><a href="a00187.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a></div><div class="ttdeci">#define _ArrayCopy1D_(x, y, size)</div><div class="ttdef"><b>Definition:</b> <a href="a00187_source.html#l00318">arrayfunctions.h:318</a></div></div>
<div class="ttc" id="a00173_html_ab991f69858c9aada0736623db264237e"><div class="ttname"><a href="a00173.html#ab991f69858c9aada0736623db264237e">PETScContext::points</a></div><div class="ttdeci">int * points</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00056">petscinterface.h:56</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aba47a541676718cced51875b1c3a4ba6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int TransferVecFromPETSc </td>
          <td>(</td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Vec&#160;</td>
          <td class="paramname"><em>Y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>ctxt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Copy data from a PETSc vector (used by PETSc time integrators, and with no ghost points) to a <a class="el" href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">HyPar::u</a> array (with ghost points).</p>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="a00173.html#a94499efe0f52b5174ce7105de5ab1a37">TransferVecToPETSc()</a> </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">u</td><td><a class="el" href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">HyPar::u</a> array (with ghost points) </td></tr>
    <tr><td class="paramname">Y</td><td>PETSc vector </td></tr>
    <tr><td class="paramname">ctxt</td><td>Object of type <a class="el" href="a00173.html#a00591" title="Structure containing the variables for time-integration with PETSc. ">PETScContext</a> </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00359_source.html#l00022">22</a> of file <a class="el" href="a00359_source.html">TransferFromPETSc.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;{</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  <a class="code" href="a00173.html#a00591">PETScContext</a>    *context = (<a class="code" href="a00173.html#a00591">PETScContext</a>*) ctxt;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  <a class="code" href="a00164.html">HyPar</a>           *solver  = (<a class="code" href="a00164.html">HyPar</a>*)        context-&gt;<a class="code" href="a00173.html#ade1bc5cad8c6735a891a28f637cbfb06">solver</a>;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  PetscErrorCode  ierr     = 0;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span>    *Yarr;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  PetscFunctionBegin;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <span class="keywordtype">int</span> npoints = context-&gt;<a class="code" href="a00173.html#a515ec0fe2abce5449e37ae520974cf5f">npoints</a>, </div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;      *points = context-&gt;<a class="code" href="a00173.html#ab991f69858c9aada0736623db264237e">points</a>,</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;      nvars   = solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;      ndims   = solver-&gt;<a class="code" href="a00164.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;      nv      = ndims + 1, n;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  ierr = VecGetArrayRead(Y,&amp;Yarr); CHKERRQ(ierr);</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <span class="keywordflow">for</span> (n = 0; n &lt; npoints; n++) {</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="keywordtype">int</span> p = (points+n*nv)[ndims];</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <a class="code" href="a00187.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>((Yarr+n*nvars),(u+p*nvars),nvars);</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  }</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  ierr = VecRestoreArrayRead(Y,&amp;Yarr); CHKERRQ(ierr);</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  PetscFunctionReturn(0);</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;}</div>
<div class="ttc" id="a00164_html_ae8f6d2fd6490d3153cb4133bf183a404"><div class="ttname"><a href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">HyPar::nvars</a></div><div class="ttdeci">int nvars</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00029">hypar.h:29</a></div></div>
<div class="ttc" id="a00164_html"><div class="ttname"><a href="a00164.html">HyPar</a></div><div class="ttdoc">Structure containing all solver-specific variables and functions. </div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00023">hypar.h:23</a></div></div>
<div class="ttc" id="a00173_html_a515ec0fe2abce5449e37ae520974cf5f"><div class="ttname"><a href="a00173.html#a515ec0fe2abce5449e37ae520974cf5f">PETScContext::npoints</a></div><div class="ttdeci">int npoints</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00051">petscinterface.h:51</a></div></div>
<div class="ttc" id="a00173_html_a00591"><div class="ttname"><a href="a00173.html#a00591">PETScContext</a></div><div class="ttdoc">Structure containing the variables for time-integration with PETSc. </div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00035">petscinterface.h:35</a></div></div>
<div class="ttc" id="a00164_html_a484873c74138512e41bc50d17b7d955a"><div class="ttname"><a href="a00164.html#a484873c74138512e41bc50d17b7d955a">HyPar::ndims</a></div><div class="ttdeci">int ndims</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00026">hypar.h:26</a></div></div>
<div class="ttc" id="a00173_html_ade1bc5cad8c6735a891a28f637cbfb06"><div class="ttname"><a href="a00173.html#ade1bc5cad8c6735a891a28f637cbfb06">PETScContext::solver</a></div><div class="ttdeci">void * solver</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00037">petscinterface.h:37</a></div></div>
<div class="ttc" id="a00187_html_a89e8330d9e06dd0666c50833628a125c"><div class="ttname"><a href="a00187.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a></div><div class="ttdeci">#define _ArrayCopy1D_(x, y, size)</div><div class="ttdef"><b>Definition:</b> <a href="a00187_source.html#l00318">arrayfunctions.h:318</a></div></div>
<div class="ttc" id="a00173_html_ab991f69858c9aada0736623db264237e"><div class="ttname"><a href="a00173.html#ab991f69858c9aada0736623db264237e">PETScContext::points</a></div><div class="ttdeci">int * points</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00056">petscinterface.h:56</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ae396bbce2aafa76d40c5acb55d4acc1d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int TransferMatToPETSc </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>J</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Mat&#160;</td>
          <td class="paramname"><em>A</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>ctxt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Copy a matrix of type <a class="el" href="a00150.html#a00572" title="Structure for defining a banded block matrix. ">BandedMatrix</a> to a PETSc matrix. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">J</td><td>Matrix of type <a class="el" href="a00150.html#a00572" title="Structure for defining a banded block matrix. ">BandedMatrix</a> </td></tr>
    <tr><td class="paramname">A</td><td>PETSc matrix </td></tr>
    <tr><td class="paramname">ctxt</td><td>Object of type <a class="el" href="a00173.html#a00591" title="Structure containing the variables for time-integration with PETSc. ">PETScContext</a> </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00360_source.html#l00054">54</a> of file <a class="el" href="a00360_source.html">TransferToPETSc.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;{</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <a class="code" href="a00150.html#a00572">BandedMatrix</a>    *M = (<a class="code" href="a00150.html#a00572">BandedMatrix</a>*) J;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  PetscErrorCode  ierr     = 0;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  <span class="keywordtype">int</span>             i, n, p, q, bs = M-&gt;<a class="code" href="a00150.html#aeae4e1754c511c08564892d93c83ada1">BlockSize</a>, nbands = M-&gt;<a class="code" href="a00150.html#a30165df2b4e7a3d2b24bfd0963c16172">nbands</a>, bs2 = bs*bs;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  <span class="keywordflow">for</span> (i=0; i&lt;M-&gt;<a class="code" href="a00150.html#ac2b596b16037450673a77da1080b8707">nrows_local</a>; i++) {</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="keywordtype">int</span>     colind[nbands];</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keywordtype">double</span>  val[bs][bs*nbands];</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="keywordflow">for</span> (n=0; n&lt;nbands; n++) {</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;      colind[n] = M-&gt;<a class="code" href="a00150.html#a6db648ed09c7736e77e2c79f2a4514fd">ncol</a>[nbands*i+n];</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;      <span class="keywordflow">for</span> (p=0; p&lt;bs; p++) {</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        <span class="keywordflow">for</span> (q = 0; q&lt;bs; q++) {</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;          val[p][n*bs+q] = M-&gt;<a class="code" href="a00150.html#a23436a7a2b44939627b59df11be7ad75">data</a>[i*nbands*bs2+n*bs2+p*bs+q];</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        }</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;      }</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    }</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    ierr = MatSetValuesBlocked(A,1,&amp;M-&gt;<a class="code" href="a00150.html#a0a58ae803aa8c0ef7cf86577919f205e">nrow</a>[i],M-&gt;<a class="code" href="a00150.html#a30165df2b4e7a3d2b24bfd0963c16172">nbands</a>,&amp;colind[0],&amp;val[0][0],INSERT_VALUES); </div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                                                                                  CHKERRQ(ierr);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  }</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  ierr = MatAssemblyBegin(A,MAT_FINAL_ASSEMBLY);                                  CHKERRQ(ierr);</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  ierr = MatAssemblyEnd  (A,MAT_FINAL_ASSEMBLY);                                  CHKERRQ(ierr);</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;}</div>
<div class="ttc" id="a00150_html_aeae4e1754c511c08564892d93c83ada1"><div class="ttname"><a href="a00150.html#aeae4e1754c511c08564892d93c83ada1">BandedMatrix::BlockSize</a></div><div class="ttdeci">int BlockSize</div><div class="ttdef"><b>Definition:</b> <a href="a00150_source.html#l00021">bandedmatrix.h:21</a></div></div>
<div class="ttc" id="a00150_html_a00572"><div class="ttname"><a href="a00150.html#a00572">BandedMatrix</a></div><div class="ttdoc">Structure for defining a banded block matrix. </div><div class="ttdef"><b>Definition:</b> <a href="a00150_source.html#l00018">bandedmatrix.h:18</a></div></div>
<div class="ttc" id="a00150_html_ac2b596b16037450673a77da1080b8707"><div class="ttname"><a href="a00150.html#ac2b596b16037450673a77da1080b8707">BandedMatrix::nrows_local</a></div><div class="ttdeci">int nrows_local</div><div class="ttdef"><b>Definition:</b> <a href="a00150_source.html#l00020">bandedmatrix.h:20</a></div></div>
<div class="ttc" id="a00150_html_a0a58ae803aa8c0ef7cf86577919f205e"><div class="ttname"><a href="a00150.html#a0a58ae803aa8c0ef7cf86577919f205e">BandedMatrix::nrow</a></div><div class="ttdeci">int * nrow</div><div class="ttdef"><b>Definition:</b> <a href="a00150_source.html#l00023">bandedmatrix.h:23</a></div></div>
<div class="ttc" id="a00150_html_a23436a7a2b44939627b59df11be7ad75"><div class="ttname"><a href="a00150.html#a23436a7a2b44939627b59df11be7ad75">BandedMatrix::data</a></div><div class="ttdeci">double * data</div><div class="ttdef"><b>Definition:</b> <a href="a00150_source.html#l00024">bandedmatrix.h:24</a></div></div>
<div class="ttc" id="a00150_html_a6db648ed09c7736e77e2c79f2a4514fd"><div class="ttname"><a href="a00150.html#a6db648ed09c7736e77e2c79f2a4514fd">BandedMatrix::ncol</a></div><div class="ttdeci">int * ncol</div><div class="ttdef"><b>Definition:</b> <a href="a00150_source.html#l00022">bandedmatrix.h:22</a></div></div>
<div class="ttc" id="a00150_html_a30165df2b4e7a3d2b24bfd0963c16172"><div class="ttname"><a href="a00150.html#a30165df2b4e7a3d2b24bfd0963c16172">BandedMatrix::nbands</a></div><div class="ttdeci">int nbands</div><div class="ttdef"><b>Definition:</b> <a href="a00150_source.html#l00019">bandedmatrix.h:19</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a005fac516715e5fb65baa1540a79c82c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int PetscRegisterTIMethods </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>rank</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function allows the registering of custom multi-stage time integration methods and using it with PETSc. More than one method may be provided, each with a unique name (the name <b>must</b> <b>not</b> conflict with the names of existing methods in PETSc). The methods should be provided in a file <em>"time_method.inp"</em>, and the following must be provided:</p>
<ul>
<li>Name</li>
<li>Class (i.e. RK or ARK)</li>
<li>Number of stages</li>
<li>Theoretical order</li>
<li>Butcher tableaux</li>
</ul>
<p>The method can then be used by invoking it by its name. For example, if a custom ARKIMEX method <em>"foo"</em> is provided through <em>"time_method.inp"</em>, it can be used by specifying <em>"-ts_type arkimex -ts_arkimex_type foo"</em> in the command line or <em>".petscrc"</em> file.</p>
<p>See <em>/Examples/PETScInputs</em> for examples of the input files required to provide a time integration method.</p>
<p>Currently supported classes of time integrators for which custom methods can be provided:</p>
<ul>
<li>RK (Runge-Kutta): See TSRKRegister (<a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/TSRKRegister.html">http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/TSRKRegister.html</a>)</li>
<li>ARK (Additive Runge-Kutta): See TSARKIMEXRegister (<a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/TSRKRegister.html">http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/TSRKRegister.html</a>)</li>
</ul>
<p>To do:</p>
<ul>
<li>Add support for TSGLEE when it gets merged to PETSc's master. </li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">rank</td><td>MPI rank </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00355_source.html#l00046">46</a> of file <a class="el" href="a00355_source.html">PetscRegisterTIMethods.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;{</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  PetscErrorCode ierr;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <span class="keywordtype">int</span>            ierr2;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  PetscFunctionBegin;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  <span class="comment">/* Note: all processors read and register the custom methods */</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <span class="comment">/* instead of root doing it and broadcasting.                */</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  FILE *in;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  in = fopen(<span class="stringliteral">&quot;time_method.inp&quot;</span>,<span class="stringliteral">&quot;r&quot;</span>);</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <span class="keywordflow">if</span> (in) {</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="keywordtype">int</span> n, N; <span class="comment">/* N = total number of methods specified in the file */</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    ierr2 = fscanf(in,<span class="stringliteral">&quot;%d&quot;</span>,&amp;N); <span class="keywordflow">if</span> (ierr2 != 1) <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="keywordflow">for</span> (n = 0; n &lt; N; n++) {</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;      <span class="keywordtype">char</span>      name[<a class="code" href="a00188.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>];      <span class="comment">/* name of the scheme                           */</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;      <span class="keywordtype">char</span>      type[<a class="code" href="a00188.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>];      <span class="comment">/* type of scheme - ARKIMEX or RK               */</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;      PetscInt  s, order;                     <span class="comment">/* number of stages and order                   */</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;      PetscReal *A , *b,  *c;                 <span class="comment">/* Butcher tableaux entries for non-stiff terms */</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;      PetscReal *At, *bt, *ct;                <span class="comment">/* Butcher tableaux entries for the stiff terms */</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;      PetscReal *bemb, *bembt;                <span class="comment">/* Embedded method coefficients                 */</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;      PetscInt  pinterp;                      <span class="comment">/* order of interpolation scheme                */</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;      PetscReal *bint,*bintt;                 <span class="comment">/* Dense output interpolation coefficients      */</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;      <span class="comment">/* Initializations */</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;      strcpy(name,<span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;      s = order = pinterp = 0;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;      A  = b  = c  = NULL;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;      At = bt = ct = NULL;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;      bemb = bembt = NULL;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;      bint = bintt = NULL;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;      <span class="comment">/* Read the method */</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;      <span class="keywordtype">char</span> word[<a class="code" href="a00188.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>];</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;      ierr2 = fscanf(in,<span class="stringliteral">&quot;%s&quot;</span>,word); <span class="keywordflow">if</span> (ierr2 != 1) <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;      <span class="keywordflow">if</span> (!strcmp(word,<span class="stringliteral">&quot;begin&quot;</span>)) {</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        <span class="keywordflow">while</span> (strcmp(word, <span class="stringliteral">&quot;end&quot;</span>)) {</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;          ierr2 = fscanf(in,<span class="stringliteral">&quot;%s&quot;</span>,word); <span class="keywordflow">if</span> (ierr2 != 1) <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;          <span class="keywordflow">if</span>      (!strcmp(word,<span class="stringliteral">&quot;name&quot;</span>))    { ierr2 = fscanf(in,<span class="stringliteral">&quot;%s&quot;</span>,name);    <span class="keywordflow">if</span> (ierr2 != 1) <span class="keywordflow">return</span>(1); }</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(word,<span class="stringliteral">&quot;class&quot;</span>))   { ierr2 = fscanf(in,<span class="stringliteral">&quot;%s&quot;</span>,type);    <span class="keywordflow">if</span> (ierr2 != 1) <span class="keywordflow">return</span>(1); }</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(word,<span class="stringliteral">&quot;nstages&quot;</span>)) { ierr2 = fscanf(in,<span class="stringliteral">&quot;%d&quot;</span>,&amp;s);      <span class="keywordflow">if</span> (ierr2 != 1) <span class="keywordflow">return</span>(1); }</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(word,<span class="stringliteral">&quot;order&quot;</span>))   { ierr2 = fscanf(in,<span class="stringliteral">&quot;%d&quot;</span>,&amp;order);  <span class="keywordflow">if</span> (ierr2 != 1) <span class="keywordflow">return</span>(1); }</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(word,<span class="stringliteral">&quot;pinterp&quot;</span>)) { ierr2 = fscanf(in,<span class="stringliteral">&quot;%d&quot;</span>,&amp;pinterp);<span class="keywordflow">if</span> (ierr2 != 1) <span class="keywordflow">return</span>(1); }</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(word,<span class="stringliteral">&quot;At&quot;</span>)) {</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;            <span class="keywordflow">if</span> (s == 0) { </div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;              <span class="keywordflow">if</span> (!rank) fprintf(stderr,<span class="stringliteral">&quot;Error in PetscRegisterTIMethods(): nstages must be defined &quot;</span>);</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;              <span class="keywordflow">if</span> (!rank) fprintf(stderr,<span class="stringliteral">&quot;before specifying the Butcher tableaux entries.\n&quot;</span>              );</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;              <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;              At = (PetscReal*) calloc (s*s, <span class="keyword">sizeof</span>(PetscReal));</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;              <span class="keywordtype">int</span> i, j;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;              <span class="keywordflow">for</span> (i = 0; i &lt; s; i++) {</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                <span class="keywordflow">for</span> (j = 0; j &lt; s; j++) {</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                  ierr2 = fscanf(in,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;At[i*s+j]); <span class="keywordflow">if</span> (ierr2 != 1) <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                }</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;              }</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;            }</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(word,<span class="stringliteral">&quot;A&quot;</span>)) {</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;            <span class="keywordflow">if</span> (s == 0) { </div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;              <span class="keywordflow">if</span> (!rank) fprintf(stderr,<span class="stringliteral">&quot;Error in PetscRegisterTIMethods(): nstages must be defined &quot;</span>);</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;              <span class="keywordflow">if</span> (!rank) fprintf(stderr,<span class="stringliteral">&quot;before specifying the Butcher tableaux entries.\n&quot;</span>              );</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;              <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;              A = (PetscReal*) calloc (s*s, <span class="keyword">sizeof</span>(PetscReal));</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;              <span class="keywordtype">int</span> i, j;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;              <span class="keywordflow">for</span> (i = 0; i &lt; s; i++) {</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                <span class="keywordflow">for</span> (j = 0; j &lt; s; j++) {</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                  ierr2 = fscanf(in,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;A[i*s+j]); <span class="keywordflow">if</span> (ierr2 != 1) <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                }</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;              }</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;            }</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(word,<span class="stringliteral">&quot;bt&quot;</span>)) {</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;            <span class="keywordflow">if</span> (s == 0) { </div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;              <span class="keywordflow">if</span> (!rank) fprintf(stderr,<span class="stringliteral">&quot;Error in PetscRegisterTIMethods(): nstages must be defined &quot;</span>);</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;              <span class="keywordflow">if</span> (!rank) fprintf(stderr,<span class="stringliteral">&quot;before specifying the Butcher tableaux entries.\n&quot;</span>              );</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;              <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;              bt = (PetscReal*) calloc (s, <span class="keyword">sizeof</span>(PetscReal));</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;              <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;              <span class="keywordflow">for</span> (i = 0; i &lt; s; i++) ierr2 = fscanf(in,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;bt[i]); <span class="keywordflow">if</span> (ierr2 != 1) <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;            }</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(word,<span class="stringliteral">&quot;b&quot;</span>)) {</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;            <span class="keywordflow">if</span> (s == 0) { </div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;              <span class="keywordflow">if</span> (!rank) fprintf(stderr,<span class="stringliteral">&quot;Error in PetscRegisterTIMethods(): nstages must be defined &quot;</span>);</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;              <span class="keywordflow">if</span> (!rank) fprintf(stderr,<span class="stringliteral">&quot;before specifying the Butcher tableaux entries.\n&quot;</span>              );</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;              <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;              b = (PetscReal*) calloc (s, <span class="keyword">sizeof</span>(PetscReal));</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;              <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;              <span class="keywordflow">for</span> (i = 0; i &lt; s; i++) ierr2 = fscanf(in,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;b[i]); <span class="keywordflow">if</span> (ierr2 != 1) <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;            }</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(word,<span class="stringliteral">&quot;ct&quot;</span>)) {</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;            <span class="keywordflow">if</span> (s == 0) { </div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;              <span class="keywordflow">if</span> (!rank) fprintf(stderr,<span class="stringliteral">&quot;Error in PetscRegisterTIMethods(): nstages must be defined &quot;</span>);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;              <span class="keywordflow">if</span> (!rank) fprintf(stderr,<span class="stringliteral">&quot;before specifying the Butcher tableaux entries.\n&quot;</span>              );</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;              <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;              ct = (PetscReal*) calloc (s, <span class="keyword">sizeof</span>(PetscReal));</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;              <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;              <span class="keywordflow">for</span> (i = 0; i &lt; s; i++) ierr2 = fscanf(in,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;ct[i]); <span class="keywordflow">if</span> (ierr2 != 1) <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;            }</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(word,<span class="stringliteral">&quot;c&quot;</span>)) {</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;            <span class="keywordflow">if</span> (s == 0) { </div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;              <span class="keywordflow">if</span> (!rank) fprintf(stderr,<span class="stringliteral">&quot;Error in PetscRegisterTIMethods(): nstages must be defined &quot;</span>);</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;              <span class="keywordflow">if</span> (!rank) fprintf(stderr,<span class="stringliteral">&quot;before specifying the Butcher tableaux entries.\n&quot;</span>              );</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;              <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;              c = (PetscReal*) calloc (s, <span class="keyword">sizeof</span>(PetscReal));</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;              <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;              <span class="keywordflow">for</span> (i = 0; i &lt; s; i++) ierr2 = fscanf(in,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;c[i]); <span class="keywordflow">if</span> (ierr2 != 1) <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;            }</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(word,<span class="stringliteral">&quot;bembt&quot;</span>)) {</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;            <span class="keywordflow">if</span> (s == 0) { </div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;              <span class="keywordflow">if</span> (!rank) fprintf(stderr,<span class="stringliteral">&quot;Error in PetscRegisterTIMethods(): nstages must be defined &quot;</span>);</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;              <span class="keywordflow">if</span> (!rank) fprintf(stderr,<span class="stringliteral">&quot;before specifying the Butcher tableaux entries.\n&quot;</span>              );</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;              <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;              bembt = (PetscReal*) calloc (s, <span class="keyword">sizeof</span>(PetscReal));</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;              <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;              <span class="keywordflow">for</span> (i = 0; i &lt; s; i++) ierr2 = fscanf(in,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;bembt[i]); <span class="keywordflow">if</span> (ierr2 != 1) <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;            }</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(word,<span class="stringliteral">&quot;bemb&quot;</span>)) {</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;            <span class="keywordflow">if</span> (s == 0) { </div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;              <span class="keywordflow">if</span> (!rank) fprintf(stderr,<span class="stringliteral">&quot;Error in PetscRegisterTIMethods(): nstages must be defined &quot;</span>);</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;              <span class="keywordflow">if</span> (!rank) fprintf(stderr,<span class="stringliteral">&quot;before specifying the Butcher tableaux entries.\n&quot;</span>              );</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;              <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;              bemb = (PetscReal*) calloc (s, <span class="keyword">sizeof</span>(PetscReal));</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;              <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;              <span class="keywordflow">for</span> (i = 0; i &lt; s; i++) ierr2 = fscanf(in,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;bemb[i]); <span class="keywordflow">if</span> (ierr2 != 1) <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;            }</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(word,<span class="stringliteral">&quot;bintt&quot;</span>)) {</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;            <span class="keywordflow">if</span> (s == 0 || pinterp == 0) { </div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;              <span class="keywordflow">if</span> (!rank) fprintf(stderr,<span class="stringliteral">&quot;Error in PetscRegisterTIMethods(): nstages and pinterp must be &quot;</span> );</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;              <span class="keywordflow">if</span> (!rank) fprintf(stderr,<span class="stringliteral">&quot;defined as positive values before specifying interpolation coeffs.\n&quot;</span>);</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;              <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;              bintt = (PetscReal*) calloc (s*pinterp, <span class="keyword">sizeof</span>(PetscReal));</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;              <span class="keywordtype">int</span> i, j;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;              <span class="keywordflow">for</span> (i = 0; i &lt; s; i++) {</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                <span class="keywordflow">for</span> (j = 0; j &lt; pinterp; j++) {</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                  ierr2 = fscanf(in,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;bintt[i*s+j]); <span class="keywordflow">if</span> (ierr2 != 1) <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                }</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;              }</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;            }</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(word,<span class="stringliteral">&quot;bint&quot;</span>)) {</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;            <span class="keywordflow">if</span> (s == 0 || pinterp == 0) { </div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;              <span class="keywordflow">if</span> (!rank) fprintf(stderr,<span class="stringliteral">&quot;Error in PetscRegisterTIMethods(): nstages and pinterp must be &quot;</span> );</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;              <span class="keywordflow">if</span> (!rank) fprintf(stderr,<span class="stringliteral">&quot;defined as positive values before specifying interpolation coeffs.\n&quot;</span>);</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;              <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;              bint = (PetscReal*) calloc (s*pinterp, <span class="keyword">sizeof</span>(PetscReal));</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;              <span class="keywordtype">int</span> i, j;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;              <span class="keywordflow">for</span> (i = 0; i &lt; s; i++) {</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                <span class="keywordflow">for</span> (j = 0; j &lt; pinterp; j++) {</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                  ierr2 = fscanf(in,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;bint[i*s+j]); <span class="keywordflow">if</span> (ierr2 != 1) <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                }</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;              }</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;            }</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;          }</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        }</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;            <span class="keywordflow">if</span> (!rank) fprintf(stderr,<span class="stringliteral">&quot;Error: Illegal format in file \&quot;time_method.inp\&quot; (expected keyword \&quot;begin\&quot;).\n&quot;</span>);</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      }</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    </div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;      <span class="comment">/* Register the method */</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      <span class="keywordflow">if</span> (!strcmp(type,<span class="stringliteral">&quot;arkimex&quot;</span>)) {</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        <span class="keywordflow">if</span> (A &amp;&amp; At) {</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;          ierr = TSARKIMEXRegister(name,order,s,At,bt,ct,A,b,c,bembt,bemb,pinterp,bintt,bint); CHKERRQ(ierr);</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;          <span class="keywordflow">if</span> (!rank) {</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;            printf(<span class="stringliteral">&quot;\nRegistered custom ARKIMEX scheme \&quot;%s\&quot; with the following Butcher tableaux:-\n&quot;</span>,name);</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            <span class="keywordtype">int</span> i,j;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;            <span class="keywordflow">for</span> (i = 0; i &lt; s; i++) {</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;              <span class="keywordflow">if</span> (c)  printf(<span class="stringliteral">&quot;  %+1.5lf |&quot;</span>,c[i]);</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;              <span class="keywordflow">else</span>    printf(<span class="stringliteral">&quot;           |&quot;</span>);</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;              <span class="keywordflow">for</span> (j = 0; j &lt; s; j++) printf (<span class="stringliteral">&quot; %+1.5lf :&quot;</span>,A[i*s+j]);</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;              printf(<span class="stringliteral">&quot;          &quot;</span>);</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;              <span class="keywordflow">if</span> (ct)  printf(<span class="stringliteral">&quot;%+1.5lf |&quot;</span>,ct[i]);</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;              <span class="keywordflow">else</span>     printf(<span class="stringliteral">&quot;           |&quot;</span>);</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;              <span class="keywordflow">for</span> (j = 0; j &lt; s; j++) printf (<span class="stringliteral">&quot; %+1.5lf :&quot;</span>,At[i*s+j]);</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;              printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;            }</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;            printf(<span class="stringliteral">&quot;  ---------|&quot;</span>);</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;            <span class="keywordflow">for</span> (j = 0; j &lt; s; j++) printf(<span class="stringliteral">&quot;-----------&quot;</span>);</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;            printf(<span class="stringliteral">&quot;            &quot;</span>);</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;            printf(<span class="stringliteral">&quot;---------|&quot;</span>);</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;            <span class="keywordflow">for</span> (j = 0; j &lt; s; j++) printf(<span class="stringliteral">&quot;-----------&quot;</span>);</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;            printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;            printf(<span class="stringliteral">&quot;           |&quot;</span>);</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;            <span class="keywordflow">if</span> (b)   <span class="keywordflow">for</span> (j = 0; j &lt; s; j++) printf(<span class="stringliteral">&quot; %+1.5lf :&quot;</span>,b[j]);</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;            <span class="keywordflow">else</span>     <span class="keywordflow">for</span> (j = 0; j &lt; s; j++) printf(<span class="stringliteral">&quot;          :&quot;</span>);</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;            printf(<span class="stringliteral">&quot;          &quot;</span>);</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;            printf(<span class="stringliteral">&quot;           |&quot;</span>);</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;            <span class="keywordflow">if</span> (bt)  <span class="keywordflow">for</span> (j = 0; j &lt; s; j++) printf(<span class="stringliteral">&quot; %+1.5lf :&quot;</span>,bt[j]);</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;            <span class="keywordflow">else</span>     <span class="keywordflow">for</span> (j = 0; j &lt; s; j++) printf(<span class="stringliteral">&quot;          :&quot;</span>);</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;            printf(<span class="stringliteral">&quot;\n\n&quot;</span>);</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;          }</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;          <span class="keywordflow">if</span> (!rank) {</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;            fprintf(stderr,<span class="stringliteral">&quot;Warning in PetscRegisterTIMethods(): Failed to register method &quot;</span>);</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;            fprintf(stderr,<span class="stringliteral">&quot;(A or At not defined).\n&quot;</span>);</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;          }</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        }</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(type,<span class="stringliteral">&quot;rk&quot;</span>)) {</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        <span class="keywordflow">if</span> (A) {</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;          ierr = TSRKRegister(name,order,s,A,b,c,bemb,pinterp,bint); CHKERRQ(ierr);</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;          <span class="keywordflow">if</span> (!rank) {</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;            printf(<span class="stringliteral">&quot;\nRegistered custom RK scheme \&quot;%s\&quot; with the following Butcher tableaux:-\n&quot;</span>,name);</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;            <span class="keywordtype">int</span> i,j;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;            <span class="keywordflow">for</span> (i = 0; i &lt; s; i++) {</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;              <span class="keywordflow">if</span> (c)  printf(<span class="stringliteral">&quot;  %+1.5lf |&quot;</span>,c[i]);</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;              <span class="keywordflow">else</span>    printf(<span class="stringliteral">&quot;           |&quot;</span>);</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;              <span class="keywordflow">for</span> (j = 0; j &lt; s; j++) printf (<span class="stringliteral">&quot; %+1.5lf :&quot;</span>,A[i*s+j]);</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;              printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;            }</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;            printf(<span class="stringliteral">&quot;  ---------|&quot;</span>);</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;            <span class="keywordflow">for</span> (j = 0; j &lt; s; j++) printf(<span class="stringliteral">&quot;-----------&quot;</span>);</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;            printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;            printf(<span class="stringliteral">&quot;           |&quot;</span>);</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;            <span class="keywordflow">if</span> (b)   <span class="keywordflow">for</span> (j = 0; j &lt; s; j++) printf(<span class="stringliteral">&quot; %+1.5lf :&quot;</span>,b[j]);</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;            <span class="keywordflow">else</span>     <span class="keywordflow">for</span> (j = 0; j &lt; s; j++) printf(<span class="stringliteral">&quot;          :&quot;</span>);</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;            printf(<span class="stringliteral">&quot;\n\n&quot;</span>);</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;          }</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;          <span class="keywordflow">if</span> (!rank) {</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;            fprintf(stderr,<span class="stringliteral">&quot;Warning in PetscRegisterTIMethods(): Failed to register method &quot;</span>);</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;            fprintf(stderr,<span class="stringliteral">&quot;(A not defined).\n&quot;</span>);</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;          }</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        }</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        <span class="keywordflow">if</span> (!rank){</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;          fprintf(stderr,<span class="stringliteral">&quot;Error in PetscRegisterTIMethods():  %s class of time-integration schemes &quot;</span>,type);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;          fprintf(stderr,<span class="stringliteral">&quot;does not support custom method registration and usage.\n&quot;</span>);</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        }</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      }</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      <span class="comment">/* Free the arrays */</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;      <span class="keywordflow">if</span> (At)     free(At);</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;      <span class="keywordflow">if</span> (bt)     free(bt);</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;      <span class="keywordflow">if</span> (ct)     free(ct);</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      <span class="keywordflow">if</span> (A)      free(A);</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;      <span class="keywordflow">if</span> (b)      free(b);</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      <span class="keywordflow">if</span> (c)      free(c);</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;      <span class="keywordflow">if</span> (bembt)  free(bembt);</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      <span class="keywordflow">if</span> (bemb)   free(bemb);</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;      <span class="keywordflow">if</span> (bintt)  free(bintt);</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      <span class="keywordflow">if</span> (bint)   free(bint);</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    </div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    }</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  }</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  PetscFunctionReturn(0);</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;}</div>
<div class="ttc" id="a00188_html_a51efea86a4d76d1259893f606b776573"><div class="ttname"><a href="a00188.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a></div><div class="ttdeci">#define _MAX_STRING_SIZE_</div><div class="ttdef"><b>Definition:</b> <a href="a00188_source.html#l00010">basic.h:10</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac67533553372ed2b44b32d095c775f5c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode PetscRHSFunctionExpl </td>
          <td>(</td>
          <td class="paramtype">TS&#160;</td>
          <td class="paramname"><em>ts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal&#160;</td>
          <td class="paramname"><em>t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Vec&#160;</td>
          <td class="paramname"><em>Y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Vec&#160;</td>
          <td class="paramname"><em>F</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>ctxt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Compute the right-hand-side (RHS) for the explicit time integration of the governing equations: The spatially discretized ODE can be expressed as </p>
<p class="formulaDsp">
\begin{equation} \frac {d{\bf U}} {dt} = {\bf F}\left({\bf U}\right). \end{equation}
</p>
<p> This function computes \({\bf F}\left({\bf U}\right)\), given \({\bf U}\).</p>
<dl class="section see"><dt>See Also</dt><dd>TSSetRHSFunction (<a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/TSSetRHSFunction.html">http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/TSSetRHSFunction.html</a>)</dd></dl>
<p>Note:</p>
<ul>
<li>\({\bf U}\) is <em>Y</em> in the code.</li>
<li>See <a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/index.html">http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/index.html</a> for documentation on PETSc's time integrators.</li>
<li>All functions and variables whose names start with Vec, Mat, PC, KSP, SNES, and TS are defined by PETSc. Refer to the PETSc documentation (<a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/">http://www.mcs.anl.gov/petsc/petsc-current/docs/</a>). Usually, googling with the function or variable name yields the specific doc page dealing with that function/variable. </li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ts</td><td>Time integration object </td></tr>
    <tr><td class="paramname">t</td><td>Current simulation time </td></tr>
    <tr><td class="paramname">Y</td><td>State vector (input) </td></tr>
    <tr><td class="paramname">F</td><td>The computed right-hand-side vector </td></tr>
    <tr><td class="paramname">ctxt</td><td>Object of type <a class="el" href="a00173.html#a00591" title="Structure containing the variables for time-integration with PETSc. ">PETScContext</a> </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00356_source.html#l00036">36</a> of file <a class="el" href="a00356_source.html">PetscRHSFunctionExpl.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;{</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  <a class="code" href="a00173.html#a00591">PETScContext</a>    *context = (<a class="code" href="a00173.html#a00591">PETScContext</a>*) ctxt;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  <a class="code" href="a00164.html">HyPar</a>           *solver  = (<a class="code" href="a00164.html">HyPar</a>*)        context-&gt;<a class="code" href="a00173.html#ade1bc5cad8c6735a891a28f637cbfb06">solver</a>;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  <a class="code" href="a00167.html#a00588">MPIVariables</a>    *mpi     = (<a class="code" href="a00167.html#a00588">MPIVariables</a>*) context-&gt;<a class="code" href="a00173.html#abaa15763a88d05dc68ff230ce570eee9">mpi</a>;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  <span class="keywordtype">int</span>             d;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  <a class="code" href="a00188.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a>;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  PetscFunctionBegin;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  solver-&gt;<a class="code" href="a00164.html#a037bb9eabb2ecdb3812c625db433cf6b">count_RHSFunction</a>++;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  </div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <span class="keywordtype">int</span> size = 1;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <span class="keywordflow">for</span> (d=0; d&lt;solver-&gt;<a class="code" href="a00164.html#a484873c74138512e41bc50d17b7d955a">ndims</a>; d++) size *= (solver-&gt;<a class="code" href="a00164.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>[d]+2*solver-&gt;<a class="code" href="a00164.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>);</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <span class="keywordtype">double</span> *u   = solver-&gt;<a class="code" href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <span class="keywordtype">double</span> *rhs = solver-&gt;<a class="code" href="a00164.html#ade4650485fe35fd3e12fea272fc80209">rhs</a>;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <span class="comment">/* copy solution from PETSc vector */</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <a class="code" href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00173.html#aba47a541676718cced51875b1c3a4ba6">TransferVecFromPETSc</a>(u,Y,context);                                         <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <span class="comment">/* apply boundary conditions and exchange data over MPI interfaces */</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  <a class="code" href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00164.html#aa4de7bdc1e62417caf51b9c45184268d">ApplyBoundaryConditions</a>(solver,mpi,u,NULL,t);                      <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  <a class="code" href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00204.html#a60ace5964c051fa481e6a1e6f1ef75d7">MPIExchangeBoundariesnD</a>(solver-&gt;<a class="code" href="a00164.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00164.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;                               solver-&gt;<a class="code" href="a00164.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,mpi,u);                             <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  <span class="comment">/* Evaluate hyperbolic, parabolic and source terms  and the RHS */</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <a class="code" href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00164.html#aa245f8c9e6af37e47c5867dccbbc208b">HyperbolicFunction</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,u,solver,mpi,t,1,solver-&gt;<a class="code" href="a00164.html#a0d895f9bb0c8a3e79a64dd2379e1f2dd">FFunction</a>,solver-&gt;<a class="code" href="a00164.html#a7eb68b9643feb74bd49f3a171b66eef1">Upwind</a>);</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;                                                                                  <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  <a class="code" href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00164.html#a75e8be4ea8c1ae2e99fc1e802e69a573">ParabolicFunction</a> (solver-&gt;<a class="code" href="a00164.html#ae53517ad7a202762d7b79eaf681701f3">par</a>,u,solver,mpi,t);                    <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <a class="code" href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00164.html#a662e256e081a2b74f971d02c747892b8">SourceFunction</a>    (solver-&gt;<a class="code" href="a00164.html#a6b4951ffdbd82f3a3848b82352d389d6">source</a>,u,solver,mpi,t);                 <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <a class="code" href="a00187.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,0.0);</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>   ,-1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00164.html#ae53517ad7a202762d7b79eaf681701f3">par</a>   , 1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00164.html#a6b4951ffdbd82f3a3848b82352d389d6">source</a>, 1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  <span class="comment">/* Transfer RHS to PETSc vector */</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  <a class="code" href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00173.html#a94499efe0f52b5174ce7105de5ab1a37">TransferVecToPETSc</a>(rhs,F,context);                                         <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  PetscFunctionReturn(0);</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;}</div>
<div class="ttc" id="a00173_html_abaa15763a88d05dc68ff230ce570eee9"><div class="ttname"><a href="a00173.html#abaa15763a88d05dc68ff230ce570eee9">PETScContext::mpi</a></div><div class="ttdeci">void * mpi</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00039">petscinterface.h:39</a></div></div>
<div class="ttc" id="a00164_html_ae8f6d2fd6490d3153cb4133bf183a404"><div class="ttname"><a href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">HyPar::nvars</a></div><div class="ttdeci">int nvars</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00029">hypar.h:29</a></div></div>
<div class="ttc" id="a00164_html_a037bb9eabb2ecdb3812c625db433cf6b"><div class="ttname"><a href="a00164.html#a037bb9eabb2ecdb3812c625db433cf6b">HyPar::count_RHSFunction</a></div><div class="ttdeci">int count_RHSFunction</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00398">hypar.h:398</a></div></div>
<div class="ttc" id="a00187_html_a4cd66304bc41a7751842230af3063b62"><div class="ttname"><a href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a></div><div class="ttdeci">#define _ArrayAXPY_(x, a, y, size)</div><div class="ttdef"><b>Definition:</b> <a href="a00187_source.html#l00270">arrayfunctions.h:270</a></div></div>
<div class="ttc" id="a00164_html"><div class="ttname"><a href="a00164.html">HyPar</a></div><div class="ttdoc">Structure containing all solver-specific variables and functions. </div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00023">hypar.h:23</a></div></div>
<div class="ttc" id="a00164_html_a6b4951ffdbd82f3a3848b82352d389d6"><div class="ttname"><a href="a00164.html#a6b4951ffdbd82f3a3848b82352d389d6">HyPar::source</a></div><div class="ttdeci">double * source</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00117">hypar.h:117</a></div></div>
<div class="ttc" id="a00173_html_a00591"><div class="ttname"><a href="a00173.html#a00591">PETScContext</a></div><div class="ttdoc">Structure containing the variables for time-integration with PETSc. </div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00035">petscinterface.h:35</a></div></div>
<div class="ttc" id="a00164_html_a662e256e081a2b74f971d02c747892b8"><div class="ttname"><a href="a00164.html#a662e256e081a2b74f971d02c747892b8">HyPar::SourceFunction</a></div><div class="ttdeci">int(* SourceFunction)(double *, double *, void *, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00246">hypar.h:246</a></div></div>
<div class="ttc" id="a00164_html_a484873c74138512e41bc50d17b7d955a"><div class="ttname"><a href="a00164.html#a484873c74138512e41bc50d17b7d955a">HyPar::ndims</a></div><div class="ttdeci">int ndims</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00026">hypar.h:26</a></div></div>
<div class="ttc" id="a00164_html_a38e0371f331cecbe63a77fa03e202afe"><div class="ttname"><a href="a00164.html#a38e0371f331cecbe63a77fa03e202afe">HyPar::dim_local</a></div><div class="ttdeci">int * dim_local</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00035">hypar.h:35</a></div></div>
<div class="ttc" id="a00188_html_add9cf96ae374934d245a1dc1ab697a42"><div class="ttname"><a href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a></div><div class="ttdeci">#define CHECKERR(ierr)</div><div class="ttdef"><b>Definition:</b> <a href="a00188_source.html#l00014">basic.h:14</a></div></div>
<div class="ttc" id="a00173_html_ade1bc5cad8c6735a891a28f637cbfb06"><div class="ttname"><a href="a00173.html#ade1bc5cad8c6735a891a28f637cbfb06">PETScContext::solver</a></div><div class="ttdeci">void * solver</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00037">petscinterface.h:37</a></div></div>
<div class="ttc" id="a00164_html_a75e8be4ea8c1ae2e99fc1e802e69a573"><div class="ttname"><a href="a00164.html#a75e8be4ea8c1ae2e99fc1e802e69a573">HyPar::ParabolicFunction</a></div><div class="ttdeci">int(* ParabolicFunction)(double *, double *, void *, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00243">hypar.h:243</a></div></div>
<div class="ttc" id="a00167_html_a00588"><div class="ttname"><a href="a00167.html#a00588">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a00167_source.html#l00024">mpivars_struct.h:24</a></div></div>
<div class="ttc" id="a00164_html_aa245f8c9e6af37e47c5867dccbbc208b"><div class="ttname"><a href="a00164.html#aa245f8c9e6af37e47c5867dccbbc208b">HyPar::HyperbolicFunction</a></div><div class="ttdeci">int(* HyperbolicFunction)(double *, double *, void *, void *, double, int, int(*)(double *, double *, int, void *, double), int(*)(double *, double *, double *, double *, double *, double *, int, void *, double))</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00237">hypar.h:237</a></div></div>
<div class="ttc" id="a00164_html_ae53517ad7a202762d7b79eaf681701f3"><div class="ttname"><a href="a00164.html#ae53517ad7a202762d7b79eaf681701f3">HyPar::par</a></div><div class="ttdeci">double * par</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00114">hypar.h:114</a></div></div>
<div class="ttc" id="a00188_html_ad6ab74942c9de13cf0b4c12eb0d91780"><div class="ttname"><a href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a></div><div class="ttdeci">#define IERR</div><div class="ttdef"><b>Definition:</b> <a href="a00188_source.html#l00012">basic.h:12</a></div></div>
<div class="ttc" id="a00164_html_a0d895f9bb0c8a3e79a64dd2379e1f2dd"><div class="ttname"><a href="a00164.html#a0d895f9bb0c8a3e79a64dd2379e1f2dd">HyPar::FFunction</a></div><div class="ttdeci">int(* FFunction)(double *, double *, int, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00262">hypar.h:262</a></div></div>
<div class="ttc" id="a00164_html_ade4650485fe35fd3e12fea272fc80209"><div class="ttname"><a href="a00164.html#ade4650485fe35fd3e12fea272fc80209">HyPar::rhs</a></div><div class="ttdeci">double * rhs</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00375">hypar.h:375</a></div></div>
<div class="ttc" id="a00187_html_a2b2826031c0cd92495ab351d3e599fc5"><div class="ttname"><a href="a00187.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a></div><div class="ttdeci">#define _ArraySetValue_(x, size, value)</div><div class="ttdef"><b>Definition:</b> <a href="a00187_source.html#l00168">arrayfunctions.h:168</a></div></div>
<div class="ttc" id="a00164_html_aeadfdde0fbc3058bace813055212dcc3"><div class="ttname"><a href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">HyPar::hyp</a></div><div class="ttdeci">double * hyp</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00111">hypar.h:111</a></div></div>
<div class="ttc" id="a00164_html_a7eb68b9643feb74bd49f3a171b66eef1"><div class="ttname"><a href="a00164.html#a7eb68b9643feb74bd49f3a171b66eef1">HyPar::Upwind</a></div><div class="ttdeci">int(* Upwind)(double *, double *, double *, double *, double *, double *, int, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00279">hypar.h:279</a></div></div>
<div class="ttc" id="a00164_html_aa4de7bdc1e62417caf51b9c45184268d"><div class="ttname"><a href="a00164.html#aa4de7bdc1e62417caf51b9c45184268d">HyPar::ApplyBoundaryConditions</a></div><div class="ttdeci">int(* ApplyBoundaryConditions)(void *, void *, double *, double *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00201">hypar.h:201</a></div></div>
<div class="ttc" id="a00173_html_aba47a541676718cced51875b1c3a4ba6"><div class="ttname"><a href="a00173.html#aba47a541676718cced51875b1c3a4ba6">TransferVecFromPETSc</a></div><div class="ttdeci">int TransferVecFromPETSc(double *, Vec, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00359_source.html#l00022">TransferFromPETSc.c:22</a></div></div>
<div class="ttc" id="a00188_html_a68f50121fb9a7daeaf60e50cdef82ef3"><div class="ttname"><a href="a00188.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a></div><div class="ttdeci">#define _DECLARE_IERR_</div><div class="ttdef"><b>Definition:</b> <a href="a00188_source.html#l00013">basic.h:13</a></div></div>
<div class="ttc" id="a00164_html_a3b6b999a764f1e2ea94bb5f28c7a558c"><div class="ttname"><a href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">HyPar::u</a></div><div class="ttdeci">double * u</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00108">hypar.h:108</a></div></div>
<div class="ttc" id="a00173_html_a94499efe0f52b5174ce7105de5ab1a37"><div class="ttname"><a href="a00173.html#a94499efe0f52b5174ce7105de5ab1a37">TransferVecToPETSc</a></div><div class="ttdeci">int TransferVecToPETSc(double *, Vec, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00360_source.html#l00023">TransferToPETSc.c:23</a></div></div>
<div class="ttc" id="a00204_html_a60ace5964c051fa481e6a1e6f1ef75d7"><div class="ttname"><a href="a00204.html#a60ace5964c051fa481e6a1e6f1ef75d7">MPIExchangeBoundariesnD</a></div><div class="ttdeci">int MPIExchangeBoundariesnD(int, int, int *, int, void *, double *)</div><div class="ttdef"><b>Definition:</b> <a href="a00326_source.html#l00042">MPIExchangeBoundariesnD.c:42</a></div></div>
<div class="ttc" id="a00164_html_aafc992b5fa79d5a4036024615d03bce6"><div class="ttname"><a href="a00164.html#aafc992b5fa79d5a4036024615d03bce6">HyPar::ghosts</a></div><div class="ttdeci">int ghosts</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00044">hypar.h:44</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a91eb21ee4374b79a74f413d926344d7e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode PetscRHSFunctionImpl </td>
          <td>(</td>
          <td class="paramtype">TS&#160;</td>
          <td class="paramname"><em>ts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal&#160;</td>
          <td class="paramname"><em>t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Vec&#160;</td>
          <td class="paramname"><em>Y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Vec&#160;</td>
          <td class="paramname"><em>F</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>ctxt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Compute the right-hand-side (RHS) for the implicit time integration of the governing equations: The spatially discretized ODE can be expressed as </p>
<p class="formulaDsp">
\begin{equation} \frac {d{\bf U}} {dt} = {\bf F}\left({\bf U}\right). \end{equation}
</p>
<p> This function computes \({\bf F}\left({\bf U}\right)\), given \({\bf U}\).</p>
<dl class="section see"><dt>See Also</dt><dd>TSSetRHSFunction (<a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/TSSetRHSFunction.html">http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/TSSetRHSFunction.html</a>)</dd></dl>
<p>Note:</p>
<ul>
<li>This function is essentially identical to <a class="el" href="a00173.html#ac67533553372ed2b44b32d095c775f5c">PetscRHSFunctionExpl()</a>.</li>
<li>\({\bf U}\) is <em>Y</em> in the code.</li>
<li>See <a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/index.html">http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/index.html</a> for documentation on PETSc's time integrators.</li>
<li>All functions and variables whose names start with Vec, Mat, PC, KSP, SNES, and TS are defined by PETSc. Refer to the PETSc documentation (<a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/">http://www.mcs.anl.gov/petsc/petsc-current/docs/</a>). Usually, googling with the function or variable name yields the specific doc page dealing with that function/variable. </li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ts</td><td>Time integration object </td></tr>
    <tr><td class="paramname">t</td><td>Current simulation time </td></tr>
    <tr><td class="paramname">Y</td><td>State vector (input) </td></tr>
    <tr><td class="paramname">F</td><td>The computed right-hand-side vector </td></tr>
    <tr><td class="paramname">ctxt</td><td>Object of type <a class="el" href="a00173.html#a00591" title="Structure containing the variables for time-integration with PETSc. ">PETScContext</a> </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00358_source.html#l00037">37</a> of file <a class="el" href="a00358_source.html">PetscRHSFunctionImpl.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;{</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  <a class="code" href="a00173.html#a00591">PETScContext</a>    *context = (<a class="code" href="a00173.html#a00591">PETScContext</a>*) ctxt;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  <a class="code" href="a00164.html">HyPar</a>           *solver  = (<a class="code" href="a00164.html">HyPar</a>*)        context-&gt;<a class="code" href="a00173.html#ade1bc5cad8c6735a891a28f637cbfb06">solver</a>;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  <a class="code" href="a00167.html#a00588">MPIVariables</a>    *mpi     = (<a class="code" href="a00167.html#a00588">MPIVariables</a>*) context-&gt;<a class="code" href="a00173.html#abaa15763a88d05dc68ff230ce570eee9">mpi</a>;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  <span class="keywordtype">int</span>             d;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  <a class="code" href="a00188.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a>;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  PetscFunctionBegin;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  solver-&gt;<a class="code" href="a00164.html#a037bb9eabb2ecdb3812c625db433cf6b">count_RHSFunction</a>++;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  </div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <span class="keywordtype">int</span> size = 1;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  <span class="keywordflow">for</span> (d=0; d&lt;solver-&gt;<a class="code" href="a00164.html#a484873c74138512e41bc50d17b7d955a">ndims</a>; d++) size *= (solver-&gt;<a class="code" href="a00164.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>[d]+2*solver-&gt;<a class="code" href="a00164.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>);</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <span class="keywordtype">double</span> *u   = solver-&gt;<a class="code" href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <span class="keywordtype">double</span> *rhs = solver-&gt;<a class="code" href="a00164.html#ade4650485fe35fd3e12fea272fc80209">rhs</a>;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <span class="comment">/* copy solution from PETSc vector */</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <a class="code" href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00173.html#aba47a541676718cced51875b1c3a4ba6">TransferVecFromPETSc</a>(u,Y,context);                                         <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  <span class="comment">/* apply boundary conditions and exchange data over MPI interfaces */</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  <a class="code" href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00164.html#aa4de7bdc1e62417caf51b9c45184268d">ApplyBoundaryConditions</a>(solver,mpi,u,NULL,t);                      <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  <a class="code" href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00204.html#a60ace5964c051fa481e6a1e6f1ef75d7">MPIExchangeBoundariesnD</a>(solver-&gt;<a class="code" href="a00164.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00164.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;                               solver-&gt;<a class="code" href="a00164.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,mpi,u);                             <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="comment">/* Evaluate hyperbolic, parabolic and source terms  and the RHS */</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <a class="code" href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00164.html#aa245f8c9e6af37e47c5867dccbbc208b">HyperbolicFunction</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,u,solver,mpi,t,1,solver-&gt;<a class="code" href="a00164.html#a0d895f9bb0c8a3e79a64dd2379e1f2dd">FFunction</a>,solver-&gt;<a class="code" href="a00164.html#a7eb68b9643feb74bd49f3a171b66eef1">Upwind</a>);</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;                                                                                  <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <a class="code" href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00164.html#a75e8be4ea8c1ae2e99fc1e802e69a573">ParabolicFunction</a> (solver-&gt;<a class="code" href="a00164.html#ae53517ad7a202762d7b79eaf681701f3">par</a>,u,solver,mpi,t);                    <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <a class="code" href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00164.html#a662e256e081a2b74f971d02c747892b8">SourceFunction</a>    (solver-&gt;<a class="code" href="a00164.html#a6b4951ffdbd82f3a3848b82352d389d6">source</a>,u,solver,mpi,t);                 <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <a class="code" href="a00187.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,0.0);</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>   ,-1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00164.html#ae53517ad7a202762d7b79eaf681701f3">par</a>   , 1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00164.html#a6b4951ffdbd82f3a3848b82352d389d6">source</a>, 1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  <span class="comment">/* save a copy of the solution and RHS for use in IJacobian */</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  <a class="code" href="a00187.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>(u  ,solver-&gt;<a class="code" href="a00164.html#a3ccc9ddb96600c40dcc41bb1ded11160">uref</a>  ,(size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>));</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  <a class="code" href="a00187.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>(rhs,solver-&gt;<a class="code" href="a00164.html#ad587a58397d439c443ae325450a01a13">rhsref</a>,(size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>));</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <span class="comment">/* Transfer RHS to PETSc vector */</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <a class="code" href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00173.html#a94499efe0f52b5174ce7105de5ab1a37">TransferVecToPETSc</a>(rhs,F,context);                                         <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  PetscFunctionReturn(0);</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;}</div>
<div class="ttc" id="a00173_html_abaa15763a88d05dc68ff230ce570eee9"><div class="ttname"><a href="a00173.html#abaa15763a88d05dc68ff230ce570eee9">PETScContext::mpi</a></div><div class="ttdeci">void * mpi</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00039">petscinterface.h:39</a></div></div>
<div class="ttc" id="a00164_html_ae8f6d2fd6490d3153cb4133bf183a404"><div class="ttname"><a href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">HyPar::nvars</a></div><div class="ttdeci">int nvars</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00029">hypar.h:29</a></div></div>
<div class="ttc" id="a00164_html_a037bb9eabb2ecdb3812c625db433cf6b"><div class="ttname"><a href="a00164.html#a037bb9eabb2ecdb3812c625db433cf6b">HyPar::count_RHSFunction</a></div><div class="ttdeci">int count_RHSFunction</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00398">hypar.h:398</a></div></div>
<div class="ttc" id="a00187_html_a4cd66304bc41a7751842230af3063b62"><div class="ttname"><a href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a></div><div class="ttdeci">#define _ArrayAXPY_(x, a, y, size)</div><div class="ttdef"><b>Definition:</b> <a href="a00187_source.html#l00270">arrayfunctions.h:270</a></div></div>
<div class="ttc" id="a00164_html"><div class="ttname"><a href="a00164.html">HyPar</a></div><div class="ttdoc">Structure containing all solver-specific variables and functions. </div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00023">hypar.h:23</a></div></div>
<div class="ttc" id="a00164_html_a6b4951ffdbd82f3a3848b82352d389d6"><div class="ttname"><a href="a00164.html#a6b4951ffdbd82f3a3848b82352d389d6">HyPar::source</a></div><div class="ttdeci">double * source</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00117">hypar.h:117</a></div></div>
<div class="ttc" id="a00173_html_a00591"><div class="ttname"><a href="a00173.html#a00591">PETScContext</a></div><div class="ttdoc">Structure containing the variables for time-integration with PETSc. </div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00035">petscinterface.h:35</a></div></div>
<div class="ttc" id="a00164_html_a662e256e081a2b74f971d02c747892b8"><div class="ttname"><a href="a00164.html#a662e256e081a2b74f971d02c747892b8">HyPar::SourceFunction</a></div><div class="ttdeci">int(* SourceFunction)(double *, double *, void *, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00246">hypar.h:246</a></div></div>
<div class="ttc" id="a00164_html_ad587a58397d439c443ae325450a01a13"><div class="ttname"><a href="a00164.html#ad587a58397d439c443ae325450a01a13">HyPar::rhsref</a></div><div class="ttdeci">double * rhsref</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00374">hypar.h:374</a></div></div>
<div class="ttc" id="a00164_html_a484873c74138512e41bc50d17b7d955a"><div class="ttname"><a href="a00164.html#a484873c74138512e41bc50d17b7d955a">HyPar::ndims</a></div><div class="ttdeci">int ndims</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00026">hypar.h:26</a></div></div>
<div class="ttc" id="a00164_html_a38e0371f331cecbe63a77fa03e202afe"><div class="ttname"><a href="a00164.html#a38e0371f331cecbe63a77fa03e202afe">HyPar::dim_local</a></div><div class="ttdeci">int * dim_local</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00035">hypar.h:35</a></div></div>
<div class="ttc" id="a00188_html_add9cf96ae374934d245a1dc1ab697a42"><div class="ttname"><a href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a></div><div class="ttdeci">#define CHECKERR(ierr)</div><div class="ttdef"><b>Definition:</b> <a href="a00188_source.html#l00014">basic.h:14</a></div></div>
<div class="ttc" id="a00173_html_ade1bc5cad8c6735a891a28f637cbfb06"><div class="ttname"><a href="a00173.html#ade1bc5cad8c6735a891a28f637cbfb06">PETScContext::solver</a></div><div class="ttdeci">void * solver</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00037">petscinterface.h:37</a></div></div>
<div class="ttc" id="a00164_html_a75e8be4ea8c1ae2e99fc1e802e69a573"><div class="ttname"><a href="a00164.html#a75e8be4ea8c1ae2e99fc1e802e69a573">HyPar::ParabolicFunction</a></div><div class="ttdeci">int(* ParabolicFunction)(double *, double *, void *, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00243">hypar.h:243</a></div></div>
<div class="ttc" id="a00167_html_a00588"><div class="ttname"><a href="a00167.html#a00588">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a00167_source.html#l00024">mpivars_struct.h:24</a></div></div>
<div class="ttc" id="a00164_html_aa245f8c9e6af37e47c5867dccbbc208b"><div class="ttname"><a href="a00164.html#aa245f8c9e6af37e47c5867dccbbc208b">HyPar::HyperbolicFunction</a></div><div class="ttdeci">int(* HyperbolicFunction)(double *, double *, void *, void *, double, int, int(*)(double *, double *, int, void *, double), int(*)(double *, double *, double *, double *, double *, double *, int, void *, double))</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00237">hypar.h:237</a></div></div>
<div class="ttc" id="a00164_html_ae53517ad7a202762d7b79eaf681701f3"><div class="ttname"><a href="a00164.html#ae53517ad7a202762d7b79eaf681701f3">HyPar::par</a></div><div class="ttdeci">double * par</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00114">hypar.h:114</a></div></div>
<div class="ttc" id="a00188_html_ad6ab74942c9de13cf0b4c12eb0d91780"><div class="ttname"><a href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a></div><div class="ttdeci">#define IERR</div><div class="ttdef"><b>Definition:</b> <a href="a00188_source.html#l00012">basic.h:12</a></div></div>
<div class="ttc" id="a00164_html_a0d895f9bb0c8a3e79a64dd2379e1f2dd"><div class="ttname"><a href="a00164.html#a0d895f9bb0c8a3e79a64dd2379e1f2dd">HyPar::FFunction</a></div><div class="ttdeci">int(* FFunction)(double *, double *, int, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00262">hypar.h:262</a></div></div>
<div class="ttc" id="a00164_html_ade4650485fe35fd3e12fea272fc80209"><div class="ttname"><a href="a00164.html#ade4650485fe35fd3e12fea272fc80209">HyPar::rhs</a></div><div class="ttdeci">double * rhs</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00375">hypar.h:375</a></div></div>
<div class="ttc" id="a00187_html_a2b2826031c0cd92495ab351d3e599fc5"><div class="ttname"><a href="a00187.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a></div><div class="ttdeci">#define _ArraySetValue_(x, size, value)</div><div class="ttdef"><b>Definition:</b> <a href="a00187_source.html#l00168">arrayfunctions.h:168</a></div></div>
<div class="ttc" id="a00164_html_aeadfdde0fbc3058bace813055212dcc3"><div class="ttname"><a href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">HyPar::hyp</a></div><div class="ttdeci">double * hyp</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00111">hypar.h:111</a></div></div>
<div class="ttc" id="a00164_html_a7eb68b9643feb74bd49f3a171b66eef1"><div class="ttname"><a href="a00164.html#a7eb68b9643feb74bd49f3a171b66eef1">HyPar::Upwind</a></div><div class="ttdeci">int(* Upwind)(double *, double *, double *, double *, double *, double *, int, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00279">hypar.h:279</a></div></div>
<div class="ttc" id="a00164_html_aa4de7bdc1e62417caf51b9c45184268d"><div class="ttname"><a href="a00164.html#aa4de7bdc1e62417caf51b9c45184268d">HyPar::ApplyBoundaryConditions</a></div><div class="ttdeci">int(* ApplyBoundaryConditions)(void *, void *, double *, double *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00201">hypar.h:201</a></div></div>
<div class="ttc" id="a00173_html_aba47a541676718cced51875b1c3a4ba6"><div class="ttname"><a href="a00173.html#aba47a541676718cced51875b1c3a4ba6">TransferVecFromPETSc</a></div><div class="ttdeci">int TransferVecFromPETSc(double *, Vec, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00359_source.html#l00022">TransferFromPETSc.c:22</a></div></div>
<div class="ttc" id="a00188_html_a68f50121fb9a7daeaf60e50cdef82ef3"><div class="ttname"><a href="a00188.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a></div><div class="ttdeci">#define _DECLARE_IERR_</div><div class="ttdef"><b>Definition:</b> <a href="a00188_source.html#l00013">basic.h:13</a></div></div>
<div class="ttc" id="a00164_html_a3b6b999a764f1e2ea94bb5f28c7a558c"><div class="ttname"><a href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">HyPar::u</a></div><div class="ttdeci">double * u</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00108">hypar.h:108</a></div></div>
<div class="ttc" id="a00164_html_a3ccc9ddb96600c40dcc41bb1ded11160"><div class="ttname"><a href="a00164.html#a3ccc9ddb96600c40dcc41bb1ded11160">HyPar::uref</a></div><div class="ttdeci">double * uref</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00373">hypar.h:373</a></div></div>
<div class="ttc" id="a00173_html_a94499efe0f52b5174ce7105de5ab1a37"><div class="ttname"><a href="a00173.html#a94499efe0f52b5174ce7105de5ab1a37">TransferVecToPETSc</a></div><div class="ttdeci">int TransferVecToPETSc(double *, Vec, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00360_source.html#l00023">TransferToPETSc.c:23</a></div></div>
<div class="ttc" id="a00187_html_a89e8330d9e06dd0666c50833628a125c"><div class="ttname"><a href="a00187.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a></div><div class="ttdeci">#define _ArrayCopy1D_(x, y, size)</div><div class="ttdef"><b>Definition:</b> <a href="a00187_source.html#l00318">arrayfunctions.h:318</a></div></div>
<div class="ttc" id="a00204_html_a60ace5964c051fa481e6a1e6f1ef75d7"><div class="ttname"><a href="a00204.html#a60ace5964c051fa481e6a1e6f1ef75d7">MPIExchangeBoundariesnD</a></div><div class="ttdeci">int MPIExchangeBoundariesnD(int, int, int *, int, void *, double *)</div><div class="ttdef"><b>Definition:</b> <a href="a00326_source.html#l00042">MPIExchangeBoundariesnD.c:42</a></div></div>
<div class="ttc" id="a00164_html_aafc992b5fa79d5a4036024615d03bce6"><div class="ttname"><a href="a00164.html#aafc992b5fa79d5a4036024615d03bce6">HyPar::ghosts</a></div><div class="ttdeci">int ghosts</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00044">hypar.h:44</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac7d9b0a219eb22bfd37482b741bd79c9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode PetscRHSFunctionIMEX </td>
          <td>(</td>
          <td class="paramtype">TS&#160;</td>
          <td class="paramname"><em>ts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal&#160;</td>
          <td class="paramname"><em>t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Vec&#160;</td>
          <td class="paramname"><em>Y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Vec&#160;</td>
          <td class="paramname"><em>F</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>ctxt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Compute the explicitly-treated right-hand-side (RHS) for the implicit-explicit (IMEX) time integration of the governing equations: The ODE, obtained after discretizing the governing PDE in space, is expressed as follows (for the purpose of IMEX time integration): </p>
<p class="formulaDsp">
\begin{eqnarray} \frac {d{\bf U}}{dt} &amp;=&amp; {\bf F}\left({\bf U}\right) + {\bf G}\left({\bf U}\right), \\ \Rightarrow \dot{\bf U} - {\bf G}\left({\bf U}\right) &amp;=&amp; {\bf F}\left({\bf U}\right), \end{eqnarray}
</p>
<p> where \({\bf F}\) is non-stiff and integrated in time explicitly, and \({\bf G}\) is stiff and integrated in time implicitly, and \({\bf U}\) represents the entire solution vector (state vector).</p>
<p>Note that \({\bf F}\left({\bf U}\right)\) represents all terms that the user has indicated to be integrated in time explicitly (<a class="el" href="a00173.html#a6a0edd627a2b2cc687d1031e3884dd6a">PETScContext::flag_hyperbolic_f</a>, <a class="el" href="a00173.html#a21b4785029b7597816341479bc3260b4">PETScContext::flag_hyperbolic_df</a>, <a class="el" href="a00173.html#a376b6b34e162357d201827d01a5aa2a4">PETScContext::flag_hyperbolic</a>, <a class="el" href="a00173.html#ac48ad2561e5e125d2789133e848db1d9">PETScContext::flag_parabolic</a>, and <a class="el" href="a00173.html#a54c0451c4ae9650a54f54246f1f8823b">PETScContext::flag_source</a>).</p>
<p>This function computes \({\bf F}\left({\bf U}\right)\), given \({\bf U}\).</p>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="a00173.html#a9d093c3140369a1178dd5b9589a926b1">PetscIFunctionIMEX()</a>, TSSetRHSFunction (<a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/TSSetRHSFunction.html">http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/TSSetRHSFunction.html</a>)</dd></dl>
<p>Note:</p>
<ul>
<li>\({\bf U}\) is <em>Y</em> in the code. PETsc denotes the state vector with \({\bf Y}\) in its time integrators.</li>
<li>It is assumed that the reader is familiar with PETSc's implementation of IMEX time integrators, for example, TSARKIMEX (<a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/TSARKIMEX.html">http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/TSARKIMEX.html</a>).</li>
<li>See <a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/index.html">http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/index.html</a> for documentation on PETSc's time integrators.</li>
<li>All functions and variables whose names start with Vec, Mat, PC, KSP, SNES, and TS are defined by PETSc. Refer to the PETSc documentation (<a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/">http://www.mcs.anl.gov/petsc/petsc-current/docs/</a>). Usually, googling with the function or variable name yields the specific doc page dealing with that function/variable. </li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ts</td><td>Time integration object </td></tr>
    <tr><td class="paramname">t</td><td>Current simulation time </td></tr>
    <tr><td class="paramname">Y</td><td>State vector (input) </td></tr>
    <tr><td class="paramname">F</td><td>The computed right-hand-side vector </td></tr>
    <tr><td class="paramname">ctxt</td><td>Object of type <a class="el" href="a00173.html#a00591" title="Structure containing the variables for time-integration with PETSc. ">PETScContext</a> </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00357_source.html#l00049">49</a> of file <a class="el" href="a00357_source.html">PetscRHSFunctionIMEX.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;{</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <a class="code" href="a00173.html#a00591">PETScContext</a>    *context = (<a class="code" href="a00173.html#a00591">PETScContext</a>*) ctxt;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <a class="code" href="a00164.html">HyPar</a>           *solver  = (<a class="code" href="a00164.html">HyPar</a>*)        context-&gt;<a class="code" href="a00173.html#ade1bc5cad8c6735a891a28f637cbfb06">solver</a>;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <a class="code" href="a00167.html#a00588">MPIVariables</a>    *mpi     = (<a class="code" href="a00167.html#a00588">MPIVariables</a>*) context-&gt;<a class="code" href="a00173.html#abaa15763a88d05dc68ff230ce570eee9">mpi</a>;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <span class="keywordtype">int</span>             d;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <a class="code" href="a00188.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a>;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  PetscFunctionBegin;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  solver-&gt;<a class="code" href="a00164.html#a037bb9eabb2ecdb3812c625db433cf6b">count_RHSFunction</a>++;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  </div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  <span class="keywordtype">int</span> size = 1;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="keywordflow">for</span> (d=0; d&lt;solver-&gt;<a class="code" href="a00164.html#a484873c74138512e41bc50d17b7d955a">ndims</a>; d++) size *= (solver-&gt;<a class="code" href="a00164.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>[d]+2*solver-&gt;<a class="code" href="a00164.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>);</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  <span class="keywordtype">double</span> *u   = solver-&gt;<a class="code" href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <span class="keywordtype">double</span> *rhs = solver-&gt;<a class="code" href="a00164.html#ade4650485fe35fd3e12fea272fc80209">rhs</a>;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <span class="comment">/* copy solution from PETSc vector */</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <a class="code" href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00173.html#aba47a541676718cced51875b1c3a4ba6">TransferVecFromPETSc</a>(u,Y,context); <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <span class="comment">/* apply boundary conditions and exchange data over MPI interfaces */</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  <a class="code" href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00164.html#aa4de7bdc1e62417caf51b9c45184268d">ApplyBoundaryConditions</a>(solver,mpi,u,NULL,t); <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  <a class="code" href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00204.html#a60ace5964c051fa481e6a1e6f1ef75d7">MPIExchangeBoundariesnD</a>(solver-&gt;<a class="code" href="a00164.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00164.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;                               solver-&gt;<a class="code" href="a00164.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,mpi,u); <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  <span class="comment">/* initialize right-hand side to zero */</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  <a class="code" href="a00187.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,0.0);</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <span class="comment">/* Evaluate hyperbolic, parabolic and source terms  and the RHS */</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <span class="keywordflow">if</span> ((!strcmp(solver-&gt;<a class="code" href="a00164.html#a5bed0cb9665daad89f4377c4f7609df4">SplitHyperbolicFlux</a>,<span class="stringliteral">&quot;yes&quot;</span>)) &amp;&amp; solver-&gt;<a class="code" href="a00164.html#ad607f82c4bfde055613e05272f9afd81">flag_fdf_specified</a>) {</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00173.html#a6a0edd627a2b2cc687d1031e3884dd6a">flag_hyperbolic_f</a> == <a class="code" href="a00173.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>) {</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;      <a class="code" href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00164.html#aa245f8c9e6af37e47c5867dccbbc208b">HyperbolicFunction</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,u,solver,mpi,t,0,solver-&gt;<a class="code" href="a00164.html#adcc5e677515d0952ce3ff702c9d85b86">FdFFunction</a>,solver-&gt;<a class="code" href="a00164.html#ab06746933e859e829d694505c18258b3">UpwindFdF</a>);  </div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;      <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;      <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,-1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    } </div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00173.html#a21b4785029b7597816341479bc3260b4">flag_hyperbolic_df</a> == <a class="code" href="a00173.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>) {</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;      <a class="code" href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00164.html#aa245f8c9e6af37e47c5867dccbbc208b">HyperbolicFunction</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,u,solver,mpi,t,0,solver-&gt;<a class="code" href="a00164.html#aa1dd38befc4bb4adda9d456146436b14">dFFunction</a>,solver-&gt;<a class="code" href="a00164.html#a73a85f83072e02bf979234486265b6d3">UpwinddF</a>); </div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;      <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;      <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,-1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    }</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00164.html#a5bed0cb9665daad89f4377c4f7609df4">SplitHyperbolicFlux</a>,<span class="stringliteral">&quot;yes&quot;</span>)) {</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00173.html#a6a0edd627a2b2cc687d1031e3884dd6a">flag_hyperbolic_f</a> == <a class="code" href="a00173.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>) {</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;      <a class="code" href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00164.html#aa245f8c9e6af37e47c5867dccbbc208b">HyperbolicFunction</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,u,solver,mpi,t,0,solver-&gt;<a class="code" href="a00164.html#a0d895f9bb0c8a3e79a64dd2379e1f2dd">FFunction</a>,solver-&gt;<a class="code" href="a00164.html#a7eb68b9643feb74bd49f3a171b66eef1">Upwind</a>);  </div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;      <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;      <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,-1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;      <a class="code" href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00164.html#aa245f8c9e6af37e47c5867dccbbc208b">HyperbolicFunction</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,u,solver,mpi,t,0,solver-&gt;<a class="code" href="a00164.html#aa1dd38befc4bb4adda9d456146436b14">dFFunction</a>,solver-&gt;<a class="code" href="a00164.html#a73a85f83072e02bf979234486265b6d3">UpwinddF</a>); </div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;      <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;      <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>, 1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    } </div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00173.html#a21b4785029b7597816341479bc3260b4">flag_hyperbolic_df</a> == <a class="code" href="a00173.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>) {</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;      <a class="code" href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00164.html#aa245f8c9e6af37e47c5867dccbbc208b">HyperbolicFunction</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,u,solver,mpi,t,0,solver-&gt;<a class="code" href="a00164.html#aa1dd38befc4bb4adda9d456146436b14">dFFunction</a>,solver-&gt;<a class="code" href="a00164.html#a73a85f83072e02bf979234486265b6d3">UpwinddF</a>); </div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;      <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;      <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,-1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    }</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00173.html#a376b6b34e162357d201827d01a5aa2a4">flag_hyperbolic</a> == <a class="code" href="a00173.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>) {</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;      <a class="code" href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00164.html#aa245f8c9e6af37e47c5867dccbbc208b">HyperbolicFunction</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,u,solver,mpi,t,0,solver-&gt;<a class="code" href="a00164.html#a0d895f9bb0c8a3e79a64dd2379e1f2dd">FFunction</a>,solver-&gt;<a class="code" href="a00164.html#a7eb68b9643feb74bd49f3a171b66eef1">Upwind</a>);  </div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;      <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;      <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,-1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    }</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  }</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00173.html#ac48ad2561e5e125d2789133e848db1d9">flag_parabolic</a> == <a class="code" href="a00173.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>) {</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <a class="code" href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00164.html#a75e8be4ea8c1ae2e99fc1e802e69a573">ParabolicFunction</a> (solver-&gt;<a class="code" href="a00164.html#ae53517ad7a202762d7b79eaf681701f3">par</a>,u,solver,mpi,t);                        </div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00164.html#ae53517ad7a202762d7b79eaf681701f3">par</a>, 1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  }</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00173.html#a54c0451c4ae9650a54f54246f1f8823b">flag_source</a> == <a class="code" href="a00173.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>) {</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <a class="code" href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00164.html#a662e256e081a2b74f971d02c747892b8">SourceFunction</a>    (solver-&gt;<a class="code" href="a00164.html#a6b4951ffdbd82f3a3848b82352d389d6">source</a>,u,solver,mpi,t);                     </div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00164.html#a6b4951ffdbd82f3a3848b82352d389d6">source</a>, 1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  }</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <span class="comment">/* Transfer RHS to PETSc vector */</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <a class="code" href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00173.html#a94499efe0f52b5174ce7105de5ab1a37">TransferVecToPETSc</a>(rhs,F,context); <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  PetscFunctionReturn(0);</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;}</div>
<div class="ttc" id="a00173_html_abaa15763a88d05dc68ff230ce570eee9"><div class="ttname"><a href="a00173.html#abaa15763a88d05dc68ff230ce570eee9">PETScContext::mpi</a></div><div class="ttdeci">void * mpi</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00039">petscinterface.h:39</a></div></div>
<div class="ttc" id="a00164_html_ae8f6d2fd6490d3153cb4133bf183a404"><div class="ttname"><a href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">HyPar::nvars</a></div><div class="ttdeci">int nvars</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00029">hypar.h:29</a></div></div>
<div class="ttc" id="a00164_html_a037bb9eabb2ecdb3812c625db433cf6b"><div class="ttname"><a href="a00164.html#a037bb9eabb2ecdb3812c625db433cf6b">HyPar::count_RHSFunction</a></div><div class="ttdeci">int count_RHSFunction</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00398">hypar.h:398</a></div></div>
<div class="ttc" id="a00187_html_a4cd66304bc41a7751842230af3063b62"><div class="ttname"><a href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a></div><div class="ttdeci">#define _ArrayAXPY_(x, a, y, size)</div><div class="ttdef"><b>Definition:</b> <a href="a00187_source.html#l00270">arrayfunctions.h:270</a></div></div>
<div class="ttc" id="a00173_html_a377d0d14ec878aeb4deed4a0533e213d"><div class="ttname"><a href="a00173.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a></div><div class="ttdeci">#define _EXPLICIT_</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00020">petscinterface.h:20</a></div></div>
<div class="ttc" id="a00164_html"><div class="ttname"><a href="a00164.html">HyPar</a></div><div class="ttdoc">Structure containing all solver-specific variables and functions. </div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00023">hypar.h:23</a></div></div>
<div class="ttc" id="a00164_html_a6b4951ffdbd82f3a3848b82352d389d6"><div class="ttname"><a href="a00164.html#a6b4951ffdbd82f3a3848b82352d389d6">HyPar::source</a></div><div class="ttdeci">double * source</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00117">hypar.h:117</a></div></div>
<div class="ttc" id="a00164_html_a73a85f83072e02bf979234486265b6d3"><div class="ttname"><a href="a00164.html#a73a85f83072e02bf979234486265b6d3">HyPar::UpwinddF</a></div><div class="ttdeci">int(* UpwinddF)(double *, double *, double *, double *, double *, double *, int, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00284">hypar.h:284</a></div></div>
<div class="ttc" id="a00173_html_a00591"><div class="ttname"><a href="a00173.html#a00591">PETScContext</a></div><div class="ttdoc">Structure containing the variables for time-integration with PETSc. </div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00035">petscinterface.h:35</a></div></div>
<div class="ttc" id="a00164_html_a662e256e081a2b74f971d02c747892b8"><div class="ttname"><a href="a00164.html#a662e256e081a2b74f971d02c747892b8">HyPar::SourceFunction</a></div><div class="ttdeci">int(* SourceFunction)(double *, double *, void *, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00246">hypar.h:246</a></div></div>
<div class="ttc" id="a00164_html_a484873c74138512e41bc50d17b7d955a"><div class="ttname"><a href="a00164.html#a484873c74138512e41bc50d17b7d955a">HyPar::ndims</a></div><div class="ttdeci">int ndims</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00026">hypar.h:26</a></div></div>
<div class="ttc" id="a00173_html_ac48ad2561e5e125d2789133e848db1d9"><div class="ttname"><a href="a00173.html#ac48ad2561e5e125d2789133e848db1d9">PETScContext::flag_parabolic</a></div><div class="ttdeci">int flag_parabolic</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00066">petscinterface.h:66</a></div></div>
<div class="ttc" id="a00164_html_a38e0371f331cecbe63a77fa03e202afe"><div class="ttname"><a href="a00164.html#a38e0371f331cecbe63a77fa03e202afe">HyPar::dim_local</a></div><div class="ttdeci">int * dim_local</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00035">hypar.h:35</a></div></div>
<div class="ttc" id="a00188_html_add9cf96ae374934d245a1dc1ab697a42"><div class="ttname"><a href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a></div><div class="ttdeci">#define CHECKERR(ierr)</div><div class="ttdef"><b>Definition:</b> <a href="a00188_source.html#l00014">basic.h:14</a></div></div>
<div class="ttc" id="a00173_html_ade1bc5cad8c6735a891a28f637cbfb06"><div class="ttname"><a href="a00173.html#ade1bc5cad8c6735a891a28f637cbfb06">PETScContext::solver</a></div><div class="ttdeci">void * solver</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00037">petscinterface.h:37</a></div></div>
<div class="ttc" id="a00164_html_a75e8be4ea8c1ae2e99fc1e802e69a573"><div class="ttname"><a href="a00164.html#a75e8be4ea8c1ae2e99fc1e802e69a573">HyPar::ParabolicFunction</a></div><div class="ttdeci">int(* ParabolicFunction)(double *, double *, void *, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00243">hypar.h:243</a></div></div>
<div class="ttc" id="a00173_html_a6a0edd627a2b2cc687d1031e3884dd6a"><div class="ttname"><a href="a00173.html#a6a0edd627a2b2cc687d1031e3884dd6a">PETScContext::flag_hyperbolic_f</a></div><div class="ttdeci">int flag_hyperbolic_f</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00062">petscinterface.h:62</a></div></div>
<div class="ttc" id="a00167_html_a00588"><div class="ttname"><a href="a00167.html#a00588">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a00167_source.html#l00024">mpivars_struct.h:24</a></div></div>
<div class="ttc" id="a00173_html_a54c0451c4ae9650a54f54246f1f8823b"><div class="ttname"><a href="a00173.html#a54c0451c4ae9650a54f54246f1f8823b">PETScContext::flag_source</a></div><div class="ttdeci">int flag_source</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00068">petscinterface.h:68</a></div></div>
<div class="ttc" id="a00164_html_aa245f8c9e6af37e47c5867dccbbc208b"><div class="ttname"><a href="a00164.html#aa245f8c9e6af37e47c5867dccbbc208b">HyPar::HyperbolicFunction</a></div><div class="ttdeci">int(* HyperbolicFunction)(double *, double *, void *, void *, double, int, int(*)(double *, double *, int, void *, double), int(*)(double *, double *, double *, double *, double *, double *, int, void *, double))</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00237">hypar.h:237</a></div></div>
<div class="ttc" id="a00164_html_ae53517ad7a202762d7b79eaf681701f3"><div class="ttname"><a href="a00164.html#ae53517ad7a202762d7b79eaf681701f3">HyPar::par</a></div><div class="ttdeci">double * par</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00114">hypar.h:114</a></div></div>
<div class="ttc" id="a00188_html_ad6ab74942c9de13cf0b4c12eb0d91780"><div class="ttname"><a href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a></div><div class="ttdeci">#define IERR</div><div class="ttdef"><b>Definition:</b> <a href="a00188_source.html#l00012">basic.h:12</a></div></div>
<div class="ttc" id="a00164_html_a0d895f9bb0c8a3e79a64dd2379e1f2dd"><div class="ttname"><a href="a00164.html#a0d895f9bb0c8a3e79a64dd2379e1f2dd">HyPar::FFunction</a></div><div class="ttdeci">int(* FFunction)(double *, double *, int, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00262">hypar.h:262</a></div></div>
<div class="ttc" id="a00164_html_ade4650485fe35fd3e12fea272fc80209"><div class="ttname"><a href="a00164.html#ade4650485fe35fd3e12fea272fc80209">HyPar::rhs</a></div><div class="ttdeci">double * rhs</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00375">hypar.h:375</a></div></div>
<div class="ttc" id="a00164_html_a5bed0cb9665daad89f4377c4f7609df4"><div class="ttname"><a href="a00164.html#a5bed0cb9665daad89f4377c4f7609df4">HyPar::SplitHyperbolicFlux</a></div><div class="ttdeci">char SplitHyperbolicFlux[_MAX_STRING_SIZE_]</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00084">hypar.h:84</a></div></div>
<div class="ttc" id="a00164_html_aa1dd38befc4bb4adda9d456146436b14"><div class="ttname"><a href="a00164.html#aa1dd38befc4bb4adda9d456146436b14">HyPar::dFFunction</a></div><div class="ttdeci">int(* dFFunction)(double *, double *, int, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00266">hypar.h:266</a></div></div>
<div class="ttc" id="a00173_html_a21b4785029b7597816341479bc3260b4"><div class="ttname"><a href="a00173.html#a21b4785029b7597816341479bc3260b4">PETScContext::flag_hyperbolic_df</a></div><div class="ttdeci">int flag_hyperbolic_df</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00064">petscinterface.h:64</a></div></div>
<div class="ttc" id="a00164_html_ab06746933e859e829d694505c18258b3"><div class="ttname"><a href="a00164.html#ab06746933e859e829d694505c18258b3">HyPar::UpwindFdF</a></div><div class="ttdeci">int(* UpwindFdF)(double *, double *, double *, double *, double *, double *, int, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00291">hypar.h:291</a></div></div>
<div class="ttc" id="a00187_html_a2b2826031c0cd92495ab351d3e599fc5"><div class="ttname"><a href="a00187.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a></div><div class="ttdeci">#define _ArraySetValue_(x, size, value)</div><div class="ttdef"><b>Definition:</b> <a href="a00187_source.html#l00168">arrayfunctions.h:168</a></div></div>
<div class="ttc" id="a00164_html_aeadfdde0fbc3058bace813055212dcc3"><div class="ttname"><a href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">HyPar::hyp</a></div><div class="ttdeci">double * hyp</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00111">hypar.h:111</a></div></div>
<div class="ttc" id="a00164_html_a7eb68b9643feb74bd49f3a171b66eef1"><div class="ttname"><a href="a00164.html#a7eb68b9643feb74bd49f3a171b66eef1">HyPar::Upwind</a></div><div class="ttdeci">int(* Upwind)(double *, double *, double *, double *, double *, double *, int, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00279">hypar.h:279</a></div></div>
<div class="ttc" id="a00164_html_aa4de7bdc1e62417caf51b9c45184268d"><div class="ttname"><a href="a00164.html#aa4de7bdc1e62417caf51b9c45184268d">HyPar::ApplyBoundaryConditions</a></div><div class="ttdeci">int(* ApplyBoundaryConditions)(void *, void *, double *, double *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00201">hypar.h:201</a></div></div>
<div class="ttc" id="a00173_html_aba47a541676718cced51875b1c3a4ba6"><div class="ttname"><a href="a00173.html#aba47a541676718cced51875b1c3a4ba6">TransferVecFromPETSc</a></div><div class="ttdeci">int TransferVecFromPETSc(double *, Vec, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00359_source.html#l00022">TransferFromPETSc.c:22</a></div></div>
<div class="ttc" id="a00188_html_a68f50121fb9a7daeaf60e50cdef82ef3"><div class="ttname"><a href="a00188.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a></div><div class="ttdeci">#define _DECLARE_IERR_</div><div class="ttdef"><b>Definition:</b> <a href="a00188_source.html#l00013">basic.h:13</a></div></div>
<div class="ttc" id="a00164_html_a3b6b999a764f1e2ea94bb5f28c7a558c"><div class="ttname"><a href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">HyPar::u</a></div><div class="ttdeci">double * u</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00108">hypar.h:108</a></div></div>
<div class="ttc" id="a00164_html_ad607f82c4bfde055613e05272f9afd81"><div class="ttname"><a href="a00164.html#ad607f82c4bfde055613e05272f9afd81">HyPar::flag_fdf_specified</a></div><div class="ttdeci">int flag_fdf_specified</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00276">hypar.h:276</a></div></div>
<div class="ttc" id="a00173_html_a94499efe0f52b5174ce7105de5ab1a37"><div class="ttname"><a href="a00173.html#a94499efe0f52b5174ce7105de5ab1a37">TransferVecToPETSc</a></div><div class="ttdeci">int TransferVecToPETSc(double *, Vec, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00360_source.html#l00023">TransferToPETSc.c:23</a></div></div>
<div class="ttc" id="a00204_html_a60ace5964c051fa481e6a1e6f1ef75d7"><div class="ttname"><a href="a00204.html#a60ace5964c051fa481e6a1e6f1ef75d7">MPIExchangeBoundariesnD</a></div><div class="ttdeci">int MPIExchangeBoundariesnD(int, int, int *, int, void *, double *)</div><div class="ttdef"><b>Definition:</b> <a href="a00326_source.html#l00042">MPIExchangeBoundariesnD.c:42</a></div></div>
<div class="ttc" id="a00164_html_aafc992b5fa79d5a4036024615d03bce6"><div class="ttname"><a href="a00164.html#aafc992b5fa79d5a4036024615d03bce6">HyPar::ghosts</a></div><div class="ttdeci">int ghosts</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00044">hypar.h:44</a></div></div>
<div class="ttc" id="a00173_html_a376b6b34e162357d201827d01a5aa2a4"><div class="ttname"><a href="a00173.html#a376b6b34e162357d201827d01a5aa2a4">PETScContext::flag_hyperbolic</a></div><div class="ttdeci">int flag_hyperbolic</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00060">petscinterface.h:60</a></div></div>
<div class="ttc" id="a00164_html_adcc5e677515d0952ce3ff702c9d85b86"><div class="ttname"><a href="a00164.html#adcc5e677515d0952ce3ff702c9d85b86">HyPar::FdFFunction</a></div><div class="ttdeci">int(* FdFFunction)(double *, double *, int, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00272">hypar.h:272</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a9d093c3140369a1178dd5b9589a926b1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode PetscIFunctionIMEX </td>
          <td>(</td>
          <td class="paramtype">TS&#160;</td>
          <td class="paramname"><em>ts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal&#160;</td>
          <td class="paramname"><em>t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Vec&#160;</td>
          <td class="paramname"><em>Y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Vec&#160;</td>
          <td class="paramname"><em>Ydot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Vec&#160;</td>
          <td class="paramname"><em>F</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>ctxt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Compute the implicitly-treated part of the right-hand-side for the implicit-explicit (IMEX) time integration of the governing equations: The ODE, obtained after discretizing the governing PDE in space, is expressed as follows (for the purpose of IMEX time integration): </p>
<p class="formulaDsp">
\begin{eqnarray} \frac {d{\bf U}}{dt} &amp;=&amp; {\bf F}\left({\bf U}\right) + {\bf G}\left({\bf U}\right), \\ \Rightarrow \dot{\bf U} - {\bf G}\left({\bf U}\right) &amp;=&amp; {\bf F}\left({\bf U}\right), \end{eqnarray}
</p>
<p> where \({\bf F}\) is non-stiff and integrated in time explicitly, and \({\bf G}\) is stiff and integrated in time implicitly, and \({\bf U}\) represents the entire solution vector (state vector).</p>
<p>Note that \({\bf G}\left({\bf U}\right)\) represents all terms that the user has indicated to be integrated in time implicitly (<a class="el" href="a00173.html#a6a0edd627a2b2cc687d1031e3884dd6a">PETScContext::flag_hyperbolic_f</a>, <a class="el" href="a00173.html#a21b4785029b7597816341479bc3260b4">PETScContext::flag_hyperbolic_df</a>, <a class="el" href="a00173.html#a376b6b34e162357d201827d01a5aa2a4">PETScContext::flag_hyperbolic</a>, <a class="el" href="a00173.html#ac48ad2561e5e125d2789133e848db1d9">PETScContext::flag_parabolic</a>, and <a class="el" href="a00173.html#a54c0451c4ae9650a54f54246f1f8823b">PETScContext::flag_source</a>).</p>
<p>This function computes the left-hand-side of the above equation: </p>
<p class="formulaDsp">
\begin{equation} \mathcal{G}\left(\dot{\bf U},{\bf U},t\right) = \dot{\bf U} - {\bf G}\left({\bf U}\right) \end{equation}
</p>
<p> given \(\dot{\bf U}\) and \({\bf U}\).</p>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="a00173.html#ac7d9b0a219eb22bfd37482b741bd79c9">PetscRHSFunctionIMEX()</a></dd></dl>
<p><b>Notes:</b> </p>
<ul>
<li><em>Y</em> and <em>Ydot</em> in the code are \({\bf U}\) and \(\dot{\bf U}\), respectively. PETsc denotes the state vector with \({\bf Y}\) in its time integrators.</li>
<li>It is assumed that the reader is familiar with PETSc's implementation of IMEX time integrators, for example, TSARKIMEX (<a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/TSARKIMEX.html">http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/TSARKIMEX.html</a>).</li>
<li>See <a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/index.html">http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/index.html</a> for documentation on PETSc's time integrators.</li>
<li>All functions and variables whose names start with Vec, Mat, PC, KSP, SNES, and TS are defined by PETSc. Refer to the PETSc documentation (<a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/">http://www.mcs.anl.gov/petsc/petsc-current/docs/</a>). Usually, googling with the function or variable name yields the specific doc page dealing with that function/variable. </li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ts</td><td>The time integration object </td></tr>
    <tr><td class="paramname">t</td><td>Current solution time </td></tr>
    <tr><td class="paramname">Y</td><td>State vector (input) </td></tr>
    <tr><td class="paramname">Ydot</td><td>Time derivative of the state vector (input) </td></tr>
    <tr><td class="paramname">F</td><td>The computed function vector </td></tr>
    <tr><td class="paramname">ctxt</td><td>Object of type <a class="el" href="a00173.html#a00591" title="Structure containing the variables for time-integration with PETSc. ">PETScContext</a> </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00348_source.html#l00053">53</a> of file <a class="el" href="a00348_source.html">PetscIFunctionIMEX.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;{</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  <a class="code" href="a00173.html#a00591">PETScContext</a>    *context = (<a class="code" href="a00173.html#a00591">PETScContext</a>*) ctxt;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  <a class="code" href="a00164.html">HyPar</a>           *solver  = (<a class="code" href="a00164.html">HyPar</a>*)        context-&gt;<a class="code" href="a00173.html#ade1bc5cad8c6735a891a28f637cbfb06">solver</a>;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  <a class="code" href="a00167.html#a00588">MPIVariables</a>    *mpi     = (<a class="code" href="a00167.html#a00588">MPIVariables</a>*) context-&gt;<a class="code" href="a00173.html#abaa15763a88d05dc68ff230ce570eee9">mpi</a>;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  <span class="keywordtype">int</span>             ierr     = 0, d;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  PetscFunctionBegin;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  solver-&gt;<a class="code" href="a00164.html#a7d89659a19156a22ef22a361592ef5f7">count_IFunction</a>++;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <span class="keywordtype">int</span> size = 1;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <span class="keywordflow">for</span> (d=0; d&lt;solver-&gt;<a class="code" href="a00164.html#a484873c74138512e41bc50d17b7d955a">ndims</a>; d++) size *= (solver-&gt;<a class="code" href="a00164.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>[d]+2*solver-&gt;<a class="code" href="a00164.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <span class="keywordtype">double</span> *u   = solver-&gt;<a class="code" href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <span class="keywordtype">double</span> *rhs = solver-&gt;<a class="code" href="a00164.html#ade4650485fe35fd3e12fea272fc80209">rhs</a>;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  <span class="comment">/* copy solution from PETSc vector */</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  ierr = <a class="code" href="a00173.html#aba47a541676718cced51875b1c3a4ba6">TransferVecFromPETSc</a>(u,Y,context);                         <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  <span class="comment">/* apply boundary conditions and exchange data over MPI interfaces */</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  ierr = solver-&gt;<a class="code" href="a00164.html#aa4de7bdc1e62417caf51b9c45184268d">ApplyBoundaryConditions</a>(solver,mpi,u,NULL,t);      <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  ierr = <a class="code" href="a00204.html#a60ace5964c051fa481e6a1e6f1ef75d7">MPIExchangeBoundariesnD</a>(solver-&gt;<a class="code" href="a00164.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00164.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                                 solver-&gt;<a class="code" href="a00164.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,mpi,u);             <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <span class="comment">/* initialize right-hand side to zero */</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <a class="code" href="a00187.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,0.0);</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <span class="comment">/* Evaluate hyperbolic, parabolic and source terms  and the RHS */</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <span class="keywordflow">if</span> ((!strcmp(solver-&gt;<a class="code" href="a00164.html#a5bed0cb9665daad89f4377c4f7609df4">SplitHyperbolicFlux</a>,<span class="stringliteral">&quot;yes&quot;</span>)) &amp;&amp; solver-&gt;<a class="code" href="a00164.html#ad607f82c4bfde055613e05272f9afd81">flag_fdf_specified</a>) {</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00173.html#a6a0edd627a2b2cc687d1031e3884dd6a">flag_hyperbolic_f</a> == <a class="code" href="a00173.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>) {</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;      ierr = solver-&gt;<a class="code" href="a00164.html#aa245f8c9e6af37e47c5867dccbbc208b">HyperbolicFunction</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,u,solver,mpi,t,0,solver-&gt;<a class="code" href="a00164.html#adcc5e677515d0952ce3ff702c9d85b86">FdFFunction</a>,solver-&gt;<a class="code" href="a00164.html#ab06746933e859e829d694505c18258b3">UpwindFdF</a>);  </div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;      <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;      <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,-1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    } </div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00173.html#a21b4785029b7597816341479bc3260b4">flag_hyperbolic_df</a> == <a class="code" href="a00173.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>) {</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;      ierr = solver-&gt;<a class="code" href="a00164.html#aa245f8c9e6af37e47c5867dccbbc208b">HyperbolicFunction</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,u,solver,mpi,t,0,solver-&gt;<a class="code" href="a00164.html#aa1dd38befc4bb4adda9d456146436b14">dFFunction</a>,solver-&gt;<a class="code" href="a00164.html#a73a85f83072e02bf979234486265b6d3">UpwinddF</a>); </div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;      <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;      <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,-1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    }</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00164.html#a5bed0cb9665daad89f4377c4f7609df4">SplitHyperbolicFlux</a>,<span class="stringliteral">&quot;yes&quot;</span>)) {</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00173.html#a6a0edd627a2b2cc687d1031e3884dd6a">flag_hyperbolic_f</a> == <a class="code" href="a00173.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>) {</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;      ierr = solver-&gt;<a class="code" href="a00164.html#aa245f8c9e6af37e47c5867dccbbc208b">HyperbolicFunction</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,u,solver,mpi,t,0,solver-&gt;<a class="code" href="a00164.html#a0d895f9bb0c8a3e79a64dd2379e1f2dd">FFunction</a>,solver-&gt;<a class="code" href="a00164.html#a7eb68b9643feb74bd49f3a171b66eef1">Upwind</a>);  </div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;      <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;      <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,-1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;      ierr = solver-&gt;<a class="code" href="a00164.html#aa245f8c9e6af37e47c5867dccbbc208b">HyperbolicFunction</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,u,solver,mpi,t,0,solver-&gt;<a class="code" href="a00164.html#aa1dd38befc4bb4adda9d456146436b14">dFFunction</a>,solver-&gt;<a class="code" href="a00164.html#a73a85f83072e02bf979234486265b6d3">UpwinddF</a>); </div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;      <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;      <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>, 1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    } </div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00173.html#a21b4785029b7597816341479bc3260b4">flag_hyperbolic_df</a> == <a class="code" href="a00173.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>) {</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;      ierr = solver-&gt;<a class="code" href="a00164.html#aa245f8c9e6af37e47c5867dccbbc208b">HyperbolicFunction</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,u,solver,mpi,t,0,solver-&gt;<a class="code" href="a00164.html#aa1dd38befc4bb4adda9d456146436b14">dFFunction</a>,solver-&gt;<a class="code" href="a00164.html#a73a85f83072e02bf979234486265b6d3">UpwinddF</a>); </div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;      <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;      <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,-1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    }</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00173.html#a376b6b34e162357d201827d01a5aa2a4">flag_hyperbolic</a> == <a class="code" href="a00173.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>) {</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;      ierr = solver-&gt;<a class="code" href="a00164.html#aa245f8c9e6af37e47c5867dccbbc208b">HyperbolicFunction</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,u,solver,mpi,t,0,solver-&gt;<a class="code" href="a00164.html#a0d895f9bb0c8a3e79a64dd2379e1f2dd">FFunction</a>,solver-&gt;<a class="code" href="a00164.html#a7eb68b9643feb74bd49f3a171b66eef1">Upwind</a>);  </div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;      <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;      <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,-1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    }</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  }</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00173.html#ac48ad2561e5e125d2789133e848db1d9">flag_parabolic</a> == <a class="code" href="a00173.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>) {</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    ierr = solver-&gt;<a class="code" href="a00164.html#a75e8be4ea8c1ae2e99fc1e802e69a573">ParabolicFunction</a> (solver-&gt;<a class="code" href="a00164.html#ae53517ad7a202762d7b79eaf681701f3">par</a>,u,solver,mpi,t);        </div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00164.html#ae53517ad7a202762d7b79eaf681701f3">par</a>, 1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  }</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00173.html#a54c0451c4ae9650a54f54246f1f8823b">flag_source</a> == <a class="code" href="a00173.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>) {</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    ierr = solver-&gt;<a class="code" href="a00164.html#a662e256e081a2b74f971d02c747892b8">SourceFunction</a>    (solver-&gt;<a class="code" href="a00164.html#a6b4951ffdbd82f3a3848b82352d389d6">source</a>,u,solver,mpi,t);     </div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00164.html#a6b4951ffdbd82f3a3848b82352d389d6">source</a>, 1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  }</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  <span class="comment">/* save a copy of the solution and RHS for use in IJacobian */</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <a class="code" href="a00187.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>(u  ,solver-&gt;<a class="code" href="a00164.html#a3ccc9ddb96600c40dcc41bb1ded11160">uref</a>  ,(size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>));</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  <a class="code" href="a00187.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>(rhs,solver-&gt;<a class="code" href="a00164.html#ad587a58397d439c443ae325450a01a13">rhsref</a>,(size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>));</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  <span class="comment">/* Transfer RHS to PETSc vector */</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  ierr = <a class="code" href="a00173.html#a94499efe0f52b5174ce7105de5ab1a37">TransferVecToPETSc</a>(rhs,F,context); <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <span class="comment">/* LHS = Ydot - F(u) */</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  ierr = VecAYPX(F,-1.0,Ydot); CHKERRQ(ierr);</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  PetscFunctionReturn(0);</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;}</div>
<div class="ttc" id="a00173_html_abaa15763a88d05dc68ff230ce570eee9"><div class="ttname"><a href="a00173.html#abaa15763a88d05dc68ff230ce570eee9">PETScContext::mpi</a></div><div class="ttdeci">void * mpi</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00039">petscinterface.h:39</a></div></div>
<div class="ttc" id="a00164_html_ae8f6d2fd6490d3153cb4133bf183a404"><div class="ttname"><a href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">HyPar::nvars</a></div><div class="ttdeci">int nvars</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00029">hypar.h:29</a></div></div>
<div class="ttc" id="a00173_html_aad212f0cfa337a32e39d307f8708eca7"><div class="ttname"><a href="a00173.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a></div><div class="ttdeci">#define _IMPLICIT_</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00022">petscinterface.h:22</a></div></div>
<div class="ttc" id="a00187_html_a4cd66304bc41a7751842230af3063b62"><div class="ttname"><a href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a></div><div class="ttdeci">#define _ArrayAXPY_(x, a, y, size)</div><div class="ttdef"><b>Definition:</b> <a href="a00187_source.html#l00270">arrayfunctions.h:270</a></div></div>
<div class="ttc" id="a00164_html_a7d89659a19156a22ef22a361592ef5f7"><div class="ttname"><a href="a00164.html#a7d89659a19156a22ef22a361592ef5f7">HyPar::count_IFunction</a></div><div class="ttdeci">int count_IFunction</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00398">hypar.h:398</a></div></div>
<div class="ttc" id="a00164_html"><div class="ttname"><a href="a00164.html">HyPar</a></div><div class="ttdoc">Structure containing all solver-specific variables and functions. </div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00023">hypar.h:23</a></div></div>
<div class="ttc" id="a00164_html_a6b4951ffdbd82f3a3848b82352d389d6"><div class="ttname"><a href="a00164.html#a6b4951ffdbd82f3a3848b82352d389d6">HyPar::source</a></div><div class="ttdeci">double * source</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00117">hypar.h:117</a></div></div>
<div class="ttc" id="a00164_html_a73a85f83072e02bf979234486265b6d3"><div class="ttname"><a href="a00164.html#a73a85f83072e02bf979234486265b6d3">HyPar::UpwinddF</a></div><div class="ttdeci">int(* UpwinddF)(double *, double *, double *, double *, double *, double *, int, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00284">hypar.h:284</a></div></div>
<div class="ttc" id="a00173_html_a00591"><div class="ttname"><a href="a00173.html#a00591">PETScContext</a></div><div class="ttdoc">Structure containing the variables for time-integration with PETSc. </div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00035">petscinterface.h:35</a></div></div>
<div class="ttc" id="a00164_html_a662e256e081a2b74f971d02c747892b8"><div class="ttname"><a href="a00164.html#a662e256e081a2b74f971d02c747892b8">HyPar::SourceFunction</a></div><div class="ttdeci">int(* SourceFunction)(double *, double *, void *, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00246">hypar.h:246</a></div></div>
<div class="ttc" id="a00164_html_ad587a58397d439c443ae325450a01a13"><div class="ttname"><a href="a00164.html#ad587a58397d439c443ae325450a01a13">HyPar::rhsref</a></div><div class="ttdeci">double * rhsref</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00374">hypar.h:374</a></div></div>
<div class="ttc" id="a00164_html_a484873c74138512e41bc50d17b7d955a"><div class="ttname"><a href="a00164.html#a484873c74138512e41bc50d17b7d955a">HyPar::ndims</a></div><div class="ttdeci">int ndims</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00026">hypar.h:26</a></div></div>
<div class="ttc" id="a00173_html_ac48ad2561e5e125d2789133e848db1d9"><div class="ttname"><a href="a00173.html#ac48ad2561e5e125d2789133e848db1d9">PETScContext::flag_parabolic</a></div><div class="ttdeci">int flag_parabolic</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00066">petscinterface.h:66</a></div></div>
<div class="ttc" id="a00164_html_a38e0371f331cecbe63a77fa03e202afe"><div class="ttname"><a href="a00164.html#a38e0371f331cecbe63a77fa03e202afe">HyPar::dim_local</a></div><div class="ttdeci">int * dim_local</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00035">hypar.h:35</a></div></div>
<div class="ttc" id="a00188_html_add9cf96ae374934d245a1dc1ab697a42"><div class="ttname"><a href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a></div><div class="ttdeci">#define CHECKERR(ierr)</div><div class="ttdef"><b>Definition:</b> <a href="a00188_source.html#l00014">basic.h:14</a></div></div>
<div class="ttc" id="a00173_html_ade1bc5cad8c6735a891a28f637cbfb06"><div class="ttname"><a href="a00173.html#ade1bc5cad8c6735a891a28f637cbfb06">PETScContext::solver</a></div><div class="ttdeci">void * solver</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00037">petscinterface.h:37</a></div></div>
<div class="ttc" id="a00164_html_a75e8be4ea8c1ae2e99fc1e802e69a573"><div class="ttname"><a href="a00164.html#a75e8be4ea8c1ae2e99fc1e802e69a573">HyPar::ParabolicFunction</a></div><div class="ttdeci">int(* ParabolicFunction)(double *, double *, void *, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00243">hypar.h:243</a></div></div>
<div class="ttc" id="a00173_html_a6a0edd627a2b2cc687d1031e3884dd6a"><div class="ttname"><a href="a00173.html#a6a0edd627a2b2cc687d1031e3884dd6a">PETScContext::flag_hyperbolic_f</a></div><div class="ttdeci">int flag_hyperbolic_f</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00062">petscinterface.h:62</a></div></div>
<div class="ttc" id="a00167_html_a00588"><div class="ttname"><a href="a00167.html#a00588">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a00167_source.html#l00024">mpivars_struct.h:24</a></div></div>
<div class="ttc" id="a00173_html_a54c0451c4ae9650a54f54246f1f8823b"><div class="ttname"><a href="a00173.html#a54c0451c4ae9650a54f54246f1f8823b">PETScContext::flag_source</a></div><div class="ttdeci">int flag_source</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00068">petscinterface.h:68</a></div></div>
<div class="ttc" id="a00164_html_aa245f8c9e6af37e47c5867dccbbc208b"><div class="ttname"><a href="a00164.html#aa245f8c9e6af37e47c5867dccbbc208b">HyPar::HyperbolicFunction</a></div><div class="ttdeci">int(* HyperbolicFunction)(double *, double *, void *, void *, double, int, int(*)(double *, double *, int, void *, double), int(*)(double *, double *, double *, double *, double *, double *, int, void *, double))</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00237">hypar.h:237</a></div></div>
<div class="ttc" id="a00164_html_ae53517ad7a202762d7b79eaf681701f3"><div class="ttname"><a href="a00164.html#ae53517ad7a202762d7b79eaf681701f3">HyPar::par</a></div><div class="ttdeci">double * par</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00114">hypar.h:114</a></div></div>
<div class="ttc" id="a00164_html_a0d895f9bb0c8a3e79a64dd2379e1f2dd"><div class="ttname"><a href="a00164.html#a0d895f9bb0c8a3e79a64dd2379e1f2dd">HyPar::FFunction</a></div><div class="ttdeci">int(* FFunction)(double *, double *, int, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00262">hypar.h:262</a></div></div>
<div class="ttc" id="a00164_html_ade4650485fe35fd3e12fea272fc80209"><div class="ttname"><a href="a00164.html#ade4650485fe35fd3e12fea272fc80209">HyPar::rhs</a></div><div class="ttdeci">double * rhs</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00375">hypar.h:375</a></div></div>
<div class="ttc" id="a00164_html_a5bed0cb9665daad89f4377c4f7609df4"><div class="ttname"><a href="a00164.html#a5bed0cb9665daad89f4377c4f7609df4">HyPar::SplitHyperbolicFlux</a></div><div class="ttdeci">char SplitHyperbolicFlux[_MAX_STRING_SIZE_]</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00084">hypar.h:84</a></div></div>
<div class="ttc" id="a00164_html_aa1dd38befc4bb4adda9d456146436b14"><div class="ttname"><a href="a00164.html#aa1dd38befc4bb4adda9d456146436b14">HyPar::dFFunction</a></div><div class="ttdeci">int(* dFFunction)(double *, double *, int, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00266">hypar.h:266</a></div></div>
<div class="ttc" id="a00173_html_a21b4785029b7597816341479bc3260b4"><div class="ttname"><a href="a00173.html#a21b4785029b7597816341479bc3260b4">PETScContext::flag_hyperbolic_df</a></div><div class="ttdeci">int flag_hyperbolic_df</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00064">petscinterface.h:64</a></div></div>
<div class="ttc" id="a00164_html_ab06746933e859e829d694505c18258b3"><div class="ttname"><a href="a00164.html#ab06746933e859e829d694505c18258b3">HyPar::UpwindFdF</a></div><div class="ttdeci">int(* UpwindFdF)(double *, double *, double *, double *, double *, double *, int, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00291">hypar.h:291</a></div></div>
<div class="ttc" id="a00187_html_a2b2826031c0cd92495ab351d3e599fc5"><div class="ttname"><a href="a00187.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a></div><div class="ttdeci">#define _ArraySetValue_(x, size, value)</div><div class="ttdef"><b>Definition:</b> <a href="a00187_source.html#l00168">arrayfunctions.h:168</a></div></div>
<div class="ttc" id="a00164_html_aeadfdde0fbc3058bace813055212dcc3"><div class="ttname"><a href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">HyPar::hyp</a></div><div class="ttdeci">double * hyp</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00111">hypar.h:111</a></div></div>
<div class="ttc" id="a00164_html_a7eb68b9643feb74bd49f3a171b66eef1"><div class="ttname"><a href="a00164.html#a7eb68b9643feb74bd49f3a171b66eef1">HyPar::Upwind</a></div><div class="ttdeci">int(* Upwind)(double *, double *, double *, double *, double *, double *, int, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00279">hypar.h:279</a></div></div>
<div class="ttc" id="a00164_html_aa4de7bdc1e62417caf51b9c45184268d"><div class="ttname"><a href="a00164.html#aa4de7bdc1e62417caf51b9c45184268d">HyPar::ApplyBoundaryConditions</a></div><div class="ttdeci">int(* ApplyBoundaryConditions)(void *, void *, double *, double *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00201">hypar.h:201</a></div></div>
<div class="ttc" id="a00173_html_aba47a541676718cced51875b1c3a4ba6"><div class="ttname"><a href="a00173.html#aba47a541676718cced51875b1c3a4ba6">TransferVecFromPETSc</a></div><div class="ttdeci">int TransferVecFromPETSc(double *, Vec, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00359_source.html#l00022">TransferFromPETSc.c:22</a></div></div>
<div class="ttc" id="a00164_html_a3b6b999a764f1e2ea94bb5f28c7a558c"><div class="ttname"><a href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">HyPar::u</a></div><div class="ttdeci">double * u</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00108">hypar.h:108</a></div></div>
<div class="ttc" id="a00164_html_ad607f82c4bfde055613e05272f9afd81"><div class="ttname"><a href="a00164.html#ad607f82c4bfde055613e05272f9afd81">HyPar::flag_fdf_specified</a></div><div class="ttdeci">int flag_fdf_specified</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00276">hypar.h:276</a></div></div>
<div class="ttc" id="a00164_html_a3ccc9ddb96600c40dcc41bb1ded11160"><div class="ttname"><a href="a00164.html#a3ccc9ddb96600c40dcc41bb1ded11160">HyPar::uref</a></div><div class="ttdeci">double * uref</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00373">hypar.h:373</a></div></div>
<div class="ttc" id="a00173_html_a94499efe0f52b5174ce7105de5ab1a37"><div class="ttname"><a href="a00173.html#a94499efe0f52b5174ce7105de5ab1a37">TransferVecToPETSc</a></div><div class="ttdeci">int TransferVecToPETSc(double *, Vec, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00360_source.html#l00023">TransferToPETSc.c:23</a></div></div>
<div class="ttc" id="a00187_html_a89e8330d9e06dd0666c50833628a125c"><div class="ttname"><a href="a00187.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a></div><div class="ttdeci">#define _ArrayCopy1D_(x, y, size)</div><div class="ttdef"><b>Definition:</b> <a href="a00187_source.html#l00318">arrayfunctions.h:318</a></div></div>
<div class="ttc" id="a00204_html_a60ace5964c051fa481e6a1e6f1ef75d7"><div class="ttname"><a href="a00204.html#a60ace5964c051fa481e6a1e6f1ef75d7">MPIExchangeBoundariesnD</a></div><div class="ttdeci">int MPIExchangeBoundariesnD(int, int, int *, int, void *, double *)</div><div class="ttdef"><b>Definition:</b> <a href="a00326_source.html#l00042">MPIExchangeBoundariesnD.c:42</a></div></div>
<div class="ttc" id="a00164_html_aafc992b5fa79d5a4036024615d03bce6"><div class="ttname"><a href="a00164.html#aafc992b5fa79d5a4036024615d03bce6">HyPar::ghosts</a></div><div class="ttdeci">int ghosts</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00044">hypar.h:44</a></div></div>
<div class="ttc" id="a00173_html_a376b6b34e162357d201827d01a5aa2a4"><div class="ttname"><a href="a00173.html#a376b6b34e162357d201827d01a5aa2a4">PETScContext::flag_hyperbolic</a></div><div class="ttdeci">int flag_hyperbolic</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00060">petscinterface.h:60</a></div></div>
<div class="ttc" id="a00164_html_adcc5e677515d0952ce3ff702c9d85b86"><div class="ttname"><a href="a00164.html#adcc5e677515d0952ce3ff702c9d85b86">HyPar::FdFFunction</a></div><div class="ttdeci">int(* FdFFunction)(double *, double *, int, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00272">hypar.h:272</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a82aacb94c1481144ce3e43d40d1f04d4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode PetscIJacobianIMEX </td>
          <td>(</td>
          <td class="paramtype">TS&#160;</td>
          <td class="paramname"><em>ts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal&#160;</td>
          <td class="paramname"><em>t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Vec&#160;</td>
          <td class="paramname"><em>Y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Vec&#160;</td>
          <td class="paramname"><em>Ydot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Mat&#160;</td>
          <td class="paramname"><em>A</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Mat&#160;</td>
          <td class="paramname"><em>B</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>ctxt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Compute the Jacobian for implicit-explicit (IMEX) time integration of the governing equations: The ODE, obtained after discretizing the governing PDE in space, is expressed as follows: </p>
<p class="formulaDsp">
\begin{equation} \frac {d{\bf U}}{dt} = {\bf F}\left({\bf U}\right) + {\bf G}\left({\bf U}\right) \Rightarrow \dot{\bf U} - {\bf G}\left({\bf U}\right) = {\bf F}\left({\bf U}\right), \end{equation}
</p>
<p> where \({\bf F}\) is the spatially discretized non-stiff right-hand-side (treated explicitly), \({\bf G}\) is the spatially discretized stiff right-hand-side (treated implicitly), and \({\bf U}\) represents the entire solution vector. The Jacobian of the implicit part is thus given by: </p>
<p class="formulaDsp">
\begin{equation} {\bf J} = \left[\alpha{\bf I} - \frac {\partial {\bf G}} {\partial {\bf U}} \right] \end{equation}
</p>
<p> where \(\alpha\) is the shift coefficient (<a class="el" href="a00173.html#ab057d99becacf205132fd8c235a8488a">PETScContext::shift</a>) of the time integration method.</p>
<p>Note that \({\bf G}\left({\bf U}\right)\) represents all terms that the user has indicated to be integrated in time implicitly (<a class="el" href="a00173.html#a6a0edd627a2b2cc687d1031e3884dd6a">PETScContext::flag_hyperbolic_f</a>, <a class="el" href="a00173.html#a21b4785029b7597816341479bc3260b4">PETScContext::flag_hyperbolic_df</a>, <a class="el" href="a00173.html#a376b6b34e162357d201827d01a5aa2a4">PETScContext::flag_hyperbolic</a>, <a class="el" href="a00173.html#ac48ad2561e5e125d2789133e848db1d9">PETScContext::flag_parabolic</a>, and <a class="el" href="a00173.html#a54c0451c4ae9650a54f54246f1f8823b">PETScContext::flag_source</a>).</p>
<p><b>Matrix-free</b> <b>representation:</b> The Jacobian is computed using a matrix-free approach, where the entire Jacobian is never assembled, computed, or stored. Instead, the action of the Jacobian on a vector is defined through functions (<a class="el" href="a00173.html#a4edf057726501be3e8fe54e16fafe07b">PetscJacobianFunctionIMEX_JFNK()</a> for nonlinear systems, and <a class="el" href="a00173.html#a8778c346e27f42f0583c63909c2ea544">PetscJacobianFunctionIMEX_Linear()</a> for linear systems). This approach works well with iterative solvers. Thus, this function just does the following:</p>
<ul>
<li>Saves the <a class="el" href="a00173.html#ab057d99becacf205132fd8c235a8488a">PETScContext::shift</a> ( \(\alpha\)) and <a class="el" href="a00173.html#a28e4e78c0bf258662bef21d26c51fc0b">PETScContext::waqt</a> (current simulation time) to the application context (so that <a class="el" href="a00173.html#a4edf057726501be3e8fe54e16fafe07b">PetscJacobianFunctionIMEX_JFNK()</a> or <a class="el" href="a00173.html#a8778c346e27f42f0583c63909c2ea544">PetscJacobianFunctionIMEX_Linear()</a> can access these values).</li>
<li>If a preconditioner is being used, calls the function to compute the preconditioning matrix.</li>
</ul>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="a00173.html#a9d093c3140369a1178dd5b9589a926b1">PetscIFunctionIMEX()</a></dd></dl>
<p><b>Notes:</b> </p>
<ul>
<li>The Jacobian is defined as the PETSc type MatShell (<a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/Mat/MATSHELL.html">http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/Mat/MATSHELL.html</a>)</li>
<li><em>Y</em> and <em>Ydot</em> in the code are \({\bf U}\) and \(\dot{\bf U}\), respectively. PETsc denotes the state vector with \({\bf Y}\) in its time integrators.</li>
<li>It is assumed that the reader is familiar with PETSc's implementation of IMEX time integrators, for example, TSARKIMEX (<a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/TSARKIMEX.html">http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/TSARKIMEX.html</a>).</li>
<li>See <a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/index.html">http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/index.html</a> for documentation on PETSc's time integrators.</li>
<li>All functions and variables whose names start with Vec, Mat, PC, KSP, SNES, and TS are defined by PETSc. Refer to the PETSc documentation (<a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/">http://www.mcs.anl.gov/petsc/petsc-current/docs/</a>). Usually, googling with the function or variable name yields the specific doc page dealing with that function/variable. </li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ts</td><td>Time stepping object (see PETSc TS) </td></tr>
    <tr><td class="paramname">t</td><td>Current time </td></tr>
    <tr><td class="paramname">Y</td><td>Solution vector </td></tr>
    <tr><td class="paramname">Ydot</td><td>Time-derivative of solution vector </td></tr>
    <tr><td class="paramname">a</td><td>Shift </td></tr>
    <tr><td class="paramname">A</td><td>Jacobian matrix </td></tr>
    <tr><td class="paramname">B</td><td>Preconditioning matrix </td></tr>
    <tr><td class="paramname">ctxt</td><td>Application context </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00350_source.html#l00061">61</a> of file <a class="el" href="a00350_source.html">PetscIJacobianIMEX.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;{</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <a class="code" href="a00173.html#a00591">PETScContext</a> *context = (<a class="code" href="a00173.html#a00591">PETScContext</a>*) ctxt;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <a class="code" href="a00164.html">HyPar</a>        *solver  = context-&gt;<a class="code" href="a00173.html#ade1bc5cad8c6735a891a28f637cbfb06">solver</a>;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <a class="code" href="a00188.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a>;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  PetscFunctionBegin;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  solver-&gt;<a class="code" href="a00164.html#a8086208a451520745e3fab0e3918db06">count_IJacobian</a>++;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  context-&gt;<a class="code" href="a00173.html#ab057d99becacf205132fd8c235a8488a">shift</a> = a;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  context-&gt;<a class="code" href="a00173.html#a28e4e78c0bf258662bef21d26c51fc0b">waqt</a>  = t;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  <span class="comment">/* Construct preconditioning matrix */</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00173.html#a271fbbfea71118710d4a2fb13eb4c1cc">flag_use_precon</a>) { <a class="code" href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00173.html#ac6ed53fc6bd35636ee50ebba2a4444bb">PetscComputePreconMatIMEX</a>(B,Y,context); <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr); }</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  PetscFunctionReturn(0);</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;}</div>
<div class="ttc" id="a00173_html_a28e4e78c0bf258662bef21d26c51fc0b"><div class="ttname"><a href="a00173.html#a28e4e78c0bf258662bef21d26c51fc0b">PETScContext::waqt</a></div><div class="ttdeci">double waqt</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00044">petscinterface.h:44</a></div></div>
<div class="ttc" id="a00164_html"><div class="ttname"><a href="a00164.html">HyPar</a></div><div class="ttdoc">Structure containing all solver-specific variables and functions. </div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00023">hypar.h:23</a></div></div>
<div class="ttc" id="a00173_html_a00591"><div class="ttname"><a href="a00173.html#a00591">PETScContext</a></div><div class="ttdoc">Structure containing the variables for time-integration with PETSc. </div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00035">petscinterface.h:35</a></div></div>
<div class="ttc" id="a00188_html_add9cf96ae374934d245a1dc1ab697a42"><div class="ttname"><a href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a></div><div class="ttdeci">#define CHECKERR(ierr)</div><div class="ttdef"><b>Definition:</b> <a href="a00188_source.html#l00014">basic.h:14</a></div></div>
<div class="ttc" id="a00173_html_ade1bc5cad8c6735a891a28f637cbfb06"><div class="ttname"><a href="a00173.html#ade1bc5cad8c6735a891a28f637cbfb06">PETScContext::solver</a></div><div class="ttdeci">void * solver</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00037">petscinterface.h:37</a></div></div>
<div class="ttc" id="a00173_html_ab057d99becacf205132fd8c235a8488a"><div class="ttname"><a href="a00173.html#ab057d99becacf205132fd8c235a8488a">PETScContext::shift</a></div><div class="ttdeci">PetscReal shift</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00042">petscinterface.h:42</a></div></div>
<div class="ttc" id="a00173_html_a271fbbfea71118710d4a2fb13eb4c1cc"><div class="ttname"><a href="a00173.html#a271fbbfea71118710d4a2fb13eb4c1cc">PETScContext::flag_use_precon</a></div><div class="ttdeci">int flag_use_precon</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00071">petscinterface.h:71</a></div></div>
<div class="ttc" id="a00188_html_ad6ab74942c9de13cf0b4c12eb0d91780"><div class="ttname"><a href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a></div><div class="ttdeci">#define IERR</div><div class="ttdef"><b>Definition:</b> <a href="a00188_source.html#l00012">basic.h:12</a></div></div>
<div class="ttc" id="a00173_html_ac6ed53fc6bd35636ee50ebba2a4444bb"><div class="ttname"><a href="a00173.html#ac6ed53fc6bd35636ee50ebba2a4444bb">PetscComputePreconMatIMEX</a></div><div class="ttdeci">int PetscComputePreconMatIMEX(Mat, Vec, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00342_source.html#l00067">PetscComputePreconMatIMEX.c:67</a></div></div>
<div class="ttc" id="a00188_html_a68f50121fb9a7daeaf60e50cdef82ef3"><div class="ttname"><a href="a00188.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a></div><div class="ttdeci">#define _DECLARE_IERR_</div><div class="ttdef"><b>Definition:</b> <a href="a00188_source.html#l00013">basic.h:13</a></div></div>
<div class="ttc" id="a00164_html_a8086208a451520745e3fab0e3918db06"><div class="ttname"><a href="a00164.html#a8086208a451520745e3fab0e3918db06">HyPar::count_IJacobian</a></div><div class="ttdeci">int count_IJacobian</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00398">hypar.h:398</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4edf057726501be3e8fe54e16fafe07b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode PetscJacobianFunctionIMEX_JFNK </td>
          <td>(</td>
          <td class="paramtype">Mat&#160;</td>
          <td class="paramname"><em>Jacobian</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Vec&#160;</td>
          <td class="paramname"><em>Y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Vec&#160;</td>
          <td class="paramname"><em>F</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Computes the action of the Jacobian on a vector: See documentation for <a class="el" href="a00173.html#a82aacb94c1481144ce3e43d40d1f04d4">PetscIJacobianIMEX()</a> for the definition of the Jacobian. This function computes its action on a vector for a nonlinear system by taking the directional derivative, as follows: </p>
<p class="formulaDsp">
\begin{equation} {\bf f} = {\bf J}\left({\bf U}_0\right){\bf y} = \frac {\partial \mathcal{F}\left({\bf U}\right)} {\partial {\bf U}}\left({\bf U}_0\right) {\bf y} \approx \frac{1}{\epsilon} \left[ \mathcal{F}\left({\bf U}_0+\epsilon{\bf y}\right)-\mathcal{F}\left({\bf U}_0\right) \right] \end{equation}
</p>
<p> In the context of the implicit-explicit (IMEX) time integration of the ODE given by </p>
<p class="formulaDsp">
\begin{equation} \frac {d {\bf U}} {dt} = {\bf F}\left({\bf U}\right) + {\bf G}\left({\bf U}\right) \Rightarrow \frac {d {\bf U}} {dt} - {\bf G}\left({\bf U}\right) = {\bf F}\left({\bf U}\right), \end{equation}
</p>
<p> where \({\bf F}\) is the spatially discretized non-stiff right-hand-side (treated explicitly), \({\bf G}\) is the spatially discretized stiff right-hand-side (treated implicitly), we have that </p>
<p class="formulaDsp">
\begin{equation} \mathcal{F}\left({\bf U}\right) \equiv \dot{\bf U} - {\bf G}\left({\bf U}\right) \Rightarrow {\bf J}\left({\bf U}\right) = \left[\alpha{\bf I} - \frac {\partial {\bf G}\left({\bf U}\right)} {\partial {\bf U}} \right]. \end{equation}
</p>
<p> where \(\alpha\) (<a class="el" href="a00173.html#ab057d99becacf205132fd8c235a8488a">PETScContext::shift</a>) is the shift variable specific to the time integration method. So this function computes </p>
<p class="formulaDsp">
\begin{equation} {\bf f} = \alpha {\bf y} - \frac{1}{\epsilon} \left[ {\bf G}\left({\bf U}_0+\epsilon{\bf y}\right)-{\bf G}\left({\bf U}_0\right) \right] \end{equation}
</p>
<p> In the code, \({\bf y}\) is <em>Y</em>, \(\bf f\) is <em>F</em>, and \({\bf U}_0\) is <em><a class="el" href="a00164.html#a3ccc9ddb96600c40dcc41bb1ded11160">HyPar::uref</a></em> (the reference solution at which the nonlinear Jacobian is computed). See papers on Jacobian-free Newton-Krylov (JFNK) methods to understand how \(\epsilon\) is computed.</p>
<p>Note that \({\bf G}\left({\bf U}\right)\) represents all terms that the user has indicated to be integrated in time implicitly (<a class="el" href="a00173.html#a6a0edd627a2b2cc687d1031e3884dd6a">PETScContext::flag_hyperbolic_f</a>, <a class="el" href="a00173.html#a21b4785029b7597816341479bc3260b4">PETScContext::flag_hyperbolic_df</a>, <a class="el" href="a00173.html#a376b6b34e162357d201827d01a5aa2a4">PETScContext::flag_hyperbolic</a>, <a class="el" href="a00173.html#ac48ad2561e5e125d2789133e848db1d9">PETScContext::flag_parabolic</a>, and <a class="el" href="a00173.html#a54c0451c4ae9650a54f54246f1f8823b">PETScContext::flag_source</a>).</p>
<p><b>Notes:</b> </p>
<ul>
<li>For a nonlinear spatial discretization, the right-hand-side <b>must</b> be computed without the nonlinearity (i.e. with a previously computed or "frozen" discretization operator). This ensures that the Jacobian being computed is consistent.</li>
<li>It is assumed that the reader is familiar with PETSc's implementation of IMEX time integrators, for example, TSARKIMEX (<a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/TSARKIMEX.html">http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/TSARKIMEX.html</a>).</li>
<li>See <a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/index.html">http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/index.html</a> for documentation on PETSc's time integrators.</li>
<li>All functions and variables whose names start with Vec, Mat, PC, KSP, SNES, and TS are defined by PETSc. Refer to the PETSc documentation (<a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/">http://www.mcs.anl.gov/petsc/petsc-current/docs/</a>). Usually, googling with the function or variable name yields the specific doc page dealing with that function/variable. </li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Jacobian</td><td>Jacobian matrix </td></tr>
    <tr><td class="paramname">Y</td><td>Input vector </td></tr>
    <tr><td class="paramname">F</td><td>Output vector (Jacobian times input vector </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00350_source.html#l00130">130</a> of file <a class="el" href="a00350_source.html">PetscIJacobianIMEX.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;{</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <a class="code" href="a00173.html#a00591">PETScContext</a>    *context = NULL;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <a class="code" href="a00164.html">HyPar</a>           *solver  = NULL;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  <a class="code" href="a00167.html#a00588">MPIVariables</a>    *mpi     = NULL;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  <span class="keywordtype">int</span>             ierr     = 0, d;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  PetscFunctionBegin;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  ierr   = MatShellGetContext(Jacobian,&amp;context); CHKERRQ(ierr);</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  solver = context-&gt;<a class="code" href="a00173.html#ade1bc5cad8c6735a891a28f637cbfb06">solver</a>;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  mpi    = context-&gt;<a class="code" href="a00173.html#abaa15763a88d05dc68ff230ce570eee9">mpi</a>;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  solver-&gt;<a class="code" href="a00164.html#afc11cc081aa04d7b35ebcbcb735f7e22">count_IJacFunction</a>++;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  <span class="keywordtype">int</span> size = 1;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  <span class="keywordflow">for</span> (d=0; d&lt;solver-&gt;<a class="code" href="a00164.html#a484873c74138512e41bc50d17b7d955a">ndims</a>; d++) size *= (solver-&gt;<a class="code" href="a00164.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>[d]+2*solver-&gt;<a class="code" href="a00164.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>);</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  <span class="keywordtype">double</span> *u       = solver-&gt;<a class="code" href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  <span class="keywordtype">double</span> *uref    = solver-&gt;<a class="code" href="a00164.html#a3ccc9ddb96600c40dcc41bb1ded11160">uref</a>;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <span class="keywordtype">double</span> *rhsref  = solver-&gt;<a class="code" href="a00164.html#ad587a58397d439c443ae325450a01a13">rhsref</a>;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  <span class="keywordtype">double</span> *rhs     = solver-&gt;<a class="code" href="a00164.html#ade4650485fe35fd3e12fea272fc80209">rhs</a>;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <span class="keywordtype">double</span> t = context-&gt;<a class="code" href="a00173.html#a28e4e78c0bf258662bef21d26c51fc0b">waqt</a>; <span class="comment">/* current stage/step time */</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  <span class="keywordtype">double</span> normY;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  ierr = VecNorm(Y,NORM_2,&amp;normY);                                        CHKERRQ(ierr);</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  <span class="keywordflow">if</span> (normY &lt; 1e-16) {</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="comment">/* F = 0 */</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    ierr = VecZeroEntries(F);                                             CHKERRQ(ierr);</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="comment">/* [J]Y = aY - F(Y) */</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    ierr = VecAXPBY(F,context-&gt;<a class="code" href="a00173.html#ab057d99becacf205132fd8c235a8488a">shift</a>,0,Y);                                CHKERRQ(ierr);</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    </div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="keywordtype">double</span> epsilon =  context-&gt;<a class="code" href="a00173.html#ad62e14c19e38497048380c4a7fe10e12">jfnk_eps</a> / normY;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="comment">/* copy solution from PETSc vector */</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    ierr = <a class="code" href="a00173.html#aba47a541676718cced51875b1c3a4ba6">TransferVecFromPETSc</a>(u,Y,context);                             <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <a class="code" href="a00187.html#ab8e3b679b04116dd6be664e727f0d951">_ArrayAYPX_</a>(uref,epsilon,u,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="comment">/* apply boundary conditions and exchange data over MPI interfaces */</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    ierr = solver-&gt;<a class="code" href="a00164.html#aa4de7bdc1e62417caf51b9c45184268d">ApplyBoundaryConditions</a>(solver,mpi,u,NULL,t);          <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    ierr = <a class="code" href="a00204.html#a60ace5964c051fa481e6a1e6f1ef75d7">MPIExchangeBoundariesnD</a>(solver-&gt;<a class="code" href="a00164.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00164.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                                   solver-&gt;<a class="code" href="a00164.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,mpi,u);                 <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="comment">/* Evaluate hyperbolic, parabolic and source terms  and the RHS for U+dU */</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <a class="code" href="a00187.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,0.0);</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="keywordflow">if</span> ((!strcmp(solver-&gt;<a class="code" href="a00164.html#a5bed0cb9665daad89f4377c4f7609df4">SplitHyperbolicFlux</a>,<span class="stringliteral">&quot;yes&quot;</span>)) &amp;&amp; solver-&gt;<a class="code" href="a00164.html#ad607f82c4bfde055613e05272f9afd81">flag_fdf_specified</a>) {</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00173.html#a6a0edd627a2b2cc687d1031e3884dd6a">flag_hyperbolic_f</a> == <a class="code" href="a00173.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>) {</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        ierr = solver-&gt;<a class="code" href="a00164.html#aa245f8c9e6af37e47c5867dccbbc208b">HyperbolicFunction</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,u,solver,mpi,t,0,</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                                          solver-&gt;<a class="code" href="a00164.html#adcc5e677515d0952ce3ff702c9d85b86">FdFFunction</a>,solver-&gt;<a class="code" href="a00164.html#ab06746933e859e829d694505c18258b3">UpwindFdF</a>);</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,-1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;      } </div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;      <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00173.html#a21b4785029b7597816341479bc3260b4">flag_hyperbolic_df</a> == <a class="code" href="a00173.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>) {</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        ierr = solver-&gt;<a class="code" href="a00164.html#aa245f8c9e6af37e47c5867dccbbc208b">HyperbolicFunction</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,u,solver,mpi,t,0,</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                                          solver-&gt;<a class="code" href="a00164.html#aa1dd38befc4bb4adda9d456146436b14">dFFunction</a>,solver-&gt;<a class="code" href="a00164.html#a73a85f83072e02bf979234486265b6d3">UpwinddF</a>); </div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,-1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;      }</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00164.html#a5bed0cb9665daad89f4377c4f7609df4">SplitHyperbolicFlux</a>,<span class="stringliteral">&quot;yes&quot;</span>)) {</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;      <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00173.html#a6a0edd627a2b2cc687d1031e3884dd6a">flag_hyperbolic_f</a> == <a class="code" href="a00173.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>) {</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        ierr = solver-&gt;<a class="code" href="a00164.html#aa245f8c9e6af37e47c5867dccbbc208b">HyperbolicFunction</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,u,solver,mpi,t,0,</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                                          solver-&gt;<a class="code" href="a00164.html#a0d895f9bb0c8a3e79a64dd2379e1f2dd">FFunction</a>,solver-&gt;<a class="code" href="a00164.html#a7eb68b9643feb74bd49f3a171b66eef1">Upwind</a>);</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,-1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        ierr = solver-&gt;<a class="code" href="a00164.html#aa245f8c9e6af37e47c5867dccbbc208b">HyperbolicFunction</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,u,solver,mpi,t,0,</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                                          solver-&gt;<a class="code" href="a00164.html#aa1dd38befc4bb4adda9d456146436b14">dFFunction</a>,solver-&gt;<a class="code" href="a00164.html#a73a85f83072e02bf979234486265b6d3">UpwinddF</a>); </div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>, 1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;      } </div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00173.html#a21b4785029b7597816341479bc3260b4">flag_hyperbolic_df</a> == <a class="code" href="a00173.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>) {</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        ierr = solver-&gt;<a class="code" href="a00164.html#aa245f8c9e6af37e47c5867dccbbc208b">HyperbolicFunction</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,u,solver,mpi,t,0,</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                                          solver-&gt;<a class="code" href="a00164.html#aa1dd38befc4bb4adda9d456146436b14">dFFunction</a>,solver-&gt;<a class="code" href="a00164.html#a73a85f83072e02bf979234486265b6d3">UpwinddF</a>); </div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,-1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;      }</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00173.html#a376b6b34e162357d201827d01a5aa2a4">flag_hyperbolic</a> == <a class="code" href="a00173.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>) {</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        ierr = solver-&gt;<a class="code" href="a00164.html#aa245f8c9e6af37e47c5867dccbbc208b">HyperbolicFunction</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,u,solver,mpi,t,0,</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                                          solver-&gt;<a class="code" href="a00164.html#a0d895f9bb0c8a3e79a64dd2379e1f2dd">FFunction</a>,solver-&gt;<a class="code" href="a00164.html#a7eb68b9643feb74bd49f3a171b66eef1">Upwind</a>);  </div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,-1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      }</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    }</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00173.html#ac48ad2561e5e125d2789133e848db1d9">flag_parabolic</a> == <a class="code" href="a00173.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>) {</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      ierr = solver-&gt;<a class="code" href="a00164.html#a75e8be4ea8c1ae2e99fc1e802e69a573">ParabolicFunction</a> (solver-&gt;<a class="code" href="a00164.html#ae53517ad7a202762d7b79eaf681701f3">par</a>,u,solver,mpi,t);        <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;      <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00164.html#ae53517ad7a202762d7b79eaf681701f3">par</a>, 1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    }</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00173.html#a54c0451c4ae9650a54f54246f1f8823b">flag_source</a> == <a class="code" href="a00173.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>) {</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;      ierr = solver-&gt;<a class="code" href="a00164.html#a662e256e081a2b74f971d02c747892b8">SourceFunction</a>    (solver-&gt;<a class="code" href="a00164.html#a6b4951ffdbd82f3a3848b82352d389d6">source</a>,u,solver,mpi,t);     <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;      <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00164.html#a6b4951ffdbd82f3a3848b82352d389d6">source</a>, 1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    }</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(rhsref,-1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="comment">/* Transfer RHS to PETSc vector */</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    ierr = <a class="code" href="a00173.html#a94499efe0f52b5174ce7105de5ab1a37">TransferVecToPETSc</a>(rhs,F,context);                  <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="comment">/* [J]Y = aY - F(Y) */</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    ierr = VecAXPBY(F,context-&gt;<a class="code" href="a00173.html#ab057d99becacf205132fd8c235a8488a">shift</a>,(-1.0/epsilon),Y);     CHKERRQ(ierr);</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  }</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  PetscFunctionReturn(0);</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;}</div>
<div class="ttc" id="a00173_html_a28e4e78c0bf258662bef21d26c51fc0b"><div class="ttname"><a href="a00173.html#a28e4e78c0bf258662bef21d26c51fc0b">PETScContext::waqt</a></div><div class="ttdeci">double waqt</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00044">petscinterface.h:44</a></div></div>
<div class="ttc" id="a00173_html_abaa15763a88d05dc68ff230ce570eee9"><div class="ttname"><a href="a00173.html#abaa15763a88d05dc68ff230ce570eee9">PETScContext::mpi</a></div><div class="ttdeci">void * mpi</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00039">petscinterface.h:39</a></div></div>
<div class="ttc" id="a00164_html_ae8f6d2fd6490d3153cb4133bf183a404"><div class="ttname"><a href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">HyPar::nvars</a></div><div class="ttdeci">int nvars</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00029">hypar.h:29</a></div></div>
<div class="ttc" id="a00173_html_aad212f0cfa337a32e39d307f8708eca7"><div class="ttname"><a href="a00173.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a></div><div class="ttdeci">#define _IMPLICIT_</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00022">petscinterface.h:22</a></div></div>
<div class="ttc" id="a00187_html_a4cd66304bc41a7751842230af3063b62"><div class="ttname"><a href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a></div><div class="ttdeci">#define _ArrayAXPY_(x, a, y, size)</div><div class="ttdef"><b>Definition:</b> <a href="a00187_source.html#l00270">arrayfunctions.h:270</a></div></div>
<div class="ttc" id="a00187_html_ab8e3b679b04116dd6be664e727f0d951"><div class="ttname"><a href="a00187.html#ab8e3b679b04116dd6be664e727f0d951">_ArrayAYPX_</a></div><div class="ttdeci">#define _ArrayAYPX_(x, a, y, size)</div><div class="ttdef"><b>Definition:</b> <a href="a00187_source.html#l00257">arrayfunctions.h:257</a></div></div>
<div class="ttc" id="a00164_html"><div class="ttname"><a href="a00164.html">HyPar</a></div><div class="ttdoc">Structure containing all solver-specific variables and functions. </div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00023">hypar.h:23</a></div></div>
<div class="ttc" id="a00164_html_a6b4951ffdbd82f3a3848b82352d389d6"><div class="ttname"><a href="a00164.html#a6b4951ffdbd82f3a3848b82352d389d6">HyPar::source</a></div><div class="ttdeci">double * source</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00117">hypar.h:117</a></div></div>
<div class="ttc" id="a00164_html_a73a85f83072e02bf979234486265b6d3"><div class="ttname"><a href="a00164.html#a73a85f83072e02bf979234486265b6d3">HyPar::UpwinddF</a></div><div class="ttdeci">int(* UpwinddF)(double *, double *, double *, double *, double *, double *, int, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00284">hypar.h:284</a></div></div>
<div class="ttc" id="a00173_html_a00591"><div class="ttname"><a href="a00173.html#a00591">PETScContext</a></div><div class="ttdoc">Structure containing the variables for time-integration with PETSc. </div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00035">petscinterface.h:35</a></div></div>
<div class="ttc" id="a00164_html_a662e256e081a2b74f971d02c747892b8"><div class="ttname"><a href="a00164.html#a662e256e081a2b74f971d02c747892b8">HyPar::SourceFunction</a></div><div class="ttdeci">int(* SourceFunction)(double *, double *, void *, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00246">hypar.h:246</a></div></div>
<div class="ttc" id="a00164_html_ad587a58397d439c443ae325450a01a13"><div class="ttname"><a href="a00164.html#ad587a58397d439c443ae325450a01a13">HyPar::rhsref</a></div><div class="ttdeci">double * rhsref</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00374">hypar.h:374</a></div></div>
<div class="ttc" id="a00164_html_a484873c74138512e41bc50d17b7d955a"><div class="ttname"><a href="a00164.html#a484873c74138512e41bc50d17b7d955a">HyPar::ndims</a></div><div class="ttdeci">int ndims</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00026">hypar.h:26</a></div></div>
<div class="ttc" id="a00173_html_ac48ad2561e5e125d2789133e848db1d9"><div class="ttname"><a href="a00173.html#ac48ad2561e5e125d2789133e848db1d9">PETScContext::flag_parabolic</a></div><div class="ttdeci">int flag_parabolic</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00066">petscinterface.h:66</a></div></div>
<div class="ttc" id="a00164_html_a38e0371f331cecbe63a77fa03e202afe"><div class="ttname"><a href="a00164.html#a38e0371f331cecbe63a77fa03e202afe">HyPar::dim_local</a></div><div class="ttdeci">int * dim_local</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00035">hypar.h:35</a></div></div>
<div class="ttc" id="a00188_html_add9cf96ae374934d245a1dc1ab697a42"><div class="ttname"><a href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a></div><div class="ttdeci">#define CHECKERR(ierr)</div><div class="ttdef"><b>Definition:</b> <a href="a00188_source.html#l00014">basic.h:14</a></div></div>
<div class="ttc" id="a00173_html_ade1bc5cad8c6735a891a28f637cbfb06"><div class="ttname"><a href="a00173.html#ade1bc5cad8c6735a891a28f637cbfb06">PETScContext::solver</a></div><div class="ttdeci">void * solver</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00037">petscinterface.h:37</a></div></div>
<div class="ttc" id="a00164_html_a75e8be4ea8c1ae2e99fc1e802e69a573"><div class="ttname"><a href="a00164.html#a75e8be4ea8c1ae2e99fc1e802e69a573">HyPar::ParabolicFunction</a></div><div class="ttdeci">int(* ParabolicFunction)(double *, double *, void *, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00243">hypar.h:243</a></div></div>
<div class="ttc" id="a00164_html_afc11cc081aa04d7b35ebcbcb735f7e22"><div class="ttname"><a href="a00164.html#afc11cc081aa04d7b35ebcbcb735f7e22">HyPar::count_IJacFunction</a></div><div class="ttdeci">int count_IJacFunction</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00398">hypar.h:398</a></div></div>
<div class="ttc" id="a00173_html_ab057d99becacf205132fd8c235a8488a"><div class="ttname"><a href="a00173.html#ab057d99becacf205132fd8c235a8488a">PETScContext::shift</a></div><div class="ttdeci">PetscReal shift</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00042">petscinterface.h:42</a></div></div>
<div class="ttc" id="a00173_html_a6a0edd627a2b2cc687d1031e3884dd6a"><div class="ttname"><a href="a00173.html#a6a0edd627a2b2cc687d1031e3884dd6a">PETScContext::flag_hyperbolic_f</a></div><div class="ttdeci">int flag_hyperbolic_f</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00062">petscinterface.h:62</a></div></div>
<div class="ttc" id="a00167_html_a00588"><div class="ttname"><a href="a00167.html#a00588">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a00167_source.html#l00024">mpivars_struct.h:24</a></div></div>
<div class="ttc" id="a00173_html_a54c0451c4ae9650a54f54246f1f8823b"><div class="ttname"><a href="a00173.html#a54c0451c4ae9650a54f54246f1f8823b">PETScContext::flag_source</a></div><div class="ttdeci">int flag_source</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00068">petscinterface.h:68</a></div></div>
<div class="ttc" id="a00164_html_aa245f8c9e6af37e47c5867dccbbc208b"><div class="ttname"><a href="a00164.html#aa245f8c9e6af37e47c5867dccbbc208b">HyPar::HyperbolicFunction</a></div><div class="ttdeci">int(* HyperbolicFunction)(double *, double *, void *, void *, double, int, int(*)(double *, double *, int, void *, double), int(*)(double *, double *, double *, double *, double *, double *, int, void *, double))</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00237">hypar.h:237</a></div></div>
<div class="ttc" id="a00164_html_ae53517ad7a202762d7b79eaf681701f3"><div class="ttname"><a href="a00164.html#ae53517ad7a202762d7b79eaf681701f3">HyPar::par</a></div><div class="ttdeci">double * par</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00114">hypar.h:114</a></div></div>
<div class="ttc" id="a00173_html_ad62e14c19e38497048380c4a7fe10e12"><div class="ttname"><a href="a00173.html#ad62e14c19e38497048380c4a7fe10e12">PETScContext::jfnk_eps</a></div><div class="ttdeci">double jfnk_eps</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00077">petscinterface.h:77</a></div></div>
<div class="ttc" id="a00164_html_a0d895f9bb0c8a3e79a64dd2379e1f2dd"><div class="ttname"><a href="a00164.html#a0d895f9bb0c8a3e79a64dd2379e1f2dd">HyPar::FFunction</a></div><div class="ttdeci">int(* FFunction)(double *, double *, int, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00262">hypar.h:262</a></div></div>
<div class="ttc" id="a00164_html_ade4650485fe35fd3e12fea272fc80209"><div class="ttname"><a href="a00164.html#ade4650485fe35fd3e12fea272fc80209">HyPar::rhs</a></div><div class="ttdeci">double * rhs</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00375">hypar.h:375</a></div></div>
<div class="ttc" id="a00164_html_a5bed0cb9665daad89f4377c4f7609df4"><div class="ttname"><a href="a00164.html#a5bed0cb9665daad89f4377c4f7609df4">HyPar::SplitHyperbolicFlux</a></div><div class="ttdeci">char SplitHyperbolicFlux[_MAX_STRING_SIZE_]</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00084">hypar.h:84</a></div></div>
<div class="ttc" id="a00164_html_aa1dd38befc4bb4adda9d456146436b14"><div class="ttname"><a href="a00164.html#aa1dd38befc4bb4adda9d456146436b14">HyPar::dFFunction</a></div><div class="ttdeci">int(* dFFunction)(double *, double *, int, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00266">hypar.h:266</a></div></div>
<div class="ttc" id="a00173_html_a21b4785029b7597816341479bc3260b4"><div class="ttname"><a href="a00173.html#a21b4785029b7597816341479bc3260b4">PETScContext::flag_hyperbolic_df</a></div><div class="ttdeci">int flag_hyperbolic_df</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00064">petscinterface.h:64</a></div></div>
<div class="ttc" id="a00164_html_ab06746933e859e829d694505c18258b3"><div class="ttname"><a href="a00164.html#ab06746933e859e829d694505c18258b3">HyPar::UpwindFdF</a></div><div class="ttdeci">int(* UpwindFdF)(double *, double *, double *, double *, double *, double *, int, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00291">hypar.h:291</a></div></div>
<div class="ttc" id="a00187_html_a2b2826031c0cd92495ab351d3e599fc5"><div class="ttname"><a href="a00187.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a></div><div class="ttdeci">#define _ArraySetValue_(x, size, value)</div><div class="ttdef"><b>Definition:</b> <a href="a00187_source.html#l00168">arrayfunctions.h:168</a></div></div>
<div class="ttc" id="a00164_html_aeadfdde0fbc3058bace813055212dcc3"><div class="ttname"><a href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">HyPar::hyp</a></div><div class="ttdeci">double * hyp</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00111">hypar.h:111</a></div></div>
<div class="ttc" id="a00164_html_a7eb68b9643feb74bd49f3a171b66eef1"><div class="ttname"><a href="a00164.html#a7eb68b9643feb74bd49f3a171b66eef1">HyPar::Upwind</a></div><div class="ttdeci">int(* Upwind)(double *, double *, double *, double *, double *, double *, int, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00279">hypar.h:279</a></div></div>
<div class="ttc" id="a00164_html_aa4de7bdc1e62417caf51b9c45184268d"><div class="ttname"><a href="a00164.html#aa4de7bdc1e62417caf51b9c45184268d">HyPar::ApplyBoundaryConditions</a></div><div class="ttdeci">int(* ApplyBoundaryConditions)(void *, void *, double *, double *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00201">hypar.h:201</a></div></div>
<div class="ttc" id="a00173_html_aba47a541676718cced51875b1c3a4ba6"><div class="ttname"><a href="a00173.html#aba47a541676718cced51875b1c3a4ba6">TransferVecFromPETSc</a></div><div class="ttdeci">int TransferVecFromPETSc(double *, Vec, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00359_source.html#l00022">TransferFromPETSc.c:22</a></div></div>
<div class="ttc" id="a00164_html_a3b6b999a764f1e2ea94bb5f28c7a558c"><div class="ttname"><a href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">HyPar::u</a></div><div class="ttdeci">double * u</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00108">hypar.h:108</a></div></div>
<div class="ttc" id="a00164_html_ad607f82c4bfde055613e05272f9afd81"><div class="ttname"><a href="a00164.html#ad607f82c4bfde055613e05272f9afd81">HyPar::flag_fdf_specified</a></div><div class="ttdeci">int flag_fdf_specified</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00276">hypar.h:276</a></div></div>
<div class="ttc" id="a00164_html_a3ccc9ddb96600c40dcc41bb1ded11160"><div class="ttname"><a href="a00164.html#a3ccc9ddb96600c40dcc41bb1ded11160">HyPar::uref</a></div><div class="ttdeci">double * uref</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00373">hypar.h:373</a></div></div>
<div class="ttc" id="a00173_html_a94499efe0f52b5174ce7105de5ab1a37"><div class="ttname"><a href="a00173.html#a94499efe0f52b5174ce7105de5ab1a37">TransferVecToPETSc</a></div><div class="ttdeci">int TransferVecToPETSc(double *, Vec, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00360_source.html#l00023">TransferToPETSc.c:23</a></div></div>
<div class="ttc" id="a00204_html_a60ace5964c051fa481e6a1e6f1ef75d7"><div class="ttname"><a href="a00204.html#a60ace5964c051fa481e6a1e6f1ef75d7">MPIExchangeBoundariesnD</a></div><div class="ttdeci">int MPIExchangeBoundariesnD(int, int, int *, int, void *, double *)</div><div class="ttdef"><b>Definition:</b> <a href="a00326_source.html#l00042">MPIExchangeBoundariesnD.c:42</a></div></div>
<div class="ttc" id="a00164_html_aafc992b5fa79d5a4036024615d03bce6"><div class="ttname"><a href="a00164.html#aafc992b5fa79d5a4036024615d03bce6">HyPar::ghosts</a></div><div class="ttdeci">int ghosts</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00044">hypar.h:44</a></div></div>
<div class="ttc" id="a00173_html_a376b6b34e162357d201827d01a5aa2a4"><div class="ttname"><a href="a00173.html#a376b6b34e162357d201827d01a5aa2a4">PETScContext::flag_hyperbolic</a></div><div class="ttdeci">int flag_hyperbolic</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00060">petscinterface.h:60</a></div></div>
<div class="ttc" id="a00164_html_adcc5e677515d0952ce3ff702c9d85b86"><div class="ttname"><a href="a00164.html#adcc5e677515d0952ce3ff702c9d85b86">HyPar::FdFFunction</a></div><div class="ttdeci">int(* FdFFunction)(double *, double *, int, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00272">hypar.h:272</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a8778c346e27f42f0583c63909c2ea544"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode PetscJacobianFunctionIMEX_Linear </td>
          <td>(</td>
          <td class="paramtype">Mat&#160;</td>
          <td class="paramname"><em>Jacobian</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Vec&#160;</td>
          <td class="paramname"><em>Y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Vec&#160;</td>
          <td class="paramname"><em>F</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Computes the action of the Jacobian on a vector: See documentation for <a class="el" href="a00173.html#a82aacb94c1481144ce3e43d40d1f04d4">PetscIJacobianIMEX()</a> for the definition of the Jacobian. This function computes its action on a vector for a linear system by taking the directional derivative, as follows: </p>
<p class="formulaDsp">
\begin{equation} {\bf f} = {\bf J}{\bf y} = \frac {\partial \mathcal{F}\left({\bf U}\right)} {\partial {\bf U}} {\bf y} = \left[ \mathcal{F}\left({\bf U}_0+{\bf y}\right)-\mathcal{F}\left({\bf U}_0\right) \right], \end{equation}
</p>
<p> where \(\mathcal{F}\) is linear, and thus \({\bf J}\) is a constant ( \(\mathcal{F}\left({\bf y}\right) = {\bf J}{\bf y}\)). In the context of the implicit-explicit (IMEX) time integration of the ODE given by </p>
<p class="formulaDsp">
\begin{equation} \frac {d {\bf U}} {dt} = {\bf F}\left({\bf U}\right) + {\bf G}\left({\bf U}\right) \Rightarrow \frac {d {\bf U}} {dt} - {\bf G}\left({\bf U}\right) = {\bf F}\left({\bf U}\right), \end{equation}
</p>
<p> where \({\bf F}\) is the spatially discretized non-stiff right-hand-side (treated explicitly), \({\bf G}\) is the spatially discretized stiff right-hand-side (treated implicitly) and <b>is</b> <b>linear</b>, we have that </p>
<p class="formulaDsp">
\begin{equation} \mathcal{F}\left({\bf U}\right) \equiv \dot{\bf U} - {\bf G}\left({\bf U}\right) \Rightarrow {\bf J}\left({\bf U}\right) = \left[\alpha{\bf I} - \frac {\partial {\bf G}\left({\bf U}\right)} {\partial {\bf U}} \right]. \end{equation}
</p>
<p> where \(\alpha\) (<a class="el" href="a00173.html#ab057d99becacf205132fd8c235a8488a">PETScContext::shift</a>) is the shift variable specific to the time integration method. So this function computes </p>
<p class="formulaDsp">
\begin{equation} {\bf f} = \alpha {\bf y} - \left[ {\bf G}\left({\bf U}_0+{\bf y}\right)-{\bf G}\left({\bf U}_0\right) \right] \end{equation}
</p>
<p> In the code, \({\bf y}\) is <em>Y</em>, \(\bf f\) is <em>F</em>, and \({\bf U}_0\) is <em><a class="el" href="a00164.html#a3ccc9ddb96600c40dcc41bb1ded11160">HyPar::uref</a></em> (the reference solution at which the nonlinear Jacobian is computed).</p>
<p>Since \(\mathcal{F}\) is linear, </p>
<p class="formulaDsp">
\begin{equation} {\bf J}{\bf y} = \left[ \mathcal{F}\left({\bf U}_0+{\bf y}\right)-\mathcal{F}\left({\bf U}_0\right) \right] = \mathcal{F}\left({\bf y}\right). \end{equation}
</p>
<p> However, the Jacobian is not computed as \(\mathcal{F}\left({\bf y}\right)\) because of the following reason: this function is used by the equation solver within the implicit time integrator in PETSc, and \({\bf y}\) represents the change in the solution, i.e. \(\Delta {\bf U}\), and not the solution \(\bf U\). Thus, evaluating \(\mathcal{F}\left({\bf y}\right)\) using <a class="el" href="a00164.html#aa245f8c9e6af37e47c5867dccbbc208b">HyPar::HyperbolicFunction</a>, <a class="el" href="a00164.html#a75e8be4ea8c1ae2e99fc1e802e69a573">HyPar::ParabolicFunction</a>, and <a class="el" href="a00164.html#a662e256e081a2b74f971d02c747892b8">HyPar::SourceFunction</a> is incorrect since these functions expect \(\bf U\) as the input.</p>
<p>Note that \({\bf G}\left({\bf U}\right)\) represents all terms that the user has indicated to be integrated in time implicitly (<a class="el" href="a00173.html#a6a0edd627a2b2cc687d1031e3884dd6a">PETScContext::flag_hyperbolic_f</a>, <a class="el" href="a00173.html#a21b4785029b7597816341479bc3260b4">PETScContext::flag_hyperbolic_df</a>, <a class="el" href="a00173.html#a376b6b34e162357d201827d01a5aa2a4">PETScContext::flag_hyperbolic</a>, <a class="el" href="a00173.html#ac48ad2561e5e125d2789133e848db1d9">PETScContext::flag_parabolic</a>, and <a class="el" href="a00173.html#a54c0451c4ae9650a54f54246f1f8823b">PETScContext::flag_source</a>).</p>
<p><b>Notes:</b> </p>
<ul>
<li>For a nonlinear spatial discretization, the right-hand-side <b>must</b> be computed without the nonlinearity (i.e. with a previously computed or "frozen" discretization operator). This ensures that the Jacobian being computed is consistent, and is truly linear.</li>
<li>See <a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/index.html">http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/index.html</a> for documentation on PETSc's time integrators.</li>
<li>All functions and variables whose names start with Vec, Mat, PC, KSP, SNES, and TS are defined by PETSc. Refer to the PETSc documentation (<a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/">http://www.mcs.anl.gov/petsc/petsc-current/docs/</a>). Usually, googling with the function or variable name yields the specific doc page dealing with that function/variable. </li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Jacobian</td><td>Jacobian matrix </td></tr>
    <tr><td class="paramname">Y</td><td>Input vector </td></tr>
    <tr><td class="paramname">F</td><td>Output vector (Jacobian times input vector </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00350_source.html#l00292">292</a> of file <a class="el" href="a00350_source.html">PetscIJacobianIMEX.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;{</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  <a class="code" href="a00173.html#a00591">PETScContext</a>    *context = NULL;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  <a class="code" href="a00164.html">HyPar</a>           *solver  = NULL;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <a class="code" href="a00167.html#a00588">MPIVariables</a>    *mpi     = NULL;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  <span class="keywordtype">int</span>             ierr     = 0, d;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  PetscFunctionBegin;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  ierr   = MatShellGetContext(Jacobian,&amp;context); CHKERRQ(ierr);</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  solver = context-&gt;<a class="code" href="a00173.html#ade1bc5cad8c6735a891a28f637cbfb06">solver</a>;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  mpi    = context-&gt;<a class="code" href="a00173.html#abaa15763a88d05dc68ff230ce570eee9">mpi</a>;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  solver-&gt;<a class="code" href="a00164.html#afc11cc081aa04d7b35ebcbcb735f7e22">count_IJacFunction</a>++;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  <span class="keywordtype">int</span> size = 1;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  <span class="keywordflow">for</span> (d=0; d&lt;solver-&gt;<a class="code" href="a00164.html#a484873c74138512e41bc50d17b7d955a">ndims</a>; d++) size *= (solver-&gt;<a class="code" href="a00164.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>[d]+2*solver-&gt;<a class="code" href="a00164.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>);</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  <span class="keywordtype">double</span> *u       = solver-&gt;<a class="code" href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  <span class="keywordtype">double</span> *uref    = solver-&gt;<a class="code" href="a00164.html#a3ccc9ddb96600c40dcc41bb1ded11160">uref</a>;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  <span class="keywordtype">double</span> *rhsref  = solver-&gt;<a class="code" href="a00164.html#ad587a58397d439c443ae325450a01a13">rhsref</a>;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  <span class="keywordtype">double</span> *rhs     = solver-&gt;<a class="code" href="a00164.html#ade4650485fe35fd3e12fea272fc80209">rhs</a>;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  <span class="keywordtype">double</span> t = context-&gt;<a class="code" href="a00173.html#a28e4e78c0bf258662bef21d26c51fc0b">waqt</a>; <span class="comment">/* current stage/step time */</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  <span class="keywordtype">double</span> normY;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  ierr = VecNorm(Y,NORM_2,&amp;normY);                                        CHKERRQ(ierr);</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  <span class="keywordflow">if</span> (normY &lt; 1e-16) {</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <span class="comment">/* F = 0 */</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    ierr = VecZeroEntries(F);                                             CHKERRQ(ierr);</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="comment">/* [J]Y = aY - F(Y) */</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    ierr = VecAXPBY(F,context-&gt;<a class="code" href="a00173.html#ab057d99becacf205132fd8c235a8488a">shift</a>,0,Y);                                CHKERRQ(ierr);</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    </div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <span class="comment">/* copy solution from PETSc vector */</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    ierr = <a class="code" href="a00173.html#aba47a541676718cced51875b1c3a4ba6">TransferVecFromPETSc</a>(u,Y,context);                             <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <a class="code" href="a00187.html#ab8e3b679b04116dd6be664e727f0d951">_ArrayAYPX_</a>(uref,1.0,u,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="comment">/* apply boundary conditions and exchange data over MPI interfaces */</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    ierr = solver-&gt;<a class="code" href="a00164.html#aa4de7bdc1e62417caf51b9c45184268d">ApplyBoundaryConditions</a>(solver,mpi,u,NULL,t);          <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    ierr = <a class="code" href="a00204.html#a60ace5964c051fa481e6a1e6f1ef75d7">MPIExchangeBoundariesnD</a>(solver-&gt;<a class="code" href="a00164.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00164.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                                   solver-&gt;<a class="code" href="a00164.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,mpi,u);                 <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="comment">/* Evaluate hyperbolic, parabolic and source terms  and the RHS for U+dU */</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <a class="code" href="a00187.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,0.0);</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="keywordflow">if</span> ((!strcmp(solver-&gt;<a class="code" href="a00164.html#a5bed0cb9665daad89f4377c4f7609df4">SplitHyperbolicFlux</a>,<span class="stringliteral">&quot;yes&quot;</span>)) &amp;&amp; solver-&gt;<a class="code" href="a00164.html#ad607f82c4bfde055613e05272f9afd81">flag_fdf_specified</a>) {</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;      <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00173.html#a6a0edd627a2b2cc687d1031e3884dd6a">flag_hyperbolic_f</a> == <a class="code" href="a00173.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>) {</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        ierr = solver-&gt;<a class="code" href="a00164.html#aa245f8c9e6af37e47c5867dccbbc208b">HyperbolicFunction</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,u,solver,mpi,t,0,</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                                          solver-&gt;<a class="code" href="a00164.html#adcc5e677515d0952ce3ff702c9d85b86">FdFFunction</a>,solver-&gt;<a class="code" href="a00164.html#ab06746933e859e829d694505c18258b3">UpwindFdF</a>);</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,-1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;      } </div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;      <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00173.html#a21b4785029b7597816341479bc3260b4">flag_hyperbolic_df</a> == <a class="code" href="a00173.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>) {</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        ierr = solver-&gt;<a class="code" href="a00164.html#aa245f8c9e6af37e47c5867dccbbc208b">HyperbolicFunction</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,u,solver,mpi,t,0,</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                                          solver-&gt;<a class="code" href="a00164.html#aa1dd38befc4bb4adda9d456146436b14">dFFunction</a>,solver-&gt;<a class="code" href="a00164.html#a73a85f83072e02bf979234486265b6d3">UpwinddF</a>); </div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,-1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;      }</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00164.html#a5bed0cb9665daad89f4377c4f7609df4">SplitHyperbolicFlux</a>,<span class="stringliteral">&quot;yes&quot;</span>)) {</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;      <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00173.html#a6a0edd627a2b2cc687d1031e3884dd6a">flag_hyperbolic_f</a> == <a class="code" href="a00173.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>) {</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        ierr = solver-&gt;<a class="code" href="a00164.html#aa245f8c9e6af37e47c5867dccbbc208b">HyperbolicFunction</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,u,solver,mpi,t,0,</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                                          solver-&gt;<a class="code" href="a00164.html#a0d895f9bb0c8a3e79a64dd2379e1f2dd">FFunction</a>,solver-&gt;<a class="code" href="a00164.html#a7eb68b9643feb74bd49f3a171b66eef1">Upwind</a>);</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,-1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        ierr = solver-&gt;<a class="code" href="a00164.html#aa245f8c9e6af37e47c5867dccbbc208b">HyperbolicFunction</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,u,solver,mpi,t,0,</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                                          solver-&gt;<a class="code" href="a00164.html#aa1dd38befc4bb4adda9d456146436b14">dFFunction</a>,solver-&gt;<a class="code" href="a00164.html#a73a85f83072e02bf979234486265b6d3">UpwinddF</a>); </div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>, 1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;      } </div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;      <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00173.html#a21b4785029b7597816341479bc3260b4">flag_hyperbolic_df</a> == <a class="code" href="a00173.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>) {</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        ierr = solver-&gt;<a class="code" href="a00164.html#aa245f8c9e6af37e47c5867dccbbc208b">HyperbolicFunction</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,u,solver,mpi,t,0,</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;                                          solver-&gt;<a class="code" href="a00164.html#aa1dd38befc4bb4adda9d456146436b14">dFFunction</a>,solver-&gt;<a class="code" href="a00164.html#a73a85f83072e02bf979234486265b6d3">UpwinddF</a>); </div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,-1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;      }</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;      <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00173.html#a376b6b34e162357d201827d01a5aa2a4">flag_hyperbolic</a> == <a class="code" href="a00173.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>) {</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        ierr = solver-&gt;<a class="code" href="a00164.html#aa245f8c9e6af37e47c5867dccbbc208b">HyperbolicFunction</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,u,solver,mpi,t,0,</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                                          solver-&gt;<a class="code" href="a00164.html#a0d895f9bb0c8a3e79a64dd2379e1f2dd">FFunction</a>,solver-&gt;<a class="code" href="a00164.html#a7eb68b9643feb74bd49f3a171b66eef1">Upwind</a>);  </div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,-1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;      }</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    }</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00173.html#ac48ad2561e5e125d2789133e848db1d9">flag_parabolic</a> == <a class="code" href="a00173.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>) {</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;      ierr = solver-&gt;<a class="code" href="a00164.html#a75e8be4ea8c1ae2e99fc1e802e69a573">ParabolicFunction</a> (solver-&gt;<a class="code" href="a00164.html#ae53517ad7a202762d7b79eaf681701f3">par</a>,u,solver,mpi,t);        <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;      <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00164.html#ae53517ad7a202762d7b79eaf681701f3">par</a>, 1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    }</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00173.html#a54c0451c4ae9650a54f54246f1f8823b">flag_source</a> == <a class="code" href="a00173.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>) {</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;      ierr = solver-&gt;<a class="code" href="a00164.html#a662e256e081a2b74f971d02c747892b8">SourceFunction</a>    (solver-&gt;<a class="code" href="a00164.html#a6b4951ffdbd82f3a3848b82352d389d6">source</a>,u,solver,mpi,t);     <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;      <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00164.html#a6b4951ffdbd82f3a3848b82352d389d6">source</a>, 1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    }</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(rhsref,-1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="comment">/* Transfer RHS to PETSc vector */</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    ierr = <a class="code" href="a00173.html#a94499efe0f52b5174ce7105de5ab1a37">TransferVecToPETSc</a>(rhs,F,context);                  <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <span class="comment">/* [J]Y = aY - F(Y) */</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    ierr = VecAXPBY(F,context-&gt;<a class="code" href="a00173.html#ab057d99becacf205132fd8c235a8488a">shift</a>,-1.0,Y);     CHKERRQ(ierr);</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;  }</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  PetscFunctionReturn(0);</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;}</div>
<div class="ttc" id="a00173_html_a28e4e78c0bf258662bef21d26c51fc0b"><div class="ttname"><a href="a00173.html#a28e4e78c0bf258662bef21d26c51fc0b">PETScContext::waqt</a></div><div class="ttdeci">double waqt</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00044">petscinterface.h:44</a></div></div>
<div class="ttc" id="a00173_html_abaa15763a88d05dc68ff230ce570eee9"><div class="ttname"><a href="a00173.html#abaa15763a88d05dc68ff230ce570eee9">PETScContext::mpi</a></div><div class="ttdeci">void * mpi</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00039">petscinterface.h:39</a></div></div>
<div class="ttc" id="a00164_html_ae8f6d2fd6490d3153cb4133bf183a404"><div class="ttname"><a href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">HyPar::nvars</a></div><div class="ttdeci">int nvars</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00029">hypar.h:29</a></div></div>
<div class="ttc" id="a00173_html_aad212f0cfa337a32e39d307f8708eca7"><div class="ttname"><a href="a00173.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a></div><div class="ttdeci">#define _IMPLICIT_</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00022">petscinterface.h:22</a></div></div>
<div class="ttc" id="a00187_html_a4cd66304bc41a7751842230af3063b62"><div class="ttname"><a href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a></div><div class="ttdeci">#define _ArrayAXPY_(x, a, y, size)</div><div class="ttdef"><b>Definition:</b> <a href="a00187_source.html#l00270">arrayfunctions.h:270</a></div></div>
<div class="ttc" id="a00187_html_ab8e3b679b04116dd6be664e727f0d951"><div class="ttname"><a href="a00187.html#ab8e3b679b04116dd6be664e727f0d951">_ArrayAYPX_</a></div><div class="ttdeci">#define _ArrayAYPX_(x, a, y, size)</div><div class="ttdef"><b>Definition:</b> <a href="a00187_source.html#l00257">arrayfunctions.h:257</a></div></div>
<div class="ttc" id="a00164_html"><div class="ttname"><a href="a00164.html">HyPar</a></div><div class="ttdoc">Structure containing all solver-specific variables and functions. </div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00023">hypar.h:23</a></div></div>
<div class="ttc" id="a00164_html_a6b4951ffdbd82f3a3848b82352d389d6"><div class="ttname"><a href="a00164.html#a6b4951ffdbd82f3a3848b82352d389d6">HyPar::source</a></div><div class="ttdeci">double * source</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00117">hypar.h:117</a></div></div>
<div class="ttc" id="a00164_html_a73a85f83072e02bf979234486265b6d3"><div class="ttname"><a href="a00164.html#a73a85f83072e02bf979234486265b6d3">HyPar::UpwinddF</a></div><div class="ttdeci">int(* UpwinddF)(double *, double *, double *, double *, double *, double *, int, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00284">hypar.h:284</a></div></div>
<div class="ttc" id="a00173_html_a00591"><div class="ttname"><a href="a00173.html#a00591">PETScContext</a></div><div class="ttdoc">Structure containing the variables for time-integration with PETSc. </div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00035">petscinterface.h:35</a></div></div>
<div class="ttc" id="a00164_html_a662e256e081a2b74f971d02c747892b8"><div class="ttname"><a href="a00164.html#a662e256e081a2b74f971d02c747892b8">HyPar::SourceFunction</a></div><div class="ttdeci">int(* SourceFunction)(double *, double *, void *, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00246">hypar.h:246</a></div></div>
<div class="ttc" id="a00164_html_ad587a58397d439c443ae325450a01a13"><div class="ttname"><a href="a00164.html#ad587a58397d439c443ae325450a01a13">HyPar::rhsref</a></div><div class="ttdeci">double * rhsref</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00374">hypar.h:374</a></div></div>
<div class="ttc" id="a00164_html_a484873c74138512e41bc50d17b7d955a"><div class="ttname"><a href="a00164.html#a484873c74138512e41bc50d17b7d955a">HyPar::ndims</a></div><div class="ttdeci">int ndims</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00026">hypar.h:26</a></div></div>
<div class="ttc" id="a00173_html_ac48ad2561e5e125d2789133e848db1d9"><div class="ttname"><a href="a00173.html#ac48ad2561e5e125d2789133e848db1d9">PETScContext::flag_parabolic</a></div><div class="ttdeci">int flag_parabolic</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00066">petscinterface.h:66</a></div></div>
<div class="ttc" id="a00164_html_a38e0371f331cecbe63a77fa03e202afe"><div class="ttname"><a href="a00164.html#a38e0371f331cecbe63a77fa03e202afe">HyPar::dim_local</a></div><div class="ttdeci">int * dim_local</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00035">hypar.h:35</a></div></div>
<div class="ttc" id="a00188_html_add9cf96ae374934d245a1dc1ab697a42"><div class="ttname"><a href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a></div><div class="ttdeci">#define CHECKERR(ierr)</div><div class="ttdef"><b>Definition:</b> <a href="a00188_source.html#l00014">basic.h:14</a></div></div>
<div class="ttc" id="a00173_html_ade1bc5cad8c6735a891a28f637cbfb06"><div class="ttname"><a href="a00173.html#ade1bc5cad8c6735a891a28f637cbfb06">PETScContext::solver</a></div><div class="ttdeci">void * solver</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00037">petscinterface.h:37</a></div></div>
<div class="ttc" id="a00164_html_a75e8be4ea8c1ae2e99fc1e802e69a573"><div class="ttname"><a href="a00164.html#a75e8be4ea8c1ae2e99fc1e802e69a573">HyPar::ParabolicFunction</a></div><div class="ttdeci">int(* ParabolicFunction)(double *, double *, void *, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00243">hypar.h:243</a></div></div>
<div class="ttc" id="a00164_html_afc11cc081aa04d7b35ebcbcb735f7e22"><div class="ttname"><a href="a00164.html#afc11cc081aa04d7b35ebcbcb735f7e22">HyPar::count_IJacFunction</a></div><div class="ttdeci">int count_IJacFunction</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00398">hypar.h:398</a></div></div>
<div class="ttc" id="a00173_html_ab057d99becacf205132fd8c235a8488a"><div class="ttname"><a href="a00173.html#ab057d99becacf205132fd8c235a8488a">PETScContext::shift</a></div><div class="ttdeci">PetscReal shift</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00042">petscinterface.h:42</a></div></div>
<div class="ttc" id="a00173_html_a6a0edd627a2b2cc687d1031e3884dd6a"><div class="ttname"><a href="a00173.html#a6a0edd627a2b2cc687d1031e3884dd6a">PETScContext::flag_hyperbolic_f</a></div><div class="ttdeci">int flag_hyperbolic_f</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00062">petscinterface.h:62</a></div></div>
<div class="ttc" id="a00167_html_a00588"><div class="ttname"><a href="a00167.html#a00588">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a00167_source.html#l00024">mpivars_struct.h:24</a></div></div>
<div class="ttc" id="a00173_html_a54c0451c4ae9650a54f54246f1f8823b"><div class="ttname"><a href="a00173.html#a54c0451c4ae9650a54f54246f1f8823b">PETScContext::flag_source</a></div><div class="ttdeci">int flag_source</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00068">petscinterface.h:68</a></div></div>
<div class="ttc" id="a00164_html_aa245f8c9e6af37e47c5867dccbbc208b"><div class="ttname"><a href="a00164.html#aa245f8c9e6af37e47c5867dccbbc208b">HyPar::HyperbolicFunction</a></div><div class="ttdeci">int(* HyperbolicFunction)(double *, double *, void *, void *, double, int, int(*)(double *, double *, int, void *, double), int(*)(double *, double *, double *, double *, double *, double *, int, void *, double))</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00237">hypar.h:237</a></div></div>
<div class="ttc" id="a00164_html_ae53517ad7a202762d7b79eaf681701f3"><div class="ttname"><a href="a00164.html#ae53517ad7a202762d7b79eaf681701f3">HyPar::par</a></div><div class="ttdeci">double * par</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00114">hypar.h:114</a></div></div>
<div class="ttc" id="a00164_html_a0d895f9bb0c8a3e79a64dd2379e1f2dd"><div class="ttname"><a href="a00164.html#a0d895f9bb0c8a3e79a64dd2379e1f2dd">HyPar::FFunction</a></div><div class="ttdeci">int(* FFunction)(double *, double *, int, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00262">hypar.h:262</a></div></div>
<div class="ttc" id="a00164_html_ade4650485fe35fd3e12fea272fc80209"><div class="ttname"><a href="a00164.html#ade4650485fe35fd3e12fea272fc80209">HyPar::rhs</a></div><div class="ttdeci">double * rhs</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00375">hypar.h:375</a></div></div>
<div class="ttc" id="a00164_html_a5bed0cb9665daad89f4377c4f7609df4"><div class="ttname"><a href="a00164.html#a5bed0cb9665daad89f4377c4f7609df4">HyPar::SplitHyperbolicFlux</a></div><div class="ttdeci">char SplitHyperbolicFlux[_MAX_STRING_SIZE_]</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00084">hypar.h:84</a></div></div>
<div class="ttc" id="a00164_html_aa1dd38befc4bb4adda9d456146436b14"><div class="ttname"><a href="a00164.html#aa1dd38befc4bb4adda9d456146436b14">HyPar::dFFunction</a></div><div class="ttdeci">int(* dFFunction)(double *, double *, int, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00266">hypar.h:266</a></div></div>
<div class="ttc" id="a00173_html_a21b4785029b7597816341479bc3260b4"><div class="ttname"><a href="a00173.html#a21b4785029b7597816341479bc3260b4">PETScContext::flag_hyperbolic_df</a></div><div class="ttdeci">int flag_hyperbolic_df</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00064">petscinterface.h:64</a></div></div>
<div class="ttc" id="a00164_html_ab06746933e859e829d694505c18258b3"><div class="ttname"><a href="a00164.html#ab06746933e859e829d694505c18258b3">HyPar::UpwindFdF</a></div><div class="ttdeci">int(* UpwindFdF)(double *, double *, double *, double *, double *, double *, int, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00291">hypar.h:291</a></div></div>
<div class="ttc" id="a00187_html_a2b2826031c0cd92495ab351d3e599fc5"><div class="ttname"><a href="a00187.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a></div><div class="ttdeci">#define _ArraySetValue_(x, size, value)</div><div class="ttdef"><b>Definition:</b> <a href="a00187_source.html#l00168">arrayfunctions.h:168</a></div></div>
<div class="ttc" id="a00164_html_aeadfdde0fbc3058bace813055212dcc3"><div class="ttname"><a href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">HyPar::hyp</a></div><div class="ttdeci">double * hyp</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00111">hypar.h:111</a></div></div>
<div class="ttc" id="a00164_html_a7eb68b9643feb74bd49f3a171b66eef1"><div class="ttname"><a href="a00164.html#a7eb68b9643feb74bd49f3a171b66eef1">HyPar::Upwind</a></div><div class="ttdeci">int(* Upwind)(double *, double *, double *, double *, double *, double *, int, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00279">hypar.h:279</a></div></div>
<div class="ttc" id="a00164_html_aa4de7bdc1e62417caf51b9c45184268d"><div class="ttname"><a href="a00164.html#aa4de7bdc1e62417caf51b9c45184268d">HyPar::ApplyBoundaryConditions</a></div><div class="ttdeci">int(* ApplyBoundaryConditions)(void *, void *, double *, double *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00201">hypar.h:201</a></div></div>
<div class="ttc" id="a00173_html_aba47a541676718cced51875b1c3a4ba6"><div class="ttname"><a href="a00173.html#aba47a541676718cced51875b1c3a4ba6">TransferVecFromPETSc</a></div><div class="ttdeci">int TransferVecFromPETSc(double *, Vec, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00359_source.html#l00022">TransferFromPETSc.c:22</a></div></div>
<div class="ttc" id="a00164_html_a3b6b999a764f1e2ea94bb5f28c7a558c"><div class="ttname"><a href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">HyPar::u</a></div><div class="ttdeci">double * u</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00108">hypar.h:108</a></div></div>
<div class="ttc" id="a00164_html_ad607f82c4bfde055613e05272f9afd81"><div class="ttname"><a href="a00164.html#ad607f82c4bfde055613e05272f9afd81">HyPar::flag_fdf_specified</a></div><div class="ttdeci">int flag_fdf_specified</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00276">hypar.h:276</a></div></div>
<div class="ttc" id="a00164_html_a3ccc9ddb96600c40dcc41bb1ded11160"><div class="ttname"><a href="a00164.html#a3ccc9ddb96600c40dcc41bb1ded11160">HyPar::uref</a></div><div class="ttdeci">double * uref</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00373">hypar.h:373</a></div></div>
<div class="ttc" id="a00173_html_a94499efe0f52b5174ce7105de5ab1a37"><div class="ttname"><a href="a00173.html#a94499efe0f52b5174ce7105de5ab1a37">TransferVecToPETSc</a></div><div class="ttdeci">int TransferVecToPETSc(double *, Vec, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00360_source.html#l00023">TransferToPETSc.c:23</a></div></div>
<div class="ttc" id="a00204_html_a60ace5964c051fa481e6a1e6f1ef75d7"><div class="ttname"><a href="a00204.html#a60ace5964c051fa481e6a1e6f1ef75d7">MPIExchangeBoundariesnD</a></div><div class="ttdeci">int MPIExchangeBoundariesnD(int, int, int *, int, void *, double *)</div><div class="ttdef"><b>Definition:</b> <a href="a00326_source.html#l00042">MPIExchangeBoundariesnD.c:42</a></div></div>
<div class="ttc" id="a00164_html_aafc992b5fa79d5a4036024615d03bce6"><div class="ttname"><a href="a00164.html#aafc992b5fa79d5a4036024615d03bce6">HyPar::ghosts</a></div><div class="ttdeci">int ghosts</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00044">hypar.h:44</a></div></div>
<div class="ttc" id="a00173_html_a376b6b34e162357d201827d01a5aa2a4"><div class="ttname"><a href="a00173.html#a376b6b34e162357d201827d01a5aa2a4">PETScContext::flag_hyperbolic</a></div><div class="ttdeci">int flag_hyperbolic</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00060">petscinterface.h:60</a></div></div>
<div class="ttc" id="a00164_html_adcc5e677515d0952ce3ff702c9d85b86"><div class="ttname"><a href="a00164.html#adcc5e677515d0952ce3ff702c9d85b86">HyPar::FdFFunction</a></div><div class="ttdeci">int(* FdFFunction)(double *, double *, int, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00272">hypar.h:272</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3d6a695a879ec54937525109ac912355"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode PetscIJacobian </td>
          <td>(</td>
          <td class="paramtype">TS&#160;</td>
          <td class="paramname"><em>ts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal&#160;</td>
          <td class="paramname"><em>t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Vec&#160;</td>
          <td class="paramname"><em>Y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Vec&#160;</td>
          <td class="paramname"><em>Ydot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Mat&#160;</td>
          <td class="paramname"><em>A</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Mat&#160;</td>
          <td class="paramname"><em>B</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>ctxt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Compute the Jacobian for implicit time integration of the governing equations: The ODE, obtained after discretizing the governing PDE in space, is expressed as follows: </p>
<p class="formulaDsp">
\begin{equation} \frac {d{\bf U}}{dt} = {\bf F}\left({\bf U}\right) \Rightarrow \dot{\bf U} - {\bf F}\left({\bf U}\right) = 0, \end{equation}
</p>
<p> where \({\bf F}\) is the spatially discretized right-hand-side, and \({\bf U}\) represents the entire solution vector. The Jacobian is thus given by: </p>
<p class="formulaDsp">
\begin{equation} {\bf J} = \left[\alpha{\bf I} - \frac {\partial {\bf F}} {\partial {\bf U}} \right] \end{equation}
</p>
<p> where \(\alpha\) is the shift coefficient (<a class="el" href="a00173.html#ab057d99becacf205132fd8c235a8488a">PETScContext::shift</a>) of the time integration method.</p>
<p><b>Matrix-free</b> <b>representation:</b> The Jacobian is computed using a matrix-free approach, where the entire Jacobian is never assembled, computed, or stored. Instead, the action of the Jacobian on a vector is defined through functions (<a class="el" href="a00173.html#a68f5a93a79d56fcb964224f649af4ac9">PetscJacobianFunction_JFNK()</a> for nonlinear systems, and <a class="el" href="a00173.html#abed41de2efef801be98f8338aa2672f2">PetscJacobianFunction_Linear()</a> for linear systems). This approach works well with iterative solvers. Thus, this function just does the following:</p>
<ul>
<li>Saves the <a class="el" href="a00173.html#ab057d99becacf205132fd8c235a8488a">PETScContext::shift</a> ( \(\alpha\)) and <a class="el" href="a00173.html#a28e4e78c0bf258662bef21d26c51fc0b">PETScContext::waqt</a> (current simulation time) to the application context (so that <a class="el" href="a00173.html#a68f5a93a79d56fcb964224f649af4ac9">PetscJacobianFunction_JFNK()</a> or <a class="el" href="a00173.html#abed41de2efef801be98f8338aa2672f2">PetscJacobianFunction_Linear()</a> can access these values).</li>
<li>If a preconditioner is being used, calls the function to compute the preconditioning matrix.</li>
</ul>
<p><b>Notes:</b> </p>
<ul>
<li>The Jacobian is defined as the PETSc type MatShell (<a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/Mat/MATSHELL.html">http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/Mat/MATSHELL.html</a>)</li>
<li><em>Y</em> and <em>Ydot</em> in the code are \({\bf U}\) and \(\dot{\bf U}\), respectively. PETsc denotes the state vector with \({\bf Y}\) in its time integrators.</li>
<li>See <a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/index.html">http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/index.html</a> for documentation on PETSc's time integrators.</li>
<li>All functions and variables whose names start with Vec, Mat, PC, KSP, SNES, and TS are defined by PETSc. Refer to the PETSc documentation (<a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/">http://www.mcs.anl.gov/petsc/petsc-current/docs/</a>). Usually, googling with the function or variable name yields the specific doc page dealing with that function/variable. </li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ts</td><td>Time stepping object (see PETSc TS) </td></tr>
    <tr><td class="paramname">t</td><td>Current time </td></tr>
    <tr><td class="paramname">Y</td><td>Solution vector </td></tr>
    <tr><td class="paramname">Ydot</td><td>Time-derivative of solution vector </td></tr>
    <tr><td class="paramname">a</td><td>Shift </td></tr>
    <tr><td class="paramname">A</td><td>Jacobian matrix </td></tr>
    <tr><td class="paramname">B</td><td>Preconditioning matrix </td></tr>
    <tr><td class="paramname">ctxt</td><td>Application context </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00349_source.html#l00052">52</a> of file <a class="el" href="a00349_source.html">PetscIJacobian.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;{</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  <a class="code" href="a00173.html#a00591">PETScContext</a> *context = (<a class="code" href="a00173.html#a00591">PETScContext</a>*) ctxt;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  <a class="code" href="a00164.html">HyPar</a>        *solver  = context-&gt;<a class="code" href="a00173.html#ade1bc5cad8c6735a891a28f637cbfb06">solver</a>;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  <a class="code" href="a00188.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a>;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  PetscFunctionBegin;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  solver-&gt;<a class="code" href="a00164.html#a8086208a451520745e3fab0e3918db06">count_IJacobian</a>++;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  context-&gt;<a class="code" href="a00173.html#ab057d99becacf205132fd8c235a8488a">shift</a> = a;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  context-&gt;<a class="code" href="a00173.html#a28e4e78c0bf258662bef21d26c51fc0b">waqt</a>  = t;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <span class="comment">/* Construct preconditioning matrix */</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00173.html#a271fbbfea71118710d4a2fb13eb4c1cc">flag_use_precon</a>) { <a class="code" href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00173.html#a4c77df03a775220fb7bcf6b137ca59b3">PetscComputePreconMatImpl</a>(B,Y,context); <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr); }</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  PetscFunctionReturn(0);</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;}</div>
<div class="ttc" id="a00173_html_a28e4e78c0bf258662bef21d26c51fc0b"><div class="ttname"><a href="a00173.html#a28e4e78c0bf258662bef21d26c51fc0b">PETScContext::waqt</a></div><div class="ttdeci">double waqt</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00044">petscinterface.h:44</a></div></div>
<div class="ttc" id="a00164_html"><div class="ttname"><a href="a00164.html">HyPar</a></div><div class="ttdoc">Structure containing all solver-specific variables and functions. </div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00023">hypar.h:23</a></div></div>
<div class="ttc" id="a00173_html_a4c77df03a775220fb7bcf6b137ca59b3"><div class="ttname"><a href="a00173.html#a4c77df03a775220fb7bcf6b137ca59b3">PetscComputePreconMatImpl</a></div><div class="ttdeci">int PetscComputePreconMatImpl(Mat, Vec, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00343_source.html#l00064">PetscComputePreconMatImpl.c:64</a></div></div>
<div class="ttc" id="a00173_html_a00591"><div class="ttname"><a href="a00173.html#a00591">PETScContext</a></div><div class="ttdoc">Structure containing the variables for time-integration with PETSc. </div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00035">petscinterface.h:35</a></div></div>
<div class="ttc" id="a00188_html_add9cf96ae374934d245a1dc1ab697a42"><div class="ttname"><a href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a></div><div class="ttdeci">#define CHECKERR(ierr)</div><div class="ttdef"><b>Definition:</b> <a href="a00188_source.html#l00014">basic.h:14</a></div></div>
<div class="ttc" id="a00173_html_ade1bc5cad8c6735a891a28f637cbfb06"><div class="ttname"><a href="a00173.html#ade1bc5cad8c6735a891a28f637cbfb06">PETScContext::solver</a></div><div class="ttdeci">void * solver</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00037">petscinterface.h:37</a></div></div>
<div class="ttc" id="a00173_html_ab057d99becacf205132fd8c235a8488a"><div class="ttname"><a href="a00173.html#ab057d99becacf205132fd8c235a8488a">PETScContext::shift</a></div><div class="ttdeci">PetscReal shift</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00042">petscinterface.h:42</a></div></div>
<div class="ttc" id="a00173_html_a271fbbfea71118710d4a2fb13eb4c1cc"><div class="ttname"><a href="a00173.html#a271fbbfea71118710d4a2fb13eb4c1cc">PETScContext::flag_use_precon</a></div><div class="ttdeci">int flag_use_precon</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00071">petscinterface.h:71</a></div></div>
<div class="ttc" id="a00188_html_ad6ab74942c9de13cf0b4c12eb0d91780"><div class="ttname"><a href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a></div><div class="ttdeci">#define IERR</div><div class="ttdef"><b>Definition:</b> <a href="a00188_source.html#l00012">basic.h:12</a></div></div>
<div class="ttc" id="a00188_html_a68f50121fb9a7daeaf60e50cdef82ef3"><div class="ttname"><a href="a00188.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a></div><div class="ttdeci">#define _DECLARE_IERR_</div><div class="ttdef"><b>Definition:</b> <a href="a00188_source.html#l00013">basic.h:13</a></div></div>
<div class="ttc" id="a00164_html_a8086208a451520745e3fab0e3918db06"><div class="ttname"><a href="a00164.html#a8086208a451520745e3fab0e3918db06">HyPar::count_IJacobian</a></div><div class="ttdeci">int count_IJacobian</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00398">hypar.h:398</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a68f5a93a79d56fcb964224f649af4ac9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode PetscJacobianFunction_JFNK </td>
          <td>(</td>
          <td class="paramtype">Mat&#160;</td>
          <td class="paramname"><em>Jacobian</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Vec&#160;</td>
          <td class="paramname"><em>Y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Vec&#160;</td>
          <td class="paramname"><em>F</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Computes the action of the Jacobian on a vector: See documentation for <a class="el" href="a00173.html#a3d6a695a879ec54937525109ac912355">PetscIJacobian()</a> for the definition of the Jacobian. This function computes its action on a vector for a nonlinear system by taking the directional derivative, as follows: </p>
<p class="formulaDsp">
\begin{equation} {\bf f} = {\bf J}\left({\bf U}_0\right){\bf y} = \frac {\partial \mathcal{F}\left({\bf U}\right)} {\partial {\bf U}}\left({\bf U}_0\right) {\bf y} \approx \frac{1}{\epsilon} \left[ \mathcal{F}\left({\bf U}_0+\epsilon{\bf y}\right)-\mathcal{F}\left({\bf U}_0\right) \right] \end{equation}
</p>
<p> In the context of the implicit time integration of the ODE given by </p>
<p class="formulaDsp">
\begin{equation} \frac {d {\bf U}} {dt} = {\bf F}\left({\bf U}\right) \Rightarrow \frac {d {\bf U}} {dt} - {\bf F}\left({\bf U}\right) = 0, \end{equation}
</p>
<p> we have that </p>
<p class="formulaDsp">
\begin{equation} \mathcal{F}\left({\bf U}\right) \equiv \dot{\bf U} - {\bf F}\left({\bf U}\right) \Rightarrow {\bf J}\left({\bf U}\right) = \left[\alpha{\bf I} - \frac {\partial {\bf F}\left({\bf U}\right)} {\partial {\bf U}} \right]. \end{equation}
</p>
<p> where \(\alpha\) (<a class="el" href="a00173.html#ab057d99becacf205132fd8c235a8488a">PETScContext::shift</a>) is the shift variable specific to the time integration method. So this function computes </p>
<p class="formulaDsp">
\begin{equation} {\bf f} = \alpha {\bf y} - \frac{1}{\epsilon} \left[ {\bf F}\left({\bf U}_0+\epsilon{\bf y}\right)-{\bf F}\left({\bf U}_0\right) \right] \end{equation}
</p>
<p> In the code, \({\bf y}\) is <em>Y</em>, \(\bf f\) is <em>F</em>, and \({\bf U}_0\) is <em><a class="el" href="a00164.html#a3ccc9ddb96600c40dcc41bb1ded11160">HyPar::uref</a></em> (the reference solution at which the nonlinear Jacobian is computed). See papers on Jacobian-free Newton-Krylov (JFNK) methods to understand how \(\epsilon\) is computed.</p>
<p><b>Notes:</b> </p>
<ul>
<li>For a nonlinear spatial discretization, the right-hand-side <b>must</b> be computed without the nonlinearity (i.e. with a previously computed or "frozen" discretization operator). This ensures that the Jacobian being computed is consistent.</li>
<li>See <a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/index.html">http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/index.html</a> for documentation on PETSc's time integrators.</li>
<li>All functions and variables whose names start with Vec, Mat, PC, KSP, SNES, and TS are defined by PETSc. Refer to the PETSc documentation (<a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/">http://www.mcs.anl.gov/petsc/petsc-current/docs/</a>). Usually, googling with the function or variable name yields the specific doc page dealing with that function/variable. </li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Jacobian</td><td>Jacobian matrix </td></tr>
    <tr><td class="paramname">Y</td><td>Input vector </td></tr>
    <tr><td class="paramname">F</td><td>Output vector (Jacobian times input vector) </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00349_source.html#l00113">113</a> of file <a class="el" href="a00349_source.html">PetscIJacobian.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;{</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  <a class="code" href="a00173.html#a00591">PETScContext</a>    *context = NULL;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <a class="code" href="a00164.html">HyPar</a>           *solver  = NULL;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  <a class="code" href="a00167.html#a00588">MPIVariables</a>    *mpi     = NULL;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  <span class="keywordtype">int</span>             ierr     = 0, d;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  PetscFunctionBegin;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  ierr   = MatShellGetContext(Jacobian,&amp;context); CHKERRQ(ierr);</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  solver = context-&gt;<a class="code" href="a00173.html#ade1bc5cad8c6735a891a28f637cbfb06">solver</a>;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  mpi    = context-&gt;<a class="code" href="a00173.html#abaa15763a88d05dc68ff230ce570eee9">mpi</a>;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  solver-&gt;<a class="code" href="a00164.html#afc11cc081aa04d7b35ebcbcb735f7e22">count_IJacFunction</a>++;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <span class="keywordtype">int</span> size = 1;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  <span class="keywordflow">for</span> (d=0; d&lt;solver-&gt;<a class="code" href="a00164.html#a484873c74138512e41bc50d17b7d955a">ndims</a>; d++) size *= (solver-&gt;<a class="code" href="a00164.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>[d]+2*solver-&gt;<a class="code" href="a00164.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>);</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  <span class="keywordtype">double</span> *u       = solver-&gt;<a class="code" href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  <span class="keywordtype">double</span> *uref    = solver-&gt;<a class="code" href="a00164.html#a3ccc9ddb96600c40dcc41bb1ded11160">uref</a>;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <span class="keywordtype">double</span> *rhsref  = solver-&gt;<a class="code" href="a00164.html#ad587a58397d439c443ae325450a01a13">rhsref</a>;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <span class="keywordtype">double</span> *rhs     = solver-&gt;<a class="code" href="a00164.html#ade4650485fe35fd3e12fea272fc80209">rhs</a>;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  <span class="keywordtype">double</span> t = context-&gt;<a class="code" href="a00173.html#a28e4e78c0bf258662bef21d26c51fc0b">waqt</a>; <span class="comment">/* current stage/step time */</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <span class="keywordtype">double</span> normY;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  ierr = VecNorm(Y,NORM_2,&amp;normY);                                        CHKERRQ(ierr);</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <span class="keywordflow">if</span> (normY &lt; 1e-16) {</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="comment">/* F = 0 */</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    ierr = VecZeroEntries(F);                                             CHKERRQ(ierr);</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="comment">/* [J]Y = aY - F(Y) */</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    ierr = VecAXPBY(F,context-&gt;<a class="code" href="a00173.html#ab057d99becacf205132fd8c235a8488a">shift</a>,0,Y);                                CHKERRQ(ierr);</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    </div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="keywordtype">double</span> epsilon =  context-&gt;<a class="code" href="a00173.html#ad62e14c19e38497048380c4a7fe10e12">jfnk_eps</a> / normY;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="comment">/* copy solution from PETSc vector */</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    ierr = <a class="code" href="a00173.html#aba47a541676718cced51875b1c3a4ba6">TransferVecFromPETSc</a>(u,Y,context);                             <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <a class="code" href="a00187.html#ab8e3b679b04116dd6be664e727f0d951">_ArrayAYPX_</a>(uref,epsilon,u,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="comment">/* apply boundary conditions and exchange data over MPI interfaces */</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    ierr = solver-&gt;<a class="code" href="a00164.html#aa4de7bdc1e62417caf51b9c45184268d">ApplyBoundaryConditions</a>(solver,mpi,u,NULL,t);          <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    ierr = <a class="code" href="a00204.html#a60ace5964c051fa481e6a1e6f1ef75d7">MPIExchangeBoundariesnD</a>(solver-&gt;<a class="code" href="a00164.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00164.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;                                   solver-&gt;<a class="code" href="a00164.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,mpi,u);                 <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="comment">/* Evaluate hyperbolic, parabolic and source terms  and the RHS for U+dU */</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <a class="code" href="a00187.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,0.0);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    ierr = solver-&gt;<a class="code" href="a00164.html#aa245f8c9e6af37e47c5867dccbbc208b">HyperbolicFunction</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,u,solver,mpi,t,0,</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;                                      solver-&gt;<a class="code" href="a00164.html#a0d895f9bb0c8a3e79a64dd2379e1f2dd">FFunction</a>,solver-&gt;<a class="code" href="a00164.html#a7eb68b9643feb74bd49f3a171b66eef1">Upwind</a>);  <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,-1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    ierr = solver-&gt;<a class="code" href="a00164.html#a75e8be4ea8c1ae2e99fc1e802e69a573">ParabolicFunction</a> (solver-&gt;<a class="code" href="a00164.html#ae53517ad7a202762d7b79eaf681701f3">par</a>,u,solver,mpi,t);        <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00164.html#ae53517ad7a202762d7b79eaf681701f3">par</a>, 1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    ierr = solver-&gt;<a class="code" href="a00164.html#a662e256e081a2b74f971d02c747892b8">SourceFunction</a>    (solver-&gt;<a class="code" href="a00164.html#a6b4951ffdbd82f3a3848b82352d389d6">source</a>,u,solver,mpi,t);     <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00164.html#a6b4951ffdbd82f3a3848b82352d389d6">source</a>, 1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(rhsref,-1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="comment">/* Transfer RHS to PETSc vector */</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    ierr = <a class="code" href="a00173.html#a94499efe0f52b5174ce7105de5ab1a37">TransferVecToPETSc</a>(rhs,F,context);               <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="comment">/* [J]Y = aY - F(Y) */</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    ierr = VecAXPBY(F,context-&gt;<a class="code" href="a00173.html#ab057d99becacf205132fd8c235a8488a">shift</a>,(-1.0/epsilon),Y);     CHKERRQ(ierr);</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  }</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  PetscFunctionReturn(0);</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;}</div>
<div class="ttc" id="a00173_html_a28e4e78c0bf258662bef21d26c51fc0b"><div class="ttname"><a href="a00173.html#a28e4e78c0bf258662bef21d26c51fc0b">PETScContext::waqt</a></div><div class="ttdeci">double waqt</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00044">petscinterface.h:44</a></div></div>
<div class="ttc" id="a00173_html_abaa15763a88d05dc68ff230ce570eee9"><div class="ttname"><a href="a00173.html#abaa15763a88d05dc68ff230ce570eee9">PETScContext::mpi</a></div><div class="ttdeci">void * mpi</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00039">petscinterface.h:39</a></div></div>
<div class="ttc" id="a00164_html_ae8f6d2fd6490d3153cb4133bf183a404"><div class="ttname"><a href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">HyPar::nvars</a></div><div class="ttdeci">int nvars</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00029">hypar.h:29</a></div></div>
<div class="ttc" id="a00187_html_a4cd66304bc41a7751842230af3063b62"><div class="ttname"><a href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a></div><div class="ttdeci">#define _ArrayAXPY_(x, a, y, size)</div><div class="ttdef"><b>Definition:</b> <a href="a00187_source.html#l00270">arrayfunctions.h:270</a></div></div>
<div class="ttc" id="a00187_html_ab8e3b679b04116dd6be664e727f0d951"><div class="ttname"><a href="a00187.html#ab8e3b679b04116dd6be664e727f0d951">_ArrayAYPX_</a></div><div class="ttdeci">#define _ArrayAYPX_(x, a, y, size)</div><div class="ttdef"><b>Definition:</b> <a href="a00187_source.html#l00257">arrayfunctions.h:257</a></div></div>
<div class="ttc" id="a00164_html"><div class="ttname"><a href="a00164.html">HyPar</a></div><div class="ttdoc">Structure containing all solver-specific variables and functions. </div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00023">hypar.h:23</a></div></div>
<div class="ttc" id="a00164_html_a6b4951ffdbd82f3a3848b82352d389d6"><div class="ttname"><a href="a00164.html#a6b4951ffdbd82f3a3848b82352d389d6">HyPar::source</a></div><div class="ttdeci">double * source</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00117">hypar.h:117</a></div></div>
<div class="ttc" id="a00173_html_a00591"><div class="ttname"><a href="a00173.html#a00591">PETScContext</a></div><div class="ttdoc">Structure containing the variables for time-integration with PETSc. </div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00035">petscinterface.h:35</a></div></div>
<div class="ttc" id="a00164_html_a662e256e081a2b74f971d02c747892b8"><div class="ttname"><a href="a00164.html#a662e256e081a2b74f971d02c747892b8">HyPar::SourceFunction</a></div><div class="ttdeci">int(* SourceFunction)(double *, double *, void *, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00246">hypar.h:246</a></div></div>
<div class="ttc" id="a00164_html_ad587a58397d439c443ae325450a01a13"><div class="ttname"><a href="a00164.html#ad587a58397d439c443ae325450a01a13">HyPar::rhsref</a></div><div class="ttdeci">double * rhsref</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00374">hypar.h:374</a></div></div>
<div class="ttc" id="a00164_html_a484873c74138512e41bc50d17b7d955a"><div class="ttname"><a href="a00164.html#a484873c74138512e41bc50d17b7d955a">HyPar::ndims</a></div><div class="ttdeci">int ndims</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00026">hypar.h:26</a></div></div>
<div class="ttc" id="a00164_html_a38e0371f331cecbe63a77fa03e202afe"><div class="ttname"><a href="a00164.html#a38e0371f331cecbe63a77fa03e202afe">HyPar::dim_local</a></div><div class="ttdeci">int * dim_local</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00035">hypar.h:35</a></div></div>
<div class="ttc" id="a00188_html_add9cf96ae374934d245a1dc1ab697a42"><div class="ttname"><a href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a></div><div class="ttdeci">#define CHECKERR(ierr)</div><div class="ttdef"><b>Definition:</b> <a href="a00188_source.html#l00014">basic.h:14</a></div></div>
<div class="ttc" id="a00173_html_ade1bc5cad8c6735a891a28f637cbfb06"><div class="ttname"><a href="a00173.html#ade1bc5cad8c6735a891a28f637cbfb06">PETScContext::solver</a></div><div class="ttdeci">void * solver</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00037">petscinterface.h:37</a></div></div>
<div class="ttc" id="a00164_html_a75e8be4ea8c1ae2e99fc1e802e69a573"><div class="ttname"><a href="a00164.html#a75e8be4ea8c1ae2e99fc1e802e69a573">HyPar::ParabolicFunction</a></div><div class="ttdeci">int(* ParabolicFunction)(double *, double *, void *, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00243">hypar.h:243</a></div></div>
<div class="ttc" id="a00164_html_afc11cc081aa04d7b35ebcbcb735f7e22"><div class="ttname"><a href="a00164.html#afc11cc081aa04d7b35ebcbcb735f7e22">HyPar::count_IJacFunction</a></div><div class="ttdeci">int count_IJacFunction</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00398">hypar.h:398</a></div></div>
<div class="ttc" id="a00173_html_ab057d99becacf205132fd8c235a8488a"><div class="ttname"><a href="a00173.html#ab057d99becacf205132fd8c235a8488a">PETScContext::shift</a></div><div class="ttdeci">PetscReal shift</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00042">petscinterface.h:42</a></div></div>
<div class="ttc" id="a00167_html_a00588"><div class="ttname"><a href="a00167.html#a00588">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a00167_source.html#l00024">mpivars_struct.h:24</a></div></div>
<div class="ttc" id="a00164_html_aa245f8c9e6af37e47c5867dccbbc208b"><div class="ttname"><a href="a00164.html#aa245f8c9e6af37e47c5867dccbbc208b">HyPar::HyperbolicFunction</a></div><div class="ttdeci">int(* HyperbolicFunction)(double *, double *, void *, void *, double, int, int(*)(double *, double *, int, void *, double), int(*)(double *, double *, double *, double *, double *, double *, int, void *, double))</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00237">hypar.h:237</a></div></div>
<div class="ttc" id="a00164_html_ae53517ad7a202762d7b79eaf681701f3"><div class="ttname"><a href="a00164.html#ae53517ad7a202762d7b79eaf681701f3">HyPar::par</a></div><div class="ttdeci">double * par</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00114">hypar.h:114</a></div></div>
<div class="ttc" id="a00173_html_ad62e14c19e38497048380c4a7fe10e12"><div class="ttname"><a href="a00173.html#ad62e14c19e38497048380c4a7fe10e12">PETScContext::jfnk_eps</a></div><div class="ttdeci">double jfnk_eps</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00077">petscinterface.h:77</a></div></div>
<div class="ttc" id="a00164_html_a0d895f9bb0c8a3e79a64dd2379e1f2dd"><div class="ttname"><a href="a00164.html#a0d895f9bb0c8a3e79a64dd2379e1f2dd">HyPar::FFunction</a></div><div class="ttdeci">int(* FFunction)(double *, double *, int, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00262">hypar.h:262</a></div></div>
<div class="ttc" id="a00164_html_ade4650485fe35fd3e12fea272fc80209"><div class="ttname"><a href="a00164.html#ade4650485fe35fd3e12fea272fc80209">HyPar::rhs</a></div><div class="ttdeci">double * rhs</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00375">hypar.h:375</a></div></div>
<div class="ttc" id="a00187_html_a2b2826031c0cd92495ab351d3e599fc5"><div class="ttname"><a href="a00187.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a></div><div class="ttdeci">#define _ArraySetValue_(x, size, value)</div><div class="ttdef"><b>Definition:</b> <a href="a00187_source.html#l00168">arrayfunctions.h:168</a></div></div>
<div class="ttc" id="a00164_html_aeadfdde0fbc3058bace813055212dcc3"><div class="ttname"><a href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">HyPar::hyp</a></div><div class="ttdeci">double * hyp</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00111">hypar.h:111</a></div></div>
<div class="ttc" id="a00164_html_a7eb68b9643feb74bd49f3a171b66eef1"><div class="ttname"><a href="a00164.html#a7eb68b9643feb74bd49f3a171b66eef1">HyPar::Upwind</a></div><div class="ttdeci">int(* Upwind)(double *, double *, double *, double *, double *, double *, int, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00279">hypar.h:279</a></div></div>
<div class="ttc" id="a00164_html_aa4de7bdc1e62417caf51b9c45184268d"><div class="ttname"><a href="a00164.html#aa4de7bdc1e62417caf51b9c45184268d">HyPar::ApplyBoundaryConditions</a></div><div class="ttdeci">int(* ApplyBoundaryConditions)(void *, void *, double *, double *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00201">hypar.h:201</a></div></div>
<div class="ttc" id="a00173_html_aba47a541676718cced51875b1c3a4ba6"><div class="ttname"><a href="a00173.html#aba47a541676718cced51875b1c3a4ba6">TransferVecFromPETSc</a></div><div class="ttdeci">int TransferVecFromPETSc(double *, Vec, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00359_source.html#l00022">TransferFromPETSc.c:22</a></div></div>
<div class="ttc" id="a00164_html_a3b6b999a764f1e2ea94bb5f28c7a558c"><div class="ttname"><a href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">HyPar::u</a></div><div class="ttdeci">double * u</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00108">hypar.h:108</a></div></div>
<div class="ttc" id="a00164_html_a3ccc9ddb96600c40dcc41bb1ded11160"><div class="ttname"><a href="a00164.html#a3ccc9ddb96600c40dcc41bb1ded11160">HyPar::uref</a></div><div class="ttdeci">double * uref</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00373">hypar.h:373</a></div></div>
<div class="ttc" id="a00173_html_a94499efe0f52b5174ce7105de5ab1a37"><div class="ttname"><a href="a00173.html#a94499efe0f52b5174ce7105de5ab1a37">TransferVecToPETSc</a></div><div class="ttdeci">int TransferVecToPETSc(double *, Vec, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00360_source.html#l00023">TransferToPETSc.c:23</a></div></div>
<div class="ttc" id="a00204_html_a60ace5964c051fa481e6a1e6f1ef75d7"><div class="ttname"><a href="a00204.html#a60ace5964c051fa481e6a1e6f1ef75d7">MPIExchangeBoundariesnD</a></div><div class="ttdeci">int MPIExchangeBoundariesnD(int, int, int *, int, void *, double *)</div><div class="ttdef"><b>Definition:</b> <a href="a00326_source.html#l00042">MPIExchangeBoundariesnD.c:42</a></div></div>
<div class="ttc" id="a00164_html_aafc992b5fa79d5a4036024615d03bce6"><div class="ttname"><a href="a00164.html#aafc992b5fa79d5a4036024615d03bce6">HyPar::ghosts</a></div><div class="ttdeci">int ghosts</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00044">hypar.h:44</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="abed41de2efef801be98f8338aa2672f2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode PetscJacobianFunction_Linear </td>
          <td>(</td>
          <td class="paramtype">Mat&#160;</td>
          <td class="paramname"><em>Jacobian</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Vec&#160;</td>
          <td class="paramname"><em>Y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Vec&#160;</td>
          <td class="paramname"><em>F</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Computes the action of the Jacobian on a vector: See documentation for <a class="el" href="a00173.html#a3d6a695a879ec54937525109ac912355">PetscIJacobian()</a> for the definition of the Jacobian. This function computes its action on a vector for a linear system by taking the directional derivative, as follows: </p>
<p class="formulaDsp">
\begin{equation} {\bf f} = {\bf J}{\bf y} = \frac {\partial \mathcal{F}\left({\bf U}\right)} {\partial {\bf U}} {\bf y} = \left[ \mathcal{F}\left({\bf U}_0+{\bf y}\right)-\mathcal{F}\left({\bf U}_0\right) \right], \end{equation}
</p>
<p> where \(\mathcal{F}\) is linear, and thus \({\bf J}\) is a constant ( \(\mathcal{F}\left({\bf y}\right) = {\bf J}{\bf y}\)). In the context of the implicit time integration of a linear ODE given by </p>
<p class="formulaDsp">
\begin{equation} \frac {d {\bf U}} {dt} = {\bf F}\left({\bf U}\right) \Rightarrow \frac {d {\bf U}} {dt} - {\bf F}\left({\bf U}\right) = 0, \end{equation}
</p>
<p> we have that </p>
<p class="formulaDsp">
\begin{equation} \mathcal{F}\left({\bf U}\right) \equiv \dot{\bf U} - {\bf F}\left({\bf U}\right) \Rightarrow {\bf J}\left({\bf U}\right) = \left[\alpha{\bf I} - \frac {\partial {\bf F}\left({\bf U}\right)} {\partial {\bf U}} \right]. \end{equation}
</p>
<p> where \(\alpha\) (<a class="el" href="a00173.html#ab057d99becacf205132fd8c235a8488a">PETScContext::shift</a>) is the shift variable specific to the time integration method. So this function computes </p>
<p class="formulaDsp">
\begin{equation} {\bf f} = \alpha {\bf y} - \left[ {\bf F}\left({\bf U}_0+{\bf y}\right)-{\bf F}\left({\bf U}_0\right) \right] \end{equation}
</p>
<p> In the code, \({\bf y}\) is <em>Y</em>, \(\bf f\) is <em>F</em>, and \({\bf U}_0\) is <em><a class="el" href="a00164.html#a3ccc9ddb96600c40dcc41bb1ded11160">HyPar::uref</a></em> (the reference solution at which the nonlinear Jacobian is computed).</p>
<p>Since \(\mathcal{F}\) is linear, </p>
<p class="formulaDsp">
\begin{equation} {\bf J}{\bf y} = \left[ \mathcal{F}\left({\bf U}_0+{\bf y}\right)-\mathcal{F}\left({\bf U}_0\right) \right] = \mathcal{F}\left({\bf y}\right). \end{equation}
</p>
<p> However, the Jacobian is not computed as \(\mathcal{F}\left({\bf y}\right)\) because of the following reason: this function is used by the equation solver within the implicit time integrator in PETSc, and \({\bf y}\) represents the change in the solution, i.e. \(\Delta {\bf U}\), and not the solution \(\bf U\). Thus, evaluating \(\mathcal{F}\left({\bf y}\right)\) using <a class="el" href="a00164.html#aa245f8c9e6af37e47c5867dccbbc208b">HyPar::HyperbolicFunction</a>, <a class="el" href="a00164.html#a75e8be4ea8c1ae2e99fc1e802e69a573">HyPar::ParabolicFunction</a>, and <a class="el" href="a00164.html#a662e256e081a2b74f971d02c747892b8">HyPar::SourceFunction</a> is incorrect since these functions expect \(\bf U\) as the input.</p>
<p><b>Notes:</b> </p>
<ul>
<li>For a nonlinear spatial discretization, the right-hand-side <b>must</b> be computed without the nonlinearity (i.e. with a previously computed or "frozen" discretization operator). This ensures that the Jacobian being computed is consistent, and is truly linear.</li>
<li>See <a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/index.html">http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/index.html</a> for documentation on PETSc's time integrators.</li>
<li>All functions and variables whose names start with Vec, Mat, PC, KSP, SNES, and TS are defined by PETSc. Refer to the PETSc documentation (<a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/">http://www.mcs.anl.gov/petsc/petsc-current/docs/</a>). Usually, googling with the function or variable name yields the specific doc page dealing with that function/variable. </li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Jacobian</td><td>Jacobian matrix </td></tr>
    <tr><td class="paramname">Y</td><td>Input vector </td></tr>
    <tr><td class="paramname">F</td><td>Output vector (Jacobian times input vector </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00349_source.html#l00231">231</a> of file <a class="el" href="a00349_source.html">PetscIJacobian.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;{</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <a class="code" href="a00173.html#a00591">PETScContext</a>    *context = NULL;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  <a class="code" href="a00164.html">HyPar</a>           *solver  = NULL;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  <a class="code" href="a00167.html#a00588">MPIVariables</a>    *mpi     = NULL;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  <span class="keywordtype">int</span>             ierr     = 0, d;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  PetscFunctionBegin;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  ierr   = MatShellGetContext(Jacobian,&amp;context); CHKERRQ(ierr);</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  solver = context-&gt;<a class="code" href="a00173.html#ade1bc5cad8c6735a891a28f637cbfb06">solver</a>;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  mpi    = context-&gt;<a class="code" href="a00173.html#abaa15763a88d05dc68ff230ce570eee9">mpi</a>;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  solver-&gt;<a class="code" href="a00164.html#afc11cc081aa04d7b35ebcbcb735f7e22">count_IJacFunction</a>++;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  <span class="keywordtype">int</span> size = 1;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  <span class="keywordflow">for</span> (d=0; d&lt;solver-&gt;<a class="code" href="a00164.html#a484873c74138512e41bc50d17b7d955a">ndims</a>; d++) size *= (solver-&gt;<a class="code" href="a00164.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>[d]+2*solver-&gt;<a class="code" href="a00164.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>);</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  <span class="keywordtype">double</span> *u       = solver-&gt;<a class="code" href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  <span class="keywordtype">double</span> *uref    = solver-&gt;<a class="code" href="a00164.html#a3ccc9ddb96600c40dcc41bb1ded11160">uref</a>;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  <span class="keywordtype">double</span> *rhsref  = solver-&gt;<a class="code" href="a00164.html#ad587a58397d439c443ae325450a01a13">rhsref</a>;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  <span class="keywordtype">double</span> *rhs     = solver-&gt;<a class="code" href="a00164.html#ade4650485fe35fd3e12fea272fc80209">rhs</a>;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  <span class="keywordtype">double</span> t = context-&gt;<a class="code" href="a00173.html#a28e4e78c0bf258662bef21d26c51fc0b">waqt</a>; <span class="comment">/* current stage/step time */</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  <span class="keywordtype">double</span> normY;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  ierr = VecNorm(Y,NORM_2,&amp;normY);                                        CHKERRQ(ierr);</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  <span class="keywordflow">if</span> (normY &lt; 1e-16) {</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="comment">/* F = 0 */</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    ierr = VecZeroEntries(F);                                             CHKERRQ(ierr);</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="comment">/* [J]Y = aY - F(Y) */</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    ierr = VecAXPBY(F,context-&gt;<a class="code" href="a00173.html#ab057d99becacf205132fd8c235a8488a">shift</a>,0,Y);                                CHKERRQ(ierr);</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    </div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="comment">/* copy solution from PETSc vector */</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    ierr = <a class="code" href="a00173.html#aba47a541676718cced51875b1c3a4ba6">TransferVecFromPETSc</a>(u,Y,context);                             <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <a class="code" href="a00187.html#ab8e3b679b04116dd6be664e727f0d951">_ArrayAYPX_</a>(uref,1.0,u,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="comment">/* apply boundary conditions and exchange data over MPI interfaces */</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    ierr = solver-&gt;<a class="code" href="a00164.html#aa4de7bdc1e62417caf51b9c45184268d">ApplyBoundaryConditions</a>(solver,mpi,u,NULL,t);          <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    ierr = <a class="code" href="a00204.html#a60ace5964c051fa481e6a1e6f1ef75d7">MPIExchangeBoundariesnD</a>(solver-&gt;<a class="code" href="a00164.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00164.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                                   solver-&gt;<a class="code" href="a00164.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,mpi,u);                 <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="comment">/* Evaluate hyperbolic, parabolic and source terms  and the RHS for U+dU */</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <a class="code" href="a00187.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,0.0);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    ierr = solver-&gt;<a class="code" href="a00164.html#aa245f8c9e6af37e47c5867dccbbc208b">HyperbolicFunction</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,u,solver,mpi,t,0,</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                                      solver-&gt;<a class="code" href="a00164.html#a0d895f9bb0c8a3e79a64dd2379e1f2dd">FFunction</a>,solver-&gt;<a class="code" href="a00164.html#a7eb68b9643feb74bd49f3a171b66eef1">Upwind</a>);  <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>,-1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    ierr = solver-&gt;<a class="code" href="a00164.html#a75e8be4ea8c1ae2e99fc1e802e69a573">ParabolicFunction</a> (solver-&gt;<a class="code" href="a00164.html#ae53517ad7a202762d7b79eaf681701f3">par</a>,u,solver,mpi,t);        <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00164.html#ae53517ad7a202762d7b79eaf681701f3">par</a>, 1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    ierr = solver-&gt;<a class="code" href="a00164.html#a662e256e081a2b74f971d02c747892b8">SourceFunction</a>    (solver-&gt;<a class="code" href="a00164.html#a6b4951ffdbd82f3a3848b82352d389d6">source</a>,u,solver,mpi,t);     <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00164.html#a6b4951ffdbd82f3a3848b82352d389d6">source</a>, 1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(rhsref,-1.0,rhs,size*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="comment">/* Transfer RHS to PETSc vector */</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    ierr = <a class="code" href="a00173.html#a94499efe0f52b5174ce7105de5ab1a37">TransferVecToPETSc</a>(rhs,F,context);     <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="comment">/* [J]Y = aY - F(Y) */</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    ierr = VecAXPBY(F,context-&gt;<a class="code" href="a00173.html#ab057d99becacf205132fd8c235a8488a">shift</a>,-1.0,Y);     CHKERRQ(ierr);</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  }</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  PetscFunctionReturn(0);</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;}</div>
<div class="ttc" id="a00173_html_a28e4e78c0bf258662bef21d26c51fc0b"><div class="ttname"><a href="a00173.html#a28e4e78c0bf258662bef21d26c51fc0b">PETScContext::waqt</a></div><div class="ttdeci">double waqt</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00044">petscinterface.h:44</a></div></div>
<div class="ttc" id="a00173_html_abaa15763a88d05dc68ff230ce570eee9"><div class="ttname"><a href="a00173.html#abaa15763a88d05dc68ff230ce570eee9">PETScContext::mpi</a></div><div class="ttdeci">void * mpi</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00039">petscinterface.h:39</a></div></div>
<div class="ttc" id="a00164_html_ae8f6d2fd6490d3153cb4133bf183a404"><div class="ttname"><a href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">HyPar::nvars</a></div><div class="ttdeci">int nvars</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00029">hypar.h:29</a></div></div>
<div class="ttc" id="a00187_html_a4cd66304bc41a7751842230af3063b62"><div class="ttname"><a href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a></div><div class="ttdeci">#define _ArrayAXPY_(x, a, y, size)</div><div class="ttdef"><b>Definition:</b> <a href="a00187_source.html#l00270">arrayfunctions.h:270</a></div></div>
<div class="ttc" id="a00187_html_ab8e3b679b04116dd6be664e727f0d951"><div class="ttname"><a href="a00187.html#ab8e3b679b04116dd6be664e727f0d951">_ArrayAYPX_</a></div><div class="ttdeci">#define _ArrayAYPX_(x, a, y, size)</div><div class="ttdef"><b>Definition:</b> <a href="a00187_source.html#l00257">arrayfunctions.h:257</a></div></div>
<div class="ttc" id="a00164_html"><div class="ttname"><a href="a00164.html">HyPar</a></div><div class="ttdoc">Structure containing all solver-specific variables and functions. </div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00023">hypar.h:23</a></div></div>
<div class="ttc" id="a00164_html_a6b4951ffdbd82f3a3848b82352d389d6"><div class="ttname"><a href="a00164.html#a6b4951ffdbd82f3a3848b82352d389d6">HyPar::source</a></div><div class="ttdeci">double * source</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00117">hypar.h:117</a></div></div>
<div class="ttc" id="a00173_html_a00591"><div class="ttname"><a href="a00173.html#a00591">PETScContext</a></div><div class="ttdoc">Structure containing the variables for time-integration with PETSc. </div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00035">petscinterface.h:35</a></div></div>
<div class="ttc" id="a00164_html_a662e256e081a2b74f971d02c747892b8"><div class="ttname"><a href="a00164.html#a662e256e081a2b74f971d02c747892b8">HyPar::SourceFunction</a></div><div class="ttdeci">int(* SourceFunction)(double *, double *, void *, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00246">hypar.h:246</a></div></div>
<div class="ttc" id="a00164_html_ad587a58397d439c443ae325450a01a13"><div class="ttname"><a href="a00164.html#ad587a58397d439c443ae325450a01a13">HyPar::rhsref</a></div><div class="ttdeci">double * rhsref</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00374">hypar.h:374</a></div></div>
<div class="ttc" id="a00164_html_a484873c74138512e41bc50d17b7d955a"><div class="ttname"><a href="a00164.html#a484873c74138512e41bc50d17b7d955a">HyPar::ndims</a></div><div class="ttdeci">int ndims</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00026">hypar.h:26</a></div></div>
<div class="ttc" id="a00164_html_a38e0371f331cecbe63a77fa03e202afe"><div class="ttname"><a href="a00164.html#a38e0371f331cecbe63a77fa03e202afe">HyPar::dim_local</a></div><div class="ttdeci">int * dim_local</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00035">hypar.h:35</a></div></div>
<div class="ttc" id="a00188_html_add9cf96ae374934d245a1dc1ab697a42"><div class="ttname"><a href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a></div><div class="ttdeci">#define CHECKERR(ierr)</div><div class="ttdef"><b>Definition:</b> <a href="a00188_source.html#l00014">basic.h:14</a></div></div>
<div class="ttc" id="a00173_html_ade1bc5cad8c6735a891a28f637cbfb06"><div class="ttname"><a href="a00173.html#ade1bc5cad8c6735a891a28f637cbfb06">PETScContext::solver</a></div><div class="ttdeci">void * solver</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00037">petscinterface.h:37</a></div></div>
<div class="ttc" id="a00164_html_a75e8be4ea8c1ae2e99fc1e802e69a573"><div class="ttname"><a href="a00164.html#a75e8be4ea8c1ae2e99fc1e802e69a573">HyPar::ParabolicFunction</a></div><div class="ttdeci">int(* ParabolicFunction)(double *, double *, void *, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00243">hypar.h:243</a></div></div>
<div class="ttc" id="a00164_html_afc11cc081aa04d7b35ebcbcb735f7e22"><div class="ttname"><a href="a00164.html#afc11cc081aa04d7b35ebcbcb735f7e22">HyPar::count_IJacFunction</a></div><div class="ttdeci">int count_IJacFunction</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00398">hypar.h:398</a></div></div>
<div class="ttc" id="a00173_html_ab057d99becacf205132fd8c235a8488a"><div class="ttname"><a href="a00173.html#ab057d99becacf205132fd8c235a8488a">PETScContext::shift</a></div><div class="ttdeci">PetscReal shift</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00042">petscinterface.h:42</a></div></div>
<div class="ttc" id="a00167_html_a00588"><div class="ttname"><a href="a00167.html#a00588">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a00167_source.html#l00024">mpivars_struct.h:24</a></div></div>
<div class="ttc" id="a00164_html_aa245f8c9e6af37e47c5867dccbbc208b"><div class="ttname"><a href="a00164.html#aa245f8c9e6af37e47c5867dccbbc208b">HyPar::HyperbolicFunction</a></div><div class="ttdeci">int(* HyperbolicFunction)(double *, double *, void *, void *, double, int, int(*)(double *, double *, int, void *, double), int(*)(double *, double *, double *, double *, double *, double *, int, void *, double))</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00237">hypar.h:237</a></div></div>
<div class="ttc" id="a00164_html_ae53517ad7a202762d7b79eaf681701f3"><div class="ttname"><a href="a00164.html#ae53517ad7a202762d7b79eaf681701f3">HyPar::par</a></div><div class="ttdeci">double * par</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00114">hypar.h:114</a></div></div>
<div class="ttc" id="a00164_html_a0d895f9bb0c8a3e79a64dd2379e1f2dd"><div class="ttname"><a href="a00164.html#a0d895f9bb0c8a3e79a64dd2379e1f2dd">HyPar::FFunction</a></div><div class="ttdeci">int(* FFunction)(double *, double *, int, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00262">hypar.h:262</a></div></div>
<div class="ttc" id="a00164_html_ade4650485fe35fd3e12fea272fc80209"><div class="ttname"><a href="a00164.html#ade4650485fe35fd3e12fea272fc80209">HyPar::rhs</a></div><div class="ttdeci">double * rhs</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00375">hypar.h:375</a></div></div>
<div class="ttc" id="a00187_html_a2b2826031c0cd92495ab351d3e599fc5"><div class="ttname"><a href="a00187.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a></div><div class="ttdeci">#define _ArraySetValue_(x, size, value)</div><div class="ttdef"><b>Definition:</b> <a href="a00187_source.html#l00168">arrayfunctions.h:168</a></div></div>
<div class="ttc" id="a00164_html_aeadfdde0fbc3058bace813055212dcc3"><div class="ttname"><a href="a00164.html#aeadfdde0fbc3058bace813055212dcc3">HyPar::hyp</a></div><div class="ttdeci">double * hyp</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00111">hypar.h:111</a></div></div>
<div class="ttc" id="a00164_html_a7eb68b9643feb74bd49f3a171b66eef1"><div class="ttname"><a href="a00164.html#a7eb68b9643feb74bd49f3a171b66eef1">HyPar::Upwind</a></div><div class="ttdeci">int(* Upwind)(double *, double *, double *, double *, double *, double *, int, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00279">hypar.h:279</a></div></div>
<div class="ttc" id="a00164_html_aa4de7bdc1e62417caf51b9c45184268d"><div class="ttname"><a href="a00164.html#aa4de7bdc1e62417caf51b9c45184268d">HyPar::ApplyBoundaryConditions</a></div><div class="ttdeci">int(* ApplyBoundaryConditions)(void *, void *, double *, double *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00201">hypar.h:201</a></div></div>
<div class="ttc" id="a00173_html_aba47a541676718cced51875b1c3a4ba6"><div class="ttname"><a href="a00173.html#aba47a541676718cced51875b1c3a4ba6">TransferVecFromPETSc</a></div><div class="ttdeci">int TransferVecFromPETSc(double *, Vec, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00359_source.html#l00022">TransferFromPETSc.c:22</a></div></div>
<div class="ttc" id="a00164_html_a3b6b999a764f1e2ea94bb5f28c7a558c"><div class="ttname"><a href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">HyPar::u</a></div><div class="ttdeci">double * u</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00108">hypar.h:108</a></div></div>
<div class="ttc" id="a00164_html_a3ccc9ddb96600c40dcc41bb1ded11160"><div class="ttname"><a href="a00164.html#a3ccc9ddb96600c40dcc41bb1ded11160">HyPar::uref</a></div><div class="ttdeci">double * uref</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00373">hypar.h:373</a></div></div>
<div class="ttc" id="a00173_html_a94499efe0f52b5174ce7105de5ab1a37"><div class="ttname"><a href="a00173.html#a94499efe0f52b5174ce7105de5ab1a37">TransferVecToPETSc</a></div><div class="ttdeci">int TransferVecToPETSc(double *, Vec, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00360_source.html#l00023">TransferToPETSc.c:23</a></div></div>
<div class="ttc" id="a00204_html_a60ace5964c051fa481e6a1e6f1ef75d7"><div class="ttname"><a href="a00204.html#a60ace5964c051fa481e6a1e6f1ef75d7">MPIExchangeBoundariesnD</a></div><div class="ttdeci">int MPIExchangeBoundariesnD(int, int, int *, int, void *, double *)</div><div class="ttdef"><b>Definition:</b> <a href="a00326_source.html#l00042">MPIExchangeBoundariesnD.c:42</a></div></div>
<div class="ttc" id="a00164_html_aafc992b5fa79d5a4036024615d03bce6"><div class="ttname"><a href="a00164.html#aafc992b5fa79d5a4036024615d03bce6">HyPar::ghosts</a></div><div class="ttdeci">int ghosts</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00044">hypar.h:44</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac6ed53fc6bd35636ee50ebba2a4444bb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int PetscComputePreconMatIMEX </td>
          <td>(</td>
          <td class="paramtype">Mat&#160;</td>
          <td class="paramname"><em>Pmat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Vec&#160;</td>
          <td class="paramname"><em>Y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>ctxt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Compute and assemble the preconditioning matrix for the implicit-explicit (IMEX) time integration of the governing equations: The ODE, obtained after discretizing the governing PDE in space, is expressed as follows (for the purpose of IMEX time integration): </p>
<p class="formulaDsp">
\begin{eqnarray} \frac {d{\bf U}}{dt} &amp;=&amp; {\bf F}\left({\bf U}\right) + {\bf G}\left({\bf U}\right), \\ \Rightarrow \frac {d{\bf U}}{dt} - {\bf G}\left({\bf U}\right) &amp;=&amp; {\bf F}\left({\bf U}\right), \end{eqnarray}
</p>
<p> where \({\bf F}\) is non-stiff and integrated in time explicitly, and \({\bf G}\) is stiff and integrated in time implicitly, and \({\bf U}\) represents the entire solution vector.</p>
<p>Note that \({\bf G}\left({\bf U}\right)\) represents all terms that the user has indicated to be integrated in time implicitly (<a class="el" href="a00173.html#a6a0edd627a2b2cc687d1031e3884dd6a">PETScContext::flag_hyperbolic_f</a>, <a class="el" href="a00173.html#a21b4785029b7597816341479bc3260b4">PETScContext::flag_hyperbolic_df</a>, <a class="el" href="a00173.html#a376b6b34e162357d201827d01a5aa2a4">PETScContext::flag_hyperbolic</a>, <a class="el" href="a00173.html#ac48ad2561e5e125d2789133e848db1d9">PETScContext::flag_parabolic</a>, and <a class="el" href="a00173.html#a54c0451c4ae9650a54f54246f1f8823b">PETScContext::flag_source</a>).</p>
<p>The Jacobian of the implicit part is thus given by: </p>
<p class="formulaDsp">
\begin{equation} {\bf J} = \left[\alpha{\bf I} - \frac {\partial {\bf G}} {\partial {\bf U}} \right] \end{equation}
</p>
<p> where \(\alpha\) is the shift coefficient (<a class="el" href="a00173.html#ab057d99becacf205132fd8c235a8488a">PETScContext::shift</a>) of the time integration method.</p>
<p>Currently, this function is implemented for the case where the implicitly-treated \({\bf G}\) is the spatially discretized part or whole of a hyperbolic term, i.e., </p>
<p class="formulaDsp">
\begin{equation} {\bf G}\left({\bf U}\right) = \mathcal{D}\left\{{\bf g}\left({\bf u}\right)\right\} \approx \nabla \cdot {\bf g}\left({\bf u}\right), \end{equation}
</p>
<p> with the governing PDE as </p>
<p class="formulaDsp">
\begin{equation} \frac {\partial {\bf u}} {\partial t} + \cdots + \nabla \cdot {\bf g}\left({\bf u}\right) + \cdots = \cdots, \end{equation}
</p>
<p> and \(\mathcal{D}\) representing the spatial discretization method. Thus, the Jacobian can be written as follows: </p>
<p class="formulaDsp">
\begin{equation} {\bf J} = \left[\alpha{\bf I} - \mathcal{D}\left\{\frac {\partial {\bf g}} {\partial {\bf u}}\right\} \right] \end{equation}
</p>
<p> The preconditioning matrix is usually a close approximation of the actual Jacobian matrix, where the actual Jacobian may be too expensive to evaluate and assemble. In this function, the preconditioning matrix is the following approximation of the actual Jacobian: </p>
<p class="formulaDsp">
\begin{equation} {\bf J}_p = \left[\alpha{\bf I} - \mathcal{D}^{\left(1\right)}\left\{\frac {\partial {\bf g}} {\partial {\bf u}}\right\} \right] \approx {\bf J}, \end{equation}
</p>
<p> where \(\mathcal{D}^{\left(1\right)}\) represents a 1st order upwind discretization operator. The matrix \({\bf J}_p\) is provided to the preconditioner. Note that <a class="el" href="a00164.html#a15eea1647344c503deb1d9f89cead631">HyPar::JFunction</a> is defined by the specific physics being solved, and computes \(\partial {\bf g}/ \partial {\bf u}\) at a grid point.</p>
<ul>
<li>See <a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/PC/index.html">http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/PC/index.html</a> for more information on PETSc preconditioners.</li>
<li>All functions and variables whose names start with Vec, Mat, PC, KSP, SNES, and TS are defined by PETSc. Refer to the PETSc documentation (<a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/">http://www.mcs.anl.gov/petsc/petsc-current/docs/</a>). Usually, googling with the function or variable name yields the specific doc page dealing with that function/variable. </li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Pmat</td><td>Preconditioning matrix to construct </td></tr>
    <tr><td class="paramname">Y</td><td>Solution vector </td></tr>
    <tr><td class="paramname">ctxt</td><td>Application context </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00342_source.html#l00067">67</a> of file <a class="el" href="a00342_source.html">PetscComputePreconMatIMEX.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;{</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <span class="comment">/* Same implementation as PetscComputePreconMatImpl() */</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <span class="keywordflow">return</span>(<a class="code" href="a00173.html#a4c77df03a775220fb7bcf6b137ca59b3">PetscComputePreconMatImpl</a>(Pmat,Y,ctxt));</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;}</div>
<div class="ttc" id="a00173_html_a4c77df03a775220fb7bcf6b137ca59b3"><div class="ttname"><a href="a00173.html#a4c77df03a775220fb7bcf6b137ca59b3">PetscComputePreconMatImpl</a></div><div class="ttdeci">int PetscComputePreconMatImpl(Mat, Vec, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00343_source.html#l00064">PetscComputePreconMatImpl.c:64</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4c77df03a775220fb7bcf6b137ca59b3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int PetscComputePreconMatImpl </td>
          <td>(</td>
          <td class="paramtype">Mat&#160;</td>
          <td class="paramname"><em>Pmat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Vec&#160;</td>
          <td class="paramname"><em>Y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>ctxt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Compute and assemble the preconditioning matrix for the implicit time integration of the governing equations: The ODE, obtained after discretizing the governing PDE in space, is expressed as follows: </p>
<p class="formulaDsp">
\begin{equation} \frac {d{\bf U}}{dt} = {\bf F}\left({\bf U}\right) \Rightarrow \frac {d{\bf U}}{dt} - {\bf F}\left({\bf U}\right) = 0, \end{equation}
</p>
<p> where \({\bf F}\) is the spatially discretized right-hand-side, and \({\bf U}\) represents the entire solution vector.</p>
<p>The Jacobian is thus given by: </p>
<p class="formulaDsp">
\begin{equation} {\bf J} = \left[\alpha{\bf I} - \frac {\partial {\bf F}} {\partial {\bf U}} \right] \end{equation}
</p>
<p> where \(\alpha\) is the shift coefficient (<a class="el" href="a00173.html#ab057d99becacf205132fd8c235a8488a">PETScContext::shift</a>) of the time integration method.</p>
<p>\(\mathcal{D}\) represents the spatial discretization method. Thus, the Jacobian can be written as follows: </p>
<p class="formulaDsp">
\begin{equation} {\bf J} = \left[\alpha{\bf I} - \mathcal{D}\left\{\frac {\partial {\bf f}} {\partial {\bf u}}\right\} \right] \end{equation}
</p>
<p> The preconditioning matrix is usually a close approximation of the actual Jacobian matrix, where the actual Jacobian may be too expensive to evaluate and assemble. In this function, the preconditioning matrix is the following approximation of the actual Jacobian: </p>
<p class="formulaDsp">
\begin{equation} {\bf J}_p = \left[\alpha{\bf I} - \mathcal{D}^{\left(1\right)}\left\{\frac {\partial {\bf f}} {\partial {\bf u}}\right\} \right] \approx {\bf J}, \end{equation}
</p>
<p> where \(\mathcal{D}^{\left(1\right)}\) represents a 1st order upwind discretization operator. The matrix \({\bf J}_p\) is provided to the preconditioner. Note that <a class="el" href="a00164.html#a15eea1647344c503deb1d9f89cead631">HyPar::JFunction</a> is defined by the specific physics being solved, and computes \(\partial {\bf f}/ \partial {\bf u}\) at a grid point.</p>
<p><b>Note:</b> Currently, this function is implemented only for the case where the implicitly-treated \({\bf F}\) is the spatially discretized hyperbolic term, i.e., </p>
<p class="formulaDsp">
\begin{equation} {\bf F}\left({\bf U}\right) = \mathcal{D}\left\{{\bf f}\left({\bf u}\right)\right\} \approx \nabla \cdot {\bf f}\left({\bf u}\right). \end{equation}
</p>
<p> If the governing PDE has a parabolic and/or source term in addition to the hyperbolic term, i.e., </p>
<p class="formulaDsp">
\begin{equation} \frac {\partial {\bf u}} {\partial t} + \nabla \cdot {\bf f}\left({\bf u}\right) + \cdots\ \left({\rm parabolic\ term}\right) = \cdots\ \left({\rm source\ term}\right), \end{equation}
</p>
<p> this function computes the approximation of the Jacobian of only the hyperbolic term.</p>
<ul>
<li>See <a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/PC/index.html">http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/PC/index.html</a> for more information on PETSc preconditioners.</li>
<li>All functions and variables whose names start with Vec, Mat, PC, KSP, SNES, and TS are defined by PETSc. Refer to the PETSc documentation (<a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/">http://www.mcs.anl.gov/petsc/petsc-current/docs/</a>). Usually, googling with the function or variable name yields the specific doc page dealing with that function/variable. </li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Pmat</td><td>Preconditioning matrix to construct </td></tr>
    <tr><td class="paramname">Y</td><td>Solution vector </td></tr>
    <tr><td class="paramname">ctxt</td><td>Application context </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00343_source.html#l00064">64</a> of file <a class="el" href="a00343_source.html">PetscComputePreconMatImpl.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;{</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <a class="code" href="a00173.html#a00591">PETScContext</a>    *context = (<a class="code" href="a00173.html#a00591">PETScContext</a>*) ctxt;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <a class="code" href="a00164.html">HyPar</a>           *solver  = context-&gt;<a class="code" href="a00173.html#ade1bc5cad8c6735a891a28f637cbfb06">solver</a>;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <a class="code" href="a00167.html#a00588">MPIVariables</a>    *mpi     = context-&gt;<a class="code" href="a00173.html#abaa15763a88d05dc68ff230ce570eee9">mpi</a>;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  PetscErrorCode  ierr;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <span class="keywordtype">int</span>             ndims       = solver-&gt;<a class="code" href="a00164.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;                  nvars       = solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                  npoints     = context-&gt;<a class="code" href="a00173.html#a515ec0fe2abce5449e37ae520974cf5f">npoints</a>,</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;                  ghosts      = solver-&gt;<a class="code" href="a00164.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;                  *dim        = solver-&gt;<a class="code" href="a00164.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;                  *isPeriodic = solver-&gt;<a class="code" href="a00164.html#a40e3f67b1530d5ea4e913fc60b594802">isPeriodic</a>,</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;                  *points     = context-&gt;<a class="code" href="a00173.html#ab991f69858c9aada0736623db264237e">points</a>,</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                  index[ndims],indexL[ndims],indexR[ndims],</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;                  v,n,dir,done,rows[nvars],cols[nvars];</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <span class="keywordtype">double</span>          *u      = solver-&gt;<a class="code" href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>, </div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                  *iblank = solver-&gt;<a class="code" href="a00164.html#a267ef7e03dbe9dd4440dee2fdf48619a">iblank</a>,</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;                  dxinv, values[nvars*nvars];</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  PetscFunctionBegin;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <span class="comment">/* copy solution from PETSc vector */</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  ierr = <a class="code" href="a00173.html#aba47a541676718cced51875b1c3a4ba6">TransferVecFromPETSc</a>(u,Y,context); <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <span class="comment">/* apply boundary conditions and exchange data over MPI interfaces */</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  ierr = solver-&gt;<a class="code" href="a00164.html#aa4de7bdc1e62417caf51b9c45184268d">ApplyBoundaryConditions</a>(solver,mpi,u,NULL,context-&gt;<a class="code" href="a00173.html#a28e4e78c0bf258662bef21d26c51fc0b">waqt</a>); <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  ierr = <a class="code" href="a00204.html#a60ace5964c051fa481e6a1e6f1ef75d7">MPIExchangeBoundariesnD</a>(ndims,nvars,dim,ghosts,mpi,u); <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <span class="comment">/* initialize preconditioning matrix to zero */</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  ierr = MatZeroEntries(Pmat); CHKERRQ(ierr);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  <span class="comment">/* loop through all computational points */</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="keywordflow">for</span> (n = 0; n &lt; npoints; n++) {</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="keywordtype">int</span> *this_point = points + n*(ndims+1);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="keywordtype">int</span> p = this_point[ndims];</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="keywordtype">int</span> index[ndims]; <a class="code" href="a00187.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>(this_point,index,ndims);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="keywordtype">double</span> iblank = solver-&gt;<a class="code" href="a00164.html#a267ef7e03dbe9dd4440dee2fdf48619a">iblank</a>[p];</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="comment">/* compute the contributions from the flux derivatives along each dimension */</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="keywordflow">for</span> (dir = 0; dir &lt; ndims; dir++) {</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;      <span class="comment">/* compute indices and global 1D indices for left and right neighbors */</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;      <a class="code" href="a00187.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>(index,indexL,ndims); indexL[dir]--;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;      <span class="keywordtype">int</span> pL;  <a class="code" href="a00187.html#afbb862a2fdf5b72b1f9ace42f64b556f">_ArrayIndex1D_</a>(ndims,dim,indexL,ghosts,pL);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;      <a class="code" href="a00187.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>(index,indexR,ndims); indexR[dir]++;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;      <span class="keywordtype">int</span> pR;  <a class="code" href="a00187.html#afbb862a2fdf5b72b1f9ace42f64b556f">_ArrayIndex1D_</a>(ndims,dim,indexR,ghosts,pR);</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;      <span class="keywordtype">int</span> pg, pgL, pgR;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;      pg  = (int) context-&gt;<a class="code" href="a00173.html#a0c5f291f027b0928672b89121f44c0fc">globalDOF</a>[p];</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;      pgL = (<span class="keywordtype">int</span>) context-&gt;<a class="code" href="a00173.html#a0c5f291f027b0928672b89121f44c0fc">globalDOF</a>[pL];</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;      pgR = (int) context-&gt;<a class="code" href="a00173.html#a0c5f291f027b0928672b89121f44c0fc">globalDOF</a>[pR];</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;      <span class="comment">/* Retrieve 1/delta-x at this grid point */</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;      <a class="code" href="a00188.html#a9aa9bad8531d6733731a850ccc471a42">_GetCoordinate_</a>(dir,index[dir],dim,ghosts,solver-&gt;<a class="code" href="a00164.html#aa24a4f5e29bd70cbe5a2413be1ea9682">dxinv</a>,dxinv);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;      <span class="comment">/* diagonal element */</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;      <span class="keywordflow">for</span> (v=0; v&lt;nvars; v++) { rows[v] = nvars*pg + v; cols[v] = nvars*pg + v; }</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;      ierr = solver-&gt;<a class="code" href="a00164.html#a15eea1647344c503deb1d9f89cead631">JFunction</a>(values,(u+nvars*p),solver-&gt;<a class="code" href="a00164.html#a48e81a1806b5774943fd9a26e9a190f2">physics</a>,dir,0);</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;      <a class="code" href="a00187.html#a1dab5f429ccd03c4a7fbb605d8ef75b6">_ArrayScale1D_</a>(values,(dxinv*iblank),(nvars*nvars));</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;      ierr = MatSetValues(Pmat,nvars,rows,nvars,cols,values,ADD_VALUES); CHKERRQ(ierr);</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;      <span class="comment">/* left neighbor */</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      <span class="keywordflow">if</span> (pgL &gt;= 0) {</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        <span class="keywordflow">for</span> (v=0; v&lt;nvars; v++) { rows[v] = nvars*pg + v; cols[v] = nvars*pgL + v; }</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        ierr = solver-&gt;<a class="code" href="a00164.html#a15eea1647344c503deb1d9f89cead631">JFunction</a>(values,(u+nvars*pL),solver-&gt;<a class="code" href="a00164.html#a48e81a1806b5774943fd9a26e9a190f2">physics</a>,dir,1);</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        <a class="code" href="a00187.html#a1dab5f429ccd03c4a7fbb605d8ef75b6">_ArrayScale1D_</a>(values,(-dxinv*iblank),(nvars*nvars));</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        ierr = MatSetValues(Pmat,nvars,rows,nvars,cols,values,ADD_VALUES); CHKERRQ(ierr);</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;      }</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      </div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;      <span class="comment">/* right neighbor */</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;      <span class="keywordflow">if</span> (pgR &gt;= 0) {</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        <span class="keywordflow">for</span> (v=0; v&lt;nvars; v++) { rows[v] = nvars*pg + v; cols[v] = nvars*pgR + v; }</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        ierr = solver-&gt;<a class="code" href="a00164.html#a15eea1647344c503deb1d9f89cead631">JFunction</a>(values,(u+nvars*pR),solver-&gt;<a class="code" href="a00164.html#a48e81a1806b5774943fd9a26e9a190f2">physics</a>,dir,-1);</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <a class="code" href="a00187.html#a1dab5f429ccd03c4a7fbb605d8ef75b6">_ArrayScale1D_</a>(values,(-dxinv*iblank),(nvars*nvars));</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        ierr = MatSetValues(Pmat,nvars,rows,nvars,cols,values,ADD_VALUES); CHKERRQ(ierr);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;      }</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    }</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  }</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  ierr = MatAssemblyBegin(Pmat,MAT_FINAL_ASSEMBLY); CHKERRQ(ierr);</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  ierr = MatAssemblyEnd  (Pmat,MAT_FINAL_ASSEMBLY); CHKERRQ(ierr);</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  </div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  ierr = MatShift(Pmat,context-&gt;<a class="code" href="a00173.html#ab057d99becacf205132fd8c235a8488a">shift</a>); CHKERRQ(ierr);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  PetscFunctionReturn(0);</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;}</div>
<div class="ttc" id="a00173_html_a28e4e78c0bf258662bef21d26c51fc0b"><div class="ttname"><a href="a00173.html#a28e4e78c0bf258662bef21d26c51fc0b">PETScContext::waqt</a></div><div class="ttdeci">double waqt</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00044">petscinterface.h:44</a></div></div>
<div class="ttc" id="a00173_html_abaa15763a88d05dc68ff230ce570eee9"><div class="ttname"><a href="a00173.html#abaa15763a88d05dc68ff230ce570eee9">PETScContext::mpi</a></div><div class="ttdeci">void * mpi</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00039">petscinterface.h:39</a></div></div>
<div class="ttc" id="a00164_html_ae8f6d2fd6490d3153cb4133bf183a404"><div class="ttname"><a href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">HyPar::nvars</a></div><div class="ttdeci">int nvars</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00029">hypar.h:29</a></div></div>
<div class="ttc" id="a00164_html"><div class="ttname"><a href="a00164.html">HyPar</a></div><div class="ttdoc">Structure containing all solver-specific variables and functions. </div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00023">hypar.h:23</a></div></div>
<div class="ttc" id="a00173_html_a515ec0fe2abce5449e37ae520974cf5f"><div class="ttname"><a href="a00173.html#a515ec0fe2abce5449e37ae520974cf5f">PETScContext::npoints</a></div><div class="ttdeci">int npoints</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00051">petscinterface.h:51</a></div></div>
<div class="ttc" id="a00173_html_a00591"><div class="ttname"><a href="a00173.html#a00591">PETScContext</a></div><div class="ttdoc">Structure containing the variables for time-integration with PETSc. </div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00035">petscinterface.h:35</a></div></div>
<div class="ttc" id="a00164_html_a484873c74138512e41bc50d17b7d955a"><div class="ttname"><a href="a00164.html#a484873c74138512e41bc50d17b7d955a">HyPar::ndims</a></div><div class="ttdeci">int ndims</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00026">hypar.h:26</a></div></div>
<div class="ttc" id="a00164_html_a38e0371f331cecbe63a77fa03e202afe"><div class="ttname"><a href="a00164.html#a38e0371f331cecbe63a77fa03e202afe">HyPar::dim_local</a></div><div class="ttdeci">int * dim_local</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00035">hypar.h:35</a></div></div>
<div class="ttc" id="a00188_html_add9cf96ae374934d245a1dc1ab697a42"><div class="ttname"><a href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a></div><div class="ttdeci">#define CHECKERR(ierr)</div><div class="ttdef"><b>Definition:</b> <a href="a00188_source.html#l00014">basic.h:14</a></div></div>
<div class="ttc" id="a00173_html_ade1bc5cad8c6735a891a28f637cbfb06"><div class="ttname"><a href="a00173.html#ade1bc5cad8c6735a891a28f637cbfb06">PETScContext::solver</a></div><div class="ttdeci">void * solver</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00037">petscinterface.h:37</a></div></div>
<div class="ttc" id="a00187_html_afbb862a2fdf5b72b1f9ace42f64b556f"><div class="ttname"><a href="a00187.html#afbb862a2fdf5b72b1f9ace42f64b556f">_ArrayIndex1D_</a></div><div class="ttdeci">#define _ArrayIndex1D_(N, imax, i, ghost, index)</div><div class="ttdef"><b>Definition:</b> <a href="a00187_source.html#l00039">arrayfunctions.h:39</a></div></div>
<div class="ttc" id="a00187_html_a1dab5f429ccd03c4a7fbb605d8ef75b6"><div class="ttname"><a href="a00187.html#a1dab5f429ccd03c4a7fbb605d8ef75b6">_ArrayScale1D_</a></div><div class="ttdeci">#define _ArrayScale1D_(x, a, size)</div><div class="ttdef"><b>Definition:</b> <a href="a00187_source.html#l00189">arrayfunctions.h:189</a></div></div>
<div class="ttc" id="a00173_html_ab057d99becacf205132fd8c235a8488a"><div class="ttname"><a href="a00173.html#ab057d99becacf205132fd8c235a8488a">PETScContext::shift</a></div><div class="ttdeci">PetscReal shift</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00042">petscinterface.h:42</a></div></div>
<div class="ttc" id="a00167_html_a00588"><div class="ttname"><a href="a00167.html#a00588">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a00167_source.html#l00024">mpivars_struct.h:24</a></div></div>
<div class="ttc" id="a00164_html_a267ef7e03dbe9dd4440dee2fdf48619a"><div class="ttname"><a href="a00164.html#a267ef7e03dbe9dd4440dee2fdf48619a">HyPar::iblank</a></div><div class="ttdeci">double * iblank</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00412">hypar.h:412</a></div></div>
<div class="ttc" id="a00164_html_a15eea1647344c503deb1d9f89cead631"><div class="ttname"><a href="a00164.html#a15eea1647344c503deb1d9f89cead631">HyPar::JFunction</a></div><div class="ttdeci">int(* JFunction)(double *, double *, void *, int, int)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00308">hypar.h:308</a></div></div>
<div class="ttc" id="a00164_html_aa24a4f5e29bd70cbe5a2413be1ea9682"><div class="ttname"><a href="a00164.html#aa24a4f5e29bd70cbe5a2413be1ea9682">HyPar::dxinv</a></div><div class="ttdeci">double * dxinv</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00102">hypar.h:102</a></div></div>
<div class="ttc" id="a00188_html_a9aa9bad8531d6733731a850ccc471a42"><div class="ttname"><a href="a00188.html#a9aa9bad8531d6733731a850ccc471a42">_GetCoordinate_</a></div><div class="ttdeci">#define _GetCoordinate_(dir, i, dim, ghosts, x, coord)</div><div class="ttdef"><b>Definition:</b> <a href="a00188_source.html#l00027">basic.h:27</a></div></div>
<div class="ttc" id="a00164_html_a48e81a1806b5774943fd9a26e9a190f2"><div class="ttname"><a href="a00164.html#a48e81a1806b5774943fd9a26e9a190f2">HyPar::physics</a></div><div class="ttdeci">void * physics</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00253">hypar.h:253</a></div></div>
<div class="ttc" id="a00164_html_aa4de7bdc1e62417caf51b9c45184268d"><div class="ttname"><a href="a00164.html#aa4de7bdc1e62417caf51b9c45184268d">HyPar::ApplyBoundaryConditions</a></div><div class="ttdeci">int(* ApplyBoundaryConditions)(void *, void *, double *, double *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00201">hypar.h:201</a></div></div>
<div class="ttc" id="a00173_html_a0c5f291f027b0928672b89121f44c0fc"><div class="ttname"><a href="a00173.html#a0c5f291f027b0928672b89121f44c0fc">PETScContext::globalDOF</a></div><div class="ttdeci">double * globalDOF</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00084">petscinterface.h:84</a></div></div>
<div class="ttc" id="a00173_html_aba47a541676718cced51875b1c3a4ba6"><div class="ttname"><a href="a00173.html#aba47a541676718cced51875b1c3a4ba6">TransferVecFromPETSc</a></div><div class="ttdeci">int TransferVecFromPETSc(double *, Vec, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00359_source.html#l00022">TransferFromPETSc.c:22</a></div></div>
<div class="ttc" id="a00164_html_a3b6b999a764f1e2ea94bb5f28c7a558c"><div class="ttname"><a href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">HyPar::u</a></div><div class="ttdeci">double * u</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00108">hypar.h:108</a></div></div>
<div class="ttc" id="a00187_html_a89e8330d9e06dd0666c50833628a125c"><div class="ttname"><a href="a00187.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a></div><div class="ttdeci">#define _ArrayCopy1D_(x, y, size)</div><div class="ttdef"><b>Definition:</b> <a href="a00187_source.html#l00318">arrayfunctions.h:318</a></div></div>
<div class="ttc" id="a00204_html_a60ace5964c051fa481e6a1e6f1ef75d7"><div class="ttname"><a href="a00204.html#a60ace5964c051fa481e6a1e6f1ef75d7">MPIExchangeBoundariesnD</a></div><div class="ttdeci">int MPIExchangeBoundariesnD(int, int, int *, int, void *, double *)</div><div class="ttdef"><b>Definition:</b> <a href="a00326_source.html#l00042">MPIExchangeBoundariesnD.c:42</a></div></div>
<div class="ttc" id="a00164_html_aafc992b5fa79d5a4036024615d03bce6"><div class="ttname"><a href="a00164.html#aafc992b5fa79d5a4036024615d03bce6">HyPar::ghosts</a></div><div class="ttdeci">int ghosts</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00044">hypar.h:44</a></div></div>
<div class="ttc" id="a00173_html_ab991f69858c9aada0736623db264237e"><div class="ttname"><a href="a00173.html#ab991f69858c9aada0736623db264237e">PETScContext::points</a></div><div class="ttdeci">int * points</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00056">petscinterface.h:56</a></div></div>
<div class="ttc" id="a00164_html_a40e3f67b1530d5ea4e913fc60b594802"><div class="ttname"><a href="a00164.html#a40e3f67b1530d5ea4e913fc60b594802">HyPar::isPeriodic</a></div><div class="ttdeci">int * isPeriodic</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00154">hypar.h:154</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ae4815491f5992839fdb3949e5dedec8e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int PetscGlobalDOF </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>c</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Compute the global DOF index for all the grid points: The "global DOF index" is the component number (or block component number for <a class="el" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">HyPar::nvars</a> &gt; 1) of a grid point in the global solution vector. It is also the row number (or block row number) of the grid point in the global matrix representing, for example, the Jacobian of the right-hand-side.</p>
<p><a class="el" href="a00173.html#a0c5f291f027b0928672b89121f44c0fc">PETScContext::globalDOF</a> is an integer array with the same layout as the solution array <a class="el" href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">HyPar::u</a> (but with one component) containing the global DOF index for the corresponding grid points. It has the same number of ghost points as <a class="el" href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">HyPar::u</a>.</p>
<ul>
<li>This array is initialized to -1.</li>
<li>The global DOF indices are computed for all non-ghost grid points.</li>
<li>If any boundaries are periodic, periodic boundary conditions are applied to fill the appropriate ghost points.</li>
<li>Ghost points corresponding to internal (MPI) boundaries are filled using <a class="el" href="a00204.html#a60ace5964c051fa481e6a1e6f1ef75d7">MPIExchangeBoundariesnD()</a>.</li>
<li>Thus, ghost points corresponding to physical, non-periodic boundaries retain the initial value of -1. </li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">c</td><td>Object of type <a class="el" href="a00173.html#a00591" title="Structure containing the variables for time-integration with PETSc. ">PETScContext</a> </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00347_source.html#l00070">70</a> of file <a class="el" href="a00347_source.html">PetscGlobalDOF.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;{</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <a class="code" href="a00173.html#a00591">PETScContext</a>  *ctxt   = (<a class="code" href="a00173.html#a00591">PETScContext</a>*) c;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <a class="code" href="a00164.html">HyPar</a>         *solver = (<a class="code" href="a00164.html">HyPar</a>*) ctxt-&gt;<a class="code" href="a00173.html#ade1bc5cad8c6735a891a28f637cbfb06">solver</a>;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <a class="code" href="a00167.html#a00588">MPIVariables</a>  *mpi    = (<a class="code" href="a00167.html#a00588">MPIVariables</a>*) ctxt-&gt;<a class="code" href="a00173.html#abaa15763a88d05dc68ff230ce570eee9">mpi</a>;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  <a class="code" href="a00188.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a>;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  <span class="keywordtype">int</span>   *dim      = solver-&gt;<a class="code" href="a00164.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        ndims     = solver-&gt;<a class="code" href="a00164.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        ghosts    = solver-&gt;<a class="code" href="a00164.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        size_wg   = solver-&gt;<a class="code" href="a00164.html#a20ee1fd00a220b98513127884a5558cf">npoints_local_wghosts</a>,</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        rank      = mpi-&gt;rank,</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        nproc     = mpi-&gt;nproc,</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        nv        = ndims + 1, i;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="comment">/* if globalDOF already allocated, free it */</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <span class="keywordflow">if</span> (ctxt-&gt;<a class="code" href="a00173.html#a0c5f291f027b0928672b89121f44c0fc">globalDOF</a>) free(ctxt-&gt;<a class="code" href="a00173.html#a0c5f291f027b0928672b89121f44c0fc">globalDOF</a>);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  ctxt-&gt;<a class="code" href="a00173.html#a0c5f291f027b0928672b89121f44c0fc">globalDOF</a> = (<span class="keywordtype">double</span>*) calloc(size_wg,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <a class="code" href="a00187.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(ctxt-&gt;<a class="code" href="a00173.html#a0c5f291f027b0928672b89121f44c0fc">globalDOF</a>,size_wg,-1.0);</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <span class="keywordtype">int</span> local_sizes[nproc];</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <a class="code" href="a00187.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(local_sizes,nproc,0);</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  local_sizes[rank] = ctxt-&gt;<a class="code" href="a00173.html#a515ec0fe2abce5449e37ae520974cf5f">npoints</a>;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <a class="code" href="a00204.html#a184fc81a4d6618de22a60c9d8436fc83">MPIMax_integer</a>(local_sizes,local_sizes,nproc,&amp;mpi-&gt;world);</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="keywordtype">int</span> myOffset = 0;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  <span class="keywordflow">for</span> (i=0; i&lt;rank; i++) myOffset += local_sizes[i];</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <span class="keywordflow">for</span> (i=0; i&lt;ctxt-&gt;<a class="code" href="a00173.html#a515ec0fe2abce5449e37ae520974cf5f">npoints</a>; i++) {</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="keywordtype">int</span> p = (ctxt-&gt;<a class="code" href="a00173.html#ab991f69858c9aada0736623db264237e">points</a>+i*nv)[ndims];</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    ctxt-&gt;<a class="code" href="a00173.html#a0c5f291f027b0928672b89121f44c0fc">globalDOF</a>[p] = (double) (i + myOffset);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  }</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <span class="keywordflow">for</span> (i=0; i&lt;ndims; i++) {</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="keywordflow">if</span> (solver-&gt;<a class="code" href="a00164.html#a40e3f67b1530d5ea4e913fc60b594802">isPeriodic</a>[i]) {</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;      <a class="code" href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00347.html#ab4b43dadf0cb676d61aee6c8f1fb5a2e">ApplyPeriodicity</a>(i,ndims,dim,ghosts,ctxt-&gt;<a class="code" href="a00173.html#a0c5f291f027b0928672b89121f44c0fc">globalDOF</a>); <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    }</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  }</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  <a class="code" href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00204.html#a60ace5964c051fa481e6a1e6f1ef75d7">MPIExchangeBoundariesnD</a>(ndims,1,dim,ghosts,mpi,ctxt-&gt;<a class="code" href="a00173.html#a0c5f291f027b0928672b89121f44c0fc">globalDOF</a>);</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;}</div>
<div class="ttc" id="a00173_html_abaa15763a88d05dc68ff230ce570eee9"><div class="ttname"><a href="a00173.html#abaa15763a88d05dc68ff230ce570eee9">PETScContext::mpi</a></div><div class="ttdeci">void * mpi</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00039">petscinterface.h:39</a></div></div>
<div class="ttc" id="a00164_html"><div class="ttname"><a href="a00164.html">HyPar</a></div><div class="ttdoc">Structure containing all solver-specific variables and functions. </div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00023">hypar.h:23</a></div></div>
<div class="ttc" id="a00173_html_a515ec0fe2abce5449e37ae520974cf5f"><div class="ttname"><a href="a00173.html#a515ec0fe2abce5449e37ae520974cf5f">PETScContext::npoints</a></div><div class="ttdeci">int npoints</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00051">petscinterface.h:51</a></div></div>
<div class="ttc" id="a00173_html_a00591"><div class="ttname"><a href="a00173.html#a00591">PETScContext</a></div><div class="ttdoc">Structure containing the variables for time-integration with PETSc. </div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00035">petscinterface.h:35</a></div></div>
<div class="ttc" id="a00164_html_a484873c74138512e41bc50d17b7d955a"><div class="ttname"><a href="a00164.html#a484873c74138512e41bc50d17b7d955a">HyPar::ndims</a></div><div class="ttdeci">int ndims</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00026">hypar.h:26</a></div></div>
<div class="ttc" id="a00164_html_a38e0371f331cecbe63a77fa03e202afe"><div class="ttname"><a href="a00164.html#a38e0371f331cecbe63a77fa03e202afe">HyPar::dim_local</a></div><div class="ttdeci">int * dim_local</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00035">hypar.h:35</a></div></div>
<div class="ttc" id="a00188_html_add9cf96ae374934d245a1dc1ab697a42"><div class="ttname"><a href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a></div><div class="ttdeci">#define CHECKERR(ierr)</div><div class="ttdef"><b>Definition:</b> <a href="a00188_source.html#l00014">basic.h:14</a></div></div>
<div class="ttc" id="a00173_html_ade1bc5cad8c6735a891a28f637cbfb06"><div class="ttname"><a href="a00173.html#ade1bc5cad8c6735a891a28f637cbfb06">PETScContext::solver</a></div><div class="ttdeci">void * solver</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00037">petscinterface.h:37</a></div></div>
<div class="ttc" id="a00204_html_a184fc81a4d6618de22a60c9d8436fc83"><div class="ttname"><a href="a00204.html#a184fc81a4d6618de22a60c9d8436fc83">MPIMax_integer</a></div><div class="ttdeci">int MPIMax_integer(int *, int *, int, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00333_source.html#l00015">MPIMax.c:15</a></div></div>
<div class="ttc" id="a00167_html_a00588"><div class="ttname"><a href="a00167.html#a00588">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a00167_source.html#l00024">mpivars_struct.h:24</a></div></div>
<div class="ttc" id="a00188_html_ad6ab74942c9de13cf0b4c12eb0d91780"><div class="ttname"><a href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a></div><div class="ttdeci">#define IERR</div><div class="ttdef"><b>Definition:</b> <a href="a00188_source.html#l00012">basic.h:12</a></div></div>
<div class="ttc" id="a00347_html_ab4b43dadf0cb676d61aee6c8f1fb5a2e"><div class="ttname"><a href="a00347.html#ab4b43dadf0cb676d61aee6c8f1fb5a2e">ApplyPeriodicity</a></div><div class="ttdeci">static int ApplyPeriodicity(int dir, int ndims, int *size, int ghosts, double *phi)</div><div class="ttdef"><b>Definition:</b> <a href="a00347_source.html#l00015">PetscGlobalDOF.c:15</a></div></div>
<div class="ttc" id="a00187_html_a2b2826031c0cd92495ab351d3e599fc5"><div class="ttname"><a href="a00187.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a></div><div class="ttdeci">#define _ArraySetValue_(x, size, value)</div><div class="ttdef"><b>Definition:</b> <a href="a00187_source.html#l00168">arrayfunctions.h:168</a></div></div>
<div class="ttc" id="a00173_html_a0c5f291f027b0928672b89121f44c0fc"><div class="ttname"><a href="a00173.html#a0c5f291f027b0928672b89121f44c0fc">PETScContext::globalDOF</a></div><div class="ttdeci">double * globalDOF</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00084">petscinterface.h:84</a></div></div>
<div class="ttc" id="a00188_html_a68f50121fb9a7daeaf60e50cdef82ef3"><div class="ttname"><a href="a00188.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a></div><div class="ttdeci">#define _DECLARE_IERR_</div><div class="ttdef"><b>Definition:</b> <a href="a00188_source.html#l00013">basic.h:13</a></div></div>
<div class="ttc" id="a00164_html_a20ee1fd00a220b98513127884a5558cf"><div class="ttname"><a href="a00164.html#a20ee1fd00a220b98513127884a5558cf">HyPar::npoints_local_wghosts</a></div><div class="ttdeci">int npoints_local_wghosts</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00040">hypar.h:40</a></div></div>
<div class="ttc" id="a00204_html_a60ace5964c051fa481e6a1e6f1ef75d7"><div class="ttname"><a href="a00204.html#a60ace5964c051fa481e6a1e6f1ef75d7">MPIExchangeBoundariesnD</a></div><div class="ttdeci">int MPIExchangeBoundariesnD(int, int, int *, int, void *, double *)</div><div class="ttdef"><b>Definition:</b> <a href="a00326_source.html#l00042">MPIExchangeBoundariesnD.c:42</a></div></div>
<div class="ttc" id="a00164_html_aafc992b5fa79d5a4036024615d03bce6"><div class="ttname"><a href="a00164.html#aafc992b5fa79d5a4036024615d03bce6">HyPar::ghosts</a></div><div class="ttdeci">int ghosts</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00044">hypar.h:44</a></div></div>
<div class="ttc" id="a00173_html_ab991f69858c9aada0736623db264237e"><div class="ttname"><a href="a00173.html#ab991f69858c9aada0736623db264237e">PETScContext::points</a></div><div class="ttdeci">int * points</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00056">petscinterface.h:56</a></div></div>
<div class="ttc" id="a00164_html_a40e3f67b1530d5ea4e913fc60b594802"><div class="ttname"><a href="a00164.html#a40e3f67b1530d5ea4e913fc60b594802">HyPar::isPeriodic</a></div><div class="ttdeci">int * isPeriodic</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00154">hypar.h:154</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a52781b615afd6404c69c93dd0aa82924"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int PetscCleanup </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>obj</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Clean up allocations in the PETSc interface </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">obj</td><td>Object of type <a class="el" href="a00173.html#a00591" title="Structure containing the variables for time-integration with PETSc. ">PETScContext</a> </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00341_source.html#l00012">12</a> of file <a class="el" href="a00341_source.html">PetscCleanup.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;{</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;  <a class="code" href="a00173.html#a00591">PETScContext</a> *ctxt = (<a class="code" href="a00173.html#a00591">PETScContext</a>*) obj;</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;  <span class="keywordflow">if</span> (ctxt-&gt;<a class="code" href="a00173.html#a0c5f291f027b0928672b89121f44c0fc">globalDOF</a>) free(ctxt-&gt;<a class="code" href="a00173.html#a0c5f291f027b0928672b89121f44c0fc">globalDOF</a>);</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;  <span class="keywordflow">if</span> (ctxt-&gt;<a class="code" href="a00173.html#ab991f69858c9aada0736623db264237e">points</a>)    free(ctxt-&gt;<a class="code" href="a00173.html#ab991f69858c9aada0736623db264237e">points</a>);</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;}</div>
<div class="ttc" id="a00173_html_a00591"><div class="ttname"><a href="a00173.html#a00591">PETScContext</a></div><div class="ttdoc">Structure containing the variables for time-integration with PETSc. </div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00035">petscinterface.h:35</a></div></div>
<div class="ttc" id="a00173_html_a0c5f291f027b0928672b89121f44c0fc"><div class="ttname"><a href="a00173.html#a0c5f291f027b0928672b89121f44c0fc">PETScContext::globalDOF</a></div><div class="ttdeci">double * globalDOF</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00084">petscinterface.h:84</a></div></div>
<div class="ttc" id="a00173_html_ab991f69858c9aada0736623db264237e"><div class="ttname"><a href="a00173.html#ab991f69858c9aada0736623db264237e">PETScContext::points</a></div><div class="ttdeci">int * points</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00056">petscinterface.h:56</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ae4a99505d5f322bfc1c590e3d31fcc0b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int PetscCreatePointList </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>obj</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Create a list of computational points: This is a list of all the grid points on which the PDE is solved. Thus, it is the total number of grid points minus the ghost points and blanked out points.</p>
<p>Note: this list is local, not global. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">obj</td><td>Object of type <a class="el" href="a00173.html#a00591" title="Structure containing the variables for time-integration with PETSc. ">PETScContext</a> </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00345_source.html#l00023">23</a> of file <a class="el" href="a00345_source.html">PetscCreatePointList.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;{</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  <a class="code" href="a00173.html#a00591">PETScContext</a>  *ctxt    = (<a class="code" href="a00173.html#a00591">PETScContext</a>*) obj;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;  <a class="code" href="a00164.html">HyPar</a>         *solver  = (<a class="code" href="a00164.html">HyPar</a>*) ctxt-&gt;<a class="code" href="a00173.html#ade1bc5cad8c6735a891a28f637cbfb06">solver</a>;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  <a class="code" href="a00167.html#a00588">MPIVariables</a>  *mpi     = (<a class="code" href="a00167.html#a00588">MPIVariables</a>*) ctxt-&gt;<a class="code" href="a00173.html#abaa15763a88d05dc68ff230ce570eee9">mpi</a>;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  <span class="keywordtype">int</span> *dim  = solver-&gt;<a class="code" href="a00164.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;      ndims = solver-&gt;<a class="code" href="a00164.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;      ghosts= solver-&gt;<a class="code" href="a00164.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;      done, index[ndims], npoints;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  <span class="comment">/* count the number of computational points */</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  npoints = 0; </div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  done    = 0; </div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <a class="code" href="a00187.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(index,ndims,0);</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  <span class="keywordflow">while</span> (!done) {</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="keywordtype">int</span> p; <a class="code" href="a00187.html#afbb862a2fdf5b72b1f9ace42f64b556f">_ArrayIndex1D_</a>(ndims,dim,index,ghosts,p);</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="keywordflow">if</span> (1) npoints++;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="comment">//if (solver-&gt;iblank[p] == 1) npoints++;</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <a class="code" href="a00187.html#ac5ec1371623f11d03b0f42adaa24acbc">_ArrayIncrementIndex_</a>(ndims,dim,index,done);</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  }</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  ctxt-&gt;<a class="code" href="a00173.html#a515ec0fe2abce5449e37ae520974cf5f">npoints</a> = npoints;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  <span class="keywordtype">int</span> nv = ndims+1;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  ctxt-&gt;<a class="code" href="a00173.html#ab991f69858c9aada0736623db264237e">points</a> = (<span class="keywordtype">int</span>*) calloc (ctxt-&gt;<a class="code" href="a00173.html#a515ec0fe2abce5449e37ae520974cf5f">npoints</a>*nv,<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  npoints = 0; </div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  done    = 0; <a class="code" href="a00187.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(index,ndims,0);</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <span class="keywordflow">while</span> (!done) {</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="keywordtype">int</span> p; <a class="code" href="a00187.html#afbb862a2fdf5b72b1f9ace42f64b556f">_ArrayIndex1D_</a>(ndims,dim,index,ghosts,p);</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="comment">//if (solver-&gt;iblank[p] == 1) {</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="keywordflow">if</span> (1) {</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;      <a class="code" href="a00187.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>(index,(ctxt-&gt;<a class="code" href="a00173.html#ab991f69858c9aada0736623db264237e">points</a>+npoints*nv),ndims);</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;      (ctxt-&gt;<a class="code" href="a00173.html#ab991f69858c9aada0736623db264237e">points</a>+npoints*nv)[ndims] = p;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;      npoints++;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    }</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <a class="code" href="a00187.html#ac5ec1371623f11d03b0f42adaa24acbc">_ArrayIncrementIndex_</a>(ndims,dim,index,done);</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  }</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  <span class="keywordflow">if</span> (npoints != ctxt-&gt;<a class="code" href="a00173.html#a515ec0fe2abce5449e37ae520974cf5f">npoints</a>) {</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    fprintf(stderr,<span class="stringliteral">&quot;Error in PetscCreatePointList() on rank %d: Inconsistency in point count - %d, %d.\n&quot;</span>,</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;            mpi-&gt;rank, ctxt-&gt;<a class="code" href="a00173.html#a515ec0fe2abce5449e37ae520974cf5f">npoints</a>, npoints);</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  }</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <span class="keywordtype">int</span> global_npoints;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  <a class="code" href="a00204.html#a25c7df0ff2e4f81a64368ea72894a4f8">MPISum_integer</a>(&amp;global_npoints,&amp;npoints,1,&amp;mpi-&gt;world);</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <span class="keywordflow">if</span> (!mpi-&gt;rank) {</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    printf(<span class="stringliteral">&quot;PETSc: total number of computational points is %d.\n&quot;</span>,global_npoints);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  }</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;}</div>
<div class="ttc" id="a00173_html_abaa15763a88d05dc68ff230ce570eee9"><div class="ttname"><a href="a00173.html#abaa15763a88d05dc68ff230ce570eee9">PETScContext::mpi</a></div><div class="ttdeci">void * mpi</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00039">petscinterface.h:39</a></div></div>
<div class="ttc" id="a00164_html"><div class="ttname"><a href="a00164.html">HyPar</a></div><div class="ttdoc">Structure containing all solver-specific variables and functions. </div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00023">hypar.h:23</a></div></div>
<div class="ttc" id="a00173_html_a515ec0fe2abce5449e37ae520974cf5f"><div class="ttname"><a href="a00173.html#a515ec0fe2abce5449e37ae520974cf5f">PETScContext::npoints</a></div><div class="ttdeci">int npoints</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00051">petscinterface.h:51</a></div></div>
<div class="ttc" id="a00173_html_a00591"><div class="ttname"><a href="a00173.html#a00591">PETScContext</a></div><div class="ttdoc">Structure containing the variables for time-integration with PETSc. </div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00035">petscinterface.h:35</a></div></div>
<div class="ttc" id="a00164_html_a484873c74138512e41bc50d17b7d955a"><div class="ttname"><a href="a00164.html#a484873c74138512e41bc50d17b7d955a">HyPar::ndims</a></div><div class="ttdeci">int ndims</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00026">hypar.h:26</a></div></div>
<div class="ttc" id="a00164_html_a38e0371f331cecbe63a77fa03e202afe"><div class="ttname"><a href="a00164.html#a38e0371f331cecbe63a77fa03e202afe">HyPar::dim_local</a></div><div class="ttdeci">int * dim_local</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00035">hypar.h:35</a></div></div>
<div class="ttc" id="a00173_html_ade1bc5cad8c6735a891a28f637cbfb06"><div class="ttname"><a href="a00173.html#ade1bc5cad8c6735a891a28f637cbfb06">PETScContext::solver</a></div><div class="ttdeci">void * solver</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00037">petscinterface.h:37</a></div></div>
<div class="ttc" id="a00187_html_afbb862a2fdf5b72b1f9ace42f64b556f"><div class="ttname"><a href="a00187.html#afbb862a2fdf5b72b1f9ace42f64b556f">_ArrayIndex1D_</a></div><div class="ttdeci">#define _ArrayIndex1D_(N, imax, i, ghost, index)</div><div class="ttdef"><b>Definition:</b> <a href="a00187_source.html#l00039">arrayfunctions.h:39</a></div></div>
<div class="ttc" id="a00187_html_ac5ec1371623f11d03b0f42adaa24acbc"><div class="ttname"><a href="a00187.html#ac5ec1371623f11d03b0f42adaa24acbc">_ArrayIncrementIndex_</a></div><div class="ttdeci">#define _ArrayIncrementIndex_(N, imax, i, done)</div><div class="ttdef"><b>Definition:</b> <a href="a00187_source.html#l00125">arrayfunctions.h:125</a></div></div>
<div class="ttc" id="a00204_html_a25c7df0ff2e4f81a64368ea72894a4f8"><div class="ttname"><a href="a00204.html#a25c7df0ff2e4f81a64368ea72894a4f8">MPISum_integer</a></div><div class="ttdeci">int MPISum_integer(int *, int *, int, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00340_source.html#l00016">MPISum.c:16</a></div></div>
<div class="ttc" id="a00167_html_a00588"><div class="ttname"><a href="a00167.html#a00588">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a00167_source.html#l00024">mpivars_struct.h:24</a></div></div>
<div class="ttc" id="a00187_html_a2b2826031c0cd92495ab351d3e599fc5"><div class="ttname"><a href="a00187.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a></div><div class="ttdeci">#define _ArraySetValue_(x, size, value)</div><div class="ttdef"><b>Definition:</b> <a href="a00187_source.html#l00168">arrayfunctions.h:168</a></div></div>
<div class="ttc" id="a00187_html_a89e8330d9e06dd0666c50833628a125c"><div class="ttname"><a href="a00187.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a></div><div class="ttdeci">#define _ArrayCopy1D_(x, y, size)</div><div class="ttdef"><b>Definition:</b> <a href="a00187_source.html#l00318">arrayfunctions.h:318</a></div></div>
<div class="ttc" id="a00164_html_aafc992b5fa79d5a4036024615d03bce6"><div class="ttname"><a href="a00164.html#aafc992b5fa79d5a4036024615d03bce6">HyPar::ghosts</a></div><div class="ttdeci">int ghosts</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00044">hypar.h:44</a></div></div>
<div class="ttc" id="a00173_html_ab991f69858c9aada0736623db264237e"><div class="ttname"><a href="a00173.html#ab991f69858c9aada0736623db264237e">PETScContext::points</a></div><div class="ttdeci">int * points</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00056">petscinterface.h:56</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aa52bad03c15488a2119b794d0e70deed"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode PetscPreStage </td>
          <td>(</td>
          <td class="paramtype">TS&#160;</td>
          <td class="paramname"><em>ts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal&#160;</td>
          <td class="paramname"><em>waqt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Function called before a stage in multi-stage time-integration methods </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ts</td><td>Time integration object </td></tr>
    <tr><td class="paramname">waqt</td><td>Current simulation time </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00353_source.html#l00014">14</a> of file <a class="el" href="a00353_source.html">PetscPreStage.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;{</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;  PetscFunctionBegin;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;  PetscFunctionReturn(0);</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad1f357f94c228ba9ff45275064ca162b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode PetscPostStage </td>
          <td>(</td>
          <td class="paramtype">TS&#160;</td>
          <td class="paramname"><em>ts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal&#160;</td>
          <td class="paramname"><em>stagetime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>stageindex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Vec *&#160;</td>
          <td class="paramname"><em>Y</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Function called after every stage in a multi-stage time-integration method </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ts</td><td>Time integrator of PETSc type TS </td></tr>
    <tr><td class="paramname">stagetime</td><td>Current stage time </td></tr>
    <tr><td class="paramname">stageindex</td><td>Stage </td></tr>
    <tr><td class="paramname">Y</td><td>Stage solutions (all stages) - be careful what you access </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00351_source.html#l00017">17</a> of file <a class="el" href="a00351_source.html">PetscPostStage.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;{</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  <a class="code" href="a00173.html#a00591">PETScContext</a>    *context  = NULL;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;  <a class="code" href="a00164.html">HyPar</a>           *solver   = NULL;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  <a class="code" href="a00167.html#a00588">MPIVariables</a>    *mpi      = NULL;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  TSType          time_scheme;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  PetscErrorCode  ierr      = 0;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  PetscFunctionBegin;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  ierr = TSGetApplicationContext(ts,&amp;context); CHKERRQ(ierr);</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <span class="keywordflow">if</span> (!context) {</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    fprintf(stderr,<span class="stringliteral">&quot;Error in PetscPreTimeStep: Null context!\n&quot;</span>);</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  }</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  solver  = context-&gt;<a class="code" href="a00173.html#ade1bc5cad8c6735a891a28f637cbfb06">solver</a>;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  mpi     = context-&gt;<a class="code" href="a00173.html#abaa15763a88d05dc68ff230ce570eee9">mpi</a>;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <span class="comment">/* get solution */</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  ierr = <a class="code" href="a00173.html#aba47a541676718cced51875b1c3a4ba6">TransferVecFromPETSc</a>(solver-&gt;<a class="code" href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>,Y[stageindex],context); <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  <span class="comment">/* apply immersed boundaries */</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  <a class="code" href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00164.html#a83d97dfc50e6bfefd0db6503d365d5bd">ApplyIBConditions</a>(solver,mpi,solver-&gt;<a class="code" href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>,stagetime); <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  <span class="comment">/* If using a non-linear scheme with ARKIMEX methods, </span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">     compute the non-linear finite-difference operator */</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  ierr = TSGetType(ts,&amp;time_scheme); CHKERRQ(ierr);</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="keywordflow">if</span> (!strcmp(time_scheme,TSARKIMEX)) {</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    ierr = solver-&gt;<a class="code" href="a00164.html#a228697ae6a0f0fe7a928a9ddad45da54">NonlinearInterp</a>(solver-&gt;<a class="code" href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>,solver,mpi,(<span class="keywordtype">double</span>)stagetime,</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;                                   solver-&gt;<a class="code" href="a00164.html#a0d895f9bb0c8a3e79a64dd2379e1f2dd">FFunction</a>); <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  }</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  <span class="comment">/* Call any physics-specific post-stage function, if available */</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <span class="keywordflow">if</span> (solver-&gt;<a class="code" href="a00164.html#a356e3534ee0048e05c5ea3ca091c33d8">PostStage</a>) {</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    ierr = solver-&gt;<a class="code" href="a00164.html#a356e3534ee0048e05c5ea3ca091c33d8">PostStage</a>(solver-&gt;<a class="code" href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>,solver,mpi,stagetime); <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  }</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <a class="code" href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00173.html#a94499efe0f52b5174ce7105de5ab1a37">TransferVecToPETSc</a>(solver-&gt;<a class="code" href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>,Y[stageindex],context);</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  PetscFunctionReturn(0);</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;}</div>
<div class="ttc" id="a00173_html_abaa15763a88d05dc68ff230ce570eee9"><div class="ttname"><a href="a00173.html#abaa15763a88d05dc68ff230ce570eee9">PETScContext::mpi</a></div><div class="ttdeci">void * mpi</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00039">petscinterface.h:39</a></div></div>
<div class="ttc" id="a00164_html_a228697ae6a0f0fe7a928a9ddad45da54"><div class="ttname"><a href="a00164.html#a228697ae6a0f0fe7a928a9ddad45da54">HyPar::NonlinearInterp</a></div><div class="ttdeci">int(* NonlinearInterp)(double *, void *, void *, double, int(*)(double *, double *, int, void *, double))</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00215">hypar.h:215</a></div></div>
<div class="ttc" id="a00164_html"><div class="ttname"><a href="a00164.html">HyPar</a></div><div class="ttdoc">Structure containing all solver-specific variables and functions. </div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00023">hypar.h:23</a></div></div>
<div class="ttc" id="a00164_html_a83d97dfc50e6bfefd0db6503d365d5bd"><div class="ttname"><a href="a00164.html#a83d97dfc50e6bfefd0db6503d365d5bd">HyPar::ApplyIBConditions</a></div><div class="ttdeci">int(* ApplyIBConditions)(void *, void *, double *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00204">hypar.h:204</a></div></div>
<div class="ttc" id="a00173_html_a00591"><div class="ttname"><a href="a00173.html#a00591">PETScContext</a></div><div class="ttdoc">Structure containing the variables for time-integration with PETSc. </div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00035">petscinterface.h:35</a></div></div>
<div class="ttc" id="a00188_html_add9cf96ae374934d245a1dc1ab697a42"><div class="ttname"><a href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a></div><div class="ttdeci">#define CHECKERR(ierr)</div><div class="ttdef"><b>Definition:</b> <a href="a00188_source.html#l00014">basic.h:14</a></div></div>
<div class="ttc" id="a00173_html_ade1bc5cad8c6735a891a28f637cbfb06"><div class="ttname"><a href="a00173.html#ade1bc5cad8c6735a891a28f637cbfb06">PETScContext::solver</a></div><div class="ttdeci">void * solver</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00037">petscinterface.h:37</a></div></div>
<div class="ttc" id="a00164_html_a356e3534ee0048e05c5ea3ca091c33d8"><div class="ttname"><a href="a00164.html#a356e3534ee0048e05c5ea3ca091c33d8">HyPar::PostStage</a></div><div class="ttdeci">int(* PostStage)(double *, void *, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00313">hypar.h:313</a></div></div>
<div class="ttc" id="a00167_html_a00588"><div class="ttname"><a href="a00167.html#a00588">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a00167_source.html#l00024">mpivars_struct.h:24</a></div></div>
<div class="ttc" id="a00188_html_ad6ab74942c9de13cf0b4c12eb0d91780"><div class="ttname"><a href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a></div><div class="ttdeci">#define IERR</div><div class="ttdef"><b>Definition:</b> <a href="a00188_source.html#l00012">basic.h:12</a></div></div>
<div class="ttc" id="a00164_html_a0d895f9bb0c8a3e79a64dd2379e1f2dd"><div class="ttname"><a href="a00164.html#a0d895f9bb0c8a3e79a64dd2379e1f2dd">HyPar::FFunction</a></div><div class="ttdeci">int(* FFunction)(double *, double *, int, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00262">hypar.h:262</a></div></div>
<div class="ttc" id="a00173_html_aba47a541676718cced51875b1c3a4ba6"><div class="ttname"><a href="a00173.html#aba47a541676718cced51875b1c3a4ba6">TransferVecFromPETSc</a></div><div class="ttdeci">int TransferVecFromPETSc(double *, Vec, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00359_source.html#l00022">TransferFromPETSc.c:22</a></div></div>
<div class="ttc" id="a00164_html_a3b6b999a764f1e2ea94bb5f28c7a558c"><div class="ttname"><a href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">HyPar::u</a></div><div class="ttdeci">double * u</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00108">hypar.h:108</a></div></div>
<div class="ttc" id="a00173_html_a94499efe0f52b5174ce7105de5ab1a37"><div class="ttname"><a href="a00173.html#a94499efe0f52b5174ce7105de5ab1a37">TransferVecToPETSc</a></div><div class="ttdeci">int TransferVecToPETSc(double *, Vec, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00360_source.html#l00023">TransferToPETSc.c:23</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ace222db5eadd0e0bd27229641e43fa9b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode PetscPreTimeStep </td>
          <td>(</td>
          <td class="paramtype">TS&#160;</td>
          <td class="paramname"><em>ts</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Function called before a time step </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ts</td><td>Time integration object </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00354_source.html#l00023">23</a> of file <a class="el" href="a00354_source.html">PetscPreTimeStep.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;{</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  <a class="code" href="a00173.html#a00591">PETScContext</a>    *context  = NULL;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;  <a class="code" href="a00164.html">HyPar</a>           *solver   = NULL;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  <a class="code" href="a00167.html#a00588">MPIVariables</a>    *mpi      = NULL;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  PetscErrorCode  ierr      = 0;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  Vec             Y;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  TSType          time_scheme;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  <span class="keywordtype">double</span>          waqt;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  <span class="keywordtype">int</span>             iter;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  PetscFunctionBegin;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  ierr = TSGetApplicationContext(ts,&amp;context); CHKERRQ(ierr);</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  <span class="keywordflow">if</span> (!context) {</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    fprintf(stderr,<span class="stringliteral">&quot;Error in PetscPreTimeStep: Null context!\n&quot;</span>);</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  }</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  solver  = context-&gt;<a class="code" href="a00173.html#ade1bc5cad8c6735a891a28f637cbfb06">solver</a>;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  mpi     = context-&gt;<a class="code" href="a00173.html#abaa15763a88d05dc68ff230ce570eee9">mpi</a>;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  <span class="comment">/* get solution */</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  ierr = TSGetSolution(ts,&amp;Y);                        CHKERRQ(ierr);</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  ierr = <a class="code" href="a00173.html#aba47a541676718cced51875b1c3a4ba6">TransferVecFromPETSc</a>(solver-&gt;<a class="code" href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>,Y,context);   <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  ierr = TSGetTime(ts,&amp;waqt);                         CHKERRQ(ierr);</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  ierr = TSGetStepNumber(ts,&amp;iter);                   CHKERRQ(ierr);</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="comment">/* save a copy of the solution to compute norm at end of time step */</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <a class="code" href="a00187.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>(solver-&gt;<a class="code" href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>,solver-&gt;<a class="code" href="a00164.html#acab4b9b417d6c3745ad789099d3731c6">u0</a>,(solver-&gt;<a class="code" href="a00164.html#a20ee1fd00a220b98513127884a5558cf">npoints_local_wghosts</a>*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>));</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <span class="comment">/* apply boundary conditions and exchange data over MPI interfaces */</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <a class="code" href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00164.html#aa4de7bdc1e62417caf51b9c45184268d">ApplyBoundaryConditions</a>(solver,mpi,solver-&gt;<a class="code" href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>,NULL,waqt); <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  <a class="code" href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00164.html#a83d97dfc50e6bfefd0db6503d365d5bd">ApplyIBConditions</a>(solver,mpi,solver-&gt;<a class="code" href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>,waqt); <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <a class="code" href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00204.html#a60ace5964c051fa481e6a1e6f1ef75d7">MPIExchangeBoundariesnD</a>(solver-&gt;<a class="code" href="a00164.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00164.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;                               solver-&gt;<a class="code" href="a00164.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,mpi,solver-&gt;<a class="code" href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>);             <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <span class="comment">/* Call any physics-specific pre-step function */</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <span class="keywordflow">if</span> (solver-&gt;<a class="code" href="a00164.html#a6a34ae8a3044f521e57180a7260f3b42">PreStep</a>) { ierr = solver-&gt;<a class="code" href="a00164.html#a6a34ae8a3044f521e57180a7260f3b42">PreStep</a>(solver-&gt;<a class="code" href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>,solver,mpi,waqt); <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr); }</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  <span class="comment">/* If using a non-linear scheme with ARKIMEX methods, </span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">     compute the non-linear finite-difference operator */</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  ierr = TSGetType(ts,&amp;time_scheme);        CHKERRQ(ierr);</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  <span class="keywordflow">if</span> (!strcmp(time_scheme,TSARKIMEX)) {</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    ierr = solver-&gt;<a class="code" href="a00164.html#a228697ae6a0f0fe7a928a9ddad45da54">NonlinearInterp</a>(solver-&gt;<a class="code" href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>,solver,mpi,waqt,solver-&gt;<a class="code" href="a00164.html#a0d895f9bb0c8a3e79a64dd2379e1f2dd">FFunction</a>); </div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  }</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  </div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <span class="comment">/* set the step boundary flux integral value to zero */</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <a class="code" href="a00187.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(solver-&gt;<a class="code" href="a00164.html#a6dfeed442d18083b68fd0f28d5f63fa7">StepBoundaryIntegral</a>,2*solver-&gt;<a class="code" href="a00164.html#a484873c74138512e41bc50d17b7d955a">ndims</a>*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,0.0);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="preprocessor">#ifdef compute_rhs_operators</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span> ((!iter) || ((iter+1)%solver-&gt;<a class="code" href="a00164.html#a6ff746b30ee55a3bbb9f3306c145f27a">file_op_iter</a> == 0)) </div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    { ierr = <a class="code" href="a00344.html#a0f2c1412c41c1c0ca7c4a68827b6e4f0">PetscComputeRHSOperators</a>(ts,waqt,context); <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr); }</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="preprocessor"></span>  <span class="comment">/* Write initial solution file if this is the first iteration */</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  <span class="keywordflow">if</span> (!iter) { </div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="keywordflow">if</span> (solver-&gt;<a class="code" href="a00164.html#ab4c55736e92f7d72f04b8a957d82b054">PhysicsOutput</a>) {</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;      <a class="code" href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00164.html#ab4c55736e92f7d72f04b8a957d82b054">PhysicsOutput</a>(solver,mpi); <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    }</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="comment">//ierr = OutputSolution(solver,mpi); CHECKERR(ierr); </span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  }</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <a class="code" href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00173.html#a94499efe0f52b5174ce7105de5ab1a37">TransferVecToPETSc</a>(solver-&gt;<a class="code" href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>,Y,context);</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  PetscFunctionReturn(0);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;}</div>
<div class="ttc" id="a00173_html_abaa15763a88d05dc68ff230ce570eee9"><div class="ttname"><a href="a00173.html#abaa15763a88d05dc68ff230ce570eee9">PETScContext::mpi</a></div><div class="ttdeci">void * mpi</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00039">petscinterface.h:39</a></div></div>
<div class="ttc" id="a00164_html_ae8f6d2fd6490d3153cb4133bf183a404"><div class="ttname"><a href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">HyPar::nvars</a></div><div class="ttdeci">int nvars</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00029">hypar.h:29</a></div></div>
<div class="ttc" id="a00164_html_a228697ae6a0f0fe7a928a9ddad45da54"><div class="ttname"><a href="a00164.html#a228697ae6a0f0fe7a928a9ddad45da54">HyPar::NonlinearInterp</a></div><div class="ttdeci">int(* NonlinearInterp)(double *, void *, void *, double, int(*)(double *, double *, int, void *, double))</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00215">hypar.h:215</a></div></div>
<div class="ttc" id="a00164_html"><div class="ttname"><a href="a00164.html">HyPar</a></div><div class="ttdoc">Structure containing all solver-specific variables and functions. </div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00023">hypar.h:23</a></div></div>
<div class="ttc" id="a00164_html_a83d97dfc50e6bfefd0db6503d365d5bd"><div class="ttname"><a href="a00164.html#a83d97dfc50e6bfefd0db6503d365d5bd">HyPar::ApplyIBConditions</a></div><div class="ttdeci">int(* ApplyIBConditions)(void *, void *, double *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00204">hypar.h:204</a></div></div>
<div class="ttc" id="a00173_html_a00591"><div class="ttname"><a href="a00173.html#a00591">PETScContext</a></div><div class="ttdoc">Structure containing the variables for time-integration with PETSc. </div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00035">petscinterface.h:35</a></div></div>
<div class="ttc" id="a00164_html_a484873c74138512e41bc50d17b7d955a"><div class="ttname"><a href="a00164.html#a484873c74138512e41bc50d17b7d955a">HyPar::ndims</a></div><div class="ttdeci">int ndims</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00026">hypar.h:26</a></div></div>
<div class="ttc" id="a00164_html_a6a34ae8a3044f521e57180a7260f3b42"><div class="ttname"><a href="a00164.html#a6a34ae8a3044f521e57180a7260f3b42">HyPar::PreStep</a></div><div class="ttdeci">int(* PreStep)(double *, void *, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00315">hypar.h:315</a></div></div>
<div class="ttc" id="a00164_html_a38e0371f331cecbe63a77fa03e202afe"><div class="ttname"><a href="a00164.html#a38e0371f331cecbe63a77fa03e202afe">HyPar::dim_local</a></div><div class="ttdeci">int * dim_local</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00035">hypar.h:35</a></div></div>
<div class="ttc" id="a00188_html_add9cf96ae374934d245a1dc1ab697a42"><div class="ttname"><a href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a></div><div class="ttdeci">#define CHECKERR(ierr)</div><div class="ttdef"><b>Definition:</b> <a href="a00188_source.html#l00014">basic.h:14</a></div></div>
<div class="ttc" id="a00173_html_ade1bc5cad8c6735a891a28f637cbfb06"><div class="ttname"><a href="a00173.html#ade1bc5cad8c6735a891a28f637cbfb06">PETScContext::solver</a></div><div class="ttdeci">void * solver</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00037">petscinterface.h:37</a></div></div>
<div class="ttc" id="a00167_html_a00588"><div class="ttname"><a href="a00167.html#a00588">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a00167_source.html#l00024">mpivars_struct.h:24</a></div></div>
<div class="ttc" id="a00188_html_ad6ab74942c9de13cf0b4c12eb0d91780"><div class="ttname"><a href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a></div><div class="ttdeci">#define IERR</div><div class="ttdef"><b>Definition:</b> <a href="a00188_source.html#l00012">basic.h:12</a></div></div>
<div class="ttc" id="a00164_html_a0d895f9bb0c8a3e79a64dd2379e1f2dd"><div class="ttname"><a href="a00164.html#a0d895f9bb0c8a3e79a64dd2379e1f2dd">HyPar::FFunction</a></div><div class="ttdeci">int(* FFunction)(double *, double *, int, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00262">hypar.h:262</a></div></div>
<div class="ttc" id="a00344_html_a0f2c1412c41c1c0ca7c4a68827b6e4f0"><div class="ttname"><a href="a00344.html#a0f2c1412c41c1c0ca7c4a68827b6e4f0">PetscComputeRHSOperators</a></div><div class="ttdeci">int PetscComputeRHSOperators(TS ts, double t, void *ctxt)</div><div class="ttdef"><b>Definition:</b> <a href="a00344_source.html#l00060">PetscComputeRHSOperators.c:60</a></div></div>
<div class="ttc" id="a00164_html_a6ff746b30ee55a3bbb9f3306c145f27a"><div class="ttname"><a href="a00164.html#a6ff746b30ee55a3bbb9f3306c145f27a">HyPar::file_op_iter</a></div><div class="ttdeci">int file_op_iter</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00163">hypar.h:163</a></div></div>
<div class="ttc" id="a00187_html_a2b2826031c0cd92495ab351d3e599fc5"><div class="ttname"><a href="a00187.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a></div><div class="ttdeci">#define _ArraySetValue_(x, size, value)</div><div class="ttdef"><b>Definition:</b> <a href="a00187_source.html#l00168">arrayfunctions.h:168</a></div></div>
<div class="ttc" id="a00164_html_aa4de7bdc1e62417caf51b9c45184268d"><div class="ttname"><a href="a00164.html#aa4de7bdc1e62417caf51b9c45184268d">HyPar::ApplyBoundaryConditions</a></div><div class="ttdeci">int(* ApplyBoundaryConditions)(void *, void *, double *, double *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00201">hypar.h:201</a></div></div>
<div class="ttc" id="a00173_html_aba47a541676718cced51875b1c3a4ba6"><div class="ttname"><a href="a00173.html#aba47a541676718cced51875b1c3a4ba6">TransferVecFromPETSc</a></div><div class="ttdeci">int TransferVecFromPETSc(double *, Vec, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00359_source.html#l00022">TransferFromPETSc.c:22</a></div></div>
<div class="ttc" id="a00164_html_a3b6b999a764f1e2ea94bb5f28c7a558c"><div class="ttname"><a href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">HyPar::u</a></div><div class="ttdeci">double * u</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00108">hypar.h:108</a></div></div>
<div class="ttc" id="a00164_html_a20ee1fd00a220b98513127884a5558cf"><div class="ttname"><a href="a00164.html#a20ee1fd00a220b98513127884a5558cf">HyPar::npoints_local_wghosts</a></div><div class="ttdeci">int npoints_local_wghosts</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00040">hypar.h:40</a></div></div>
<div class="ttc" id="a00173_html_a94499efe0f52b5174ce7105de5ab1a37"><div class="ttname"><a href="a00173.html#a94499efe0f52b5174ce7105de5ab1a37">TransferVecToPETSc</a></div><div class="ttdeci">int TransferVecToPETSc(double *, Vec, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00360_source.html#l00023">TransferToPETSc.c:23</a></div></div>
<div class="ttc" id="a00164_html_a6dfeed442d18083b68fd0f28d5f63fa7"><div class="ttname"><a href="a00164.html#a6dfeed442d18083b68fd0f28d5f63fa7">HyPar::StepBoundaryIntegral</a></div><div class="ttdeci">double * StepBoundaryIntegral</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00360">hypar.h:360</a></div></div>
<div class="ttc" id="a00187_html_a89e8330d9e06dd0666c50833628a125c"><div class="ttname"><a href="a00187.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a></div><div class="ttdeci">#define _ArrayCopy1D_(x, y, size)</div><div class="ttdef"><b>Definition:</b> <a href="a00187_source.html#l00318">arrayfunctions.h:318</a></div></div>
<div class="ttc" id="a00204_html_a60ace5964c051fa481e6a1e6f1ef75d7"><div class="ttname"><a href="a00204.html#a60ace5964c051fa481e6a1e6f1ef75d7">MPIExchangeBoundariesnD</a></div><div class="ttdeci">int MPIExchangeBoundariesnD(int, int, int *, int, void *, double *)</div><div class="ttdef"><b>Definition:</b> <a href="a00326_source.html#l00042">MPIExchangeBoundariesnD.c:42</a></div></div>
<div class="ttc" id="a00164_html_aafc992b5fa79d5a4036024615d03bce6"><div class="ttname"><a href="a00164.html#aafc992b5fa79d5a4036024615d03bce6">HyPar::ghosts</a></div><div class="ttdeci">int ghosts</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00044">hypar.h:44</a></div></div>
<div class="ttc" id="a00164_html_acab4b9b417d6c3745ad789099d3731c6"><div class="ttname"><a href="a00164.html#acab4b9b417d6c3745ad789099d3731c6">HyPar::u0</a></div><div class="ttdeci">double * u0</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00372">hypar.h:372</a></div></div>
<div class="ttc" id="a00164_html_ab4c55736e92f7d72f04b8a957d82b054"><div class="ttname"><a href="a00164.html#ab4c55736e92f7d72f04b8a957d82b054">HyPar::PhysicsOutput</a></div><div class="ttdeci">int(* PhysicsOutput)(void *, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00323">hypar.h:323</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3f7397f8cd5e90306fb7f02edecb3782"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode PetscPostTimeStep </td>
          <td>(</td>
          <td class="paramtype">TS&#160;</td>
          <td class="paramname"><em>ts</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Function called after every time step </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ts</td><td>Time integrator object </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00352_source.html#l00019">19</a> of file <a class="el" href="a00352_source.html">PetscPostTimeStep.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;{</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;  <a class="code" href="a00173.html#a00591">PETScContext</a>    *context  = NULL;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;  <a class="code" href="a00164.html">HyPar</a>           *solver   = NULL;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;  <a class="code" href="a00167.html#a00588">MPIVariables</a>    *mpi      = NULL;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;  PetscErrorCode  ierr;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  Vec             Y;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  PetscFunctionBegin;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  ierr = TSGetApplicationContext(ts,&amp;context); CHKERRQ(ierr);</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  <span class="keywordflow">if</span> (!context) {</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    fprintf(stderr,<span class="stringliteral">&quot;Error in PetscPostTimeStep: Null context!\n&quot;</span>);</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  }</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  solver  = context-&gt;<a class="code" href="a00173.html#ade1bc5cad8c6735a891a28f637cbfb06">solver</a>;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  mpi     = context-&gt;<a class="code" href="a00173.html#abaa15763a88d05dc68ff230ce570eee9">mpi</a>;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  context-&gt;<a class="code" href="a00173.html#a34cbd56d5136d5e8b5ea2cbb901c04cd">tic</a>++;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <span class="keywordtype">int</span>     iter; ierr = TSGetStepNumber(ts,&amp;iter); CHKERRQ(ierr);</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  <span class="keywordtype">double</span>  dt;   ierr = TSGetTimeStep  (ts,&amp;dt  ); CHKERRQ(ierr);</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <span class="keywordtype">double</span>  waqt; ierr = TSGetTime      (ts,&amp;waqt); CHKERRQ(ierr);</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  <span class="comment">/* get solution */</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  ierr = TSGetSolution(ts,&amp;Y); CHKERRQ(ierr);</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  ierr = <a class="code" href="a00173.html#aba47a541676718cced51875b1c3a4ba6">TransferVecFromPETSc</a>(solver-&gt;<a class="code" href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>,Y,context);</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  <span class="comment">/* Call any physics-specific post-step function */</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  <span class="keywordflow">if</span> (solver-&gt;<a class="code" href="a00164.html#a85a6422b0b08263704165a2a14719033">PostStep</a>)  { ierr = solver-&gt;<a class="code" href="a00164.html#a85a6422b0b08263704165a2a14719033">PostStep</a>(solver-&gt;<a class="code" href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>,solver,mpi,waqt,iter); <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr); }</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  <span class="comment">/* Calculate CFL and diffusion number */</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="keywordtype">double</span> local_max_cfl  = -1.0, max_cfl  = -1.0;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <span class="keywordtype">double</span> local_max_diff = -1.0, max_diff = -1.0;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <span class="keywordflow">if</span> (solver-&gt;<a class="code" href="a00164.html#a73ad2e9dae43bf438ab8bfc4cd2e1bdd">ComputeCFL</a>       ) local_max_cfl  = solver-&gt;<a class="code" href="a00164.html#a73ad2e9dae43bf438ab8bfc4cd2e1bdd">ComputeCFL</a>        (solver,mpi,dt,waqt);</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <span class="keywordflow">if</span> (solver-&gt;<a class="code" href="a00164.html#a49e17e5889baddd411c028afc3b91335">ComputeDiffNumber</a>) local_max_diff = solver-&gt;<a class="code" href="a00164.html#a49e17e5889baddd411c028afc3b91335">ComputeDiffNumber</a> (solver,mpi,dt,waqt);</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  ierr = <a class="code" href="a00204.html#a33aa37e0050ec72dadb8d63851df51ec">MPIMax_double</a>(&amp;max_cfl ,&amp;local_max_cfl ,1,&amp;mpi-&gt;<a class="code" href="a00167.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  ierr = <a class="code" href="a00204.html#a33aa37e0050ec72dadb8d63851df51ec">MPIMax_double</a>(&amp;max_diff,&amp;local_max_diff,1,&amp;mpi-&gt;<a class="code" href="a00167.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <span class="comment">/* Calculate norm of the change in the solution for this time step */</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <a class="code" href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>,-1.0,solver-&gt;<a class="code" href="a00164.html#acab4b9b417d6c3745ad789099d3731c6">u0</a>,(solver-&gt;<a class="code" href="a00164.html#a20ee1fd00a220b98513127884a5558cf">npoints_local_wghosts</a>*solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>));</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <span class="keywordtype">double</span> <a class="code" href="a00571.html#aca1295e3cf52d990f4cd1d5872f1385a">sum</a> = <a class="code" href="a00187.html#a8c279db0af78d8ff386cf1a023a405dd">ArraySumSquarenD</a>(solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00164.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00164.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;                                solver-&gt;<a class="code" href="a00164.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,solver-&gt;<a class="code" href="a00164.html#a95e9e0f8a692321b83a2e0ce2789c485">index</a>,solver-&gt;<a class="code" href="a00164.html#acab4b9b417d6c3745ad789099d3731c6">u0</a>);</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <span class="keywordtype">double</span> global_sum = 0; <a class="code" href="a00204.html#abd61f932b070ee84262d9d98b6dd854f">MPISum_double</a>(&amp;global_sum,&amp;sum,1,&amp;mpi-&gt;<a class="code" href="a00167.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  <span class="keywordtype">double</span> norm = sqrt((global_sum/(<span class="keywordtype">double</span>)solver-&gt;<a class="code" href="a00164.html#a4e67f54563a3c4ff005dfaf0130f957c">npoints_global</a>));</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  </div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00164.html#ac92c34fe456d92c694eacd2231f5a7b1">ConservationCheck</a>,<span class="stringliteral">&quot;yes&quot;</span>)) {</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="comment">/* calculate volume integral of the solution at this time step */</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <a class="code" href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00164.html#a0fda913c8c0424880302e9296cc0e813">VolumeIntegralFunction</a>(solver-&gt;<a class="code" href="a00164.html#a57f7bff1d8bf27f2ca5c00270da00d05">VolumeIntegral</a>,solver-&gt;<a class="code" href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>,solver,mpi); <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="comment">/* calculate surface integral of the flux at this time step */</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <a class="code" href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00164.html#a479abc98a0ca73359a33089ba5d37863">BoundaryIntegralFunction</a>(solver,mpi); <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="comment">/* calculate the conservation error at this time step       */</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <a class="code" href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00164.html#a2108550c80e1666f11c684fcb4f1ca89">CalculateConservationError</a>(solver,mpi); <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  }</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <span class="keywordflow">if</span> ((!mpi-&gt;<a class="code" href="a00167.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) &amp;&amp; (iter%solver-&gt;<a class="code" href="a00164.html#a74ff7fa96cbfc4ee87f508f964e94409">screen_op_iter</a> == 0)) {</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    printf(<span class="stringliteral">&quot;Iteration: %6d  &quot;</span>       ,iter    );</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    printf(<span class="stringliteral">&quot;Time: %1.3E  &quot;</span>          ,waqt    );</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    printf(<span class="stringliteral">&quot;Max CFL: %1.3E  &quot;</span>       ,max_cfl );</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    printf(<span class="stringliteral">&quot;Max Diff. No.: %1.3E  &quot;</span> ,max_diff);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    printf(<span class="stringliteral">&quot;Norm: %1.4E &quot;</span>           ,norm    );</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="comment">/* calculate and print conservation error */</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00164.html#ac92c34fe456d92c694eacd2231f5a7b1">ConservationCheck</a>,<span class="stringliteral">&quot;yes&quot;</span>)) {</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;      <span class="keywordtype">double</span> error = 0;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;      <span class="keywordtype">int</span> v;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;      <span class="keywordflow">for</span> (v=0; v&lt;solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>; v++) </div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        error += solver-&gt;<a class="code" href="a00164.html#a965363cd64ce50ae17705dfb285dd0ab">ConservationError</a>[v] * solver-&gt;<a class="code" href="a00164.html#a965363cd64ce50ae17705dfb285dd0ab">ConservationError</a>[v];</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;      error = sqrt(error);</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;      printf(<span class="stringliteral">&quot;Conservation loss: %1.4E&quot;</span>,error);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    }</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="comment">/* print physics-specific info, if available */</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="keywordflow">if</span> (solver-&gt;<a class="code" href="a00164.html#aa4ef2f3e9fcc13ef7b8885b8a7145967">PrintStep</a>) solver-&gt;<a class="code" href="a00164.html#aa4ef2f3e9fcc13ef7b8885b8a7145967">PrintStep</a>(solver,mpi,waqt);</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  }</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <span class="comment">/* Write intermediate solution to file */</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="keywordflow">if</span> (iter%solver-&gt;<a class="code" href="a00164.html#a6ff746b30ee55a3bbb9f3306c145f27a">file_op_iter</a> == 0) { </div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="keywordflow">if</span> (solver-&gt;<a class="code" href="a00164.html#ab4c55736e92f7d72f04b8a957d82b054">PhysicsOutput</a>) {</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;      <a class="code" href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00164.html#ab4c55736e92f7d72f04b8a957d82b054">PhysicsOutput</a>(solver,mpi); <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    }</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="comment">//ierr = OutputSolution(solver,mpi); CHECKERR(ierr); context-&gt;tic=0; </span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  }</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  PetscFunctionReturn(0);</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;}</div>
<div class="ttc" id="a00164_html_a57f7bff1d8bf27f2ca5c00270da00d05"><div class="ttname"><a href="a00164.html#a57f7bff1d8bf27f2ca5c00270da00d05">HyPar::VolumeIntegral</a></div><div class="ttdeci">double * VolumeIntegral</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00354">hypar.h:354</a></div></div>
<div class="ttc" id="a00173_html_abaa15763a88d05dc68ff230ce570eee9"><div class="ttname"><a href="a00173.html#abaa15763a88d05dc68ff230ce570eee9">PETScContext::mpi</a></div><div class="ttdeci">void * mpi</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00039">petscinterface.h:39</a></div></div>
<div class="ttc" id="a00164_html_a85a6422b0b08263704165a2a14719033"><div class="ttname"><a href="a00164.html#a85a6422b0b08263704165a2a14719033">HyPar::PostStep</a></div><div class="ttdeci">int(* PostStep)(double *, void *, void *, double, int)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00317">hypar.h:317</a></div></div>
<div class="ttc" id="a00164_html_ae8f6d2fd6490d3153cb4133bf183a404"><div class="ttname"><a href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">HyPar::nvars</a></div><div class="ttdeci">int nvars</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00029">hypar.h:29</a></div></div>
<div class="ttc" id="a00187_html_a4cd66304bc41a7751842230af3063b62"><div class="ttname"><a href="a00187.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a></div><div class="ttdeci">#define _ArrayAXPY_(x, a, y, size)</div><div class="ttdef"><b>Definition:</b> <a href="a00187_source.html#l00270">arrayfunctions.h:270</a></div></div>
<div class="ttc" id="a00167_html_adad7a6f85831f3ac84d854b6c80aef43"><div class="ttname"><a href="a00167.html#adad7a6f85831f3ac84d854b6c80aef43">MPIVariables::world</a></div><div class="ttdeci">MPI_Comm world</div><div class="ttdef"><b>Definition:</b> <a href="a00167_source.html#l00037">mpivars_struct.h:37</a></div></div>
<div class="ttc" id="a00164_html"><div class="ttname"><a href="a00164.html">HyPar</a></div><div class="ttdoc">Structure containing all solver-specific variables and functions. </div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00023">hypar.h:23</a></div></div>
<div class="ttc" id="a00164_html_a49e17e5889baddd411c028afc3b91335"><div class="ttname"><a href="a00164.html#a49e17e5889baddd411c028afc3b91335">HyPar::ComputeDiffNumber</a></div><div class="ttdeci">double(* ComputeDiffNumber)(void *, void *, double, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00259">hypar.h:259</a></div></div>
<div class="ttc" id="a00164_html_a965363cd64ce50ae17705dfb285dd0ab"><div class="ttname"><a href="a00164.html#a965363cd64ce50ae17705dfb285dd0ab">HyPar::ConservationError</a></div><div class="ttdeci">double * ConservationError</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00350">hypar.h:350</a></div></div>
<div class="ttc" id="a00173_html_a00591"><div class="ttname"><a href="a00173.html#a00591">PETScContext</a></div><div class="ttdoc">Structure containing the variables for time-integration with PETSc. </div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00035">petscinterface.h:35</a></div></div>
<div class="ttc" id="a00164_html_a73ad2e9dae43bf438ab8bfc4cd2e1bdd"><div class="ttname"><a href="a00164.html#a73ad2e9dae43bf438ab8bfc4cd2e1bdd">HyPar::ComputeCFL</a></div><div class="ttdeci">double(* ComputeCFL)(void *, void *, double, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00256">hypar.h:256</a></div></div>
<div class="ttc" id="a00164_html_a484873c74138512e41bc50d17b7d955a"><div class="ttname"><a href="a00164.html#a484873c74138512e41bc50d17b7d955a">HyPar::ndims</a></div><div class="ttdeci">int ndims</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00026">hypar.h:26</a></div></div>
<div class="ttc" id="a00164_html_a38e0371f331cecbe63a77fa03e202afe"><div class="ttname"><a href="a00164.html#a38e0371f331cecbe63a77fa03e202afe">HyPar::dim_local</a></div><div class="ttdeci">int * dim_local</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00035">hypar.h:35</a></div></div>
<div class="ttc" id="a00188_html_add9cf96ae374934d245a1dc1ab697a42"><div class="ttname"><a href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a></div><div class="ttdeci">#define CHECKERR(ierr)</div><div class="ttdef"><b>Definition:</b> <a href="a00188_source.html#l00014">basic.h:14</a></div></div>
<div class="ttc" id="a00173_html_ade1bc5cad8c6735a891a28f637cbfb06"><div class="ttname"><a href="a00173.html#ade1bc5cad8c6735a891a28f637cbfb06">PETScContext::solver</a></div><div class="ttdeci">void * solver</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00037">petscinterface.h:37</a></div></div>
<div class="ttc" id="a00204_html_a33aa37e0050ec72dadb8d63851df51ec"><div class="ttname"><a href="a00204.html#a33aa37e0050ec72dadb8d63851df51ec">MPIMax_double</a></div><div class="ttdeci">int MPIMax_double(double *, double *, int, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00333_source.html#l00038">MPIMax.c:38</a></div></div>
<div class="ttc" id="a00164_html_a0fda913c8c0424880302e9296cc0e813"><div class="ttname"><a href="a00164.html#a0fda913c8c0424880302e9296cc0e813">HyPar::VolumeIntegralFunction</a></div><div class="ttdeci">int(* VolumeIntegralFunction)(double *, double *, void *, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00364">hypar.h:364</a></div></div>
<div class="ttc" id="a00167_html_a00588"><div class="ttname"><a href="a00167.html#a00588">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a00167_source.html#l00024">mpivars_struct.h:24</a></div></div>
<div class="ttc" id="a00187_html_a8c279db0af78d8ff386cf1a023a405dd"><div class="ttname"><a href="a00187.html#a8c279db0af78d8ff386cf1a023a405dd">ArraySumSquarenD</a></div><div class="ttdeci">INLINE double ArraySumSquarenD(int, int, int *, int, int *, double *)</div><div class="ttdef"><b>Definition:</b> <a href="a00187_source.html#l00482">arrayfunctions.h:482</a></div></div>
<div class="ttc" id="a00571_html_aca1295e3cf52d990f4cd1d5872f1385a"><div class="ttname"><a href="a00571.html#aca1295e3cf52d990f4cd1d5872f1385a">StdVecOps::sum</a></div><div class="ttdeci">long sum(const std::vector&lt; int &gt; &amp;a_iv)</div><div class="ttdef"><b>Definition:</b> <a href="a00216_source.html#l00018">std_vec_ops.h:18</a></div></div>
<div class="ttc" id="a00164_html_a2108550c80e1666f11c684fcb4f1ca89"><div class="ttname"><a href="a00164.html#a2108550c80e1666f11c684fcb4f1ca89">HyPar::CalculateConservationError</a></div><div class="ttdeci">int(* CalculateConservationError)(void *, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00368">hypar.h:368</a></div></div>
<div class="ttc" id="a00188_html_ad6ab74942c9de13cf0b4c12eb0d91780"><div class="ttname"><a href="a00188.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a></div><div class="ttdeci">#define IERR</div><div class="ttdef"><b>Definition:</b> <a href="a00188_source.html#l00012">basic.h:12</a></div></div>
<div class="ttc" id="a00164_html_a479abc98a0ca73359a33089ba5d37863"><div class="ttname"><a href="a00164.html#a479abc98a0ca73359a33089ba5d37863">HyPar::BoundaryIntegralFunction</a></div><div class="ttdeci">int(* BoundaryIntegralFunction)(void *, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00366">hypar.h:366</a></div></div>
<div class="ttc" id="a00167_html_a6cfd95afd0afebd625b889fb6e58371c"><div class="ttname"><a href="a00167.html#a6cfd95afd0afebd625b889fb6e58371c">MPIVariables::rank</a></div><div class="ttdeci">int rank</div><div class="ttdef"><b>Definition:</b> <a href="a00167_source.html#l00025">mpivars_struct.h:25</a></div></div>
<div class="ttc" id="a00204_html_abd61f932b070ee84262d9d98b6dd854f"><div class="ttname"><a href="a00204.html#abd61f932b070ee84262d9d98b6dd854f">MPISum_double</a></div><div class="ttdeci">int MPISum_double(double *, double *, int, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00340_source.html#l00039">MPISum.c:39</a></div></div>
<div class="ttc" id="a00164_html_a6ff746b30ee55a3bbb9f3306c145f27a"><div class="ttname"><a href="a00164.html#a6ff746b30ee55a3bbb9f3306c145f27a">HyPar::file_op_iter</a></div><div class="ttdeci">int file_op_iter</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00163">hypar.h:163</a></div></div>
<div class="ttc" id="a00164_html_a95e9e0f8a692321b83a2e0ce2789c485"><div class="ttname"><a href="a00164.html#a95e9e0f8a692321b83a2e0ce2789c485">HyPar::index</a></div><div class="ttdeci">int * index</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00094">hypar.h:94</a></div></div>
<div class="ttc" id="a00173_html_a34cbd56d5136d5e8b5ea2cbb901c04cd"><div class="ttname"><a href="a00173.html#a34cbd56d5136d5e8b5ea2cbb901c04cd">PETScContext::tic</a></div><div class="ttdeci">int tic</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00046">petscinterface.h:46</a></div></div>
<div class="ttc" id="a00173_html_aba47a541676718cced51875b1c3a4ba6"><div class="ttname"><a href="a00173.html#aba47a541676718cced51875b1c3a4ba6">TransferVecFromPETSc</a></div><div class="ttdeci">int TransferVecFromPETSc(double *, Vec, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00359_source.html#l00022">TransferFromPETSc.c:22</a></div></div>
<div class="ttc" id="a00164_html_a3b6b999a764f1e2ea94bb5f28c7a558c"><div class="ttname"><a href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">HyPar::u</a></div><div class="ttdeci">double * u</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00108">hypar.h:108</a></div></div>
<div class="ttc" id="a00164_html_a20ee1fd00a220b98513127884a5558cf"><div class="ttname"><a href="a00164.html#a20ee1fd00a220b98513127884a5558cf">HyPar::npoints_local_wghosts</a></div><div class="ttdeci">int npoints_local_wghosts</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00040">hypar.h:40</a></div></div>
<div class="ttc" id="a00164_html_a4e67f54563a3c4ff005dfaf0130f957c"><div class="ttname"><a href="a00164.html#a4e67f54563a3c4ff005dfaf0130f957c">HyPar::npoints_global</a></div><div class="ttdeci">int npoints_global</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00038">hypar.h:38</a></div></div>
<div class="ttc" id="a00164_html_aa4ef2f3e9fcc13ef7b8885b8a7145967"><div class="ttname"><a href="a00164.html#aa4ef2f3e9fcc13ef7b8885b8a7145967">HyPar::PrintStep</a></div><div class="ttdeci">int(* PrintStep)(void *, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00320">hypar.h:320</a></div></div>
<div class="ttc" id="a00164_html_a74ff7fa96cbfc4ee87f508f964e94409"><div class="ttname"><a href="a00164.html#a74ff7fa96cbfc4ee87f508f964e94409">HyPar::screen_op_iter</a></div><div class="ttdeci">int screen_op_iter</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00160">hypar.h:160</a></div></div>
<div class="ttc" id="a00164_html_aafc992b5fa79d5a4036024615d03bce6"><div class="ttname"><a href="a00164.html#aafc992b5fa79d5a4036024615d03bce6">HyPar::ghosts</a></div><div class="ttdeci">int ghosts</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00044">hypar.h:44</a></div></div>
<div class="ttc" id="a00164_html_acab4b9b417d6c3745ad789099d3731c6"><div class="ttname"><a href="a00164.html#acab4b9b417d6c3745ad789099d3731c6">HyPar::u0</a></div><div class="ttdeci">double * u0</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00372">hypar.h:372</a></div></div>
<div class="ttc" id="a00164_html_ac92c34fe456d92c694eacd2231f5a7b1"><div class="ttname"><a href="a00164.html#ac92c34fe456d92c694eacd2231f5a7b1">HyPar::ConservationCheck</a></div><div class="ttdeci">char ConservationCheck[_MAX_STRING_SIZE_]</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00352">hypar.h:352</a></div></div>
<div class="ttc" id="a00164_html_ab4c55736e92f7d72f04b8a957d82b054"><div class="ttname"><a href="a00164.html#ab4c55736e92f7d72f04b8a957d82b054">HyPar::PhysicsOutput</a></div><div class="ttdeci">int(* PhysicsOutput)(void *, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00323">hypar.h:323</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ab501847c597b0c20dff03d95a663b9b4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode PetscTimeError </td>
          <td>(</td>
          <td class="paramtype">TS&#160;</td>
          <td class="paramname"><em>ts</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Function to compute any error estimates, if available</p>
<p>Compute the norms of the error estimate, if the PETSc time integrator has it (for example TSGLEE) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ts</td><td>Time integrator object of PETSc type TS </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00346_source.html#l00021">21</a> of file <a class="el" href="a00346_source.html">PetscError.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;{</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  <a class="code" href="a00173.html#a00591">PETScContext</a>    *context  = NULL;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;  <a class="code" href="a00164.html">HyPar</a>           *solver   = NULL;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  <a class="code" href="a00167.html#a00588">MPIVariables</a>    *mpi      = NULL;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  Vec             Y,Z;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  TSType          time_scheme;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  <span class="keywordtype">double</span>          dt;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  PetscErrorCode  ierr;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  ierr = TSGetApplicationContext(ts,&amp;context); CHKERRQ(ierr);</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <span class="keywordflow">if</span> (!context) {</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    fprintf(stderr,<span class="stringliteral">&quot;Error in PetscError: Null context!\n&quot;</span>);</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  }</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  solver  = context-&gt;<a class="code" href="a00173.html#ade1bc5cad8c6735a891a28f637cbfb06">solver</a>;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  mpi     = context-&gt;<a class="code" href="a00173.html#abaa15763a88d05dc68ff230ce570eee9">mpi</a>;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <span class="keywordtype">int</span>    size    = solver-&gt;<a class="code" href="a00164.html#a20ee1fd00a220b98513127884a5558cf">npoints_local_wghosts</a> * solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  <span class="keywordtype">double</span> <a class="code" href="a00571.html#aca1295e3cf52d990f4cd1d5872f1385a">sum</a>     = 0.0, global_sum = 0.0, *Uerr = solver-&gt;<a class="code" href="a00164.html#a3ccc9ddb96600c40dcc41bb1ded11160">uref</a>,</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;         error[3] = {0,0,0};</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  ierr = TSGetTimeStep(ts,&amp;dt  ); CHKERRQ(ierr);</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  ierr = TSGetType(ts,&amp;time_scheme); CHKERRQ(ierr);</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  ierr = TSGetSolution(ts,&amp;Y); CHKERRQ(ierr);</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  ierr = <a class="code" href="a00173.html#aba47a541676718cced51875b1c3a4ba6">TransferVecFromPETSc</a>(solver-&gt;<a class="code" href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>,Y,context); <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  <span class="keywordflow">if</span> (!strcmp(time_scheme,TSGLEE)) {</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    ierr = VecDuplicate(Y,&amp;Z); CHKERRQ(ierr);</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    ierr = TSGetTimeError(ts,0,&amp;Z);CHKERRQ(ierr);</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    ierr = <a class="code" href="a00173.html#aba47a541676718cced51875b1c3a4ba6">TransferVecFromPETSc</a>(Uerr,Z,context); <a class="code" href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    ierr = VecDestroy(&amp;Z); CHKERRQ(ierr);</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="comment">/* calculate solution norm for relative errors */</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="keywordtype">double</span> sol_norm[3] = {0.0,0.0,0.0};</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="comment">/* L1 */</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    sum = <a class="code" href="a00187.html#a60a3d838d95d860a21de20936f7bb910">ArraySumAbsnD</a>   (solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00164.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00164.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;                           solver-&gt;<a class="code" href="a00164.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,solver-&gt;<a class="code" href="a00164.html#a95e9e0f8a692321b83a2e0ce2789c485">index</a>,solver-&gt;<a class="code" href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>);</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    global_sum = 0; <a class="code" href="a00204.html#abd61f932b070ee84262d9d98b6dd854f">MPISum_double</a>(&amp;global_sum,&amp;sum,1,&amp;mpi-&gt;<a class="code" href="a00167.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    sol_norm[0] = global_sum/((double)solver-&gt;<a class="code" href="a00164.html#a4e67f54563a3c4ff005dfaf0130f957c">npoints_global</a>);</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="comment">/* L2 */</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    sum = <a class="code" href="a00187.html#a8c279db0af78d8ff386cf1a023a405dd">ArraySumSquarenD</a>(solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00164.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00164.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;                           solver-&gt;<a class="code" href="a00164.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,solver-&gt;<a class="code" href="a00164.html#a95e9e0f8a692321b83a2e0ce2789c485">index</a>,solver-&gt;<a class="code" href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>);</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    global_sum = 0; <a class="code" href="a00204.html#abd61f932b070ee84262d9d98b6dd854f">MPISum_double</a>(&amp;global_sum,&amp;sum,1,&amp;mpi-&gt;<a class="code" href="a00167.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    sol_norm[1] = sqrt(global_sum/((<span class="keywordtype">double</span>)solver-&gt;<a class="code" href="a00164.html#a4e67f54563a3c4ff005dfaf0130f957c">npoints_global</a>));</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="comment">/* Linf */</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    sum = <a class="code" href="a00187.html#ac20bd4916c6169956e5bf80777c6ab8f">ArrayMaxnD</a>      (solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00164.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00164.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;                           solver-&gt;<a class="code" href="a00164.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,solver-&gt;<a class="code" href="a00164.html#a95e9e0f8a692321b83a2e0ce2789c485">index</a>,solver-&gt;<a class="code" href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>);</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    global_sum = 0; <a class="code" href="a00204.html#a33aa37e0050ec72dadb8d63851df51ec">MPIMax_double</a>(&amp;global_sum,&amp;sum,1,&amp;mpi-&gt;<a class="code" href="a00167.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    sol_norm[2] = global_sum;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="comment">/* calculate L1 norm of error */</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    sum = <a class="code" href="a00187.html#a60a3d838d95d860a21de20936f7bb910">ArraySumAbsnD</a>   (solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00164.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00164.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                           solver-&gt;<a class="code" href="a00164.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,solver-&gt;<a class="code" href="a00164.html#a95e9e0f8a692321b83a2e0ce2789c485">index</a>,Uerr);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    global_sum = 0; <a class="code" href="a00204.html#abd61f932b070ee84262d9d98b6dd854f">MPISum_double</a>(&amp;global_sum,&amp;sum,1,&amp;mpi-&gt;<a class="code" href="a00167.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    error[0] = global_sum/((double)solver-&gt;<a class="code" href="a00164.html#a4e67f54563a3c4ff005dfaf0130f957c">npoints_global</a>);</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="comment">/* calculate L2 norm of error */</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    sum = <a class="code" href="a00187.html#a8c279db0af78d8ff386cf1a023a405dd">ArraySumSquarenD</a>(solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00164.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00164.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                           solver-&gt;<a class="code" href="a00164.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,solver-&gt;<a class="code" href="a00164.html#a95e9e0f8a692321b83a2e0ce2789c485">index</a>,Uerr);</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    global_sum = 0; <a class="code" href="a00204.html#abd61f932b070ee84262d9d98b6dd854f">MPISum_double</a>(&amp;global_sum,&amp;sum,1,&amp;mpi-&gt;<a class="code" href="a00167.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    error[1] = sqrt(global_sum/((<span class="keywordtype">double</span>)solver-&gt;<a class="code" href="a00164.html#a4e67f54563a3c4ff005dfaf0130f957c">npoints_global</a>));</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="comment">/* calculate Linf norm of error */</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    sum = <a class="code" href="a00187.html#ac20bd4916c6169956e5bf80777c6ab8f">ArrayMaxnD</a>      (solver-&gt;<a class="code" href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00164.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00164.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;                           solver-&gt;<a class="code" href="a00164.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,solver-&gt;<a class="code" href="a00164.html#a95e9e0f8a692321b83a2e0ce2789c485">index</a>,Uerr);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    global_sum = 0; <a class="code" href="a00204.html#a33aa37e0050ec72dadb8d63851df51ec">MPIMax_double</a>(&amp;global_sum,&amp;sum,1,&amp;mpi-&gt;<a class="code" href="a00167.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    error[2] = global_sum;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="keywordflow">if</span> (   (sol_norm[0] &gt; <a class="code" href="a00188.html#abfd977805f9104d0141377f9b4ac954e">_MACHINE_ZERO_</a>)</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        &amp;&amp; (sol_norm[1] &gt; <a class="code" href="a00188.html#abfd977805f9104d0141377f9b4ac954e">_MACHINE_ZERO_</a>)</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        &amp;&amp; (sol_norm[2] &gt; <a class="code" href="a00188.html#abfd977805f9104d0141377f9b4ac954e">_MACHINE_ZERO_</a>) ) {</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;      error[0] /= sol_norm[0];</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;      error[1] /= sol_norm[1];</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;      error[2] /= sol_norm[2];</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    }</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="comment">/* write to file */</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a00167.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) {</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;      FILE *out;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;      out = fopen(<span class="stringliteral">&quot;glm_err.dat&quot;</span>,<span class="stringliteral">&quot;w&quot;</span>);</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;      fprintf(out,<span class="stringliteral">&quot;%1.16E  %1.16E  %1.16E  %1.16E  &quot;</span>,dt,error[0],error[1],error[2]);</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;      fclose(out);</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;      printf(<span class="stringliteral">&quot;Estimated time integration errors (GLM-GEE time-integration):-\n&quot;</span>);</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;      printf(<span class="stringliteral">&quot;  L1         Error           : %1.16E\n&quot;</span>,error[0]);</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;      printf(<span class="stringliteral">&quot;  L2         Error           : %1.16E\n&quot;</span>,error[1]);</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;      printf(<span class="stringliteral">&quot;  Linfinity  Error           : %1.16E\n&quot;</span>,error[2]);</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    }</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  }</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;}</div>
<div class="ttc" id="a00173_html_abaa15763a88d05dc68ff230ce570eee9"><div class="ttname"><a href="a00173.html#abaa15763a88d05dc68ff230ce570eee9">PETScContext::mpi</a></div><div class="ttdeci">void * mpi</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00039">petscinterface.h:39</a></div></div>
<div class="ttc" id="a00164_html_ae8f6d2fd6490d3153cb4133bf183a404"><div class="ttname"><a href="a00164.html#ae8f6d2fd6490d3153cb4133bf183a404">HyPar::nvars</a></div><div class="ttdeci">int nvars</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00029">hypar.h:29</a></div></div>
<div class="ttc" id="a00167_html_adad7a6f85831f3ac84d854b6c80aef43"><div class="ttname"><a href="a00167.html#adad7a6f85831f3ac84d854b6c80aef43">MPIVariables::world</a></div><div class="ttdeci">MPI_Comm world</div><div class="ttdef"><b>Definition:</b> <a href="a00167_source.html#l00037">mpivars_struct.h:37</a></div></div>
<div class="ttc" id="a00164_html"><div class="ttname"><a href="a00164.html">HyPar</a></div><div class="ttdoc">Structure containing all solver-specific variables and functions. </div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00023">hypar.h:23</a></div></div>
<div class="ttc" id="a00173_html_a00591"><div class="ttname"><a href="a00173.html#a00591">PETScContext</a></div><div class="ttdoc">Structure containing the variables for time-integration with PETSc. </div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00035">petscinterface.h:35</a></div></div>
<div class="ttc" id="a00164_html_a484873c74138512e41bc50d17b7d955a"><div class="ttname"><a href="a00164.html#a484873c74138512e41bc50d17b7d955a">HyPar::ndims</a></div><div class="ttdeci">int ndims</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00026">hypar.h:26</a></div></div>
<div class="ttc" id="a00164_html_a38e0371f331cecbe63a77fa03e202afe"><div class="ttname"><a href="a00164.html#a38e0371f331cecbe63a77fa03e202afe">HyPar::dim_local</a></div><div class="ttdeci">int * dim_local</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00035">hypar.h:35</a></div></div>
<div class="ttc" id="a00188_html_add9cf96ae374934d245a1dc1ab697a42"><div class="ttname"><a href="a00188.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a></div><div class="ttdeci">#define CHECKERR(ierr)</div><div class="ttdef"><b>Definition:</b> <a href="a00188_source.html#l00014">basic.h:14</a></div></div>
<div class="ttc" id="a00173_html_ade1bc5cad8c6735a891a28f637cbfb06"><div class="ttname"><a href="a00173.html#ade1bc5cad8c6735a891a28f637cbfb06">PETScContext::solver</a></div><div class="ttdeci">void * solver</div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00037">petscinterface.h:37</a></div></div>
<div class="ttc" id="a00204_html_a33aa37e0050ec72dadb8d63851df51ec"><div class="ttname"><a href="a00204.html#a33aa37e0050ec72dadb8d63851df51ec">MPIMax_double</a></div><div class="ttdeci">int MPIMax_double(double *, double *, int, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00333_source.html#l00038">MPIMax.c:38</a></div></div>
<div class="ttc" id="a00167_html_a00588"><div class="ttname"><a href="a00167.html#a00588">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a00167_source.html#l00024">mpivars_struct.h:24</a></div></div>
<div class="ttc" id="a00187_html_a8c279db0af78d8ff386cf1a023a405dd"><div class="ttname"><a href="a00187.html#a8c279db0af78d8ff386cf1a023a405dd">ArraySumSquarenD</a></div><div class="ttdeci">INLINE double ArraySumSquarenD(int, int, int *, int, int *, double *)</div><div class="ttdef"><b>Definition:</b> <a href="a00187_source.html#l00482">arrayfunctions.h:482</a></div></div>
<div class="ttc" id="a00571_html_aca1295e3cf52d990f4cd1d5872f1385a"><div class="ttname"><a href="a00571.html#aca1295e3cf52d990f4cd1d5872f1385a">StdVecOps::sum</a></div><div class="ttdeci">long sum(const std::vector&lt; int &gt; &amp;a_iv)</div><div class="ttdef"><b>Definition:</b> <a href="a00216_source.html#l00018">std_vec_ops.h:18</a></div></div>
<div class="ttc" id="a00167_html_a6cfd95afd0afebd625b889fb6e58371c"><div class="ttname"><a href="a00167.html#a6cfd95afd0afebd625b889fb6e58371c">MPIVariables::rank</a></div><div class="ttdeci">int rank</div><div class="ttdef"><b>Definition:</b> <a href="a00167_source.html#l00025">mpivars_struct.h:25</a></div></div>
<div class="ttc" id="a00204_html_abd61f932b070ee84262d9d98b6dd854f"><div class="ttname"><a href="a00204.html#abd61f932b070ee84262d9d98b6dd854f">MPISum_double</a></div><div class="ttdeci">int MPISum_double(double *, double *, int, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00340_source.html#l00039">MPISum.c:39</a></div></div>
<div class="ttc" id="a00187_html_ac20bd4916c6169956e5bf80777c6ab8f"><div class="ttname"><a href="a00187.html#ac20bd4916c6169956e5bf80777c6ab8f">ArrayMaxnD</a></div><div class="ttdeci">INLINE double ArrayMaxnD(int, int, int *, int, int *, double *)</div><div class="ttdef"><b>Definition:</b> <a href="a00187_source.html#l00439">arrayfunctions.h:439</a></div></div>
<div class="ttc" id="a00164_html_a95e9e0f8a692321b83a2e0ce2789c485"><div class="ttname"><a href="a00164.html#a95e9e0f8a692321b83a2e0ce2789c485">HyPar::index</a></div><div class="ttdeci">int * index</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00094">hypar.h:94</a></div></div>
<div class="ttc" id="a00173_html_aba47a541676718cced51875b1c3a4ba6"><div class="ttname"><a href="a00173.html#aba47a541676718cced51875b1c3a4ba6">TransferVecFromPETSc</a></div><div class="ttdeci">int TransferVecFromPETSc(double *, Vec, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00359_source.html#l00022">TransferFromPETSc.c:22</a></div></div>
<div class="ttc" id="a00164_html_a3b6b999a764f1e2ea94bb5f28c7a558c"><div class="ttname"><a href="a00164.html#a3b6b999a764f1e2ea94bb5f28c7a558c">HyPar::u</a></div><div class="ttdeci">double * u</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00108">hypar.h:108</a></div></div>
<div class="ttc" id="a00187_html_a60a3d838d95d860a21de20936f7bb910"><div class="ttname"><a href="a00187.html#a60a3d838d95d860a21de20936f7bb910">ArraySumAbsnD</a></div><div class="ttdeci">INLINE double ArraySumAbsnD(int, int, int *, int, int *, double *)</div><div class="ttdef"><b>Definition:</b> <a href="a00187_source.html#l00463">arrayfunctions.h:463</a></div></div>
<div class="ttc" id="a00164_html_a3ccc9ddb96600c40dcc41bb1ded11160"><div class="ttname"><a href="a00164.html#a3ccc9ddb96600c40dcc41bb1ded11160">HyPar::uref</a></div><div class="ttdeci">double * uref</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00373">hypar.h:373</a></div></div>
<div class="ttc" id="a00164_html_a20ee1fd00a220b98513127884a5558cf"><div class="ttname"><a href="a00164.html#a20ee1fd00a220b98513127884a5558cf">HyPar::npoints_local_wghosts</a></div><div class="ttdeci">int npoints_local_wghosts</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00040">hypar.h:40</a></div></div>
<div class="ttc" id="a00164_html_a4e67f54563a3c4ff005dfaf0130f957c"><div class="ttname"><a href="a00164.html#a4e67f54563a3c4ff005dfaf0130f957c">HyPar::npoints_global</a></div><div class="ttdeci">int npoints_global</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00038">hypar.h:38</a></div></div>
<div class="ttc" id="a00188_html_abfd977805f9104d0141377f9b4ac954e"><div class="ttname"><a href="a00188.html#abfd977805f9104d0141377f9b4ac954e">_MACHINE_ZERO_</a></div><div class="ttdeci">#define _MACHINE_ZERO_</div><div class="ttdef"><b>Definition:</b> <a href="a00188_source.html#l00022">basic.h:22</a></div></div>
<div class="ttc" id="a00164_html_aafc992b5fa79d5a4036024615d03bce6"><div class="ttname"><a href="a00164.html#aafc992b5fa79d5a4036024615d03bce6">HyPar::ghosts</a></div><div class="ttdeci">int ghosts</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00044">hypar.h:44</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">
var sc_project=10897352; 
var sc_invisible=1; 
var sc_security="83042f57"; 
var scJsHost = (("https:" == document.location.protocol) ?
"https://secure." : "http://www.");
document.write("<sc"+"ript type='text/javascript' src='" +
scJsHost+
"statcounter.com/counter/counter.js'></"+"script>");
</script>
<noscript><div class="statcounter"><a title="website
statistics" href="http://statcounter.com/"
target="_blank"><img class="statcounter"
src="//c.statcounter.com/10897352/0/83042f57/1/"
alt="website statistics"></a></div></noscript>
<!-- End of StatCounter Code for Default Guide -->
