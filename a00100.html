<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>HyPar: include/tridiagLU.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_html_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">HyPar
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">Finite-Difference Hyperbolic-Parabolic PDE Solver on Cartesian Grids</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('a00100.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">tridiagLU.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Header file for <a class="el" href="a00100.html#a00408">TridiagLU</a>.  
<a href="#details">More...</a></p>

<p><a href="a00100_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:a00408"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00100.html#a00408">TridiagLU</a></td></tr>
<tr class="separator:a00408"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a79ddfe354b89d113b72db4b5ae6c6e3d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00100.html#a79ddfe354b89d113b72db4b5ae6c6e3d">_TRIDIAG_JACOBI_</a>&#160;&#160;&#160;&quot;jacobi&quot;</td></tr>
<tr class="separator:a79ddfe354b89d113b72db4b5ae6c6e3d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adf756eb923ab79f911e38a82da7a6cab"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00100.html#adf756eb923ab79f911e38a82da7a6cab">_TRIDIAG_GS_</a>&#160;&#160;&#160;&quot;gather-and-solve&quot;</td></tr>
<tr class="separator:adf756eb923ab79f911e38a82da7a6cab"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a83b53dedf034d67bf2dde46eebf492ee"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00100.html#a83b53dedf034d67bf2dde46eebf492ee">tridiagLU</a> (double *, double *, double *, double *, int, int, void *, void *)</td></tr>
<tr class="separator:a83b53dedf034d67bf2dde46eebf492ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3d43d79472727ef201c8a48f3073decd"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00100.html#a3d43d79472727ef201c8a48f3073decd">tridiagLUGS</a> (double *, double *, double *, double *, int, int, void *, void *)</td></tr>
<tr class="separator:a3d43d79472727ef201c8a48f3073decd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1b0ccd6fb49ee8efe7c87a78e1bbe0ec"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00100.html#a1b0ccd6fb49ee8efe7c87a78e1bbe0ec">tridiagIterJacobi</a> (double *, double *, double *, double *, int, int, void *, void *)</td></tr>
<tr class="separator:a1b0ccd6fb49ee8efe7c87a78e1bbe0ec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a52d21dfe1d76916811879bf0d7a29d72"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00100.html#a52d21dfe1d76916811879bf0d7a29d72">tridiagLUInit</a> (void *, void *)</td></tr>
<tr class="separator:a52d21dfe1d76916811879bf0d7a29d72"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad2c404dd44e760ee729740176b186bd0"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00100.html#ad2c404dd44e760ee729740176b186bd0">blocktridiagLU</a> (double *, double *, double *, double *, int, int, int, void *, void *)</td></tr>
<tr class="separator:ad2c404dd44e760ee729740176b186bd0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8c48f135943fe35da85072714d4b1b23"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00100.html#a8c48f135943fe35da85072714d4b1b23">blocktridiagIterJacobi</a> (double *, double *, double *, double *, int, int, int, void *, void *)</td></tr>
<tr class="separator:a8c48f135943fe35da85072714d4b1b23"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Header file for <a class="el" href="a00100.html#a00408">TridiagLU</a>. </p>
<dl class="section author"><dt>Author</dt><dd>Debojyoti Ghosh </dd></dl>

<p>Definition in file <a class="el" href="a00100_source.html">tridiagLU.h</a>.</p>
</div><hr/><h2 class="groupheader">Data Structure Documentation</h2>
<a name="a00408" id="a00408"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct TridiagLU</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock">
<p>Definition at line <a class="el" href="a00100_source.html#l00081">81</a> of file <a class="el" href="a00100_source.html">tridiagLU.h</a>.</p>
</div><table class="fieldtable">
<tr><th colspan="3">Data Fields</th></tr>
<tr><td class="fieldtype">
<a class="anchor" id="ae50ec60868beaab2cb84897adefda09f"></a>char</td>
<td class="fieldname">
reducedsolvetype[50]</td>
<td class="fielddoc">
<p>Choice of solver for solving the reduced system. May be <a class="el" href="a00100.html#a79ddfe354b89d113b72db4b5ae6c6e3d">_TRIDIAG_JACOBI_</a> or <a class="el" href="a00100.html#adf756eb923ab79f911e38a82da7a6cab">_TRIDIAG_GS_</a>. </p>
</td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a584c0fc0b1e845800ad511dffc60e032"></a>int</td>
<td class="fieldname">
evaluate_norm</td>
<td class="fielddoc">
<p>calculate norm at each iteration? (relevant only for iterative solvers) </p>
</td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a274519264a28477940f161ddb4b61feb"></a>int</td>
<td class="fieldname">
maxiter</td>
<td class="fielddoc">
<p>maximum number of iterations (relevant only for iterative solvers) </p>
</td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a60c6dfc476dd9596072f61c2ec8d58ed"></a>double</td>
<td class="fieldname">
atol</td>
<td class="fielddoc">
<p>absolute tolerance (relevant only for iterative solvers) </p>
</td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a4587afeee8941ba7c208b3690a3eeaa7"></a>double</td>
<td class="fieldname">
rtol</td>
<td class="fielddoc">
<p>relative tolerace (relevant only for iterative solvers) </p>
</td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a846172807b19cf19a2587ede74b06828"></a>int</td>
<td class="fieldname">
exititer</td>
<td class="fielddoc">
<p>number of iterations it ran for (relevant only for iterative solvers) </p>
</td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a0a20107c06f29ce4d4ac23a4e7cfb17a"></a>double</td>
<td class="fieldname">
exitnorm</td>
<td class="fielddoc">
<p>error norm at exit (relevant only for iterative solvers) </p>
</td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a0b2caeb4b6f130be43e5a2f0267dd453"></a>int</td>
<td class="fieldname">
verbose</td>
<td class="fielddoc">
<p>print iterations and norms (relevant only for iterative solvers) </p>
</td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="abc276e47b85df9dd59f248e663b3b971"></a>double</td>
<td class="fieldname">
total_time</td>
<td class="fielddoc">
<p>Total wall time in seconds </p>
</td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a8cd56611f6cd8c71a991c9ed2b97ca29"></a>double</td>
<td class="fieldname">
stage1_time</td>
<td class="fielddoc">
<p>Wall time (in seconds) for stage 1 of <a class="el" href="a00100.html#a83b53dedf034d67bf2dde46eebf492ee">tridiagLU()</a> or <a class="el" href="a00100.html#ad2c404dd44e760ee729740176b186bd0">blocktridiagLU()</a> </p>
</td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="ab956b3ef566ffdd35d9ddc39c2662875"></a>double</td>
<td class="fieldname">
stage2_time</td>
<td class="fielddoc">
<p>Wall time (in seconds) for stage 2 of <a class="el" href="a00100.html#a83b53dedf034d67bf2dde46eebf492ee">tridiagLU()</a> or <a class="el" href="a00100.html#ad2c404dd44e760ee729740176b186bd0">blocktridiagLU()</a> </p>
</td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a45e5bf315927ed87c57bcf220ec49861"></a>double</td>
<td class="fieldname">
stage3_time</td>
<td class="fielddoc">
<p>Wall time (in seconds) for stage 3 of <a class="el" href="a00100.html#a83b53dedf034d67bf2dde46eebf492ee">tridiagLU()</a> or <a class="el" href="a00100.html#ad2c404dd44e760ee729740176b186bd0">blocktridiagLU()</a> </p>
</td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="ac7df4fddfc5aa2827b346dcfd80346fb"></a>double</td>
<td class="fieldname">
stage4_time</td>
<td class="fielddoc">
<p>Wall time (in seconds) for stage 4 of <a class="el" href="a00100.html#a83b53dedf034d67bf2dde46eebf492ee">tridiagLU()</a> or <a class="el" href="a00100.html#ad2c404dd44e760ee729740176b186bd0">blocktridiagLU()</a> </p>
</td></tr>
</table>

</div>
</div>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="a79ddfe354b89d113b72db4b5ae6c6e3d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define _TRIDIAG_JACOBI_&#160;&#160;&#160;&quot;jacobi&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Jacobi method </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="a00100.html#a1b0ccd6fb49ee8efe7c87a78e1bbe0ec">tridiagIterJacobi()</a>, <a class="el" href="a00100.html#a8c48f135943fe35da85072714d4b1b23">blocktridiagIterJacobi()</a> </dd></dl>

<p>Definition at line <a class="el" href="a00100_source.html#l00071">71</a> of file <a class="el" href="a00100_source.html">tridiagLU.h</a>.</p>

</div>
</div>
<a class="anchor" id="adf756eb923ab79f911e38a82da7a6cab"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define _TRIDIAG_GS_&#160;&#160;&#160;&quot;gather-and-solve&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>"Gather-and-solve" method </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="a00100.html#a3d43d79472727ef201c8a48f3073decd">tridiagLUGS</a> </dd></dl>

<p>Definition at line <a class="el" href="a00100_source.html#l00073">73</a> of file <a class="el" href="a00100_source.html">tridiagLU.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a83b53dedf034d67bf2dde46eebf492ee"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int tridiagLU </td>
          <td>(</td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ns</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>r</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>m</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Solve tridiagonal (non-periodic) systems of equations using parallel LU decomposition: This function can solve multiple independent systems with one call. The systems need not share the same left- or right-hand-sides. The iterative substructuring method is used in this function that can be briefly described through the following 4 stages:</p><ul>
<li>Stage 1: Parallel elimination of the tridiagonal blocks on each processor comprising all points of the subdomain except the 1st point (unless its the 1st global point, i.e., a physical boundary)</li>
<li>Stage 2: Elimination of the 1st row on each processor (except the 1st processor) using the last row of the previous processor.</li>
<li>Stage 3: Solution of the reduced tridiagonal system that represents the coupling of the system across the processors, using <a class="el" href="a00100.html#a8c48f135943fe35da85072714d4b1b23">blocktridiagIterJacobi()</a> in this implementation.</li>
<li>Stage 4: Backward-solve to obtain the final solution</li>
</ul>
<p>Specific details of the method implemented here are available in:</p><ul>
<li>Ghosh, D., Constantinescu, E. M., Brown, J., "Scalable Nonlinear Compact Schemes", Technical Memorandum, ANL/MCS-TM-340, Argonne National Laboratory, April 2014, (<a href="http://www.mcs.anl.gov/publication/scalable-nonlinear-compact-schemes">http://www.mcs.anl.gov/publication/scalable-nonlinear-compact-schemes</a>) (also available at <a href="http://debog.github.io/Files/2014_Ghosh_Consta_Brown_MCSTR340.pdf">http://debog.github.io/Files/2014_Ghosh_Consta_Brown_MCSTR340.pdf</a>).</li>
<li>Ghosh, D., Constantinescu, E. M., Brown, J., Efficient Implementation of Nonlinear Compact Schemes on Massively Parallel Platforms, SIAM Journal on Scientific Computing, 37 (3), 2015, C354–C383 (<a href="http://dx.doi.org/10.1137/140989261">http://dx.doi.org/10.1137/140989261</a>).</li>
</ul>
<p>More references on this class of parallel tridiagonal solvers:</p><ul>
<li>E. Polizzi and A. H. Sameh, "A parallel hybrid banded system solver: The SPIKE algorithm", Parallel Comput., 32 (2006), pp. 177–194.</li>
<li>E. Polizzi and A. H. Sameh, "SPIKE: A parallel environment for solving banded linear systems", Comput. &amp; Fluids, 36 (2007), pp. 113–120.</li>
</ul>
<p>Array layout: The arguments <em>a</em>, <em>b</em>, <em>c</em>, and <em>x</em> are local 1D arrays (containing this processor's part of the subdiagonal, diagonal, superdiagonal, and right-hand-side) of size (<em>n</em> X <em>ns</em>), where <em>n</em> is the local size of the system, and <em>ns</em> is the number of independent systems to solve. The ordering of the elements in these arrays is as follows:</p><ul>
<li>Elements of the same row for each of the independent systems are stored adjacent to each other.</li>
</ul>
<p>For example, consider the following systems: </p><p class="formulaDsp">
\begin{equation} \left[\begin{array}{ccccc} b_0^k &amp; c_0^k &amp; &amp; &amp; \\ a_1^k &amp; b_1^k &amp; c_1^k &amp; &amp; \\ &amp; a_2^k &amp; b_2^k &amp; c_2^k &amp; &amp; \\ &amp; &amp; a_3^k &amp; b_3^k &amp; c_3^k &amp; \\ &amp; &amp; &amp; a_4^k &amp; b_4^k &amp; c_4^k \\ \end{array}\right] \left[\begin{array}{c} x_0^k \\ x_1^k \\ x_2^k \\ x_3^k \\ x_4^k \end{array}\right] = \left[\begin{array}{c} r_0^k \\ r_1^k \\ r_2^k \\ r_3^k \\ r_4^k \end{array}\right]; \ \ k= 1,\cdots,ns \end{equation}
</p>
<p> and let \( ns = 3\). Note that in the code, \(x\) and \(r\) are the same array <em>x</em>.</p>
<p>Then, the array <em>b</em> must be a 1D array with the following layout of elements:<br />
[<br />
b_0^0, b_0^1, b_0^2, (diagonal element of the first row in each system) <br />
b_1^0, b_1^1, b_1^2, (diagonal element of the second row in each system) <br />
..., <br />
b_{n-1}^0, b_{n-1}^1, b_{n-1}^2 (diagonal element of the last row in each system) <br />
]<br />
The arrays <em>a</em>, <em>c</em>, and <em>x</em> are stored similarly.</p>
<p>Notes:</p><ul>
<li>This function does <em>not</em> preserve the sub-diagonal, diagonal, super-diagonal elements and the right-hand-sides.</li>
<li>The input array <em>x</em> contains the right-hand-side on entering the function, and the solution on exiting it. </li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">a</td><td>Array containing the sub-diagonal elements </td></tr>
    <tr><td class="paramname">b</td><td>Array containing the diagonal elements </td></tr>
    <tr><td class="paramname">c</td><td>Array containing the super-diagonal elements </td></tr>
    <tr><td class="paramname">x</td><td>Right-hand side; will contain the solution on exit </td></tr>
    <tr><td class="paramname">n</td><td>Local size of the system on this processor </td></tr>
    <tr><td class="paramname">ns</td><td>Number of systems to solve </td></tr>
    <tr><td class="paramname">r</td><td>Object of type <a class="el" href="a00100.html#a00408">TridiagLU</a> </td></tr>
    <tr><td class="paramname">m</td><td>MPI communicator </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00389_source.html#l00083">83</a> of file <a class="el" href="a00389_source.html">tridiagLU.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;{</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <a class="code" href="a00100.html#a00408">TridiagLU</a>       *params = (<a class="code" href="a00100.html#a00408">TridiagLU</a>*) r;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="keywordtype">int</span>             d,i,istart,iend;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  <span class="keywordtype">int</span>             rank,nproc;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="keyword">struct </span>timeval  start,stage1,stage2,stage3,stage4;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="preprocessor">#ifdef serial</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  rank  = 0;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  nproc = 1;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  MPI_Comm        *comm = (MPI_Comm*) m;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <span class="keywordtype">int</span>             ierr = 0;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span>       nvar = 4;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <span class="keywordflow">if</span> (comm) {</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    MPI_Comm_size(*comm,&amp;nproc);</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    MPI_Comm_rank(*comm,&amp;rank);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    rank  = 0;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    nproc = 1;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  }</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <span class="keywordflow">if</span> (!params) {</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    fprintf(stderr,<span class="stringliteral">&quot;Error in tridiagLU(): NULL pointer passed for parameters.\n&quot;</span>);</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  }</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  <span class="comment">/* start */</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  gettimeofday(&amp;start,NULL);</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  <span class="keywordflow">if</span> ((ns == 0) || (n == 0)) <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  <span class="keywordtype">double</span> *xs1, *xp1;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  xs1 = (<span class="keywordtype">double</span>*) calloc (ns, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  xp1 = (<span class="keywordtype">double</span>*) calloc (ns, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  <span class="keywordflow">for</span> (i=0; i&lt;ns; i++) xs1[i] = xp1[i] = 0;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  <span class="comment">/* Stage 1 - Parallel elimination of subdiagonal entries */</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  istart  = (rank == 0 ? 1 : 2);</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  iend    = n;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="keywordflow">for</span> (i = istart; i &lt; iend; i++) {</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="keywordflow">for</span> (d = 0; d &lt; ns; d++) {</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      <span class="keywordflow">if</span> (b[(i-1)*ns+d] == 0) <span class="keywordflow">return</span>(-1);</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;      <span class="keywordtype">double</span> factor = a[i*ns+d] / b[(i-1)*ns+d];</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;      b[i*ns+d] -=  factor * c[(i-1)*ns+d];</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;      a[i*ns+d]  = -factor * a[(i-1)*ns+d];</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;      x[i*ns+d] -=  factor * x[(i-1)*ns+d];</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;      <span class="keywordflow">if</span> (rank) {</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <span class="keywordtype">double</span> factor = c[d] / b[(i-1)*ns+d];</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        c[d]  = -factor * c[(i-1)*ns+d];</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        b[d] -=  factor * a[(i-1)*ns+d];</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        x[d] -=  factor * x[(i-1)*ns+d];</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;      }</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    }</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  }</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  <span class="comment">/* end of stage 1 */</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  gettimeofday(&amp;stage1,NULL);</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  <span class="comment">/* Stage 2 - Eliminate the first sub- &amp; super-diagonal entries */</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <span class="comment">/* This needs the last (a,b,c,x) from the previous process     */</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="preprocessor">#ifndef serial</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  <span class="keywordtype">double</span> *sendbuf, *recvbuf;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  sendbuf = (<span class="keywordtype">double</span>*) calloc (ns*nvar, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  recvbuf = (<span class="keywordtype">double</span>*) calloc (ns*nvar, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  <span class="keywordflow">for</span> (d=0; d&lt;ns; d++) {</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    sendbuf[d*nvar+0] = a[(n-1)*ns+d]; </div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    sendbuf[d*nvar+1] = b[(n-1)*ns+d]; </div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    sendbuf[d*nvar+2] = c[(n-1)*ns+d]; </div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    sendbuf[d*nvar+3] = x[(n-1)*ns+d];</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  }</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  <span class="keywordflow">if</span> (nproc &gt; 1) {</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    MPI_Request req[2] = {MPI_REQUEST_NULL,MPI_REQUEST_NULL};</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="keywordflow">if</span> (rank)             MPI_Irecv(recvbuf,nvar*ns,MPI_DOUBLE,rank-1,1436,*comm,&amp;req[0]);</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="keywordflow">if</span> (rank != nproc-1)  MPI_Isend(sendbuf,nvar*ns,MPI_DOUBLE,rank+1,1436,*comm,&amp;req[1]);</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    MPI_Waitall(2,&amp;req[0],MPI_STATUS_IGNORE);</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  }</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  <span class="comment">/* The first process sits this one out */</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  <span class="keywordflow">if</span> (rank) {</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="keywordflow">for</span> (d = 0; d &lt; ns; d++) {</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;      <span class="keywordtype">double</span> am1, bm1, cm1, xm1;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;      am1 = recvbuf[d*nvar+0]; </div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      bm1 = recvbuf[d*nvar+1]; </div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;      cm1 = recvbuf[d*nvar+2]; </div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;      xm1 = recvbuf[d*nvar+3];</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;      <span class="keywordtype">double</span> factor;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;      <span class="keywordflow">if</span> (bm1 == 0) <span class="keywordflow">return</span>(-1);</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;      factor =  a[d] / bm1;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;      b[d]  -=  factor * cm1;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      a[d]   = -factor * am1;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;      x[d]  -=  factor * xm1;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;      <span class="keywordflow">if</span> (b[(n-1)*ns+d] == 0) <span class="keywordflow">return</span>(-1);</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;      factor =  c[d] / b[(n-1)*ns+d];</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;      b[d]  -=  factor * a[(n-1)*ns+d];</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;      c[d]   = -factor * c[(n-1)*ns+d];</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;      x[d]  -=  factor * x[(n-1)*ns+d];</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    }</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  }</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  free(sendbuf);</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  free(recvbuf);</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  <span class="comment">/* end of stage 2 */</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  gettimeofday(&amp;stage2,NULL);</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  <span class="comment">/* Stage 3 - Solve the reduced (nproc-1) X (nproc-1) tridiagonal system   */</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="preprocessor">#ifndef serial</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  <span class="keywordflow">if</span> (nproc &gt; 1) {</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keywordtype">double</span> *zero, *one;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    zero = (<span class="keywordtype">double</span>*) calloc (ns, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    one  = (<span class="keywordtype">double</span>*) calloc (ns, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="keywordflow">for</span> (d=0; d&lt;ns; d++) {</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      zero[d] = 0.0;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;      one [d] = 1.0;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    }</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="keywordflow">if</span> (!strcmp(params-&gt;<a class="code" href="a00100.html#ae50ec60868beaab2cb84897adefda09f">reducedsolvetype</a>,<a class="code" href="a00100.html#adf756eb923ab79f911e38a82da7a6cab">_TRIDIAG_GS_</a>)) {</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      <span class="comment">/* Solving the reduced system by gather-and-solve algorithm */</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;      <span class="keywordflow">if</span> (rank) ierr = <a class="code" href="a00100.html#a3d43d79472727ef201c8a48f3073decd">tridiagLUGS</a>(a,b,c,x,1,ns,params,comm);</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;      <span class="keywordflow">else</span>      ierr = <a class="code" href="a00100.html#a3d43d79472727ef201c8a48f3073decd">tridiagLUGS</a>(zero,one,zero,zero,1,ns,params,comm);</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      <span class="keywordflow">if</span> (ierr) <span class="keywordflow">return</span>(ierr);</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(params-&gt;<a class="code" href="a00100.html#ae50ec60868beaab2cb84897adefda09f">reducedsolvetype</a>,<a class="code" href="a00100.html#a79ddfe354b89d113b72db4b5ae6c6e3d">_TRIDIAG_JACOBI_</a>)) {</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;      <span class="comment">/* Solving the reduced system iteratively with the Jacobi method */</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      <span class="keywordflow">if</span> (rank) ierr = <a class="code" href="a00100.html#a1b0ccd6fb49ee8efe7c87a78e1bbe0ec">tridiagIterJacobi</a>(a,b,c,x,1,ns,params,comm);</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      <span class="keywordflow">else</span>      ierr = <a class="code" href="a00100.html#a1b0ccd6fb49ee8efe7c87a78e1bbe0ec">tridiagIterJacobi</a>(zero,one,zero,zero,1,ns,params,comm);</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    }</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    free(zero);</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    free(one);</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="comment">/* Each process, get the first x of the next process */</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    MPI_Request req[2] = {MPI_REQUEST_NULL,MPI_REQUEST_NULL};</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="keywordflow">for</span> (d=0; d&lt;ns; d++)  xs1[d] = x[d];</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="keywordflow">if</span> (rank+1 &lt; nproc) MPI_Irecv(xp1,ns,MPI_DOUBLE,rank+1,1323,*comm,&amp;req[0]);</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="keywordflow">if</span> (rank)           MPI_Isend(xs1,ns,MPI_DOUBLE,rank-1,1323,*comm,&amp;req[1]);</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    MPI_Waitall(2,&amp;req[0],MPI_STATUS_IGNORE);</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  }</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  <span class="keywordflow">if</span> (nproc &gt; 1) {</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    fprintf(stderr,<span class="stringliteral">&quot;Error: nproc &gt; 1 for a serial run!\n&quot;</span>);</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  }</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* if not serial */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  <span class="comment">/* end of stage 3 */</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  gettimeofday(&amp;stage3,NULL);</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <span class="comment">/* Stage 4 - Parallel back-substitution to get the solution  */</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  istart = n-1;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  iend   = (rank == 0 ? 0 : 1);</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  <span class="keywordflow">for</span> (d = 0; d &lt; ns; d++) {</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="keywordflow">if</span> (b[istart*ns+d] == 0) <span class="keywordflow">return</span>(-1);</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    x[istart*ns+d] = (x[istart*ns+d]-a[istart*ns+d]*x[d]-c[istart*ns+d]*xp1[d]) / b[istart*ns+d];</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  }</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="keywordflow">for</span> (i = istart-1; i &gt; iend-1; i--) {</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <span class="keywordflow">for</span> (d = 0; d &lt; ns; d++) {</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;      <span class="keywordflow">if</span> (b[i*ns+d] == 0) <span class="keywordflow">return</span>(-1);</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      x[i*ns+d] = (x[i*ns+d]-c[i*ns+d]*x[(i+1)*ns+d]-a[i*ns+d]*x[d]) / b[i*ns+d];</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    }</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  }</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  <span class="comment">/* end of stage 4 */</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  gettimeofday(&amp;stage4,NULL);</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  <span class="comment">/* Done - now x contains the solution */</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  free(xs1);</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  free(xp1);</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  <span class="comment">/* save runtimes if needed */</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span> walltime;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  walltime = ((stage1.tv_sec * 1000000 + stage1.tv_usec) - (start.tv_sec * 1000000 + start.tv_usec));</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  params-&gt;<a class="code" href="a00100.html#a8cd56611f6cd8c71a991c9ed2b97ca29">stage1_time</a> = (double) walltime / 1000000.0;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  walltime = ((stage2.tv_sec * 1000000 + stage2.tv_usec) - (stage1.tv_sec * 1000000 + stage1.tv_usec));</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  params-&gt;<a class="code" href="a00100.html#ab956b3ef566ffdd35d9ddc39c2662875">stage2_time</a> = (double) walltime / 1000000.0;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  walltime = ((stage3.tv_sec * 1000000 + stage3.tv_usec) - (stage2.tv_sec * 1000000 + stage2.tv_usec));</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  params-&gt;<a class="code" href="a00100.html#a45e5bf315927ed87c57bcf220ec49861">stage3_time</a> = (double) walltime / 1000000.0;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  walltime = ((stage4.tv_sec * 1000000 + stage4.tv_usec) - (stage3.tv_sec * 1000000 + stage3.tv_usec));</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  params-&gt;<a class="code" href="a00100.html#ac7df4fddfc5aa2827b346dcfd80346fb">stage4_time</a> = (double) walltime / 1000000.0;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  walltime = ((stage4.tv_sec * 1000000 + stage4.tv_usec) - (start.tv_sec * 1000000 + start.tv_usec));</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  params-&gt;<a class="code" href="a00100.html#abc276e47b85df9dd59f248e663b3b971">total_time</a> = (double) walltime / 1000000.0;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;}</div>
<div class="ttc" id="a00100_html_adf756eb923ab79f911e38a82da7a6cab"><div class="ttname"><a href="a00100.html#adf756eb923ab79f911e38a82da7a6cab">_TRIDIAG_GS_</a></div><div class="ttdeci">#define _TRIDIAG_GS_</div><div class="ttdef"><b>Definition:</b> <a href="a00100_source.html#l00073">tridiagLU.h:73</a></div></div>
<div class="ttc" id="a00100_html_ab956b3ef566ffdd35d9ddc39c2662875"><div class="ttname"><a href="a00100.html#ab956b3ef566ffdd35d9ddc39c2662875">TridiagLU::stage2_time</a></div><div class="ttdeci">double stage2_time</div><div class="ttdef"><b>Definition:</b> <a href="a00100_source.html#l00100">tridiagLU.h:100</a></div></div>
<div class="ttc" id="a00100_html_a45e5bf315927ed87c57bcf220ec49861"><div class="ttname"><a href="a00100.html#a45e5bf315927ed87c57bcf220ec49861">TridiagLU::stage3_time</a></div><div class="ttdeci">double stage3_time</div><div class="ttdef"><b>Definition:</b> <a href="a00100_source.html#l00101">tridiagLU.h:101</a></div></div>
<div class="ttc" id="a00100_html_ac7df4fddfc5aa2827b346dcfd80346fb"><div class="ttname"><a href="a00100.html#ac7df4fddfc5aa2827b346dcfd80346fb">TridiagLU::stage4_time</a></div><div class="ttdeci">double stage4_time</div><div class="ttdef"><b>Definition:</b> <a href="a00100_source.html#l00102">tridiagLU.h:102</a></div></div>
<div class="ttc" id="a00100_html_a3d43d79472727ef201c8a48f3073decd"><div class="ttname"><a href="a00100.html#a3d43d79472727ef201c8a48f3073decd">tridiagLUGS</a></div><div class="ttdeci">int tridiagLUGS(double *, double *, double *, double *, int, int, void *, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00390_source.html#l00064">tridiagLUGS.c:64</a></div></div>
<div class="ttc" id="a00100_html_a1b0ccd6fb49ee8efe7c87a78e1bbe0ec"><div class="ttname"><a href="a00100.html#a1b0ccd6fb49ee8efe7c87a78e1bbe0ec">tridiagIterJacobi</a></div><div class="ttdeci">int tridiagIterJacobi(double *, double *, double *, double *, int, int, void *, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00388_source.html#l00064">tridiagIterJacobi.c:64</a></div></div>
<div class="ttc" id="a00100_html_a79ddfe354b89d113b72db4b5ae6c6e3d"><div class="ttname"><a href="a00100.html#a79ddfe354b89d113b72db4b5ae6c6e3d">_TRIDIAG_JACOBI_</a></div><div class="ttdeci">#define _TRIDIAG_JACOBI_</div><div class="ttdef"><b>Definition:</b> <a href="a00100_source.html#l00071">tridiagLU.h:71</a></div></div>
<div class="ttc" id="a00100_html_ae50ec60868beaab2cb84897adefda09f"><div class="ttname"><a href="a00100.html#ae50ec60868beaab2cb84897adefda09f">TridiagLU::reducedsolvetype</a></div><div class="ttdeci">char reducedsolvetype[50]</div><div class="ttdef"><b>Definition:</b> <a href="a00100_source.html#l00088">tridiagLU.h:88</a></div></div>
<div class="ttc" id="a00100_html_a00408"><div class="ttname"><a href="a00100.html#a00408">TridiagLU</a></div><div class="ttdef"><b>Definition:</b> <a href="a00100_source.html#l00081">tridiagLU.h:81</a></div></div>
<div class="ttc" id="a00100_html_abc276e47b85df9dd59f248e663b3b971"><div class="ttname"><a href="a00100.html#abc276e47b85df9dd59f248e663b3b971">TridiagLU::total_time</a></div><div class="ttdeci">double total_time</div><div class="ttdef"><b>Definition:</b> <a href="a00100_source.html#l00098">tridiagLU.h:98</a></div></div>
<div class="ttc" id="a00100_html_a8cd56611f6cd8c71a991c9ed2b97ca29"><div class="ttname"><a href="a00100.html#a8cd56611f6cd8c71a991c9ed2b97ca29">TridiagLU::stage1_time</a></div><div class="ttdeci">double stage1_time</div><div class="ttdef"><b>Definition:</b> <a href="a00100_source.html#l00099">tridiagLU.h:99</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3d43d79472727ef201c8a48f3073decd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int tridiagLUGS </td>
          <td>(</td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ns</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>r</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>m</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Solve tridiagonal (non-periodic) systems of equations using the gather-and-solve approach: This function can solve multiple independent systems with one call. The systems need not share the same left- or right-hand-sides. The "gather-and-solve" approach gathers a tridiagonal system on one processor and solves it using <a class="el" href="a00100.html#a83b53dedf034d67bf2dde46eebf492ee">tridiagLU()</a> (sending NULL as the argument for MPI communicator to indicate that a serial solution is desired). Given multiple tridiagonal systems (<em>ns</em> &gt; 1), this function will gather the systems on different processors in an optimal way, and thus each processor will solve some of the systems. After the system(s) is (are) solved, the solution(s) is (are) scattered back to the original processors.</p>
<p>Array layout: The arguments <em>a</em>, <em>b</em>, <em>c</em>, and <em>x</em> are local 1D arrays (containing this processor's part of the subdiagonal, diagonal, superdiagonal, and right-hand-side) of size (<em>n</em> X <em>ns</em>), where <em>n</em> is the local size of the system, and <em>ns</em> is the number of independent systems to solve. The ordering of the elements in these arrays is as follows:</p><ul>
<li>Elements of the same row for each of the independent systems are stored adjacent to each other.</li>
</ul>
<p>For example, consider the following systems: </p><p class="formulaDsp">
\begin{equation} \left[\begin{array}{ccccc} b_0^k &amp; c_0^k &amp; &amp; &amp; \\ a_1^k &amp; b_1^k &amp; c_1^k &amp; &amp; \\ &amp; a_2^k &amp; b_2^k &amp; c_2^k &amp; &amp; \\ &amp; &amp; a_3^k &amp; b_3^k &amp; c_3^k &amp; \\ &amp; &amp; &amp; a_4^k &amp; b_4^k &amp; c_4^k \\ \end{array}\right] \left[\begin{array}{c} x_0^k \\ x_1^k \\ x_2^k \\ x_3^k \\ x_4^k \end{array}\right] = \left[\begin{array}{c} r_0^k \\ r_1^k \\ r_2^k \\ r_3^k \\ r_4^k \end{array}\right]; \ \ k= 1,\cdots,ns \end{equation}
</p>
<p> and let \( ns = 3\). Note that in the code, \(x\) and \(r\) are the same array <em>x</em>.</p>
<p>Then, the array <em>b</em> must be a 1D array with the following layout of elements:<br />
[<br />
b_0^0, b_0^1, b_0^2, (diagonal element of the first row in each system) <br />
b_1^0, b_1^1, b_1^2, (diagonal element of the second row in each system) <br />
..., <br />
b_{n-1}^0, b_{n-1}^1, b_{n-1}^2 (diagonal element of the last row in each system) <br />
]<br />
The arrays <em>a</em>, <em>c</em>, and <em>x</em> are stored similarly.</p>
<p>Notes:</p><ul>
<li>This function does <em>not</em> preserve the sub-diagonal, diagonal, super-diagonal elements and the right-hand-sides.</li>
<li>The input array <em>x</em> contains the right-hand-side on entering the function, and the solution on exiting it. </li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">a</td><td>Array containing the sub-diagonal elements </td></tr>
    <tr><td class="paramname">b</td><td>Array containing the diagonal elements </td></tr>
    <tr><td class="paramname">c</td><td>Array containing the super-diagonal elements </td></tr>
    <tr><td class="paramname">x</td><td>Right-hand side; will contain the solution on exit </td></tr>
    <tr><td class="paramname">n</td><td>Local size of the system on this processor </td></tr>
    <tr><td class="paramname">ns</td><td>Number of systems to solve </td></tr>
    <tr><td class="paramname">r</td><td>Object of type <a class="el" href="a00100.html#a00408">TridiagLU</a> </td></tr>
    <tr><td class="paramname">m</td><td>MPI communicator </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00390_source.html#l00064">64</a> of file <a class="el" href="a00390_source.html">tridiagLUGS.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;{</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  <a class="code" href="a00100.html#a00408">TridiagLU</a> *context = (<a class="code" href="a00100.html#a00408">TridiagLU</a>*) r;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  <span class="keywordflow">if</span> (!context) {</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    fprintf(stderr,<span class="stringliteral">&quot;Error in tridiagLUGS(): NULL pointer passed for parameters.\n&quot;</span>);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keywordflow">return</span>(-1);</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  }</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="preprocessor">#ifdef serial</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <span class="comment">/* Serial compilation */</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <span class="keywordflow">return</span>(<a class="code" href="a00100.html#a83b53dedf034d67bf2dde46eebf492ee">tridiagLU</a>(a,b,c,x,n,ns,context,m));</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <span class="keywordtype">int</span>         d,i,ierr = 0,dstart,istart,p,q;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span>   nvar = 4;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <span class="keywordtype">double</span>      *sendbuf,*recvbuf;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <span class="keywordtype">int</span>         rank,nproc;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <span class="comment">/* Parallel compilation */</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  MPI_Comm  *comm = (MPI_Comm*) m;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <span class="keywordflow">if</span> (!comm) <span class="keywordflow">return</span>(<a class="code" href="a00100.html#a83b53dedf034d67bf2dde46eebf492ee">tridiagLU</a>(a,b,c,x,n,ns,context,NULL));</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  MPI_Comm_size(*comm,&amp;nproc);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  MPI_Comm_rank(*comm,&amp;rank);</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <span class="keywordflow">if</span> ((ns == 0) || (n == 0)) <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <span class="comment">/* </span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">    each process needs to know the local sizes of every other process </span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">    and total size of the system</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">  */</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <span class="keywordtype">int</span> *N = (<span class="keywordtype">int</span>*) calloc (nproc, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  MPI_Allgather(&amp;n,1,MPI_INT,N,1,MPI_INT,*comm);</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  <span class="keywordtype">int</span> NT = 0; <span class="keywordflow">for</span> (i=0; i&lt;nproc; i++) NT += N[i];</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  <span class="comment">/* counts and displacements for gather and scatter operations */</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  <span class="keywordtype">int</span> *counts = (<span class="keywordtype">int</span>*) calloc (nproc, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  <span class="keywordtype">int</span> *displ  = (<span class="keywordtype">int</span>*) calloc (nproc, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  <span class="comment">/* on all processes, calculate the number of systems each     */</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  <span class="comment">/* process has to solve                                       */</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  <span class="keywordtype">int</span> *ns_local = (<span class="keywordtype">int</span>*) calloc (nproc,<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  <span class="keywordflow">for</span> (p=0; p&lt;nproc; p++)    ns_local[p] = ns / nproc; </div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <span class="keywordflow">for</span> (p=0; p&lt;ns%nproc; p++) ns_local[p]++;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <span class="comment">/* allocate the arrays for the gathered tridiagonal systems */</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  <span class="keywordtype">double</span> *ra=NULL,*rb=NULL,*rc=NULL,*rx=NULL; </div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="keywordflow">if</span> (ns_local[rank] &gt; 0) {</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    ra = (<span class="keywordtype">double</span>*) calloc (ns_local[rank]*NT,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    rb = (<span class="keywordtype">double</span>*) calloc (ns_local[rank]*NT,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    rc = (<span class="keywordtype">double</span>*) calloc (ns_local[rank]*NT,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    rx = (<span class="keywordtype">double</span>*) calloc (ns_local[rank]*NT,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  }</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <span class="comment">/* Gather the systems on each process */</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  <span class="comment">/* allocate receive buffer */</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  <span class="keywordflow">if</span> (ns_local[rank] &gt; 0) </div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    recvbuf = (<span class="keywordtype">double</span>*) calloc (ns_local[rank]*nvar*NT,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <span class="keywordflow">else</span> recvbuf = NULL;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  dstart = 0;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="keywordflow">for</span> (p = 0; p &lt; nproc; p++) {</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="keywordflow">if</span> (ns_local[p] &gt; 0) {</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      <span class="comment">/* allocate send buffer and form the send packet of data */</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;      sendbuf = (<span class="keywordtype">double</span>*) calloc (nvar*n*ns_local[p],<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;      <span class="keywordflow">for</span> (d = 0; d &lt; ns_local[p]; d++) {</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        <span class="keywordflow">for</span> (i = 0; i &lt; n; i++) {</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;          sendbuf[n*nvar*d+n*0+i] = a[d+dstart+ns*i];</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;          sendbuf[n*nvar*d+n*1+i] = b[d+dstart+ns*i];</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;          sendbuf[n*nvar*d+n*2+i] = c[d+dstart+ns*i];</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;          sendbuf[n*nvar*d+n*3+i] = x[d+dstart+ns*i];</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        }</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;      }</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;      dstart += ns_local[p];</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;      <span class="comment">/* gather these reduced systems on process with rank = p */</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;      <span class="keywordflow">if</span> (rank == p) {</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        <span class="keywordflow">for</span> (q = 0; q &lt; nproc; q++) {</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;          counts[q] = nvar*N[q]*ns_local[p];</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;          displ [q] = (q == 0 ? 0 : displ[q-1]+counts[q-1]);</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        }</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;      }</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;      MPI_Gatherv(sendbuf,nvar*n*ns_local[p],MPI_DOUBLE,</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                  recvbuf,counts,displ,MPI_DOUBLE,p,*comm);</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;      <span class="comment">/* deallocate send buffer */</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;      free(sendbuf);</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    }</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  }</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  <span class="comment">/* extract the data from the recvbuf and solve */</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  istart = 0;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <span class="keywordflow">for</span> (q = 0; q &lt; nproc; q++) {</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="keywordflow">for</span> (d = 0; d &lt; ns_local[rank]; d++) {</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      <span class="keywordflow">for</span> (i = 0; i &lt; N[q]; i++) {</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        ra[d+ns_local[rank]*(istart+i)] = recvbuf[istart*nvar*ns_local[rank]+d*nvar*N[q]+0*N[q]+i];</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        rb[d+ns_local[rank]*(istart+i)] = recvbuf[istart*nvar*ns_local[rank]+d*nvar*N[q]+1*N[q]+i];</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        rc[d+ns_local[rank]*(istart+i)] = recvbuf[istart*nvar*ns_local[rank]+d*nvar*N[q]+2*N[q]+i];</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        rx[d+ns_local[rank]*(istart+i)] = recvbuf[istart*nvar*ns_local[rank]+d*nvar*N[q]+3*N[q]+i];</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;      }</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    }</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    istart += N[q];</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  }</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  <span class="comment">/* deallocate receive buffer */</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  <span class="keywordflow">if</span> (recvbuf)  free(recvbuf);</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  <span class="comment">/* solve the gathered systems in serial */</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  ierr = <a class="code" href="a00100.html#a83b53dedf034d67bf2dde46eebf492ee">tridiagLU</a>(ra,rb,rc,rx,NT,ns_local[rank],context,NULL);</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  <span class="keywordflow">if</span> (ierr) <span class="keywordflow">return</span>(ierr);</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  <span class="comment">/* allocate send buffer and save the data to send */</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  <span class="keywordflow">if</span> (ns_local[rank] &gt; 0)</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    sendbuf = (<span class="keywordtype">double</span>*) calloc (ns_local[rank]*NT,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  <span class="keywordflow">else</span> sendbuf = NULL;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  istart = 0;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  <span class="keywordflow">for</span> (q = 0; q &lt; nproc; q++) {</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; N[q]; i++) {</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;      <span class="keywordflow">for</span> (d = 0; d &lt; ns_local[rank]; d++) {</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        sendbuf[istart*ns_local[rank]+d*N[q]+i] = rx[d+ns_local[rank]*(istart+i)];</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      }</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    }</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    istart += N[q];</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  }</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  dstart = 0;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  <span class="keywordflow">for</span> (p = 0; p &lt; nproc; p++) {</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keywordflow">if</span> (ns_local[p] &gt; 0) {</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;      <span class="comment">/* allocate receive buffer */</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;      recvbuf = (<span class="keywordtype">double</span>*) calloc (ns_local[p]*n, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;      <span class="comment">/* scatter the solution back */</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      <span class="keywordflow">for</span> (q = 0; q &lt; nproc; q++) {</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        counts[q] = ns_local[p]*N[q];</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        displ[q]  = (q == 0 ? 0 : displ[q-1]+counts[q-1]);</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      }</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;      MPI_Scatterv(sendbuf,counts,displ,MPI_DOUBLE,</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                   recvbuf,ns_local[p]*n,MPI_DOUBLE,</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                   p,*comm);</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      <span class="comment">/* save the solution on all root processes */</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;      <span class="keywordflow">for</span> (d = 0; d &lt; ns_local[p]; d++) {</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        <span class="keywordflow">for</span> (i = 0; i &lt; n; i++) {</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;          x[d+dstart+ns*i] = recvbuf[d*n+i];</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        }</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;      }</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      dstart += ns_local[p];</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      <span class="comment">/* deallocate receive buffer */</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      free(recvbuf);</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    }</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  }</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  <span class="comment">/* deallocate send buffer */</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  <span class="keywordflow">if</span> (sendbuf) free(sendbuf);</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  <span class="comment">/* clean up */</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  <span class="keywordflow">if</span> (ns_local[rank] &gt; 0) {</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    free(ra);</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    free(rb);</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    free(rc);</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    free(rx);</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  }</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  free(ns_local);</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  free(N);</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  free(displ);</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  free(counts);</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;}</div>
<div class="ttc" id="a00100_html_a83b53dedf034d67bf2dde46eebf492ee"><div class="ttname"><a href="a00100.html#a83b53dedf034d67bf2dde46eebf492ee">tridiagLU</a></div><div class="ttdeci">int tridiagLU(double *, double *, double *, double *, int, int, void *, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00389_source.html#l00083">tridiagLU.c:83</a></div></div>
<div class="ttc" id="a00100_html_a00408"><div class="ttname"><a href="a00100.html#a00408">TridiagLU</a></div><div class="ttdef"><b>Definition:</b> <a href="a00100_source.html#l00081">tridiagLU.h:81</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a1b0ccd6fb49ee8efe7c87a78e1bbe0ec"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int tridiagIterJacobi </td>
          <td>(</td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ns</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>r</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>m</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Solve tridiagonal (non-periodic) systems of equations using point Jacobi iterations: This function can solve multiple independent systems with one call. The systems need not share the same left- or right-hand-sides. The initial guess is taken as the solution of </p><p class="formulaDsp">
\begin{equation} {\rm diag}\left[{\bf b}\right]{\bf x} = {\bf r} \end{equation}
</p>
<p> where \({\bf b}\) represents the diagonal elements of the tridiagonal system, and \({\bf r}\) is the right-hand-side, stored in \({\bf x}\) at the start of this function.</p>
<p>Array layout: The arguments <em>a</em>, <em>b</em>, <em>c</em>, and <em>x</em> are local 1D arrays (containing this processor's part of the subdiagonal, diagonal, superdiagonal, and right-hand-side) of size (<em>n</em> X <em>ns</em>), where <em>n</em> is the local size of the system, and <em>ns</em> is the number of independent systems to solve. The ordering of the elements in these arrays is as follows:</p><ul>
<li>Elements of the same row for each of the independent systems are stored adjacent to each other.</li>
</ul>
<p>For example, consider the following systems: </p><p class="formulaDsp">
\begin{equation} \left[\begin{array}{ccccc} b_0^k &amp; c_0^k &amp; &amp; &amp; \\ a_1^k &amp; b_1^k &amp; c_1^k &amp; &amp; \\ &amp; a_2^k &amp; b_2^k &amp; c_2^k &amp; &amp; \\ &amp; &amp; a_3^k &amp; b_3^k &amp; c_3^k &amp; \\ &amp; &amp; &amp; a_4^k &amp; b_4^k &amp; c_4^k \\ \end{array}\right] \left[\begin{array}{c} x_0^k \\ x_1^k \\ x_2^k \\ x_3^k \\ x_4^k \end{array}\right] = \left[\begin{array}{c} r_0^k \\ r_1^k \\ r_2^k \\ r_3^k \\ r_4^k \end{array}\right]; \ \ k= 1,\cdots,ns \end{equation}
</p>
<p> and let \( ns = 3\). Note that in the code, \(x\) and \(r\) are the same array <em>x</em>.</p>
<p>Then, the array <em>b</em> must be a 1D array with the following layout of elements:<br />
[<br />
b_0^0, b_0^1, b_0^2, (diagonal element of the first row in each system) <br />
b_1^0, b_1^1, b_1^2, (diagonal element of the second row in each system) <br />
..., <br />
b_{n-1}^0, b_{n-1}^1, b_{n-1}^2 (diagonal element of the last row in each system) <br />
]<br />
The arrays <em>a</em>, <em>c</em>, and <em>x</em> are stored similarly.</p>
<p>Notes:</p><ul>
<li>This function does <em>not</em> preserve the sub-diagonal, diagonal, super-diagonal elements and the right-hand-sides.</li>
<li>The input array <em>x</em> contains the right-hand-side on entering the function, and the solution on exiting it. </li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">a</td><td>Array containing the sub-diagonal elements </td></tr>
    <tr><td class="paramname">b</td><td>Array containing the diagonal elements </td></tr>
    <tr><td class="paramname">c</td><td>Array containing the super-diagonal elements </td></tr>
    <tr><td class="paramname">x</td><td>Right-hand side; will contain the solution on exit </td></tr>
    <tr><td class="paramname">n</td><td>Local size of the system on this processor </td></tr>
    <tr><td class="paramname">ns</td><td>Number of systems to solve </td></tr>
    <tr><td class="paramname">r</td><td>Object of type <a class="el" href="a00100.html#a00408">TridiagLU</a> </td></tr>
    <tr><td class="paramname">m</td><td>MPI communicator </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00388_source.html#l00064">64</a> of file <a class="el" href="a00388_source.html">tridiagIterJacobi.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;{</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  <a class="code" href="a00100.html#a00408">TridiagLU</a>  *context = (<a class="code" href="a00100.html#a00408">TridiagLU</a>*) r;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  <span class="keywordtype">int</span>        iter,d,i,NT;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  <span class="keywordtype">double</span>     norm=0,norm0=0,global_norm=0;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="preprocessor">#ifndef serial</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  MPI_Comm  *comm = (MPI_Comm*) m;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <span class="keywordtype">int</span>       rank,nproc;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <span class="keywordflow">if</span> (comm) {</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    MPI_Comm_size(*comm,&amp;nproc);</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    MPI_Comm_rank(*comm,&amp;rank);</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    rank  = 0;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    nproc = 1;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  }</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <span class="keywordflow">if</span> (!context) {</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    fprintf(stderr,<span class="stringliteral">&quot;Error in tridiagIterJacobi(): NULL pointer passed for parameters!\n&quot;</span>);</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="keywordflow">return</span>(-1);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  }</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="comment">/* check for zero along the diagonal */</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <span class="keywordflow">for</span> (i=0; i&lt;n; i++) {</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="keywordflow">for</span> (d=0; d&lt;ns; d++) {</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;      <span class="keywordflow">if</span> (b[i*ns+d]*b[i*ns+d] &lt; context-&gt;<a class="code" href="a00100.html#a60c6dfc476dd9596072f61c2ec8d58ed">atol</a>*context-&gt;<a class="code" href="a00100.html#a60c6dfc476dd9596072f61c2ec8d58ed">atol</a>) {</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        fprintf(stderr,<span class="stringliteral">&quot;Error in tridiagIterJacobi(): Encountered zero on main diagonal!\n&quot;</span>);</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;      }</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    }</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  }</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <span class="keywordtype">double</span> *rhs = (<span class="keywordtype">double</span>*) calloc (ns*n, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  <span class="keywordflow">for</span> (i=0; i&lt;n; i++) {</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="keywordflow">for</span> (d=0; d&lt;ns; d++) {</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;      rhs[i*ns+d] = x[i*ns+d]; <span class="comment">/* save a copy of the rhs */</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;      x[i*ns+d]  /= b[i*ns+d]; <span class="comment">/* initial guess          */</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    }</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  }</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  <span class="keywordtype">double</span> *recvbufL, *recvbufR, *sendbufL, *sendbufR;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  recvbufL = (<span class="keywordtype">double</span>*) calloc (ns, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  recvbufR = (<span class="keywordtype">double</span>*) calloc (ns, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  sendbufL = (<span class="keywordtype">double</span>*) calloc (ns, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  sendbufR = (<span class="keywordtype">double</span>*) calloc (ns, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  <span class="comment">/* total number of points */</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="preprocessor">#ifdef serial</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00100.html#a584c0fc0b1e845800ad511dffc60e032">evaluate_norm</a>)    NT = n;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  <span class="keywordflow">else</span>                           NT = 0;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00100.html#a584c0fc0b1e845800ad511dffc60e032">evaluate_norm</a>) MPI_Allreduce(&amp;n,&amp;NT,1,MPI_INT,MPI_SUM,*comm);</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <span class="keywordflow">else</span> NT = 0;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="preprocessor">#ifdef serial</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00100.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00100.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> &amp;&amp; (!rank)) printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  iter = 0;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <span class="keywordflow">while</span>(1) {</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="comment">/* evaluate break conditions */</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="keywordflow">if</span> (    (iter &gt;= context-&gt;<a class="code" href="a00100.html#a274519264a28477940f161ddb4b61feb">maxiter</a>) </div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        ||  (iter &amp;&amp; context-&gt;<a class="code" href="a00100.html#a584c0fc0b1e845800ad511dffc60e032">evaluate_norm</a> &amp;&amp; (global_norm &lt; context-&gt;atol)) </div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        ||  (iter &amp;&amp; context-&gt;<a class="code" href="a00100.html#a584c0fc0b1e845800ad511dffc60e032">evaluate_norm</a> &amp;&amp; (global_norm/norm0 &lt; context-&gt;rtol))  ) {</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    }</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="comment">/* Communicate the boundary x values between processors */</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="keywordflow">for</span> (d=0; d&lt;ns; d++)  recvbufL[d] = recvbufR[d] = 0;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="preprocessor">#ifndef serial</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    MPI_Request req[4] =  {MPI_REQUEST_NULL,MPI_REQUEST_NULL,MPI_REQUEST_NULL,MPI_REQUEST_NULL};</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="keywordflow">if</span> (rank)             MPI_Irecv(recvbufL,ns,MPI_DOUBLE,rank-1,2,*comm,&amp;req[0]);</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="keywordflow">if</span> (rank != nproc-1)  MPI_Irecv(recvbufR,ns,MPI_DOUBLE,rank+1,3,*comm,&amp;req[1]);</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="keywordflow">for</span> (d=0; d&lt;ns; d++)  { sendbufL[d] = x[d]; sendbufR[d] = x[(n-1)*ns+d]; }</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="keywordflow">if</span> (rank)             MPI_Isend(sendbufL,ns,MPI_DOUBLE,rank-1,3,*comm,&amp;req[2]);</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="keywordflow">if</span> (rank != nproc-1)  MPI_Isend(sendbufR,ns,MPI_DOUBLE,rank+1,2,*comm,&amp;req[3]);</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="comment">/* calculate error norm - interior */</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00100.html#a584c0fc0b1e845800ad511dffc60e032">evaluate_norm</a>) {</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      norm = 0;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;      <span class="keywordflow">for</span> (i=1; i&lt;n-1; i++) {</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <span class="keywordflow">for</span> (d=0; d&lt;ns; d++) {</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;          norm  += ( (a[i*ns+d]*x[(i-1)*ns+d] + b[i*ns+d]*x[i*ns+d] + c[i*ns+d]*x[(i+1)*ns+d] - rhs[i*ns+d])</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                   * (a[i*ns+d]*x[(i-1)*ns+d] + b[i*ns+d]*x[i*ns+d] + c[i*ns+d]*x[(i+1)*ns+d] - rhs[i*ns+d]) );</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        }</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      }</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    }</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="comment">/* calculate error norm - boundary */</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="preprocessor">#ifndef serial</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    MPI_Waitall(4,req,MPI_STATUS_IGNORE);</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00100.html#a584c0fc0b1e845800ad511dffc60e032">evaluate_norm</a>) {</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;      <span class="keywordflow">if</span> (n &gt; 1) {</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        <span class="keywordflow">for</span> (d=0; d&lt;ns; d++) {</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;          norm  += ( (a[d]*recvbufL[d] + b[d]*x[d] + c[d]*x[d+ns*1]- rhs[d])</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                   * (a[d]*recvbufL[d] + b[d]*x[d] + c[d]*x[d+ns*1]- rhs[d]) );</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        }</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        <span class="keywordflow">for</span> (d=0; d&lt;ns; d++) {</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;          norm  += ( (a[d+ns*(n-1)]*x[d+ns*(n-2)] + b[d+ns*(n-1)]*x[d+ns*(n-1)] + c[d+ns*(n-1)]*recvbufR[d] - rhs[d+ns*(n-1)])</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                   * (a[d+ns*(n-1)]*x[d+ns*(n-2)] + b[d+ns*(n-1)]*x[d+ns*(n-1)] + c[d+ns*(n-1)]*recvbufR[d] - rhs[d+ns*(n-1)]) );</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        }</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <span class="keywordflow">for</span> (d=0; d&lt;ns; d++) {</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;          norm  += ( (a[d]*recvbufL[d] + b[d]*x[d] + c[d]*recvbufR[d] - rhs[d])</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                   * (a[d]*recvbufL[d] + b[d]*x[d] + c[d]*recvbufR[d] - rhs[d]) );</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        }</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;      }</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;      <span class="comment">/* sum over all processes */</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="preprocessor">#ifdef serial</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;      global_norm = norm;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      MPI_Allreduce(&amp;norm,&amp;global_norm,1,MPI_DOUBLE,MPI_SUM,*comm);</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;      global_norm = sqrt(global_norm/NT);</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      <span class="keywordflow">if</span> (!iter) norm0 = global_norm;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;      norm = -1.0;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      global_norm = -1.0;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    }</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="preprocessor">#ifdef serial</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00100.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00100.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> &amp;&amp; (!rank))</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      printf(<span class="stringliteral">&quot;\t\titer: %d, norm: %1.16E\n&quot;</span>,iter,global_norm);</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="comment">/* correct the solution for this iteration */</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="keywordflow">if</span> (n &gt; 1) {</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      <span class="keywordflow">for</span> (d=0; d&lt;ns; d++) {</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        i = 0;    x[i*ns+d] = (rhs[i*ns+d] - a[i*ns+d]*recvbufL[d] - c[i*ns+d]*x[d+ns*(i+1)]  ) / b[i*ns+d];</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        i = n-1;  x[i*ns+d] = (rhs[i*ns+d] - a[i*ns+d]*x[d+ns*(i-1)]   - c[i*ns+d]*recvbufR[d]) / b[i*ns+d];</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      }</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;      <span class="keywordflow">for</span> (i=1; i&lt;n-1; i++) {</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        <span class="keywordflow">for</span> (d=0; d&lt;ns; d++) {</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;          x[i*ns+d] = (rhs[i*ns+d] - a[i*ns+d]*x[d+ns*(i-1)] - c[i*ns+d]*x[d+ns*(i+1)]) / b[i*ns+d];</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        }</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      }</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;      <span class="keywordflow">for</span> (d=0; d&lt;ns; d++) x[d] = (rhs[d] - a[d]*recvbufL[d] - c[d]*recvbufR[d]) / b[d];</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    }</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="comment">/* finished with this iteration */</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    iter++;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  }</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  <span class="comment">/* save convergence information */</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  context-&gt;<a class="code" href="a00100.html#a0a20107c06f29ce4d4ac23a4e7cfb17a">exitnorm</a> = (context-&gt;<a class="code" href="a00100.html#a584c0fc0b1e845800ad511dffc60e032">evaluate_norm</a> ? global_norm : -1.0);</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  context-&gt;<a class="code" href="a00100.html#a846172807b19cf19a2587ede74b06828">exititer</a> = iter;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  free(rhs);</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  free(sendbufL);</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  free(sendbufR);</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  free(recvbufL);</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  free(recvbufR);</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;}</div>
<div class="ttc" id="a00100_html_a584c0fc0b1e845800ad511dffc60e032"><div class="ttname"><a href="a00100.html#a584c0fc0b1e845800ad511dffc60e032">TridiagLU::evaluate_norm</a></div><div class="ttdeci">int evaluate_norm</div><div class="ttdef"><b>Definition:</b> <a href="a00100_source.html#l00090">tridiagLU.h:90</a></div></div>
<div class="ttc" id="a00100_html_a0a20107c06f29ce4d4ac23a4e7cfb17a"><div class="ttname"><a href="a00100.html#a0a20107c06f29ce4d4ac23a4e7cfb17a">TridiagLU::exitnorm</a></div><div class="ttdeci">double exitnorm</div><div class="ttdef"><b>Definition:</b> <a href="a00100_source.html#l00095">tridiagLU.h:95</a></div></div>
<div class="ttc" id="a00100_html_a846172807b19cf19a2587ede74b06828"><div class="ttname"><a href="a00100.html#a846172807b19cf19a2587ede74b06828">TridiagLU::exititer</a></div><div class="ttdeci">int exititer</div><div class="ttdef"><b>Definition:</b> <a href="a00100_source.html#l00094">tridiagLU.h:94</a></div></div>
<div class="ttc" id="a00100_html_a00408"><div class="ttname"><a href="a00100.html#a00408">TridiagLU</a></div><div class="ttdef"><b>Definition:</b> <a href="a00100_source.html#l00081">tridiagLU.h:81</a></div></div>
<div class="ttc" id="a00100_html_a274519264a28477940f161ddb4b61feb"><div class="ttname"><a href="a00100.html#a274519264a28477940f161ddb4b61feb">TridiagLU::maxiter</a></div><div class="ttdeci">int maxiter</div><div class="ttdef"><b>Definition:</b> <a href="a00100_source.html#l00091">tridiagLU.h:91</a></div></div>
<div class="ttc" id="a00100_html_a60c6dfc476dd9596072f61c2ec8d58ed"><div class="ttname"><a href="a00100.html#a60c6dfc476dd9596072f61c2ec8d58ed">TridiagLU::atol</a></div><div class="ttdeci">double atol</div><div class="ttdef"><b>Definition:</b> <a href="a00100_source.html#l00092">tridiagLU.h:92</a></div></div>
<div class="ttc" id="a00100_html_a0b2caeb4b6f130be43e5a2f0267dd453"><div class="ttname"><a href="a00100.html#a0b2caeb4b6f130be43e5a2f0267dd453">TridiagLU::verbose</a></div><div class="ttdeci">int verbose</div><div class="ttdef"><b>Definition:</b> <a href="a00100_source.html#l00096">tridiagLU.h:96</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a52d21dfe1d76916811879bf0d7a29d72"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int tridiagLUInit </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>r</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>c</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Initialize the tridiagLU solver by setting the various parameters in <a class="el" href="a00100.html#a00408">TridiagLU</a> to their default values. If the file <em>lusolver.inp</em> is available, read it and set the parameters.</p>
<p>The file <b>lusolver.inp</b> must be in the following format:<br />
</p><pre class="fragment">    begin
        &lt;keyword&gt;   &lt;value&gt;
        &lt;keyword&gt;   &lt;value&gt;
        &lt;keyword&gt;   &lt;value&gt;
        ...
        &lt;keyword&gt;   &lt;value&gt;
    end
</pre><p>where the list of keywords are:<br />
</p><table class="doxtable">
<tr>
<th>Keyword name </th><th>Type </th><th>Variable </th><th>Default value  </th></tr>
<tr>
<td>evaluate_norm </td><td>int </td><td><a class="el" href="a00100.html#a584c0fc0b1e845800ad511dffc60e032">TridiagLU::evaluate_norm</a> </td><td>1 </td></tr>
<tr>
<td>maxiter </td><td>int </td><td><a class="el" href="a00100.html#a274519264a28477940f161ddb4b61feb">TridiagLU::maxiter</a> </td><td>10 </td></tr>
<tr>
<td>atol </td><td>double </td><td><a class="el" href="a00100.html#a60c6dfc476dd9596072f61c2ec8d58ed">TridiagLU::atol</a> </td><td>1e-12 </td></tr>
<tr>
<td>rtol </td><td>double </td><td><a class="el" href="a00100.html#a4587afeee8941ba7c208b3690a3eeaa7">TridiagLU::rtol</a> </td><td>1e-10 </td></tr>
<tr>
<td>verbose </td><td>int </td><td><a class="el" href="a00100.html#a0b2caeb4b6f130be43e5a2f0267dd453">TridiagLU::verbose</a> </td><td>0 </td></tr>
<tr>
<td>reducedsolvetype </td><td>char[] </td><td><a class="el" href="a00100.html#ae50ec60868beaab2cb84897adefda09f">TridiagLU::reducedsolvetype</a> </td><td><a class="el" href="a00100.html#a79ddfe354b89d113b72db4b5ae6c6e3d">_TRIDIAG_JACOBI_</a> </td></tr>
</table>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">r</td><td>Object of type <a class="el" href="a00100.html#a00408">TridiagLU</a> </td></tr>
    <tr><td class="paramname">c</td><td>MPI communicator </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00391_source.html#l00039">39</a> of file <a class="el" href="a00391_source.html">tridiagLUInit.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;{</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  <a class="code" href="a00100.html#a00408">TridiagLU</a> *t = (<a class="code" href="a00100.html#a00408">TridiagLU</a>*) r;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  <span class="keywordtype">int</span>       rank,ierr;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#ifdef serial</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  rank  = 0;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  MPI_Comm  *comm = (MPI_Comm*) c;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="keywordflow">if</span> (!comm) rank = 0;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <span class="keywordflow">else</span> MPI_Comm_rank(*comm,&amp;rank);</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <span class="comment">/* default values */</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  strcpy(t-&gt;<a class="code" href="a00100.html#ae50ec60868beaab2cb84897adefda09f">reducedsolvetype</a>,<a class="code" href="a00100.html#a79ddfe354b89d113b72db4b5ae6c6e3d">_TRIDIAG_JACOBI_</a>);</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  t-&gt;<a class="code" href="a00100.html#a584c0fc0b1e845800ad511dffc60e032">evaluate_norm</a> = 1;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  t-&gt;<a class="code" href="a00100.html#a274519264a28477940f161ddb4b61feb">maxiter</a>       = 10;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  t-&gt;<a class="code" href="a00100.html#a60c6dfc476dd9596072f61c2ec8d58ed">atol</a>          = 1e-12;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  t-&gt;<a class="code" href="a00100.html#a4587afeee8941ba7c208b3690a3eeaa7">rtol</a>          = 1e-10;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  t-&gt;<a class="code" href="a00100.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>       = 0;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  <span class="comment">/* read from file, if available */</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  <span class="keywordflow">if</span> (!rank) {</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    FILE *in;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    in = fopen(<span class="stringliteral">&quot;lusolver.inp&quot;</span>,<span class="stringliteral">&quot;r&quot;</span>);</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keywordflow">if</span> (!in) {</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;      printf(<span class="stringliteral">&quot;tridiagLUInit: File \&quot;lusolver.inp\&quot; not found. Using default values.\n&quot;</span>);</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;      <span class="keywordtype">char</span> word[100];</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;      ierr = fscanf(in,<span class="stringliteral">&quot;%s&quot;</span>,word); <span class="keywordflow">if</span> (ierr != 1) <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;      <span class="keywordflow">if</span> (!strcmp(word, <span class="stringliteral">&quot;begin&quot;</span>)) {</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;          <span class="keywordflow">while</span> (strcmp(word, <span class="stringliteral">&quot;end&quot;</span>)) {</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;              ierr = fscanf(in,<span class="stringliteral">&quot;%s&quot;</span>,word); <span class="keywordflow">if</span> (ierr != 1) <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                <span class="keywordflow">if</span>      (!strcmp(word, <span class="stringliteral">&quot;evaluate_norm&quot;</span>   )) ierr = fscanf(in,<span class="stringliteral">&quot;%d&quot;</span> ,&amp;t-&gt;<a class="code" href="a00100.html#a584c0fc0b1e845800ad511dffc60e032">evaluate_norm</a>  );</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(word, <span class="stringliteral">&quot;maxiter&quot;</span>         )) ierr = fscanf(in,<span class="stringliteral">&quot;%d&quot;</span> ,&amp;t-&gt;<a class="code" href="a00100.html#a274519264a28477940f161ddb4b61feb">maxiter</a>        );</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(word, <span class="stringliteral">&quot;atol&quot;</span>            )) ierr = fscanf(in,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;t-&gt;<a class="code" href="a00100.html#a60c6dfc476dd9596072f61c2ec8d58ed">atol</a>           );</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(word, <span class="stringliteral">&quot;rtol&quot;</span>            )) ierr = fscanf(in,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;t-&gt;<a class="code" href="a00100.html#a4587afeee8941ba7c208b3690a3eeaa7">rtol</a>           );</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(word, <span class="stringliteral">&quot;verbose&quot;</span>         ))   ierr = fscanf(in,<span class="stringliteral">&quot;%d&quot;</span> ,&amp;t-&gt;<a class="code" href="a00100.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>        );</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(word, <span class="stringliteral">&quot;reducedsolvetype&quot;</span>))   ierr = fscanf(in,<span class="stringliteral">&quot;%s&quot;</span> ,t-&gt;<a class="code" href="a00100.html#ae50ec60868beaab2cb84897adefda09f">reducedsolvetype</a>);</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(word,<span class="stringliteral">&quot;end&quot;</span>)) {</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;            <span class="keywordtype">char</span> useless[100];</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;            ierr = fscanf(in,<span class="stringliteral">&quot;%s&quot;</span>,useless);</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;            printf(<span class="stringliteral">&quot;Warning: keyword %s in file \&quot;lusolver.inp\&quot; with value %s not recognized or extraneous. Ignoring.\n&quot;</span>,word,useless);</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;          }</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;          <span class="keywordflow">if</span> (ierr != 1) <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        }</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;          fprintf(stderr,<span class="stringliteral">&quot;Error: Illegal format in file \&quot;solver.inp\&quot;.\n&quot;</span>);</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;      }</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;      fclose(in);</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    }</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  }</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="comment">/* broadcast to all processes */</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="preprocessor">#ifndef serial</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="keywordflow">if</span> (comm) {</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    MPI_Bcast(t-&gt;<a class="code" href="a00100.html#ae50ec60868beaab2cb84897adefda09f">reducedsolvetype</a>,50,MPI_CHAR,0,*comm);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    MPI_Bcast(&amp;t-&gt;<a class="code" href="a00100.html#a584c0fc0b1e845800ad511dffc60e032">evaluate_norm</a>,1,MPI_INT,0,*comm);</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    MPI_Bcast(&amp;t-&gt;<a class="code" href="a00100.html#a274519264a28477940f161ddb4b61feb">maxiter</a>,1,MPI_INT,0,*comm);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    MPI_Bcast(&amp;t-&gt;<a class="code" href="a00100.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>,1,MPI_INT,0,*comm);</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    MPI_Bcast(&amp;t-&gt;<a class="code" href="a00100.html#a60c6dfc476dd9596072f61c2ec8d58ed">atol</a>,1,MPI_DOUBLE,0,*comm);</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    MPI_Bcast(&amp;t-&gt;<a class="code" href="a00100.html#a4587afeee8941ba7c208b3690a3eeaa7">rtol</a>,1,MPI_DOUBLE,0,*comm);</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  }</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;}</div>
<div class="ttc" id="a00100_html_a584c0fc0b1e845800ad511dffc60e032"><div class="ttname"><a href="a00100.html#a584c0fc0b1e845800ad511dffc60e032">TridiagLU::evaluate_norm</a></div><div class="ttdeci">int evaluate_norm</div><div class="ttdef"><b>Definition:</b> <a href="a00100_source.html#l00090">tridiagLU.h:90</a></div></div>
<div class="ttc" id="a00100_html_a79ddfe354b89d113b72db4b5ae6c6e3d"><div class="ttname"><a href="a00100.html#a79ddfe354b89d113b72db4b5ae6c6e3d">_TRIDIAG_JACOBI_</a></div><div class="ttdeci">#define _TRIDIAG_JACOBI_</div><div class="ttdef"><b>Definition:</b> <a href="a00100_source.html#l00071">tridiagLU.h:71</a></div></div>
<div class="ttc" id="a00100_html_ae50ec60868beaab2cb84897adefda09f"><div class="ttname"><a href="a00100.html#ae50ec60868beaab2cb84897adefda09f">TridiagLU::reducedsolvetype</a></div><div class="ttdeci">char reducedsolvetype[50]</div><div class="ttdef"><b>Definition:</b> <a href="a00100_source.html#l00088">tridiagLU.h:88</a></div></div>
<div class="ttc" id="a00100_html_a00408"><div class="ttname"><a href="a00100.html#a00408">TridiagLU</a></div><div class="ttdef"><b>Definition:</b> <a href="a00100_source.html#l00081">tridiagLU.h:81</a></div></div>
<div class="ttc" id="a00100_html_a274519264a28477940f161ddb4b61feb"><div class="ttname"><a href="a00100.html#a274519264a28477940f161ddb4b61feb">TridiagLU::maxiter</a></div><div class="ttdeci">int maxiter</div><div class="ttdef"><b>Definition:</b> <a href="a00100_source.html#l00091">tridiagLU.h:91</a></div></div>
<div class="ttc" id="a00100_html_a60c6dfc476dd9596072f61c2ec8d58ed"><div class="ttname"><a href="a00100.html#a60c6dfc476dd9596072f61c2ec8d58ed">TridiagLU::atol</a></div><div class="ttdeci">double atol</div><div class="ttdef"><b>Definition:</b> <a href="a00100_source.html#l00092">tridiagLU.h:92</a></div></div>
<div class="ttc" id="a00100_html_a4587afeee8941ba7c208b3690a3eeaa7"><div class="ttname"><a href="a00100.html#a4587afeee8941ba7c208b3690a3eeaa7">TridiagLU::rtol</a></div><div class="ttdeci">double rtol</div><div class="ttdef"><b>Definition:</b> <a href="a00100_source.html#l00092">tridiagLU.h:92</a></div></div>
<div class="ttc" id="a00100_html_a0b2caeb4b6f130be43e5a2f0267dd453"><div class="ttname"><a href="a00100.html#a0b2caeb4b6f130be43e5a2f0267dd453">TridiagLU::verbose</a></div><div class="ttdeci">int verbose</div><div class="ttdef"><b>Definition:</b> <a href="a00100_source.html#l00096">tridiagLU.h:96</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad2c404dd44e760ee729740176b186bd0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int blocktridiagLU </td>
          <td>(</td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ns</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>bs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>r</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>m</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Solve block tridiagonal (non-periodic) systems of equations using parallel LU decomposition: This function can solve multiple independent systems with one call. The systems need not share the same left- or right-hand-sides. The iterative substructuring method is used in this function that can be briefly described through the following 4 stages:</p><ul>
<li>Stage 1: Parallel elimination of the tridiagonal blocks on each processor comprising all points of the subdomain except the 1st point (unless its the 1st global point, i.e., a physical boundary)</li>
<li>Stage 2: Elimination of the 1st row on each processor (except the 1st processor) using the last row of the previous processor.</li>
<li>Stage 3: Solution of the reduced tridiagonal system that represents the coupling of the system across the processors, using <a class="el" href="a00100.html#a8c48f135943fe35da85072714d4b1b23">blocktridiagIterJacobi()</a> in this implementation.</li>
<li>Stage 4: Backward-solve to obtain the final solution</li>
</ul>
<p>Specific details of the method implemented here are available in:</p><ul>
<li>Ghosh, D., Constantinescu, E. M., Brown, J., "Scalable Nonlinear Compact Schemes", Technical Memorandum, ANL/MCS-TM-340, Argonne National Laboratory, April 2014, (<a href="http://www.mcs.anl.gov/publication/scalable-nonlinear-compact-schemes">http://www.mcs.anl.gov/publication/scalable-nonlinear-compact-schemes</a>) (also available at <a href="http://debog.github.io/Files/2014_Ghosh_Consta_Brown_MCSTR340.pdf">http://debog.github.io/Files/2014_Ghosh_Consta_Brown_MCSTR340.pdf</a>).</li>
<li>Ghosh, D., Constantinescu, E. M., Brown, J., Efficient Implementation of Nonlinear Compact Schemes on Massively Parallel Platforms, SIAM Journal on Scientific Computing, 37 (3), 2015, C354–C383 (<a href="http://dx.doi.org/10.1137/140989261">http://dx.doi.org/10.1137/140989261</a>).</li>
</ul>
<p>More references on this class of parallel tridiagonal solvers:</p><ul>
<li>E. Polizzi and A. H. Sameh, "A parallel hybrid banded system solver: The SPIKE algorithm", Parallel Comput., 32 (2006), pp. 177–194.</li>
<li>E. Polizzi and A. H. Sameh, "SPIKE: A parallel environment for solving banded linear systems", Comput. &amp; Fluids, 36 (2007), pp. 113–120.</li>
</ul>
<p>Array layout: The arguments <em>a</em>, <em>b</em>, and <em>c</em> are local 1D arrays (containing this processor's part of the subdiagonal, diagonal, and superdiagonal) of size (<em>n</em> X <em>ns</em> X <em>bs^2</em>), and <em>x</em> is a local 1D array (containing this processor's part of the right-hand-side, and will contain the solution on exit) of size (<em>n</em> X <em>ns</em> X <em>bs</em>), where <em>n</em> is the local size of the system, <em>ns</em> is the number of independent systems to solve, and <em>bs</em> is the block size. The ordering of the elements in these arrays is as follows:</p><ul>
<li>Each block is stored in the row-major format.</li>
<li>Blocks of the same row for each of the independent systems are stored adjacent to each other.</li>
</ul>
<p>For example, consider the following systems: </p><p class="formulaDsp">
\begin{equation} \left[\begin{array}{ccccc} B_0^k &amp; C_0^k &amp; &amp; &amp; \\ A_1^k &amp; B_1^k &amp; C_1^k &amp; &amp; \\ &amp; A_2^k &amp; B_2^k &amp; C_2^k &amp; &amp; \\ &amp; &amp; A_3^k &amp; B_3^k &amp; C_3^k &amp; \\ &amp; &amp; &amp; A_4^k &amp; B_4^k &amp; C_4^k \\ \end{array}\right] \left[\begin{array}{c} X_0^k \\ X_1^k \\ X_2^k \\ X_3^k \\ X_4^k \end{array}\right] = \left[\begin{array}{c} R_0^k \\ R_1^k \\ R_2^k \\ R_3^k \\ R_4^k \end{array}\right]; \ \ k= 1,\cdots,ns \end{equation}
</p>
<p> where \(A\), \(B\), and \(C\) are matrices of size <em>bs</em> = 2 (say), and let \( ns = 3\). In the equation above, we have </p><p class="formulaDsp">
\begin{equation} B_i^k = \left[\begin{array}{cc} b_{00,i}^k &amp; b_{01,i}^k \\ b_{10,i}^k &amp; b_{11,i}^k \end{array}\right], X_i^k = \left[\begin{array}{c} x_{0,i}^k \\ x_{1,i}^k \end{array} \right], R_i^k = \left[\begin{array}{c} r_{0,i}^k \\ r_{1,i}^k \end{array} \right] \end{equation}
</p>
<p> Note that in the code, \(X\) and \(R\) are the same array <em>x</em>.</p>
<p>Then, the array <em>b</em> must be a 1D array with the following layout of elements:<br />
[<br />
b_{00,0}^0, b_{01,0}^0, b_{10,0}^0, b_{11,0}^0, b_{00,0}^1, b_{01,0}^1, b_{10,0}^1, b_{11,0}^1, b_{00,0}^2, b_{01,0}^2, b_{10,0}^2, b_{11,0}^2, <br />
b_{00,1}^0, b_{01,1}^0, b_{10,1}^0, b_{11,1}^0, b_{00,1}^1, b_{01,1}^1, b_{10,1}^1, b_{11,1}^1, b_{00,1}^2, b_{01,1}^2, b_{10,1}^2, b_{11,1}^2, <br />
..., <br />
b_{00,n-1}^0, b_{01,n-1}^0, b_{10,n-1}^0, b_{11,n-1}^0, b_{00,n-1}^1, b_{01,n-1}^1, b_{10,n-1}^1, b_{11,n-1}^1, b_{00,n-1}^2, b_{01,n-1}^2, b_{10,n-1}^2, b_{11,n-1}^2<br />
]<br />
The arrays <em>a</em> and <em>c</em> are stored similarly.</p>
<p>The array corresponding to a vector (the solution and the right-hand-side <em>x</em>) must be a 1D array with the following layout of elements:<br />
[<br />
x_{0,0}^0, x_{1,0}^0, x_{0,0}^1, x_{1,0}^1,x_{0,0}^2, x_{1,0}^2,<br />
x_{0,1}^0, x_{1,1}^0, x_{0,1}^1, x_{1,1}^1,x_{0,1}^2, x_{1,1}^2,<br />
..., <br />
x_{0,n-1}^0, x_{1,n-1}^0, x_{0,n-1}^1, x_{1,n-1}^1,x_{0,n-1}^2, x_{1,n-1}^2<br />
]<br />
</p>
<p>Notes:</p><ul>
<li>This function does <em>not</em> preserve the sub-diagonal, diagonal, super-diagonal elements and the right-hand-sides.</li>
<li>The input array <em>x</em> contains the right-hand-side on entering the function, and the solution on exiting it. </li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">a</td><td>Array containing the sub-diagonal elements </td></tr>
    <tr><td class="paramname">b</td><td>Array containing the diagonal elements </td></tr>
    <tr><td class="paramname">c</td><td>Array containing the super-diagonal elements </td></tr>
    <tr><td class="paramname">x</td><td>Right-hand side; will contain the solution on exit </td></tr>
    <tr><td class="paramname">n</td><td>Local size of the system on this processor (<em>not</em> multiplied by the block size) </td></tr>
    <tr><td class="paramname">ns</td><td>Number of systems to solve </td></tr>
    <tr><td class="paramname">bs</td><td>Block size </td></tr>
    <tr><td class="paramname">r</td><td>Object of type <a class="el" href="a00100.html#a00408">TridiagLU</a> (contains wall times at exit) </td></tr>
    <tr><td class="paramname">m</td><td>MPI communicator </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00387_source.html#l00107">107</a> of file <a class="el" href="a00387_source.html">blocktridiagLU.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;{</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <a class="code" href="a00100.html#a00408">TridiagLU</a>       *params = (<a class="code" href="a00100.html#a00408">TridiagLU</a>*) r;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  <span class="keywordtype">int</span>             d,i,j,istart,iend,size;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  <span class="keywordtype">int</span>             rank,nproc,bs2=bs*bs,nsbs=ns*bs;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  <span class="keyword">struct </span>timeval  start,stage1,stage2,stage3,stage4;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="preprocessor">#ifdef serial</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  rank  = 0;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  nproc = 1;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  MPI_Comm        *comm = (MPI_Comm*) m;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span>       nvar = 4;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <span class="keywordtype">int</span>             ierr = 0;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="keywordflow">if</span> (comm) {</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    MPI_Comm_size(*comm,&amp;nproc);</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    MPI_Comm_rank(*comm,&amp;rank);</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    rank  = 0;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    nproc = 1;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  }</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  <span class="keywordflow">if</span> (!params) {</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    fprintf(stderr,<span class="stringliteral">&quot;Error in tridiagLU(): NULL pointer passed for parameters.\n&quot;</span>);</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  }</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  <span class="comment">/* start */</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  gettimeofday(&amp;start,NULL);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  <span class="keywordflow">if</span> ((ns == 0) || (n == 0) || (bs == 0)) <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  <span class="keywordtype">double</span> *xs1, *xp1;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  xs1 = (<span class="keywordtype">double</span>*) calloc (nsbs, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  xp1 = (<span class="keywordtype">double</span>*) calloc (nsbs, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  <span class="keywordflow">for</span> (i=0; i&lt;nsbs; i++) xs1[i] = xp1[i] = 0;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <span class="comment">/* Stage 1 - Parallel elimination of subdiagonal entries */</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  istart  = (rank == 0 ? 1 : 2);</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  iend    = n;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  <span class="keywordflow">for</span> (i = istart; i &lt; iend; i++) {</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="keywordtype">double</span> binv[bs2], factor[bs2];</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="keywordflow">for</span> (d = 0; d &lt; ns; d++) {</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;      <a class="code" href="a00111.html#a2fc4a6b3bc38a4c6e804076ca1e94de0">_MatrixInvert_</a>           (b+((i-1)*ns+d)*bs2,binv,bs);</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;      <a class="code" href="a00111.html#ab6aa501e79620e67e647017307e412f5">_MatrixMultiply_</a>         (a+(i*ns+d)*bs2,binv,factor,bs);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;      <a class="code" href="a00111.html#a625c8dc5d5de2ed16dc1a211fc998d36">_MatrixMultiplySubtract_</a> (b+(i*ns+d)*bs2,factor,c+((i-1)*ns+d)*bs2,bs);</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      <a class="code" href="a00111.html#ac7d8b887f87e447fc24749ba3eea95e4">_MatrixZero_</a>             (a+(i*ns+d)*bs2,bs);</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;      <a class="code" href="a00111.html#a625c8dc5d5de2ed16dc1a211fc998d36">_MatrixMultiplySubtract_</a> (a+(i*ns+d)*bs2,factor,a+((i-1)*ns+d)*bs2,bs);</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;      <a class="code" href="a00111.html#a41e1094e8869844c3e7bf9d8818b8276">_MatVecMultiplySubtract_</a> (x+(i*ns+d)*bs ,factor,x+((i-1)*ns+d)*bs ,bs);</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;      <span class="keywordflow">if</span> (rank) {</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        <a class="code" href="a00111.html#ab6aa501e79620e67e647017307e412f5">_MatrixMultiply_</a>         (c+d*bs2,binv,factor,bs);</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        <a class="code" href="a00111.html#ac7d8b887f87e447fc24749ba3eea95e4">_MatrixZero_</a>             (c+d*bs2,bs);</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        <a class="code" href="a00111.html#a625c8dc5d5de2ed16dc1a211fc998d36">_MatrixMultiplySubtract_</a> (c+d*bs2,factor,c+((i-1)*ns+d)*bs2,bs);</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        <a class="code" href="a00111.html#a625c8dc5d5de2ed16dc1a211fc998d36">_MatrixMultiplySubtract_</a> (b+d*bs2,factor,a+((i-1)*ns+d)*bs2,bs);</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        <a class="code" href="a00111.html#a41e1094e8869844c3e7bf9d8818b8276">_MatVecMultiplySubtract_</a> (x+d*bs ,factor,x+((i-1)*ns+d)*bs ,bs);</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;      }</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    }</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  }</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  <span class="comment">/* end of stage 1 */</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  gettimeofday(&amp;stage1,NULL);</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  <span class="comment">/* Stage 2 - Eliminate the first sub- &amp; super-diagonal entries */</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  <span class="comment">/* This needs the last (a,b,c,x) from the previous process     */</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="preprocessor">#ifndef serial</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  <span class="keywordtype">double</span> *sendbuf, *recvbuf;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  size = ns*bs2*(nvar-1)+nsbs;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  sendbuf = (<span class="keywordtype">double</span>*) calloc (size, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  recvbuf = (<span class="keywordtype">double</span>*) calloc (size, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  <span class="keywordflow">for</span> (d=0; d&lt;ns; d++) {</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="keywordflow">for</span> (i=0; i&lt;bs2; i++) {</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      sendbuf[(0*ns+d)*bs2+i] = a[((n-1)*ns+d)*bs2+i]; </div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      sendbuf[(1*ns+d)*bs2+i] = b[((n-1)*ns+d)*bs2+i]; </div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      sendbuf[(2*ns+d)*bs2+i] = c[((n-1)*ns+d)*bs2+i];</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    }</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="keywordflow">for</span> (i=0; i&lt;bs; i++) sendbuf[3*ns*bs2+d*bs+i] = x[((n-1)*ns+d)*bs+i];</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  }</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  <span class="keywordflow">if</span> (nproc &gt; 1) {</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    MPI_Request req[2] = {MPI_REQUEST_NULL,MPI_REQUEST_NULL};</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="keywordflow">if</span> (rank)             MPI_Irecv(recvbuf,size,MPI_DOUBLE,rank-1,1436,*comm,&amp;req[0]);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="keywordflow">if</span> (rank != nproc-1)  MPI_Isend(sendbuf,size,MPI_DOUBLE,rank+1,1436,*comm,&amp;req[1]);</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    MPI_Waitall(2,&amp;req[0],MPI_STATUS_IGNORE);</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  }</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  <span class="comment">/* The first process sits this one out */</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  <span class="keywordflow">if</span> (rank) {</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="keywordflow">for</span> (d = 0; d &lt; ns; d++) {</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      <span class="keywordtype">double</span> am1[bs2], bm1[bs2], cm1[bs2], xm1[bs];</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;      <span class="keywordflow">for</span> (i=0; i&lt;bs2; i++) {</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        am1[i] = recvbuf[(0*ns+d)*bs2+i]; </div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        bm1[i] = recvbuf[(1*ns+d)*bs2+i]; </div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        cm1[i] = recvbuf[(2*ns+d)*bs2+i]; </div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;      }</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;      <span class="keywordflow">for</span> (i=0; i&lt;bs; i++) xm1[i] = recvbuf[3*ns*bs2+d*bs+i];</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      <span class="keywordtype">double</span> factor[bs2], binv[bs2];</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;      <a class="code" href="a00111.html#a2fc4a6b3bc38a4c6e804076ca1e94de0">_MatrixInvert_</a>           (bm1,binv,bs);</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;      <a class="code" href="a00111.html#ab6aa501e79620e67e647017307e412f5">_MatrixMultiply_</a>         (a+d*bs2,binv,factor,bs);</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      <a class="code" href="a00111.html#a625c8dc5d5de2ed16dc1a211fc998d36">_MatrixMultiplySubtract_</a> (b+d*bs2,factor,cm1,bs);</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      <a class="code" href="a00111.html#ac7d8b887f87e447fc24749ba3eea95e4">_MatrixZero_</a>             (a+d*bs2,bs);</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      <a class="code" href="a00111.html#a625c8dc5d5de2ed16dc1a211fc998d36">_MatrixMultiplySubtract_</a> (a+d*bs2,factor,am1,bs);</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;      <a class="code" href="a00111.html#a41e1094e8869844c3e7bf9d8818b8276">_MatVecMultiplySubtract_</a> (x+d*bs ,factor,xm1,bs);</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;      </div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      <a class="code" href="a00111.html#a2fc4a6b3bc38a4c6e804076ca1e94de0">_MatrixInvert_</a>           (b+((n-1)*ns+d)*bs2,binv,bs); <span class="keywordflow">if</span> (ierr) <span class="keywordflow">return</span>(ierr);</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;      <a class="code" href="a00111.html#ab6aa501e79620e67e647017307e412f5">_MatrixMultiply_</a>         (c+d*bs2,binv,factor,bs);</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;      <a class="code" href="a00111.html#a625c8dc5d5de2ed16dc1a211fc998d36">_MatrixMultiplySubtract_</a> (b+d*bs2,factor,a+((n-1)*ns+d)*bs2,bs);</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      <a class="code" href="a00111.html#ac7d8b887f87e447fc24749ba3eea95e4">_MatrixZero_</a>             (c+d*bs2,bs);</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;      <a class="code" href="a00111.html#a625c8dc5d5de2ed16dc1a211fc998d36">_MatrixMultiplySubtract_</a> (c+d*bs2,factor,c+((n-1)*ns+d)*bs2,bs);</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;      <a class="code" href="a00111.html#a41e1094e8869844c3e7bf9d8818b8276">_MatVecMultiplySubtract_</a> (x+d*bs ,factor,x+((n-1)*ns+d)*bs ,bs);</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    }</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  }</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  free(sendbuf);</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  free(recvbuf);</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  <span class="comment">/* end of stage 2 */</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  gettimeofday(&amp;stage2,NULL);</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <span class="comment">/* Stage 3 - Solve the reduced (nproc-1) X (nproc-1) tridiagonal system   */</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="preprocessor">#ifndef serial</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <span class="keywordflow">if</span> (nproc &gt; 1) {</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="keywordtype">double</span> *zero, *eye;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    zero = (<span class="keywordtype">double</span>*) calloc (ns*bs2, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    eye  = (<span class="keywordtype">double</span>*) calloc (ns*bs2, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="keywordflow">for</span> (d=0; d&lt;ns*bs2; d++) zero[d] = eye[d] = 0.0;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="keywordflow">for</span> (d=0; d&lt;ns; d++) {</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;      <span class="keywordflow">for</span> (i=0; i&lt;bs; i++) eye[d*bs2+(i*bs+i)] = 1.0;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    }</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <span class="keywordflow">if</span> (!strcmp(params-&gt;<a class="code" href="a00100.html#ae50ec60868beaab2cb84897adefda09f">reducedsolvetype</a>,<a class="code" href="a00100.html#adf756eb923ab79f911e38a82da7a6cab">_TRIDIAG_GS_</a>)) {</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;      <span class="comment">/* not supported */</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      fprintf(stderr,<span class="stringliteral">&quot;Error in blocktridiagLU(): Gather-and-solve for reduced system not available.\n&quot;</span>);</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(params-&gt;<a class="code" href="a00100.html#ae50ec60868beaab2cb84897adefda09f">reducedsolvetype</a>,<a class="code" href="a00100.html#a79ddfe354b89d113b72db4b5ae6c6e3d">_TRIDIAG_JACOBI_</a>)) {</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      <span class="comment">/* Solving the reduced system iteratively with the Jacobi method */</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;      <span class="keywordflow">if</span> (rank) ierr = <a class="code" href="a00100.html#a8c48f135943fe35da85072714d4b1b23">blocktridiagIterJacobi</a>(a,b,c,x,1,ns,bs,params,comm);</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;      <span class="keywordflow">else</span>      ierr = <a class="code" href="a00100.html#a8c48f135943fe35da85072714d4b1b23">blocktridiagIterJacobi</a>(zero,eye,zero,zero,1,ns,bs,params,comm);</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    }</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    free(zero);</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    free(eye);</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="comment">/* Each process, get the first x of the next process */</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    MPI_Request req[2] = {MPI_REQUEST_NULL,MPI_REQUEST_NULL};</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="keywordflow">for</span> (d=0; d&lt;nsbs; d++)  xs1[d] = x[d];</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="keywordflow">if</span> (rank+1 &lt; nproc) MPI_Irecv(xp1,nsbs,MPI_DOUBLE,rank+1,1323,*comm,&amp;req[0]);</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="keywordflow">if</span> (rank)           MPI_Isend(xs1,nsbs,MPI_DOUBLE,rank-1,1323,*comm,&amp;req[1]);</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    MPI_Waitall(2,&amp;req[0],MPI_STATUS_IGNORE);</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  }</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  <span class="keywordflow">if</span> (nproc &gt; 1) {</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    fprintf(stderr,<span class="stringliteral">&quot;Error: nproc &gt; 1 for a serial run!\n&quot;</span>);</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  }</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* if not serial */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <span class="comment">/* end of stage 3 */</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  gettimeofday(&amp;stage3,NULL);</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;  <span class="comment">/* Stage 4 - Parallel back-substitution to get the solution  */</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  istart = n-1;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  iend   = (rank == 0 ? 0 : 1);</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <span class="keywordflow">for</span> (d = 0; d &lt; ns; d++) {</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="keywordtype">double</span> binv[bs2],xt[bs];</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <a class="code" href="a00111.html#a2fc4a6b3bc38a4c6e804076ca1e94de0">_MatrixInvert_</a>           (b+(istart*ns+d)*bs2,binv,bs);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <a class="code" href="a00111.html#a41e1094e8869844c3e7bf9d8818b8276">_MatVecMultiplySubtract_</a> (x+(istart*ns+d)*bs ,a+(istart*ns+d)*bs2,x  +d*bs,bs);</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <a class="code" href="a00111.html#a41e1094e8869844c3e7bf9d8818b8276">_MatVecMultiplySubtract_</a> (x+(istart*ns+d)*bs ,c+(istart*ns+d)*bs2,xp1+d*bs,bs);</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <a class="code" href="a00111.html#a1318a4facf7b30129d0509f524a1eb3b">_MatVecMultiply_</a>         (binv,x+(istart*ns+d)*bs,xt,bs);</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="keywordflow">for</span> (j=0; j&lt;bs; j++)   x[(istart*ns+d)*bs+j]=xt[j];</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  }</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  <span class="keywordflow">for</span> (i = istart-1; i &gt; iend-1; i--) {</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="keywordflow">for</span> (d = 0; d &lt; ns; d++) {</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;      <span class="keywordtype">double</span> binv[bs2],xt[bs];</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      <a class="code" href="a00111.html#a2fc4a6b3bc38a4c6e804076ca1e94de0">_MatrixInvert_</a>           (b+(i*ns+d)*bs2,binv,bs);</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;      <a class="code" href="a00111.html#a41e1094e8869844c3e7bf9d8818b8276">_MatVecMultiplySubtract_</a> (x+(i*ns+d)*bs ,c+(i*ns+d)*bs2,x+((i+1)*ns+d)*bs,bs);</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      <a class="code" href="a00111.html#a41e1094e8869844c3e7bf9d8818b8276">_MatVecMultiplySubtract_</a> (x+(i*ns+d)*bs ,a+(i*ns+d)*bs2,x+d*bs,bs);</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;      <a class="code" href="a00111.html#a1318a4facf7b30129d0509f524a1eb3b">_MatVecMultiply_</a>         (binv,x+(i*ns+d)*bs,xt,bs);</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      <span class="keywordflow">for</span> (j=0; j&lt;bs; j++)   x[(i*ns+d)*bs+j] = xt[j];</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    }</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  }</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  <span class="comment">/* end of stage 4 */</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  gettimeofday(&amp;stage4,NULL);</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <span class="comment">/* Done - now x contains the solution */</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  free(xs1);</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  free(xp1);</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  <span class="comment">/* save runtimes if needed */</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span> walltime;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  walltime = ((stage1.tv_sec * 1000000 + stage1.tv_usec) - (start.tv_sec * 1000000 + start.tv_usec));</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  params-&gt;<a class="code" href="a00100.html#a8cd56611f6cd8c71a991c9ed2b97ca29">stage1_time</a> = (double) walltime / 1000000.0;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  walltime = ((stage2.tv_sec * 1000000 + stage2.tv_usec) - (stage1.tv_sec * 1000000 + stage1.tv_usec));</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  params-&gt;<a class="code" href="a00100.html#ab956b3ef566ffdd35d9ddc39c2662875">stage2_time</a> = (double) walltime / 1000000.0;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  walltime = ((stage3.tv_sec * 1000000 + stage3.tv_usec) - (stage2.tv_sec * 1000000 + stage2.tv_usec));</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  params-&gt;<a class="code" href="a00100.html#a45e5bf315927ed87c57bcf220ec49861">stage3_time</a> = (double) walltime / 1000000.0;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  walltime = ((stage4.tv_sec * 1000000 + stage4.tv_usec) - (stage3.tv_sec * 1000000 + stage3.tv_usec));</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  params-&gt;<a class="code" href="a00100.html#ac7df4fddfc5aa2827b346dcfd80346fb">stage4_time</a> = (double) walltime / 1000000.0;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  walltime = ((stage4.tv_sec * 1000000 + stage4.tv_usec) - (start.tv_sec * 1000000 + start.tv_usec));</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  params-&gt;<a class="code" href="a00100.html#abc276e47b85df9dd59f248e663b3b971">total_time</a> = (double) walltime / 1000000.0;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;}</div>
<div class="ttc" id="a00100_html_a8c48f135943fe35da85072714d4b1b23"><div class="ttname"><a href="a00100.html#a8c48f135943fe35da85072714d4b1b23">blocktridiagIterJacobi</a></div><div class="ttdeci">int blocktridiagIterJacobi(double *, double *, double *, double *, int, int, int, void *, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00386_source.html#l00088">blocktridiagIterJacobi.c:88</a></div></div>
<div class="ttc" id="a00100_html_adf756eb923ab79f911e38a82da7a6cab"><div class="ttname"><a href="a00100.html#adf756eb923ab79f911e38a82da7a6cab">_TRIDIAG_GS_</a></div><div class="ttdeci">#define _TRIDIAG_GS_</div><div class="ttdef"><b>Definition:</b> <a href="a00100_source.html#l00073">tridiagLU.h:73</a></div></div>
<div class="ttc" id="a00111_html_a2fc4a6b3bc38a4c6e804076ca1e94de0"><div class="ttname"><a href="a00111.html#a2fc4a6b3bc38a4c6e804076ca1e94de0">_MatrixInvert_</a></div><div class="ttdeci">#define _MatrixInvert_(A, B, N)</div><div class="ttdef"><b>Definition:</b> <a href="a00111_source.html#l00090">matops.h:90</a></div></div>
<div class="ttc" id="a00100_html_ab956b3ef566ffdd35d9ddc39c2662875"><div class="ttname"><a href="a00100.html#ab956b3ef566ffdd35d9ddc39c2662875">TridiagLU::stage2_time</a></div><div class="ttdeci">double stage2_time</div><div class="ttdef"><b>Definition:</b> <a href="a00100_source.html#l00100">tridiagLU.h:100</a></div></div>
<div class="ttc" id="a00100_html_a45e5bf315927ed87c57bcf220ec49861"><div class="ttname"><a href="a00100.html#a45e5bf315927ed87c57bcf220ec49861">TridiagLU::stage3_time</a></div><div class="ttdeci">double stage3_time</div><div class="ttdef"><b>Definition:</b> <a href="a00100_source.html#l00101">tridiagLU.h:101</a></div></div>
<div class="ttc" id="a00100_html_ac7df4fddfc5aa2827b346dcfd80346fb"><div class="ttname"><a href="a00100.html#ac7df4fddfc5aa2827b346dcfd80346fb">TridiagLU::stage4_time</a></div><div class="ttdeci">double stage4_time</div><div class="ttdef"><b>Definition:</b> <a href="a00100_source.html#l00102">tridiagLU.h:102</a></div></div>
<div class="ttc" id="a00100_html_a79ddfe354b89d113b72db4b5ae6c6e3d"><div class="ttname"><a href="a00100.html#a79ddfe354b89d113b72db4b5ae6c6e3d">_TRIDIAG_JACOBI_</a></div><div class="ttdeci">#define _TRIDIAG_JACOBI_</div><div class="ttdef"><b>Definition:</b> <a href="a00100_source.html#l00071">tridiagLU.h:71</a></div></div>
<div class="ttc" id="a00111_html_ac7d8b887f87e447fc24749ba3eea95e4"><div class="ttname"><a href="a00111.html#ac7d8b887f87e447fc24749ba3eea95e4">_MatrixZero_</a></div><div class="ttdeci">#define _MatrixZero_(A, N)</div><div class="ttdef"><b>Definition:</b> <a href="a00111_source.html#l00012">matops.h:12</a></div></div>
<div class="ttc" id="a00111_html_a625c8dc5d5de2ed16dc1a211fc998d36"><div class="ttname"><a href="a00111.html#a625c8dc5d5de2ed16dc1a211fc998d36">_MatrixMultiplySubtract_</a></div><div class="ttdeci">#define _MatrixMultiplySubtract_(C, A, B, N)</div><div class="ttdef"><b>Definition:</b> <a href="a00111_source.html#l00051">matops.h:51</a></div></div>
<div class="ttc" id="a00111_html_ab6aa501e79620e67e647017307e412f5"><div class="ttname"><a href="a00111.html#ab6aa501e79620e67e647017307e412f5">_MatrixMultiply_</a></div><div class="ttdeci">#define _MatrixMultiply_(A, B, C, N)</div><div class="ttdef"><b>Definition:</b> <a href="a00111_source.html#l00022">matops.h:22</a></div></div>
<div class="ttc" id="a00100_html_ae50ec60868beaab2cb84897adefda09f"><div class="ttname"><a href="a00100.html#ae50ec60868beaab2cb84897adefda09f">TridiagLU::reducedsolvetype</a></div><div class="ttdeci">char reducedsolvetype[50]</div><div class="ttdef"><b>Definition:</b> <a href="a00100_source.html#l00088">tridiagLU.h:88</a></div></div>
<div class="ttc" id="a00111_html_a41e1094e8869844c3e7bf9d8818b8276"><div class="ttname"><a href="a00111.html#a41e1094e8869844c3e7bf9d8818b8276">_MatVecMultiplySubtract_</a></div><div class="ttdeci">#define _MatVecMultiplySubtract_(y, A, x, N)</div><div class="ttdef"><b>Definition:</b> <a href="a00111_source.html#l00078">matops.h:78</a></div></div>
<div class="ttc" id="a00100_html_a00408"><div class="ttname"><a href="a00100.html#a00408">TridiagLU</a></div><div class="ttdef"><b>Definition:</b> <a href="a00100_source.html#l00081">tridiagLU.h:81</a></div></div>
<div class="ttc" id="a00100_html_abc276e47b85df9dd59f248e663b3b971"><div class="ttname"><a href="a00100.html#abc276e47b85df9dd59f248e663b3b971">TridiagLU::total_time</a></div><div class="ttdeci">double total_time</div><div class="ttdef"><b>Definition:</b> <a href="a00100_source.html#l00098">tridiagLU.h:98</a></div></div>
<div class="ttc" id="a00100_html_a8cd56611f6cd8c71a991c9ed2b97ca29"><div class="ttname"><a href="a00100.html#a8cd56611f6cd8c71a991c9ed2b97ca29">TridiagLU::stage1_time</a></div><div class="ttdeci">double stage1_time</div><div class="ttdef"><b>Definition:</b> <a href="a00100_source.html#l00099">tridiagLU.h:99</a></div></div>
<div class="ttc" id="a00111_html_a1318a4facf7b30129d0509f524a1eb3b"><div class="ttname"><a href="a00111.html#a1318a4facf7b30129d0509f524a1eb3b">_MatVecMultiply_</a></div><div class="ttdeci">#define _MatVecMultiply_(A, x, y, N)</div><div class="ttdef"><b>Definition:</b> <a href="a00111_source.html#l00064">matops.h:64</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a8c48f135943fe35da85072714d4b1b23"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int blocktridiagIterJacobi </td>
          <td>(</td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ns</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>bs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>r</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>m</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Solve block tridiagonal (non-periodic) systems of equations using point Jacobi iterations: This function can solve multiple independent systems with one call. The systems need not share the same left- or right-hand-sides. The initial guess is taken as the solution of </p><p class="formulaDsp">
\begin{equation} {\rm diag}\left[{\bf b}\right]{\bf x} = {\bf r} \end{equation}
</p>
<p> where \({\bf b}\) represents the diagonal elements of the tridiagonal system, and \({\bf r}\) is the right-hand-side, stored in \({\bf x}\) at the start of this function.</p>
<p>Array layout: The arguments <em>a</em>, <em>b</em>, and <em>c</em> are local 1D arrays (containing this processor's part of the subdiagonal, diagonal, and superdiagonal) of size (<em>n</em> X <em>ns</em> X <em>bs^2</em>), and <em>x</em> is a local 1D array (containing this processor's part of the right-hand-side, and will contain the solution on exit) of size (<em>n</em> X <em>ns</em> X <em>bs</em>), where <em>n</em> is the local size of the system, <em>ns</em> is the number of independent systems to solve, and <em>bs</em> is the block size. The ordering of the elements in these arrays is as follows:</p><ul>
<li>Each block is stored in the row-major format.</li>
<li>Blocks of the same row for each of the independent systems are stored adjacent to each other.</li>
</ul>
<p>For example, consider the following systems: </p><p class="formulaDsp">
\begin{equation} \left[\begin{array}{ccccc} B_0^k &amp; C_0^k &amp; &amp; &amp; \\ A_1^k &amp; B_1^k &amp; C_1^k &amp; &amp; \\ &amp; A_2^k &amp; B_2^k &amp; C_2^k &amp; &amp; \\ &amp; &amp; A_3^k &amp; B_3^k &amp; C_3^k &amp; \\ &amp; &amp; &amp; A_4^k &amp; B_4^k &amp; C_4^k \\ \end{array}\right] \left[\begin{array}{c} X_0^k \\ X_1^k \\ X_2^k \\ X_3^k \\ X_4^k \end{array}\right] = \left[\begin{array}{c} R_0^k \\ R_1^k \\ R_2^k \\ R_3^k \\ R_4^k \end{array}\right]; \ \ k= 1,\cdots,ns \end{equation}
</p>
<p> where \(A\), \(B\), and \(C\) are matrices of size <em>bs</em> = 2 (say), and let \( ns = 3\). In the equation above, we have </p><p class="formulaDsp">
\begin{equation} B_i^k = \left[\begin{array}{cc} b_{00,i}^k &amp; b_{01,i}^k \\ b_{10,i}^k &amp; b_{11,i}^k \end{array}\right], X_i^k = \left[\begin{array}{c} x_{0,i}^k \\ x_{1,i}^k \end{array} \right], R_i^k = \left[\begin{array}{c} r_{0,i}^k \\ r_{1,i}^k \end{array} \right] \end{equation}
</p>
<p> Note that in the code, \(X\) and \(R\) are the same array <em>x</em>.</p>
<p>Then, the array <em>b</em> must be a 1D array with the following layout of elements:<br />
[<br />
b_{00,0}^0, b_{01,0}^0, b_{10,0}^0, b_{11,0}^0, b_{00,0}^1, b_{01,0}^1, b_{10,0}^1, b_{11,0}^1, b_{00,0}^2, b_{01,0}^2, b_{10,0}^2, b_{11,0}^2, <br />
b_{00,1}^0, b_{01,1}^0, b_{10,1}^0, b_{11,1}^0, b_{00,1}^1, b_{01,1}^1, b_{10,1}^1, b_{11,1}^1, b_{00,1}^2, b_{01,1}^2, b_{10,1}^2, b_{11,1}^2, <br />
..., <br />
b_{00,n-1}^0, b_{01,n-1}^0, b_{10,n-1}^0, b_{11,n-1}^0, b_{00,n-1}^1, b_{01,n-1}^1, b_{10,n-1}^1, b_{11,n-1}^1, b_{00,n-1}^2, b_{01,n-1}^2, b_{10,n-1}^2, b_{11,n-1}^2<br />
]<br />
The arrays <em>a</em> and <em>c</em> are stored similarly.</p>
<p>The array corresponding to a vector (the solution and the right-hand-side <em>x</em>) must be a 1D array with the following layout of elements:<br />
[<br />
x_{0,0}^0, x_{1,0}^0, x_{0,0}^1, x_{1,0}^1,x_{0,0}^2, x_{1,0}^2,<br />
x_{0,1}^0, x_{1,1}^0, x_{0,1}^1, x_{1,1}^1,x_{0,1}^2, x_{1,1}^2,<br />
..., <br />
x_{0,n-1}^0, x_{1,n-1}^0, x_{0,n-1}^1, x_{1,n-1}^1,x_{0,n-1}^2, x_{1,n-1}^2<br />
]<br />
</p>
<p>Notes:</p><ul>
<li>This function does <em>not</em> preserve the sub-diagonal, diagonal, super-diagonal elements and the right-hand-sides.</li>
<li>The input array <em>x</em> contains the right-hand-side on entering the function, and the solution on exiting it. </li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">a</td><td>Array containing the sub-diagonal elements </td></tr>
    <tr><td class="paramname">b</td><td>Array containing the diagonal elements </td></tr>
    <tr><td class="paramname">c</td><td>Array containing the super-diagonal elements </td></tr>
    <tr><td class="paramname">x</td><td>Right-hand side; will contain the solution on exit </td></tr>
    <tr><td class="paramname">n</td><td>Local size of the system on this processor (<em>not</em> multiplied by the block size) </td></tr>
    <tr><td class="paramname">ns</td><td>Number of systems to solve </td></tr>
    <tr><td class="paramname">bs</td><td>Block size </td></tr>
    <tr><td class="paramname">r</td><td>Object of type <a class="el" href="a00100.html#a00408">TridiagLU</a> </td></tr>
    <tr><td class="paramname">m</td><td>MPI communicator </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00386_source.html#l00088">88</a> of file <a class="el" href="a00386_source.html">blocktridiagIterJacobi.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;{</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <a class="code" href="a00100.html#a00408">TridiagLU</a>  *context = (<a class="code" href="a00100.html#a00408">TridiagLU</a>*) r;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <span class="keywordtype">int</span>        iter,d,i,j,NT,bs2=bs*bs,nsbs=ns*bs;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <span class="keywordtype">double</span>     norm=0,norm0=0,global_norm=0;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="preprocessor">#ifndef serial</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  MPI_Comm  *comm = (MPI_Comm*) m;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <span class="keywordtype">int</span>       rank,nproc;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  <span class="keywordflow">if</span> (comm) {</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    MPI_Comm_size(*comm,&amp;nproc);</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    MPI_Comm_rank(*comm,&amp;rank);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    rank  = 0;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    nproc = 1;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  }</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <span class="keywordflow">if</span> (!context) {</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    fprintf(stderr,<span class="stringliteral">&quot;Error in tridiagIterJacobi(): NULL pointer passed for parameters!\n&quot;</span>);</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="keywordflow">return</span>(-1);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  }</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  <span class="keywordtype">double</span> *rhs = (<span class="keywordtype">double</span>*) calloc (ns*n*bs, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  <span class="keywordflow">for</span> (i=0; i&lt;ns*n*bs; i++) rhs[i] = x[i]; <span class="comment">/* save a copy of the rhs */</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  <span class="comment">/* initial guess */</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <span class="keywordflow">for</span> (i=0; i&lt;n; i++) {</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="keywordflow">for</span> (d=0; d&lt;ns; d++) {</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;      <span class="keywordtype">double</span> binv[bs2];</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      <a class="code" href="a00111.html#a2fc4a6b3bc38a4c6e804076ca1e94de0">_MatrixInvert_</a>    (b+(i*ns+d)*bs2,binv,bs);</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;      <a class="code" href="a00111.html#a1318a4facf7b30129d0509f524a1eb3b">_MatVecMultiply_</a>  (binv,rhs+(i*ns+d)*bs,x+(i*ns+d)*bs,bs);</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    }</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  }</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  <span class="keywordtype">double</span> *recvbufL, *recvbufR, *sendbufL, *sendbufR;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  recvbufL = (<span class="keywordtype">double</span>*) calloc (nsbs, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  recvbufR = (<span class="keywordtype">double</span>*) calloc (nsbs, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  sendbufL = (<span class="keywordtype">double</span>*) calloc (nsbs, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  sendbufR = (<span class="keywordtype">double</span>*) calloc (nsbs, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <span class="comment">/* total number of points */</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="preprocessor">#ifdef serial</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00100.html#a584c0fc0b1e845800ad511dffc60e032">evaluate_norm</a>)    NT = n;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <span class="keywordflow">else</span>                           NT = 0;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00100.html#a584c0fc0b1e845800ad511dffc60e032">evaluate_norm</a>) MPI_Allreduce(&amp;n,&amp;NT,1,MPI_INT,MPI_SUM,*comm);</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  <span class="keywordflow">else</span> NT = 0;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="preprocessor">#ifdef serial</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00100.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00100.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> &amp;&amp; (!rank)) printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  iter = 0;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <span class="keywordflow">while</span>(1) {</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="comment">/* evaluate break conditions */</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="keywordflow">if</span> (    (iter &gt;= context-&gt;<a class="code" href="a00100.html#a274519264a28477940f161ddb4b61feb">maxiter</a>) </div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        ||  (iter &amp;&amp; context-&gt;<a class="code" href="a00100.html#a584c0fc0b1e845800ad511dffc60e032">evaluate_norm</a> &amp;&amp; (global_norm &lt; context-&gt;atol)) </div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        ||  (iter &amp;&amp; context-&gt;<a class="code" href="a00100.html#a584c0fc0b1e845800ad511dffc60e032">evaluate_norm</a> &amp;&amp; (global_norm/norm0 &lt; context-&gt;rtol))  ) {</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    }</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="comment">/* Communicate the boundary x values between processors */</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="keywordflow">for</span> (d=0; d&lt;nsbs; d++)  recvbufL[d] = recvbufR[d] = 0;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="preprocessor">#ifndef serial</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    MPI_Request req[4] =  {MPI_REQUEST_NULL,MPI_REQUEST_NULL,MPI_REQUEST_NULL,MPI_REQUEST_NULL};</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="keywordflow">if</span> (rank)             MPI_Irecv(recvbufL,nsbs,MPI_DOUBLE,rank-1,2,*comm,&amp;req[0]);</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="keywordflow">if</span> (rank != nproc-1)  MPI_Irecv(recvbufR,nsbs,MPI_DOUBLE,rank+1,3,*comm,&amp;req[1]);</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="keywordflow">for</span> (d=0; d&lt;nsbs; d++) {</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;      sendbufL[d] = x[d];</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;      sendbufR[d] = x[(n-1)*nsbs+d];</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    }</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="keywordflow">if</span> (rank)             MPI_Isend(sendbufL,nsbs,MPI_DOUBLE,rank-1,3,*comm,&amp;req[2]);</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="keywordflow">if</span> (rank != nproc-1)  MPI_Isend(sendbufR,nsbs,MPI_DOUBLE,rank+1,2,*comm,&amp;req[3]);</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="comment">/* calculate error norm - interior */</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00100.html#a584c0fc0b1e845800ad511dffc60e032">evaluate_norm</a>) {</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;      norm = 0;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      <span class="keywordflow">for</span> (i=1; i&lt;n-1; i++) {</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <span class="keywordflow">for</span> (d=0; d&lt;ns; d++) {</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;          <span class="keywordtype">double</span> err[bs]; <span class="keywordflow">for</span> (j=0; j&lt;bs; j++) err[j] = rhs[(i*ns+d)*bs+j];</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;          <a class="code" href="a00111.html#a41e1094e8869844c3e7bf9d8818b8276">_MatVecMultiplySubtract_</a>(err,a+(i*ns+d)*bs2,x+((i-1)*ns+d)*bs,bs);</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;          <a class="code" href="a00111.html#a41e1094e8869844c3e7bf9d8818b8276">_MatVecMultiplySubtract_</a>(err,b+(i*ns+d)*bs2,x+((i  )*ns+d)*bs,bs);</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;          <a class="code" href="a00111.html#a41e1094e8869844c3e7bf9d8818b8276">_MatVecMultiplySubtract_</a>(err,c+(i*ns+d)*bs2,x+((i+1)*ns+d)*bs,bs);</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;          <span class="keywordflow">for</span> (j=0; j&lt;bs; j++) norm += (err[j]*err[j]);</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        }</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      }</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    }</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="comment">/* calculate error norm - boundary */</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="preprocessor">#ifndef serial</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    MPI_Waitall(4,req,MPI_STATUS_IGNORE);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00100.html#a584c0fc0b1e845800ad511dffc60e032">evaluate_norm</a>) {</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      <span class="keywordflow">if</span> (n &gt; 1) {</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <span class="keywordflow">for</span> (d=0; d&lt;ns; d++) {</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;          <span class="keywordtype">double</span> err[bs]; <span class="keywordflow">for</span> (j=0; j&lt;bs; j++) err[j] = rhs[d*bs+j];</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;          <a class="code" href="a00111.html#a41e1094e8869844c3e7bf9d8818b8276">_MatVecMultiplySubtract_</a>(err,a+d*bs2,recvbufL+d*bs,bs);</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;          <a class="code" href="a00111.html#a41e1094e8869844c3e7bf9d8818b8276">_MatVecMultiplySubtract_</a>(err,b+d*bs2,x+d*bs,bs);</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;          <a class="code" href="a00111.html#a41e1094e8869844c3e7bf9d8818b8276">_MatVecMultiplySubtract_</a>(err,c+d*bs2,x+(ns+d)*bs,bs);</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;          <span class="keywordflow">for</span> (j=0; j&lt;bs; j++) norm += (err[j]*err[j]);</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        }</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        <span class="keywordflow">for</span> (d=0; d&lt;ns; d++) {</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;          <span class="keywordtype">double</span> err[bs]; <span class="keywordflow">for</span> (j=0; j&lt;bs; j++) err[j] = rhs[(d+ns*(n-1))*bs+j];</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;          <a class="code" href="a00111.html#a41e1094e8869844c3e7bf9d8818b8276">_MatVecMultiplySubtract_</a>(err,a+(d+ns*(n-1))*bs2,x+(d+ns*(n-2))*bs,bs);</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;          <a class="code" href="a00111.html#a41e1094e8869844c3e7bf9d8818b8276">_MatVecMultiplySubtract_</a>(err,b+(d+ns*(n-1))*bs2,x+(d+ns*(n-1))*bs,bs);</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;          <a class="code" href="a00111.html#a41e1094e8869844c3e7bf9d8818b8276">_MatVecMultiplySubtract_</a>(err,c+(d+ns*(n-1))*bs2,recvbufR+d*bs,bs);</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;          <span class="keywordflow">for</span> (j=0; j&lt;bs; j++) norm += (err[j]*err[j]);</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        }</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        <span class="keywordflow">for</span> (d=0; d&lt;ns; d++) {</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;          <span class="keywordtype">double</span> err[bs]; <span class="keywordflow">for</span> (j=0; j&lt;bs; j++) err[j] = rhs[d*bs+j];</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;          <a class="code" href="a00111.html#a41e1094e8869844c3e7bf9d8818b8276">_MatVecMultiplySubtract_</a>(err,a+d*bs2,recvbufL+d*bs,bs);</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;          <a class="code" href="a00111.html#a41e1094e8869844c3e7bf9d8818b8276">_MatVecMultiplySubtract_</a>(err,b+d*bs2,x+d*bs,bs);</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;          <a class="code" href="a00111.html#a41e1094e8869844c3e7bf9d8818b8276">_MatVecMultiplySubtract_</a>(err,c+d*bs2,recvbufR+d*bs,bs);</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;          <span class="keywordflow">for</span> (j=0; j&lt;bs; j++) norm += (err[j]*err[j]);</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        }</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      }</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;      <span class="comment">/* sum over all processes */</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="preprocessor">#ifdef serial</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      global_norm = norm;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;      MPI_Allreduce(&amp;norm,&amp;global_norm,1,MPI_DOUBLE,MPI_SUM,*comm);</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      global_norm = sqrt(global_norm/NT);</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;      <span class="keywordflow">if</span> (!iter) norm0 = global_norm;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;      norm = -1.0;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;      global_norm = -1.0;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    }</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="preprocessor">#ifdef serial</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00100.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="keywordflow">if</span> (context-&gt;<a class="code" href="a00100.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> &amp;&amp; (!rank))</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;      printf(<span class="stringliteral">&quot;\t\titer: %d, norm: %1.16E\n&quot;</span>,iter,global_norm);</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="comment">/* correct the solution for this iteration */</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="keywordflow">if</span> (n &gt; 1) {</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;      <span class="keywordflow">for</span> (d=0; d&lt;ns; d++) {</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        <span class="keywordtype">double</span> xt[bs],binv[bs2];</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        </div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        i = 0;    </div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        <span class="keywordflow">for</span> (j=0; j&lt;bs; j++) xt[j] = rhs[(i*ns+d)*bs+j];</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        <a class="code" href="a00111.html#a41e1094e8869844c3e7bf9d8818b8276">_MatVecMultiplySubtract_</a>(xt,a+(i*ns+d)*bs2,recvbufL+d*bs,bs);</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        <a class="code" href="a00111.html#a41e1094e8869844c3e7bf9d8818b8276">_MatVecMultiplySubtract_</a>(xt,c+(i*ns+d)*bs2,x+(d+ns*(i+1))*bs,bs);</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        <a class="code" href="a00111.html#a2fc4a6b3bc38a4c6e804076ca1e94de0">_MatrixInvert_</a>(b+(i*ns+d)*bs2,binv,bs);</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        <a class="code" href="a00111.html#a1318a4facf7b30129d0509f524a1eb3b">_MatVecMultiply_</a>(binv,xt,x+(i*ns+d)*bs,bs);</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        i = n-1;  </div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        <span class="keywordflow">for</span> (j=0; j&lt;bs; j++) xt[j] = rhs[(i*ns+d)*bs+j];</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        <a class="code" href="a00111.html#a41e1094e8869844c3e7bf9d8818b8276">_MatVecMultiplySubtract_</a>(xt,a+(i*ns+d)*bs2,x+(d+ns*(i-1))*bs,bs);</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        <a class="code" href="a00111.html#a41e1094e8869844c3e7bf9d8818b8276">_MatVecMultiplySubtract_</a>(xt,c+(i*ns+d)*bs2,recvbufR+d*bs,bs);</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        <a class="code" href="a00111.html#a2fc4a6b3bc38a4c6e804076ca1e94de0">_MatrixInvert_</a>(b+(i*ns+d)*bs2,binv,bs);</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        <a class="code" href="a00111.html#a1318a4facf7b30129d0509f524a1eb3b">_MatVecMultiply_</a>(binv,xt,x+(i*ns+d)*bs,bs);</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;      }</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      <span class="keywordflow">for</span> (i=1; i&lt;n-1; i++) {</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        <span class="keywordflow">for</span> (d=0; d&lt;ns; d++) {</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;          <span class="keywordtype">double</span> xt[bs],binv[bs2];</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;          <span class="keywordflow">for</span> (j=0; j&lt;bs; j++) xt[j] = rhs[(i*ns+d)*bs+j];</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;          <a class="code" href="a00111.html#a41e1094e8869844c3e7bf9d8818b8276">_MatVecMultiplySubtract_</a>(xt,a+(i*ns+d)*bs2,x+(d+ns*(i-1))*bs,bs);</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;          <a class="code" href="a00111.html#a41e1094e8869844c3e7bf9d8818b8276">_MatVecMultiplySubtract_</a>(xt,c+(i*ns+d)*bs2,x+(d+ns*(i+1))*bs,bs);</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;          <a class="code" href="a00111.html#a2fc4a6b3bc38a4c6e804076ca1e94de0">_MatrixInvert_</a>(b+(i*ns+d)*bs2,binv,bs);</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;          <a class="code" href="a00111.html#a1318a4facf7b30129d0509f524a1eb3b">_MatVecMultiply_</a>(binv,xt,x+(i*ns+d)*bs,bs);</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        }</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;      }</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;      <span class="keywordflow">for</span> (d=0; d&lt;ns; d++) {</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        <span class="keywordtype">double</span> xt[bs],binv[bs2];</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        <span class="keywordflow">for</span> (j=0; j&lt;bs; j++) xt[j] = rhs[d*bs+j];</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        <a class="code" href="a00111.html#a41e1094e8869844c3e7bf9d8818b8276">_MatVecMultiplySubtract_</a>(xt,a+d*bs2,recvbufL+d*bs,bs);</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        <a class="code" href="a00111.html#a41e1094e8869844c3e7bf9d8818b8276">_MatVecMultiplySubtract_</a>(xt,c+d*bs2,recvbufR+d*bs,bs);</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        <a class="code" href="a00111.html#a2fc4a6b3bc38a4c6e804076ca1e94de0">_MatrixInvert_</a>(b+d*bs2,binv,bs);</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        <a class="code" href="a00111.html#a1318a4facf7b30129d0509f524a1eb3b">_MatVecMultiply_</a>(binv,xt,x+d*bs,bs);</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;      }</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    }</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="comment">/* finished with this iteration */</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    iter++;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  }</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  <span class="comment">/* save convergence information */</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  context-&gt;<a class="code" href="a00100.html#a0a20107c06f29ce4d4ac23a4e7cfb17a">exitnorm</a> = (context-&gt;<a class="code" href="a00100.html#a584c0fc0b1e845800ad511dffc60e032">evaluate_norm</a> ? global_norm : -1.0);</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  context-&gt;<a class="code" href="a00100.html#a846172807b19cf19a2587ede74b06828">exititer</a> = iter;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  free(rhs);</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  free(sendbufL);</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  free(sendbufR);</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  free(recvbufL);</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  free(recvbufR);</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;}</div>
<div class="ttc" id="a00111_html_a2fc4a6b3bc38a4c6e804076ca1e94de0"><div class="ttname"><a href="a00111.html#a2fc4a6b3bc38a4c6e804076ca1e94de0">_MatrixInvert_</a></div><div class="ttdeci">#define _MatrixInvert_(A, B, N)</div><div class="ttdef"><b>Definition:</b> <a href="a00111_source.html#l00090">matops.h:90</a></div></div>
<div class="ttc" id="a00100_html_a584c0fc0b1e845800ad511dffc60e032"><div class="ttname"><a href="a00100.html#a584c0fc0b1e845800ad511dffc60e032">TridiagLU::evaluate_norm</a></div><div class="ttdeci">int evaluate_norm</div><div class="ttdef"><b>Definition:</b> <a href="a00100_source.html#l00090">tridiagLU.h:90</a></div></div>
<div class="ttc" id="a00100_html_a0a20107c06f29ce4d4ac23a4e7cfb17a"><div class="ttname"><a href="a00100.html#a0a20107c06f29ce4d4ac23a4e7cfb17a">TridiagLU::exitnorm</a></div><div class="ttdeci">double exitnorm</div><div class="ttdef"><b>Definition:</b> <a href="a00100_source.html#l00095">tridiagLU.h:95</a></div></div>
<div class="ttc" id="a00100_html_a846172807b19cf19a2587ede74b06828"><div class="ttname"><a href="a00100.html#a846172807b19cf19a2587ede74b06828">TridiagLU::exititer</a></div><div class="ttdeci">int exititer</div><div class="ttdef"><b>Definition:</b> <a href="a00100_source.html#l00094">tridiagLU.h:94</a></div></div>
<div class="ttc" id="a00111_html_a41e1094e8869844c3e7bf9d8818b8276"><div class="ttname"><a href="a00111.html#a41e1094e8869844c3e7bf9d8818b8276">_MatVecMultiplySubtract_</a></div><div class="ttdeci">#define _MatVecMultiplySubtract_(y, A, x, N)</div><div class="ttdef"><b>Definition:</b> <a href="a00111_source.html#l00078">matops.h:78</a></div></div>
<div class="ttc" id="a00100_html_a00408"><div class="ttname"><a href="a00100.html#a00408">TridiagLU</a></div><div class="ttdef"><b>Definition:</b> <a href="a00100_source.html#l00081">tridiagLU.h:81</a></div></div>
<div class="ttc" id="a00100_html_a274519264a28477940f161ddb4b61feb"><div class="ttname"><a href="a00100.html#a274519264a28477940f161ddb4b61feb">TridiagLU::maxiter</a></div><div class="ttdeci">int maxiter</div><div class="ttdef"><b>Definition:</b> <a href="a00100_source.html#l00091">tridiagLU.h:91</a></div></div>
<div class="ttc" id="a00111_html_a1318a4facf7b30129d0509f524a1eb3b"><div class="ttname"><a href="a00111.html#a1318a4facf7b30129d0509f524a1eb3b">_MatVecMultiply_</a></div><div class="ttdeci">#define _MatVecMultiply_(A, x, y, N)</div><div class="ttdef"><b>Definition:</b> <a href="a00111_source.html#l00064">matops.h:64</a></div></div>
<div class="ttc" id="a00100_html_a0b2caeb4b6f130be43e5a2f0267dd453"><div class="ttname"><a href="a00100.html#a0b2caeb4b6f130be43e5a2f0267dd453">TridiagLU::verbose</a></div><div class="ttdeci">int verbose</div><div class="ttdef"><b>Definition:</b> <a href="a00100_source.html#l00096">tridiagLU.h:96</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">
var sc_project=10897352; 
var sc_invisible=1; 
var sc_security="83042f57"; 
var scJsHost = (("https:" == document.location.protocol) ?
"https://secure." : "http://www.");
document.write("<sc"+"ript type='text/javascript' src='" +
scJsHost+
"statcounter.com/counter/counter.js'></"+"script>");
</script>
<noscript><div class="statcounter"><a title="free hit
counters" href="http://statcounter.com/free-hit-counter/"
target="_blank"><img class="statcounter"
src="http://c.statcounter.com/10897352/0/83042f57/1/"
alt="free hit counters"></a></div></noscript>
<!-- End of StatCounter Code for Default Guide -->
