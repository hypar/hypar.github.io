<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>HyPar: src/IOFunctions/ReadArray.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_html_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">HyPar
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">Finite-Difference Hyperbolic-Parabolic PDE Solver on Cartesian Grids</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('a01418.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">ReadArray.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Read in a vector field from file.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;<a class="el" href="a00965_source.html">basic.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="a00956_source.html">arrayfunctions.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="a01022_source.html">mpivars.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="a00986_source.html">hypar.h</a>&gt;</code><br />
</div>
<p><a href="a01418_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:adad6ec70ca9a4a6fef53b7d2abc8b270"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a01418.html#adad6ec70ca9a4a6fef53b7d2abc8b270">ReadArraySerial</a> (int, int, int *, int *, int, void *, void *, double *, double *, char *, int *)</td></tr>
<tr class="separator:adad6ec70ca9a4a6fef53b7d2abc8b270"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adaa1bd7f962777f3b7ce886a94a8338e"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a01418.html#adaa1bd7f962777f3b7ce886a94a8338e">ReadArrayParallel</a> (int, int, int *, int *, int, void *, void *, double *, double *, char *, int *)</td></tr>
<tr class="separator:adaa1bd7f962777f3b7ce886a94a8338e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac69cac66cd56d57f21a094418a649714"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a01418.html#ac69cac66cd56d57f21a094418a649714">ReadArrayMPI_IO</a> (int, int, int *, int *, int, void *, void *, double *, double *, char *, int *)</td></tr>
<tr class="separator:ac69cac66cd56d57f21a094418a649714"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a61cd8732591552b50c4aeeeb729d8bd3"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a01418.html#a61cd8732591552b50c4aeeeb729d8bd3">ReadArray</a> (int ndims, int nvars, int *dim_global, int *dim_local, int ghosts, void *s, void *m, double *x, double *u, char *fname_root, int *read_flag)</td></tr>
<tr class="separator:a61cd8732591552b50c4aeeeb729d8bd3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Read in a vector field from file. </p>
<dl class="section author"><dt>Author</dt><dd>Debojyoti Ghosh </dd></dl>

<p class="definition">Definition in file <a class="el" href="a01418_source.html">ReadArray.c</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="adad6ec70ca9a4a6fef53b7d2abc8b270"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adad6ec70ca9a4a6fef53b7d2abc8b270">&#9670;&nbsp;</a></span>ReadArraySerial()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int ReadArraySerial </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ndims</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nvars</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>dim_global</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>dim_local</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ghosts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>fname_root</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>read_flag</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Read an array in a serial fashion: For multi-processor simulation, only rank 0 reads in the entire solution from the file, and then distributes the relevant portions to each of the processors. This involves memory allocation for the global domain on rank 0. Thus, do not use for large domains. This approach is not very scalable either, if running with a very large number of processors (&gt; 1000). Supports both binary and ASCII formats. <br />
<br />
The name of the file being read is &lt;fname_root&gt;.inp <br />
<br />
<b>ASCII</b> format:-<br />
The input file should contain the ASCII data as follows:<br />
<br />
x0_i (0 &lt;= i &lt; dim_global[0])<br />
x1_i (0 &lt;= i &lt; dim_global[1])<br />
...<br />
x{ndims-1}_i (0 &lt;= i &lt; dim_global[ndims-1])<br />
u0_p (0 &lt;= p &lt; N)<br />
u1_p (0 &lt;= p &lt; N)<br />
...<br />
u{nvars-1}_p (0 &lt;= p &lt; N)<br />
<br />
where <br />
x0, x1, ..., x{ndims-1} represent the spatial dimensions (for a 3D problem, x0 = x, x1 = y, x2 = z),<br />
u0, u1, ..., u{nvars-1} are each component of the vector u,<br />
N = dim_global[0]*dim_global[1]*...*dim_global[ndims-1] is the total number of points,<br />
and p = i0 + dim_global[0]*( i1 + dim_global[1]*( i2 + dim_global[2]*( ... + dim_global[ndims-2]*i{ndims-1} ))) (see <a class="el" href="a00956.html#a03f49e4d44ae8aca85cb04cfe91e4ce4">_ArrayIndexnD_</a>)<br />
with i0, i1, i2, etc representing grid indices along each spatial dimension, i.e.,<br />
0 &lt;= i0 &lt; dim_global[0]-1<br />
0 &lt;= i1 &lt; dim_global[1]-1<br />
...<br />
0 &lt;= i{ndims-1} &lt; dim_global[ndims=1]-1<br />
<br />
<br />
<b>Binary</b> format:-<br />
The input file should contain the binary data in as follows:<br />
<br />
x0_i (0 &lt;= i &lt; dim_global[0])<br />
x1_i (0 &lt;= i &lt; dim_global[1])<br />
...<br />
x{ndims-1}_i (0 &lt;= i &lt; dim_global[ndims-1])<br />
[u0,u1,...,u{nvars-1}]_p (0 &lt;= p &lt; N) (with no commas)<br />
<br />
where <br />
x0, x1, ..., x{ndims-1} represent the spatial dimensions (for a 3D problem, x0 = x, x1 = y, x2 = z),<br />
u0, u1, ..., u{nvars-1} are each component of the vector u at a grid point,<br />
N = dim_global[0]*dim_global[1]*...*dim_global[ndims-1] is the total number of points,<br />
and p = i0 + dim_global[0]*( i1 + dim_global[1]*( i2 + dim_global[2]*( ... + dim_global[ndims-2]*i{ndims-1} ))) (see <a class="el" href="a00956.html#a03f49e4d44ae8aca85cb04cfe91e4ce4">_ArrayIndexnD_</a>)<br />
with i0, i1, i2, etc representing grid indices along each spatial dimension, i.e.,<br />
0 &lt;= i0 &lt; dim_global[0]-1<br />
0 &lt;= i1 &lt; dim_global[1]-1<br />
...<br />
0 &lt;= i{ndims-1} &lt; dim_global[ndims=1]-1<br />
<br />
For serial runs, this is the only input mode (of course!). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ndims</td><td>Number of spatial dimensions </td></tr>
    <tr><td class="paramname">nvars</td><td>Number of variables per grid point </td></tr>
    <tr><td class="paramname">dim_global</td><td>Integer array of size ndims with global grid size in each dimension </td></tr>
    <tr><td class="paramname">dim_local</td><td>Integer array of size ndims with local grid size in each dimension </td></tr>
    <tr><td class="paramname">ghosts</td><td>Number of ghost points </td></tr>
    <tr><td class="paramname">s</td><td>Solver object of type <a class="el" href="a02289.html" title="Structure containing all solver-specific variables and functions. ">HyPar</a> </td></tr>
    <tr><td class="paramname">m</td><td>MPI object of type <a class="el" href="a01028.html#a02329" title="Structure of MPI-related variables. ">MPIVariables</a> </td></tr>
    <tr><td class="paramname">x</td><td>Grid associated with the array (can be NULL) </td></tr>
    <tr><td class="paramname">u</td><td>Array to hold the vector field being read </td></tr>
    <tr><td class="paramname">fname_root</td><td>Filename root </td></tr>
    <tr><td class="paramname">read_flag</td><td>Flag to indicate if the file was read </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="a01418_source.html#l00150">150</a> of file <a class="el" href="a01418_source.html">ReadArray.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;{</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  <a class="code" href="a02289.html">HyPar</a>         *solver = (<a class="code" href="a02289.html">HyPar</a>*)        s;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <a class="code" href="a01028.html#a02329">MPIVariables</a>  *mpi    = (<a class="code" href="a01028.html#a02329">MPIVariables</a>*) m;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  <span class="keywordtype">int</span>           i, d, ferr, index[ndims];</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <span class="keywordtype">double</span>        *ug = NULL, *xg = NULL;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <a class="code" href="a00965.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a>;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  *read_flag = 0;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  <span class="comment">/* Only root process reads from the file */</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a01028.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) {</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a02289.html#a83f3dcd022f744511a44f2a31a824ac8">ip_file_type</a>,<span class="stringliteral">&quot;ascii&quot;</span>)) {</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      <span class="keywordtype">char</span> filename[<a class="code" href="a00965.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>];</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;      strcpy(filename,fname_root);</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;      strcat(filename,<span class="stringliteral">&quot;.inp&quot;</span>);</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;      FILE *in; in = fopen(filename,<span class="stringliteral">&quot;r&quot;</span>);</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;      <span class="keywordflow">if</span> (!in) *read_flag = 0;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        *read_flag = 1;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <span class="comment">/* Reading from file */</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        printf(<span class="stringliteral">&quot;Reading array from ASCII file %s (Serial mode).\n&quot;</span>,filename);</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        <span class="keywordtype">int</span> size,offset;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <span class="comment">/* allocate global solution array */</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        size  = 1; <span class="keywordflow">for</span> (d=0; d&lt;ndims; d++) size *= dim_global[d]; size *= nvars;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        ug    = (<span class="keywordtype">double</span>*) calloc(size,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        size  = 0; <span class="keywordflow">for</span> (d=0; d&lt;ndims; d++) size += dim_global[d];</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        xg    = (<span class="keywordtype">double</span>*) calloc(size,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        <span class="comment">/* read grid */</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        offset = 0;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        <span class="keywordflow">for</span> (d = 0; d &lt; ndims; d++) {</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;          <span class="keywordflow">for</span> (i = 0; i &lt; dim_global[d]; i++) {</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;            ferr = fscanf(in,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;xg[i+offset]);</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;            <span class="keywordflow">if</span> (ferr != 1) {</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;              printf(<span class="stringliteral">&quot;Error in ReadArraySerial(): unable to read data. ferr=%d\n&quot;</span>, ferr);</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;              exit(1);</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;            }</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;          }</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;          offset += dim_global[d];</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        }</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        <span class="comment">/* read solution */</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        <span class="keywordflow">for</span> (i = 0; i &lt; nvars; i++) {</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;          <span class="keywordtype">int</span> done = 0; <a class="code" href="a00956.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(index,ndims,0);</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;          <span class="keywordflow">while</span> (!done) {</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;            <span class="keywordtype">int</span> p; <a class="code" href="a00956.html#afbb862a2fdf5b72b1f9ace42f64b556f">_ArrayIndex1D_</a>(ndims,dim_global,index,0,p);</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;            ferr = fscanf(in,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;ug[p*nvars+i]);</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;            <span class="keywordflow">if</span> (ferr != 1) {</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;              printf(<span class="stringliteral">&quot;Error in ReadArraySerial(): unable to read data. ferr=%d\n&quot;</span>, ferr);</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;              exit(1);</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            }</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;            <a class="code" href="a00956.html#ac5ec1371623f11d03b0f42adaa24acbc">_ArrayIncrementIndex_</a>(ndims,dim_global,index,done);</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;          }</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        }</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        fclose(in);</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;      }</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((!strcmp(solver-&gt;<a class="code" href="a02289.html#a83f3dcd022f744511a44f2a31a824ac8">ip_file_type</a>,<span class="stringliteral">&quot;bin&quot;</span>)) || (!strcmp(solver-&gt;<a class="code" href="a02289.html#a83f3dcd022f744511a44f2a31a824ac8">ip_file_type</a>,<span class="stringliteral">&quot;binary&quot;</span>))) {</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;      <span class="keywordtype">char</span> filename[<a class="code" href="a00965.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>];</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      strcpy(filename,fname_root);</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;      strcat(filename,<span class="stringliteral">&quot;.inp&quot;</span>);</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;      FILE *in; in = fopen(filename,<span class="stringliteral">&quot;rb&quot;</span>);</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;      <span class="keywordflow">if</span> (!in) *read_flag = 0;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        *read_flag = 1;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        printf(<span class="stringliteral">&quot;Reading array from binary file %s (Serial mode).\n&quot;</span>,filename);</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        <span class="keywordtype">size_t</span> bytes;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        <span class="keywordtype">int</span> size;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        <span class="comment">/* allocate global solution array */</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        size  = 1; <span class="keywordflow">for</span> (d=0; d&lt;ndims; d++) size *= dim_global[d]; size *= nvars;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        ug = (<span class="keywordtype">double</span>*) calloc(size,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        size = 0; <span class="keywordflow">for</span> (d=0; d&lt;ndims; d++) size += dim_global[d];</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        xg      = (<span class="keywordtype">double</span>*) calloc(size,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        <span class="comment">/* read grid */</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        size = 0;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        <span class="keywordflow">for</span> (d = 0; d &lt; ndims; d++) size += dim_global[d];</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        bytes = fread(xg, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>), size, in);</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)bytes != size) {</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;          fprintf(stderr,<span class="stringliteral">&quot;Error in ReadArray(): Unable to read grid. Expected %d, Read %d.\n&quot;</span>,</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                  size, (<span class="keywordtype">int</span>)bytes);</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        }</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        <span class="comment">/* read solution */</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        size = 1;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        <span class="keywordflow">for</span> (d = 0; d &lt; ndims; d++) size *= dim_global[d]; size *= nvars;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        bytes = fread(ug, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>), size, in);</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)bytes != size) {</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;          fprintf(stderr,<span class="stringliteral">&quot;Error in ReadArray(): Unable to read solution. Expected %d, Read %d.\n&quot;</span>,</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                  size, (<span class="keywordtype">int</span>)bytes);</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        }</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        fclose(in);</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;      }</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    }</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  }</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  <span class="comment">/* Broadcast read_flag to all processes */</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <a class="code" href="a00965.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a01022.html#acd7957559b9206224c7da3cab4f22b27">MPIBroadcast_integer</a>(read_flag,1,0,&amp;mpi-&gt;<a class="code" href="a01028.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00965.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  <span class="keywordflow">if</span> (*read_flag) {</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="comment">/* partition global array to all processes */</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <a class="code" href="a00965.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a01022.html#a690395a8c8453cdfb455de275a46be07">MPIPartitionArraynD</a>(ndims,mpi,(mpi-&gt;<a class="code" href="a01028.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>?NULL:ug),u,dim_global,</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                             dim_local,ghosts,nvars); <a class="code" href="a00965.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="keywordflow">if</span> (x) {</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;      <span class="comment">/* partition x vector across the processes */</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;      <span class="keywordtype">int</span> offset_global = 0, offset_local = 0;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;      <span class="keywordflow">for</span> (d=0; d&lt;ndims; d++) {</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        <a class="code" href="a00965.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a01022.html#a77f4e7a03979d9fabce2a536a113ff42">MPIPartitionArray1D</a>(mpi,(mpi-&gt;<a class="code" href="a01028.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>?NULL:&amp;xg[offset_global]),</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                                 &amp;x[offset_local+ghosts],</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                                 mpi-&gt;<a class="code" href="a01028.html#a481013ba007a99a4237cde5eeb3c9a29">is</a>[d],mpi-&gt;<a class="code" href="a01028.html#a7602de5ebb1b59ec35217e78a35a531e">ie</a>[d],dim_local[d],0); <a class="code" href="a00965.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        offset_global += dim_global[d];</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        offset_local  += dim_local [d] + 2*ghosts;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;      }</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    }</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="comment">/* free global arrays */</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a01028.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) {</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      free(ug);</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;      free(xg);</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    }</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  }</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  <span class="keywordflow">return</span>(0);</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;}</div><div class="ttc" id="a00965_html_add9cf96ae374934d245a1dc1ab697a42"><div class="ttname"><a href="a00965.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a></div><div class="ttdeci">#define CHECKERR(ierr)</div><div class="ttdef"><b>Definition:</b> <a href="a00965_source.html#l00018">basic.h:18</a></div></div>
<div class="ttc" id="a00956_html_ac5ec1371623f11d03b0f42adaa24acbc"><div class="ttname"><a href="a00956.html#ac5ec1371623f11d03b0f42adaa24acbc">_ArrayIncrementIndex_</a></div><div class="ttdeci">#define _ArrayIncrementIndex_(N, imax, i, done)</div><div class="ttdef"><b>Definition:</b> <a href="a00956_source.html#l00126">arrayfunctions.h:126</a></div></div>
<div class="ttc" id="a01022_html_a690395a8c8453cdfb455de275a46be07"><div class="ttname"><a href="a01022.html#a690395a8c8453cdfb455de275a46be07">MPIPartitionArraynD</a></div><div class="ttdeci">int MPIPartitionArraynD(int, void *, double *, double *, int *, int *, int, int)</div><div class="ttdef"><b>Definition:</b> <a href="a01511_source.html#l00021">MPIPartitionArraynD.c:21</a></div></div>
<div class="ttc" id="a00965_html_a51efea86a4d76d1259893f606b776573"><div class="ttname"><a href="a00965.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a></div><div class="ttdeci">#define _MAX_STRING_SIZE_</div><div class="ttdef"><b>Definition:</b> <a href="a00965_source.html#l00014">basic.h:14</a></div></div>
<div class="ttc" id="a01028_html_adad7a6f85831f3ac84d854b6c80aef43"><div class="ttname"><a href="a01028.html#adad7a6f85831f3ac84d854b6c80aef43">MPIVariables::world</a></div><div class="ttdeci">MPI_Comm world</div><div class="ttdef"><b>Definition:</b> <a href="a01028_source.html#l00037">mpivars_struct.h:37</a></div></div>
<div class="ttc" id="a00956_html_a2b2826031c0cd92495ab351d3e599fc5"><div class="ttname"><a href="a00956.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a></div><div class="ttdeci">#define _ArraySetValue_(x, size, value)</div><div class="ttdef"><b>Definition:</b> <a href="a00956_source.html#l00169">arrayfunctions.h:169</a></div></div>
<div class="ttc" id="a01028_html_a02329"><div class="ttname"><a href="a01028.html#a02329">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a01028_source.html#l00024">mpivars_struct.h:24</a></div></div>
<div class="ttc" id="a00965_html_a68f50121fb9a7daeaf60e50cdef82ef3"><div class="ttname"><a href="a00965.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a></div><div class="ttdeci">#define _DECLARE_IERR_</div><div class="ttdef"><b>Definition:</b> <a href="a00965_source.html#l00017">basic.h:17</a></div></div>
<div class="ttc" id="a01028_html_a481013ba007a99a4237cde5eeb3c9a29"><div class="ttname"><a href="a01028.html#a481013ba007a99a4237cde5eeb3c9a29">MPIVariables::is</a></div><div class="ttdeci">int * is</div><div class="ttdef"><b>Definition:</b> <a href="a01028_source.html#l00029">mpivars_struct.h:29</a></div></div>
<div class="ttc" id="a00965_html_ad6ab74942c9de13cf0b4c12eb0d91780"><div class="ttname"><a href="a00965.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a></div><div class="ttdeci">#define IERR</div><div class="ttdef"><b>Definition:</b> <a href="a00965_source.html#l00016">basic.h:16</a></div></div>
<div class="ttc" id="a01022_html_a77f4e7a03979d9fabce2a536a113ff42"><div class="ttname"><a href="a01022.html#a77f4e7a03979d9fabce2a536a113ff42">MPIPartitionArray1D</a></div><div class="ttdeci">int MPIPartitionArray1D(void *, double *, double *, int, int, int, int)</div><div class="ttdef"><b>Definition:</b> <a href="a01508_source.html#l00025">MPIPartitionArray1D.c:25</a></div></div>
<div class="ttc" id="a02289_html_a83f3dcd022f744511a44f2a31a824ac8"><div class="ttname"><a href="a02289.html#a83f3dcd022f744511a44f2a31a824ac8">HyPar::ip_file_type</a></div><div class="ttdeci">char ip_file_type[_MAX_STRING_SIZE_]</div><div class="ttdef"><b>Definition:</b> <a href="a00986_source.html#l00180">hypar.h:180</a></div></div>
<div class="ttc" id="a01022_html_acd7957559b9206224c7da3cab4f22b27"><div class="ttname"><a href="a01022.html#acd7957559b9206224c7da3cab4f22b27">MPIBroadcast_integer</a></div><div class="ttdeci">int MPIBroadcast_integer(int *, int, int, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a01466_source.html#l00023">MPIBroadcast.c:23</a></div></div>
<div class="ttc" id="a01028_html_a7602de5ebb1b59ec35217e78a35a531e"><div class="ttname"><a href="a01028.html#a7602de5ebb1b59ec35217e78a35a531e">MPIVariables::ie</a></div><div class="ttdeci">int * ie</div><div class="ttdef"><b>Definition:</b> <a href="a01028_source.html#l00029">mpivars_struct.h:29</a></div></div>
<div class="ttc" id="a01028_html_a6cfd95afd0afebd625b889fb6e58371c"><div class="ttname"><a href="a01028.html#a6cfd95afd0afebd625b889fb6e58371c">MPIVariables::rank</a></div><div class="ttdeci">int rank</div><div class="ttdef"><b>Definition:</b> <a href="a01028_source.html#l00025">mpivars_struct.h:25</a></div></div>
<div class="ttc" id="a02289_html"><div class="ttname"><a href="a02289.html">HyPar</a></div><div class="ttdoc">Structure containing all solver-specific variables and functions. </div><div class="ttdef"><b>Definition:</b> <a href="a00986_source.html#l00023">hypar.h:23</a></div></div>
<div class="ttc" id="a00956_html_afbb862a2fdf5b72b1f9ace42f64b556f"><div class="ttname"><a href="a00956.html#afbb862a2fdf5b72b1f9ace42f64b556f">_ArrayIndex1D_</a></div><div class="ttdeci">#define _ArrayIndex1D_(N, imax, i, ghost, index)</div><div class="ttdef"><b>Definition:</b> <a href="a00956_source.html#l00040">arrayfunctions.h:40</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="adaa1bd7f962777f3b7ce886a94a8338e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adaa1bd7f962777f3b7ce886a94a8338e">&#9670;&nbsp;</a></span>ReadArrayParallel()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int ReadArrayParallel </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ndims</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nvars</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>dim_global</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>dim_local</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ghosts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>fname_root</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>read_flag</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Read in a vector field in a parallel fashion: The number of MPI ranks participating in file I/O is specified as an input (<a class="el" href="a01028.html#a297fca986fa3aa27de07a0c746ffaaa8">MPIVariables::N_IORanks</a>). All the MPI ranks are divided into that many I/O groups, with one rank in each group as the "leader" that does the file reading and writing. For reading in the solution, the leader of an I/O group reads its own file and distributes the solution to the processors in its group. The number of I/O group is typically specified as the number of I/O nodes available on the HPC platform, given the number of compute nodes the code is running on. This is a good balance between all the processors serially reading from the same file, and having as many files (with the local solution) as the number of processors. This approach has been observed to be very scalable (up to ~ 100,000 - 1,000,000 processors). <br />
</p><ul>
<li>Supports only binary format.</li>
</ul>
<p>There should be as many files as the number of IO ranks (<a class="el" href="a01028.html#a297fca986fa3aa27de07a0c746ffaaa8">MPIVariables::N_IORanks</a>). The files should be named as: &lt;fname_root&gt;_par.inp.&lt;nnnn&gt;, where &lt;nnnn&gt; is the string of formast "%04d" corresponding to integer n, 0 &lt;= n &lt; <a class="el" href="a01028.html#a297fca986fa3aa27de07a0c746ffaaa8">MPIVariables::N_IORanks</a>.<br />
Each file should contain the following data: <br />
{<br />
 x0_i (0 &lt;= i &lt; dim_local[0])<br />
 x1_i (0 &lt;= i &lt; dim_local[1])<br />
 ...<br />
 x{ndims-1}_i (0 &lt;= i &lt; dim_local[ndims-1])<br />
 [u0,u1,...,u{nvars-1}]_p (0 &lt;= p &lt; N) (with no commas)<br />
 <br />
 where <br />
 x0, x1, ..., x{ndims-1} represent the spatial dimensions (for a 3D problem, x0 = x, x1 = y, x2 = z),<br />
 u0, u1, ..., u{nvars-1} are each component of the vector u at a grid point,<br />
 N = dim_local[0]*dim_local[1]*...*dim_local[ndims-1] is the total number of points,<br />
 and p = i0 + dim_local[0]*( i1 + dim_local[1]*( i2 + dim_local[2]*( ... + dim_global[ndims-2]*i{ndims-1} ))) (see <a class="el" href="a00956.html#a03f49e4d44ae8aca85cb04cfe91e4ce4">_ArrayIndexnD_</a>)<br />
 with i0, i1, i2, etc representing grid indices along each spatial dimension, i.e.,<br />
 0 &lt;= i0 &lt; dim_local[0]-1<br />
 0 &lt;= i1 &lt; dim_local[1]-1<br />
 ...<br />
 0 &lt;= i{ndims-1} &lt; dim_local[ndims=1]-1<br />
}<br />
for each rank in the IO group corresponding to the file being read.</p><ul>
<li>The above block represents the local grid and vector field for each rank</li>
<li>Each file should contain as many such blocks of data as there are members in the corresponding IO group.</li>
<li>The ranks that belong to a particular IO group are given as p, where <a class="el" href="a01028.html#aff30abd72b51ad067b03ec6d574973a1">MPIVariables::GroupStartRank</a> &lt;= p &lt; <a class="el" href="a01028.html#ada7c6833a6ee759beee80a693cf86072">MPIVariables::GroupEndRank</a></li>
<li>The code Extras/ParallelInput.c can generate the files &lt;fname_root&gt;_par.inp.&lt;nnnn&gt; from the file &lt;fname_root&gt;.inp that is read by <a class="el" href="a01418.html#adad6ec70ca9a4a6fef53b7d2abc8b270">ReadArraySerial()</a> if input_mode in the input file "solver.inp" is set to "parallel n" where n is the number of IO ranks. </li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ndims</td><td>Number of spatial dimensions </td></tr>
    <tr><td class="paramname">nvars</td><td>Number of variables per grid point </td></tr>
    <tr><td class="paramname">dim_global</td><td>Integer array of size ndims with global grid size in each dimension </td></tr>
    <tr><td class="paramname">dim_local</td><td>Integer array of size ndims with local grid size in each dimension </td></tr>
    <tr><td class="paramname">ghosts</td><td>Number of ghost points </td></tr>
    <tr><td class="paramname">s</td><td>Solver object of type <a class="el" href="a02289.html" title="Structure containing all solver-specific variables and functions. ">HyPar</a> </td></tr>
    <tr><td class="paramname">m</td><td>MPI object of type <a class="el" href="a01028.html#a02329" title="Structure of MPI-related variables. ">MPIVariables</a> </td></tr>
    <tr><td class="paramname">x</td><td>Grid associated with the array (can be NULL) </td></tr>
    <tr><td class="paramname">u</td><td>Array to hold the vector field being read </td></tr>
    <tr><td class="paramname">fname_root</td><td>Filename root </td></tr>
    <tr><td class="paramname">read_flag</td><td>Flag to indicate if file was read </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="a01418_source.html#l00341">341</a> of file <a class="el" href="a01418_source.html">ReadArray.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;{</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  <a class="code" href="a02289.html">HyPar</a>         *solver = (<a class="code" href="a02289.html">HyPar</a>*)        s;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  <a class="code" href="a01028.html#a02329">MPIVariables</a>  *mpi    = (<a class="code" href="a01028.html#a02329">MPIVariables</a>*) m;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  <span class="keywordtype">int</span>           proc,d;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  <a class="code" href="a00965.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a>;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  *read_flag = 1;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  <span class="keywordtype">char</span> filename_root[<a class="code" href="a00965.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>];</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  strcpy(filename_root,fname_root);</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;  strcat(filename_root,<span class="stringliteral">&quot;_par.inp&quot;</span>);</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  <span class="comment">/* check for existence of the file */</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  <span class="keywordflow">if</span> (mpi-&gt;<a class="code" href="a01028.html#a92096d6b87420d0e71b38c6dc5e10b14">IOParticipant</a>) {</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    FILE *in;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="keywordtype">char</span> filename[<a class="code" href="a00965.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>];</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <a class="code" href="a01022.html#ad9bc49863d543b6251903e9150c46a9c">MPIGetFilename</a>(filename_root,&amp;mpi-&gt;<a class="code" href="a01028.html#ae297d101be8576bfb36202ebb61085e6">IOWorld</a>,filename);</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    in = fopen(filename,<span class="stringliteral">&quot;rb&quot;</span>);</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <span class="keywordflow">if</span> (!in)  *read_flag = 0;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;      *read_flag = 1;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;      fclose(in);</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    }</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  }</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  <a class="code" href="a00965.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a01022.html#ac57453b9ebabb57bbadd0521c9151aaf">MPIMin_integer</a>(read_flag,read_flag,1,&amp;mpi-&gt;<a class="code" href="a01028.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  <span class="keywordflow">if</span> (*read_flag) {</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a01028.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) printf(<span class="stringliteral">&quot;Reading from binary file %s.xxx (parallel mode).\n&quot;</span>,filename_root);</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <span class="comment">/* calculate size of the local grid on this rank */</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <span class="keywordtype">int</span> sizex = 0;     <span class="keywordflow">for</span> (d=0; d&lt;ndims; d++) sizex += dim_local[d];</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="keywordtype">int</span> sizeu = nvars; <span class="keywordflow">for</span> (d=0; d&lt;ndims; d++) sizeu *= dim_local[d];</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <span class="comment">/* allocate buffer arrays to read in grid and solution */</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    <span class="keywordtype">double</span> *buffer = (<span class="keywordtype">double</span>*) calloc (sizex+sizeu, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="keywordflow">if</span> (mpi-&gt;<a class="code" href="a01028.html#a92096d6b87420d0e71b38c6dc5e10b14">IOParticipant</a>) {</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;      <span class="comment">/* if this rank is responsible for file I/O */</span></div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;      <span class="keywordtype">double</span> *read_buffer = NULL;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;      <span class="keywordtype">int</span>     read_size_x, read_size_u, read_total_size;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;      <span class="keywordtype">int</span>     is[ndims], ie[ndims];</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;      <span class="comment">/* open the file */</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;      FILE *in;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;      <span class="keywordtype">int</span>  bytes;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;      <span class="keywordtype">char</span> filename[<a class="code" href="a00965.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>];</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;      <a class="code" href="a01022.html#ad9bc49863d543b6251903e9150c46a9c">MPIGetFilename</a>(filename_root,&amp;mpi-&gt;<a class="code" href="a01028.html#ae297d101be8576bfb36202ebb61085e6">IOWorld</a>,filename);</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;      in = fopen(filename,<span class="stringliteral">&quot;rb&quot;</span>);</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;      <span class="keywordflow">if</span> (!in) {</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        fprintf(stderr,<span class="stringliteral">&quot;Error in ReadArrayParallel(): File %s could not be opened.\n&quot;</span>,filename);</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        <span class="keywordflow">return</span>(1);</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;      }</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;      <span class="comment">/* Read own data */</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;      bytes = fread(buffer,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>),(sizex+sizeu),in);</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;      <span class="keywordflow">if</span> (bytes != (sizex+sizeu)) {</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        fprintf(stderr,<span class="stringliteral">&quot;Error in ReadArrayParallel(): File %s contains insufficient data.\n&quot;</span>,filename);</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        <span class="keywordflow">return</span>(1);</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;      }</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;      <span class="comment">/* read and send the data for the other processors in this IO rank&#39;s group */</span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;      <span class="keywordflow">for</span> (proc=mpi-&gt;<a class="code" href="a01028.html#aff30abd72b51ad067b03ec6d574973a1">GroupStartRank</a>+1; proc&lt;mpi-&gt;GroupEndRank; proc++) {</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        <span class="comment">/* get the local domain limits for process proc */</span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        <a class="code" href="a00965.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a01022.html#a9a3fc32b7d4bea6a1dac44ab21c9202e">MPILocalDomainLimits</a>(ndims,proc,mpi,dim_global,is,ie);</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        <span class="comment">/* calculate the size of its local data and allocate read buffer */</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        read_size_x = 0;      <span class="keywordflow">for</span> (d=0; d&lt;ndims; d++) read_size_x += (ie[d]-is[d]);</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        read_size_u = nvars;  <span class="keywordflow">for</span> (d=0; d&lt;ndims; d++) read_size_u *= (ie[d]-is[d]);</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        read_total_size = read_size_x + read_size_u;</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;        read_buffer = (<span class="keywordtype">double</span>*) calloc (read_total_size, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        <span class="comment">/* read the data */</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;        bytes = fread(read_buffer,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>),read_total_size,in);</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        <span class="keywordflow">if</span> (bytes != read_total_size) {</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;          fprintf(stderr,<span class="stringliteral">&quot;Error in ReadArrayParallel(): File %s contains insufficient data.\n&quot;</span>,filename);</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;          <span class="keywordflow">return</span>(1);</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        }</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;        <span class="comment">/* send the data */</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        MPI_Request req = MPI_REQUEST_NULL;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        MPI_Isend(read_buffer,read_total_size,MPI_DOUBLE,proc,1100,mpi-&gt;<a class="code" href="a01028.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>,&amp;req);</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        MPI_Wait(&amp;req,MPI_STATUS_IGNORE);</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        free(read_buffer);</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;      }</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;      <span class="comment">/* close the file */</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;      fclose(in);</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;      <span class="comment">/* all other processes, just receive the data from</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="comment">       * the rank responsible for file I/O */</span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;      MPI_Request req = MPI_REQUEST_NULL;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;      MPI_Irecv(buffer,(sizex+sizeu),MPI_DOUBLE,mpi-&gt;<a class="code" href="a01028.html#a1e6b9b6dca494aa45e43214f120e6630">IORank</a>,1100,mpi-&gt;<a class="code" href="a01028.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>,&amp;req);</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;      MPI_Wait(&amp;req,MPI_STATUS_IGNORE);</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    }</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <span class="comment">/* copy the grid */</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <span class="keywordflow">if</span> (x) {</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;      <span class="keywordtype">int</span> offset1 = 0, offset2 = 0;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;      <span class="keywordflow">for</span> (d = 0; d &lt; ndims; d++) {</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        <a class="code" href="a00956.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>((buffer+offset2),(x+offset1+ghosts),dim_local[d]);</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        offset1 += (dim_local[d]+2*ghosts);</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        offset2 +=  dim_local[d];</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;      }</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    }</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <span class="comment">/* copy the solution */</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <span class="keywordtype">int</span> index[ndims];</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <a class="code" href="a00965.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00956.html#ad9b36abcf37c1f675c71da3da16cc8f0">ArrayCopynD</a>(ndims,(buffer+sizex),u,dim_local,0,ghosts,index,nvars); </div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    <a class="code" href="a00965.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  </div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    <span class="comment">/* free buffers */</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    free(buffer);</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  }</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  <span class="keywordflow">return</span>(0);</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;}</div><div class="ttc" id="a00965_html_add9cf96ae374934d245a1dc1ab697a42"><div class="ttname"><a href="a00965.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a></div><div class="ttdeci">#define CHECKERR(ierr)</div><div class="ttdef"><b>Definition:</b> <a href="a00965_source.html#l00018">basic.h:18</a></div></div>
<div class="ttc" id="a00965_html_a51efea86a4d76d1259893f606b776573"><div class="ttname"><a href="a00965.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a></div><div class="ttdeci">#define _MAX_STRING_SIZE_</div><div class="ttdef"><b>Definition:</b> <a href="a00965_source.html#l00014">basic.h:14</a></div></div>
<div class="ttc" id="a01028_html_adad7a6f85831f3ac84d854b6c80aef43"><div class="ttname"><a href="a01028.html#adad7a6f85831f3ac84d854b6c80aef43">MPIVariables::world</a></div><div class="ttdeci">MPI_Comm world</div><div class="ttdef"><b>Definition:</b> <a href="a01028_source.html#l00037">mpivars_struct.h:37</a></div></div>
<div class="ttc" id="a00956_html_ad9b36abcf37c1f675c71da3da16cc8f0"><div class="ttname"><a href="a00956.html#ad9b36abcf37c1f675c71da3da16cc8f0">ArrayCopynD</a></div><div class="ttdeci">INLINE int ArrayCopynD(int, const double *, double *, int *, int, int, int *, int)</div><div class="ttdef"><b>Definition:</b> <a href="a00956_source.html#l00410">arrayfunctions.h:410</a></div></div>
<div class="ttc" id="a01028_html_ae297d101be8576bfb36202ebb61085e6"><div class="ttname"><a href="a01028.html#ae297d101be8576bfb36202ebb61085e6">MPIVariables::IOWorld</a></div><div class="ttdeci">MPI_Comm IOWorld</div><div class="ttdef"><b>Definition:</b> <a href="a01028_source.html#l00048">mpivars_struct.h:48</a></div></div>
<div class="ttc" id="a00956_html_a89e8330d9e06dd0666c50833628a125c"><div class="ttname"><a href="a00956.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a></div><div class="ttdeci">#define _ArrayCopy1D_(x, y, size)</div><div class="ttdef"><b>Definition:</b> <a href="a00956_source.html#l00319">arrayfunctions.h:319</a></div></div>
<div class="ttc" id="a01028_html_a1e6b9b6dca494aa45e43214f120e6630"><div class="ttname"><a href="a01028.html#a1e6b9b6dca494aa45e43214f120e6630">MPIVariables::IORank</a></div><div class="ttdeci">int IORank</div><div class="ttdef"><b>Definition:</b> <a href="a01028_source.html#l00044">mpivars_struct.h:44</a></div></div>
<div class="ttc" id="a01028_html_a02329"><div class="ttname"><a href="a01028.html#a02329">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a01028_source.html#l00024">mpivars_struct.h:24</a></div></div>
<div class="ttc" id="a00965_html_a68f50121fb9a7daeaf60e50cdef82ef3"><div class="ttname"><a href="a00965.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a></div><div class="ttdeci">#define _DECLARE_IERR_</div><div class="ttdef"><b>Definition:</b> <a href="a00965_source.html#l00017">basic.h:17</a></div></div>
<div class="ttc" id="a00965_html_ad6ab74942c9de13cf0b4c12eb0d91780"><div class="ttname"><a href="a00965.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a></div><div class="ttdeci">#define IERR</div><div class="ttdef"><b>Definition:</b> <a href="a00965_source.html#l00016">basic.h:16</a></div></div>
<div class="ttc" id="a01028_html_aff30abd72b51ad067b03ec6d574973a1"><div class="ttname"><a href="a01028.html#aff30abd72b51ad067b03ec6d574973a1">MPIVariables::GroupStartRank</a></div><div class="ttdeci">int GroupStartRank</div><div class="ttdef"><b>Definition:</b> <a href="a01028_source.html#l00045">mpivars_struct.h:45</a></div></div>
<div class="ttc" id="a01022_html_ad9bc49863d543b6251903e9150c46a9c"><div class="ttname"><a href="a01022.html#ad9bc49863d543b6251903e9150c46a9c">MPIGetFilename</a></div><div class="ttdeci">void MPIGetFilename(char *, void *, char *)</div><div class="ttdef"><b>Definition:</b> <a href="a01490_source.html#l00019">MPIGetFilename.c:19</a></div></div>
<div class="ttc" id="a01022_html_ac57453b9ebabb57bbadd0521c9151aaf"><div class="ttname"><a href="a01022.html#ac57453b9ebabb57bbadd0521c9151aaf">MPIMin_integer</a></div><div class="ttdeci">int MPIMin_integer(int *, int *, int, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a01502_source.html#l00015">MPIMin.c:15</a></div></div>
<div class="ttc" id="a01022_html_a9a3fc32b7d4bea6a1dac44ab21c9202e"><div class="ttname"><a href="a01022.html#a9a3fc32b7d4bea6a1dac44ab21c9202e">MPILocalDomainLimits</a></div><div class="ttdeci">int MPILocalDomainLimits(int, int, void *, int *, int *, int *)</div><div class="ttdef"><b>Definition:</b> <a href="a01496_source.html#l00018">MPILocalDomainLimits.c:18</a></div></div>
<div class="ttc" id="a01028_html_a6cfd95afd0afebd625b889fb6e58371c"><div class="ttname"><a href="a01028.html#a6cfd95afd0afebd625b889fb6e58371c">MPIVariables::rank</a></div><div class="ttdeci">int rank</div><div class="ttdef"><b>Definition:</b> <a href="a01028_source.html#l00025">mpivars_struct.h:25</a></div></div>
<div class="ttc" id="a01028_html_a92096d6b87420d0e71b38c6dc5e10b14"><div class="ttname"><a href="a01028.html#a92096d6b87420d0e71b38c6dc5e10b14">MPIVariables::IOParticipant</a></div><div class="ttdeci">int IOParticipant</div><div class="ttdef"><b>Definition:</b> <a href="a01028_source.html#l00042">mpivars_struct.h:42</a></div></div>
<div class="ttc" id="a02289_html"><div class="ttname"><a href="a02289.html">HyPar</a></div><div class="ttdoc">Structure containing all solver-specific variables and functions. </div><div class="ttdef"><b>Definition:</b> <a href="a00986_source.html#l00023">hypar.h:23</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac69cac66cd56d57f21a094418a649714"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac69cac66cd56d57f21a094418a649714">&#9670;&nbsp;</a></span>ReadArrayMPI_IO()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int ReadArrayMPI_IO </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ndims</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nvars</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>dim_global</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>dim_local</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ghosts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>fname_root</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>read_flag</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Read in an array in a parallel fashion using MPI-IO: Similar to <a class="el" href="a01418.html#adaa1bd7f962777f3b7ce886a94a8338e">ReadArrayParallel()</a>, except that the I/O leaders read from the same file using the MPI I/O routines, by calculating their respective offsets and reading the correct chunk of data from that offset. The MPI-IO functions (part of MPICH) are constantly being developed to be scalable on the latest and greatest HPC platforms. <br />
</p><ul>
<li>Supports only binary format.</li>
</ul>
<p>There should be as one file named as &lt;fname_root&gt;_mpi.inp. It should contain the following data: <br />
{<br />
 x0_i (0 &lt;= i &lt; dim_local[0])<br />
 x1_i (0 &lt;= i &lt; dim_local[1])<br />
 ...<br />
 x{ndims-1}_i (0 &lt;= i &lt; dim_local[ndims-1])<br />
 [u0,u1,...,u{nvars-1}]_p (0 &lt;= p &lt; N) (with no commas)<br />
 <br />
 where <br />
 x0, x1, ..., x{ndims-1} represent the spatial dimensions (for a 3D problem, x0 = x, x1 = y, x2 = z),<br />
 u0, u1, ..., u{nvars-1} are each component of the vector u at a grid point,<br />
 N = dim_local[0]*dim_local[1]*...*dim_local[ndims-1] is the total number of points,<br />
 and p = i0 + dim_local[0]*( i1 + dim_local[1]*( i2 + dim_local[2]*( ... + dim_global[ndims-2]*i{ndims-1} ))) (see <a class="el" href="a00956.html#a03f49e4d44ae8aca85cb04cfe91e4ce4">_ArrayIndexnD_</a>)<br />
 with i0, i1, i2, etc representing grid indices along each spatial dimension, i.e.,<br />
 0 &lt;= i0 &lt; dim_local[0]-1<br />
 0 &lt;= i1 &lt; dim_local[1]-1<br />
 ...<br />
 0 &lt;= i{ndims-1} &lt; dim_local[ndims=1]-1<br />
}<br />
for each rank, in the order of rank number (0 to nproc-1).</p><ul>
<li>The above block represents the local grid and vector field for each rank</li>
<li>The file should contain as many such blocks of data as there are MPI ranks.</li>
<li>Each IO rank computes its offset to figure out where the data it's supposed to read exists in the file, and then reads it.</li>
<li>The code Extras/MPIInput.c can generate the file &lt;fname_root&gt;_mpi.inp from the file &lt;fname_root&gt;.inp that is read by <a class="el" href="a01418.html#adad6ec70ca9a4a6fef53b7d2abc8b270">ReadArraySerial()</a> if input_mode in the input file "solver.inp" is set to "mpi-io n" where n is the number of IO ranks. </li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ndims</td><td>Number of spatial dimensions </td></tr>
    <tr><td class="paramname">nvars</td><td>Number of variables per grid point </td></tr>
    <tr><td class="paramname">dim_global</td><td>Integer array of size ndims with global grid size in each dimension </td></tr>
    <tr><td class="paramname">dim_local</td><td>Integer array of size ndims with local grid size in each dimension </td></tr>
    <tr><td class="paramname">ghosts</td><td>Number of ghost points </td></tr>
    <tr><td class="paramname">s</td><td>Solver object of type <a class="el" href="a02289.html" title="Structure containing all solver-specific variables and functions. ">HyPar</a> </td></tr>
    <tr><td class="paramname">m</td><td>MPI object of type <a class="el" href="a01028.html#a02329" title="Structure of MPI-related variables. ">MPIVariables</a> </td></tr>
    <tr><td class="paramname">x</td><td>Grid associated with the array (can be NULL) </td></tr>
    <tr><td class="paramname">u</td><td>Array to hold the vector field being read </td></tr>
    <tr><td class="paramname">fname_root</td><td>Filename root </td></tr>
    <tr><td class="paramname">read_flag</td><td>Flag to indicate if file was read </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="a01418_source.html#l00513">513</a> of file <a class="el" href="a01418_source.html">ReadArray.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;{</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  <a class="code" href="a02289.html">HyPar</a>         *solver = (<a class="code" href="a02289.html">HyPar</a>*)        s;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  <a class="code" href="a01028.html#a02329">MPIVariables</a>  *mpi    = (<a class="code" href="a01028.html#a02329">MPIVariables</a>*) m;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  <span class="keywordtype">int</span>           proc,d;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  <a class="code" href="a00965.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a>;</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  *read_flag = 0;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  <span class="keywordtype">char</span> filename[<a class="code" href="a00965.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>];</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  strcpy(filename,fname_root);</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;  strcat(filename,<span class="stringliteral">&quot;_mpi.inp&quot;</span>);</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;  <span class="comment">/* check for existence of file */</span></div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;  <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a01028.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) {</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    FILE *in;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    in = fopen(filename,<span class="stringliteral">&quot;rb&quot;</span>);</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <span class="keywordflow">if</span> (!in)  *read_flag = 0;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;      *read_flag = 1;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;      fclose(in);</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    }</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  }</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  <a class="code" href="a00965.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a01022.html#acd7957559b9206224c7da3cab4f22b27">MPIBroadcast_integer</a>(read_flag,1,0,&amp;mpi-&gt;<a class="code" href="a01028.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  <span class="keywordflow">if</span> (*read_flag) {</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a01028.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) printf(<span class="stringliteral">&quot;Reading from binary file %s (MPI-IO mode).\n&quot;</span>,filename);</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <span class="comment">/* calculate size of the local grid on this rank */</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    <span class="keywordtype">int</span> sizex = 0;     <span class="keywordflow">for</span> (d=0; d&lt;ndims; d++) sizex += dim_local[d];</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <span class="keywordtype">int</span> sizeu = nvars; <span class="keywordflow">for</span> (d=0; d&lt;ndims; d++) sizeu *= dim_local[d];</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <span class="comment">/* allocate buffer arrays to read in grid and solution */</span></div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <span class="keywordtype">double</span> *buffer = (<span class="keywordtype">double</span>*) calloc (sizex+sizeu, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <span class="keywordflow">if</span> (mpi-&gt;<a class="code" href="a01028.html#a92096d6b87420d0e71b38c6dc5e10b14">IOParticipant</a>) {</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;      <span class="comment">/* if this rank is responsible for file I/O */</span></div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;      <span class="keywordtype">double</span> *read_buffer = NULL;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;      <span class="keywordtype">int</span>     read_size_x, read_size_u, read_total_size;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;      <span class="keywordtype">int</span>     is[ndims], ie[ndims], size;</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;      <span class="comment">/* calculate offset */</span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;      <span class="keywordtype">long</span> <span class="keywordtype">long</span> offset = 0;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;      <span class="keywordflow">for</span> (proc=0; proc &lt; mpi-&gt;<a class="code" href="a01028.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>; proc++) {</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        <span class="comment">/* get the local domain limits for process proc */</span></div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;        <a class="code" href="a00965.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a01022.html#a9a3fc32b7d4bea6a1dac44ab21c9202e">MPILocalDomainLimits</a>(ndims,proc,mpi,dim_global,is,ie);</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        <span class="comment">/* calculate the size of its local grid */</span></div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;        size = 0; <span class="keywordflow">for</span> (d=0; d&lt;ndims; d++) size += (ie[d]-is[d]);</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;        offset += size;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;        <span class="comment">/* calculate the size of the local solution */</span></div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;        size = nvars; <span class="keywordflow">for</span> (d=0; d&lt;ndims; d++) size *= (ie[d]-is[d]);</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        offset += size;</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;      }</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    </div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;      <span class="comment">/* open the file */</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;      MPI_Status  status;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;      MPI_File    in;</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;      <span class="keywordtype">int</span>         error;</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;      error = MPI_File_open(mpi-&gt;<a class="code" href="a01028.html#ae297d101be8576bfb36202ebb61085e6">IOWorld</a>,filename,MPI_MODE_RDONLY,MPI_INFO_NULL,&amp;in);</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;      <span class="keywordflow">if</span> (error != MPI_SUCCESS) {</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        fprintf(stderr,<span class="stringliteral">&quot;Error in ReadArrayMPI_IO(): Unable to open %s.\n&quot;</span>,filename);</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;        <span class="keywordflow">return</span>(1);</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;      }</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;      <span class="comment">/* set offset */</span></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;      MPI_Offset FileOffset = (MPI_Offset) (offset * <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;      MPI_File_seek(in,FileOffset,MPI_SEEK_SET);</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;      <span class="comment">/* Read own data */</span></div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;      MPI_File_read(in,buffer,(sizex+sizeu)*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>),MPI_BYTE,&amp;status);</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;      <span class="comment">/* read and send the data for the other processors in this IO rank&#39;s group */</span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;      <span class="keywordflow">for</span> (proc=mpi-&gt;<a class="code" href="a01028.html#aff30abd72b51ad067b03ec6d574973a1">GroupStartRank</a>+1; proc&lt;mpi-&gt;GroupEndRank; proc++) {</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;        <span class="comment">/* get the local domain limits for process proc */</span></div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;        <a class="code" href="a00965.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a01022.html#a9a3fc32b7d4bea6a1dac44ab21c9202e">MPILocalDomainLimits</a>(ndims,proc,mpi,dim_global,is,ie);</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        <span class="comment">/* calculate the size of its local data and allocate read buffer */</span></div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        read_size_x = 0;      <span class="keywordflow">for</span> (d=0; d&lt;ndims; d++) read_size_x += (ie[d]-is[d]);</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        read_size_u = nvars;  <span class="keywordflow">for</span> (d=0; d&lt;ndims; d++) read_size_u *= (ie[d]-is[d]);</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        read_total_size = read_size_x + read_size_u;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        read_buffer = (<span class="keywordtype">double</span>*) calloc (read_total_size, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        <span class="comment">/* read the data */</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        MPI_File_read(in,read_buffer,read_total_size*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>),MPI_BYTE,&amp;status);</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        <span class="comment">/* send the data */</span></div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        MPI_Request req = MPI_REQUEST_NULL;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        MPI_Isend(read_buffer,read_total_size,MPI_DOUBLE,proc,1100,mpi-&gt;<a class="code" href="a01028.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>,&amp;req);</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;        MPI_Wait(&amp;req,MPI_STATUS_IGNORE);</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        free(read_buffer);</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;      }</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;      <span class="comment">/* close the file */</span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;      MPI_File_close(&amp;in);</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;      <span class="comment">/* all other processes, just receive the data from</span></div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="comment">       * the rank responsible for file I/O */</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;      MPI_Request req = MPI_REQUEST_NULL;</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;      MPI_Irecv(buffer,(sizex+sizeu),MPI_DOUBLE,mpi-&gt;<a class="code" href="a01028.html#a1e6b9b6dca494aa45e43214f120e6630">IORank</a>,1100,mpi-&gt;<a class="code" href="a01028.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>,&amp;req);</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;      MPI_Wait(&amp;req,MPI_STATUS_IGNORE);</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    }</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    <span class="comment">/* copy the grid */</span></div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    <span class="keywordflow">if</span> (x) {</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;      <span class="keywordtype">int</span> offset1 = 0, offset2 = 0;</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;      <span class="keywordflow">for</span> (d = 0; d &lt; ndims; d++) {</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;        <a class="code" href="a00956.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>((buffer+offset2),(x+offset1+ghosts),dim_local[d]);</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;        offset1 += (dim_local[d]+2*ghosts);</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        offset2 +=  dim_local[d];</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;      }</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    }</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    <span class="comment">/* copy the solution */</span></div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    <span class="keywordtype">int</span> index[ndims];</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    <a class="code" href="a00965.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00956.html#ad9b36abcf37c1f675c71da3da16cc8f0">ArrayCopynD</a>(ndims,(buffer+sizex),u,dim_local,0,ghosts,index,nvars); </div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <a class="code" href="a00965.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    <span class="comment">/* free buffers */</span></div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    free(buffer);</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;  }</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;  <span class="keywordflow">return</span>(0);</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;}</div><div class="ttc" id="a00965_html_add9cf96ae374934d245a1dc1ab697a42"><div class="ttname"><a href="a00965.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a></div><div class="ttdeci">#define CHECKERR(ierr)</div><div class="ttdef"><b>Definition:</b> <a href="a00965_source.html#l00018">basic.h:18</a></div></div>
<div class="ttc" id="a00965_html_a51efea86a4d76d1259893f606b776573"><div class="ttname"><a href="a00965.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a></div><div class="ttdeci">#define _MAX_STRING_SIZE_</div><div class="ttdef"><b>Definition:</b> <a href="a00965_source.html#l00014">basic.h:14</a></div></div>
<div class="ttc" id="a01028_html_adad7a6f85831f3ac84d854b6c80aef43"><div class="ttname"><a href="a01028.html#adad7a6f85831f3ac84d854b6c80aef43">MPIVariables::world</a></div><div class="ttdeci">MPI_Comm world</div><div class="ttdef"><b>Definition:</b> <a href="a01028_source.html#l00037">mpivars_struct.h:37</a></div></div>
<div class="ttc" id="a00956_html_ad9b36abcf37c1f675c71da3da16cc8f0"><div class="ttname"><a href="a00956.html#ad9b36abcf37c1f675c71da3da16cc8f0">ArrayCopynD</a></div><div class="ttdeci">INLINE int ArrayCopynD(int, const double *, double *, int *, int, int, int *, int)</div><div class="ttdef"><b>Definition:</b> <a href="a00956_source.html#l00410">arrayfunctions.h:410</a></div></div>
<div class="ttc" id="a01028_html_ae297d101be8576bfb36202ebb61085e6"><div class="ttname"><a href="a01028.html#ae297d101be8576bfb36202ebb61085e6">MPIVariables::IOWorld</a></div><div class="ttdeci">MPI_Comm IOWorld</div><div class="ttdef"><b>Definition:</b> <a href="a01028_source.html#l00048">mpivars_struct.h:48</a></div></div>
<div class="ttc" id="a00956_html_a89e8330d9e06dd0666c50833628a125c"><div class="ttname"><a href="a00956.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a></div><div class="ttdeci">#define _ArrayCopy1D_(x, y, size)</div><div class="ttdef"><b>Definition:</b> <a href="a00956_source.html#l00319">arrayfunctions.h:319</a></div></div>
<div class="ttc" id="a01028_html_a1e6b9b6dca494aa45e43214f120e6630"><div class="ttname"><a href="a01028.html#a1e6b9b6dca494aa45e43214f120e6630">MPIVariables::IORank</a></div><div class="ttdeci">int IORank</div><div class="ttdef"><b>Definition:</b> <a href="a01028_source.html#l00044">mpivars_struct.h:44</a></div></div>
<div class="ttc" id="a01028_html_a02329"><div class="ttname"><a href="a01028.html#a02329">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a01028_source.html#l00024">mpivars_struct.h:24</a></div></div>
<div class="ttc" id="a00965_html_a68f50121fb9a7daeaf60e50cdef82ef3"><div class="ttname"><a href="a00965.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a></div><div class="ttdeci">#define _DECLARE_IERR_</div><div class="ttdef"><b>Definition:</b> <a href="a00965_source.html#l00017">basic.h:17</a></div></div>
<div class="ttc" id="a00965_html_ad6ab74942c9de13cf0b4c12eb0d91780"><div class="ttname"><a href="a00965.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a></div><div class="ttdeci">#define IERR</div><div class="ttdef"><b>Definition:</b> <a href="a00965_source.html#l00016">basic.h:16</a></div></div>
<div class="ttc" id="a01028_html_aff30abd72b51ad067b03ec6d574973a1"><div class="ttname"><a href="a01028.html#aff30abd72b51ad067b03ec6d574973a1">MPIVariables::GroupStartRank</a></div><div class="ttdeci">int GroupStartRank</div><div class="ttdef"><b>Definition:</b> <a href="a01028_source.html#l00045">mpivars_struct.h:45</a></div></div>
<div class="ttc" id="a01022_html_acd7957559b9206224c7da3cab4f22b27"><div class="ttname"><a href="a01022.html#acd7957559b9206224c7da3cab4f22b27">MPIBroadcast_integer</a></div><div class="ttdeci">int MPIBroadcast_integer(int *, int, int, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a01466_source.html#l00023">MPIBroadcast.c:23</a></div></div>
<div class="ttc" id="a01022_html_a9a3fc32b7d4bea6a1dac44ab21c9202e"><div class="ttname"><a href="a01022.html#a9a3fc32b7d4bea6a1dac44ab21c9202e">MPILocalDomainLimits</a></div><div class="ttdeci">int MPILocalDomainLimits(int, int, void *, int *, int *, int *)</div><div class="ttdef"><b>Definition:</b> <a href="a01496_source.html#l00018">MPILocalDomainLimits.c:18</a></div></div>
<div class="ttc" id="a01028_html_a6cfd95afd0afebd625b889fb6e58371c"><div class="ttname"><a href="a01028.html#a6cfd95afd0afebd625b889fb6e58371c">MPIVariables::rank</a></div><div class="ttdeci">int rank</div><div class="ttdef"><b>Definition:</b> <a href="a01028_source.html#l00025">mpivars_struct.h:25</a></div></div>
<div class="ttc" id="a01028_html_a92096d6b87420d0e71b38c6dc5e10b14"><div class="ttname"><a href="a01028.html#a92096d6b87420d0e71b38c6dc5e10b14">MPIVariables::IOParticipant</a></div><div class="ttdeci">int IOParticipant</div><div class="ttdef"><b>Definition:</b> <a href="a01028_source.html#l00042">mpivars_struct.h:42</a></div></div>
<div class="ttc" id="a02289_html"><div class="ttname"><a href="a02289.html">HyPar</a></div><div class="ttdoc">Structure containing all solver-specific variables and functions. </div><div class="ttdef"><b>Definition:</b> <a href="a00986_source.html#l00023">hypar.h:23</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a61cd8732591552b50c4aeeeb729d8bd3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a61cd8732591552b50c4aeeeb729d8bd3">&#9670;&nbsp;</a></span>ReadArray()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ReadArray </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ndims</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nvars</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>dim_global</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>dim_local</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ghosts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>fname_root</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>read_flag</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Read in a vector field from file: wrapper function that calls the appropriate function depending on input mode (<a class="el" href="a02289.html#a0a0b9dc97c7c278a019939d301db9399">HyPar::input_mode</a>).<br />
<br />
The mode and type of input are specified through <a class="el" href="a02289.html#a0a0b9dc97c7c278a019939d301db9399">HyPar::input_mode</a> and <a class="el" href="a02289.html#a83f3dcd022f744511a44f2a31a824ac8">HyPar::ip_file_type</a>. A vector field is read from file and stored in an array. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ndims</td><td>Number of spatial dimensions </td></tr>
    <tr><td class="paramname">nvars</td><td>Number of variables per grid point </td></tr>
    <tr><td class="paramname">dim_global</td><td>Integer array of size ndims with global grid size in each dimension </td></tr>
    <tr><td class="paramname">dim_local</td><td>Integer array of size ndims with local grid size in each dimension </td></tr>
    <tr><td class="paramname">ghosts</td><td>Number of ghost points </td></tr>
    <tr><td class="paramname">s</td><td>Solver object of type <a class="el" href="a02289.html" title="Structure containing all solver-specific variables and functions. ">HyPar</a> </td></tr>
    <tr><td class="paramname">m</td><td>MPI object of type <a class="el" href="a01028.html#a02329" title="Structure of MPI-related variables. ">MPIVariables</a> </td></tr>
    <tr><td class="paramname">x</td><td>Grid associated with the array (can be NULL) </td></tr>
    <tr><td class="paramname">u</td><td>Array to hold the vector field </td></tr>
    <tr><td class="paramname">fname_root</td><td>Filename root </td></tr>
    <tr><td class="paramname">read_flag</td><td>Flag to indicate if the file was read </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="a01418_source.html#l00025">25</a> of file <a class="el" href="a01418_source.html">ReadArray.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;{</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  <a class="code" href="a02289.html">HyPar</a>         *solver = (<a class="code" href="a02289.html">HyPar</a>*) s;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <a class="code" href="a01028.html#a02329">MPIVariables</a>  *mpi    = (<a class="code" href="a01028.html#a02329">MPIVariables</a>*) m;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <a class="code" href="a00965.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a>;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  <span class="keywordflow">if</span>      (!strcmp(solver-&gt;<a class="code" href="a02289.html#a0a0b9dc97c7c278a019939d301db9399">input_mode</a>,<span class="stringliteral">&quot;serial&quot;</span>)) {</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <a class="code" href="a00965.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a01418.html#adad6ec70ca9a4a6fef53b7d2abc8b270">ReadArraySerial</a>(ndims,nvars,dim_global,dim_local,ghosts,s,m,x,u,fname_root,read_flag);</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <a class="code" href="a00965.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#ifndef serial</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a02289.html#a0a0b9dc97c7c278a019939d301db9399">input_mode</a>,<span class="stringliteral">&quot;parallel&quot;</span>)) {</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <a class="code" href="a01418.html#adaa1bd7f962777f3b7ce886a94a8338e">ReadArrayParallel</a>(ndims,nvars,dim_global,dim_local,ghosts,s,m,x,u,fname_root,read_flag);</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <a class="code" href="a00965.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a02289.html#a0a0b9dc97c7c278a019939d301db9399">input_mode</a>,<span class="stringliteral">&quot;mpi-io&quot;</span>  )) {</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <a class="code" href="a01418.html#ac69cac66cd56d57f21a094418a649714">ReadArrayMPI_IO</a>(ndims,nvars,dim_global,dim_local,ghosts,s,m,x,u,fname_root,read_flag);</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <a class="code" href="a00965.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    fprintf(stderr,<span class="stringliteral">&quot;Error: Illegal value (%s) for input_mode.\n&quot;</span>,solver-&gt;<a class="code" href="a02289.html#a0a0b9dc97c7c278a019939d301db9399">input_mode</a>);</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="keywordflow">return</span>(1);</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  }</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <span class="keywordflow">if</span> (x) {</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="keywordtype">int</span> offset, d;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="comment">/* exchange MPI-boundary values of x between processors */</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    offset = 0;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="keywordflow">for</span> (d = 0; d &lt; ndims; d++) {</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;      <a class="code" href="a00965.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a01022.html#ac2f0cce702a9ce439753286ce227c7a2">MPIExchangeBoundaries1D</a>(mpi,&amp;x[offset],dim_local[d],</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;                                   ghosts,d,ndims); <a class="code" href="a00965.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;      offset  += (dim_local [d] + 2*ghosts);</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    }</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="comment">/* fill in ghost values of x at physical boundaries by extrapolation */</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    offset = 0;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="keywordflow">for</span> (d = 0; d &lt; ndims; d++) {</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;      <span class="keywordtype">double</span> *X     = &amp;x[offset];</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;      <span class="keywordtype">int</span>    *dim   = dim_local, i;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;      <span class="keywordflow">if</span> (mpi-&gt;<a class="code" href="a01028.html#aa3c28612a64b8a97bde66b720e15c700">ip</a>[d] == 0) {</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        <span class="comment">/* fill left boundary along this dimension */</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        <span class="keywordflow">for</span> (i = 0; i &lt; ghosts; i++) {</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;          <span class="keywordtype">int</span> delta = ghosts - i;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;          X[i] = X[ghosts] + ((double) delta) * (X[ghosts]-X[ghosts+1]);</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        }</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;      }</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;      <span class="keywordflow">if</span> (mpi-&gt;<a class="code" href="a01028.html#aa3c28612a64b8a97bde66b720e15c700">ip</a>[d] == mpi-&gt;<a class="code" href="a01028.html#a0be0f30a83bc3f3d9f6ee3a36bbf2716">iproc</a>[d]-1) {</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        <span class="comment">/* fill right boundary along this dimension */</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        <span class="keywordflow">for</span> (i = dim[d]+ghosts; i &lt; dim[d]+2*ghosts; i++) {</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;          <span class="keywordtype">int</span> delta = i - (dim[d]+ghosts-1);</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;          X[i] =  X[dim[d]+ghosts-1] </div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;                  + ((double) delta) * (X[dim[d]+ghosts-1]-X[dim[d]+ghosts-2]);</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        }</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;      }</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;      offset  += (dim[d] + 2*ghosts);</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    }</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  }</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <span class="keywordflow">return</span>(0);</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;}</div><div class="ttc" id="a02289_html_a0a0b9dc97c7c278a019939d301db9399"><div class="ttname"><a href="a02289.html#a0a0b9dc97c7c278a019939d301db9399">HyPar::input_mode</a></div><div class="ttdeci">char input_mode[_MAX_STRING_SIZE_]</div><div class="ttdef"><b>Definition:</b> <a href="a00986_source.html#l00177">hypar.h:177</a></div></div>
<div class="ttc" id="a01022_html_ac2f0cce702a9ce439753286ce227c7a2"><div class="ttname"><a href="a01022.html#ac2f0cce702a9ce439753286ce227c7a2">MPIExchangeBoundaries1D</a></div><div class="ttdeci">int MPIExchangeBoundaries1D(void *, double *, int, int, int, int)</div><div class="ttdef"><b>Definition:</b> <a href="a01472_source.html#l00032">MPIExchangeBoundaries1D.c:32</a></div></div>
<div class="ttc" id="a00965_html_add9cf96ae374934d245a1dc1ab697a42"><div class="ttname"><a href="a00965.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a></div><div class="ttdeci">#define CHECKERR(ierr)</div><div class="ttdef"><b>Definition:</b> <a href="a00965_source.html#l00018">basic.h:18</a></div></div>
<div class="ttc" id="a01028_html_a0be0f30a83bc3f3d9f6ee3a36bbf2716"><div class="ttname"><a href="a01028.html#a0be0f30a83bc3f3d9f6ee3a36bbf2716">MPIVariables::iproc</a></div><div class="ttdeci">int * iproc</div><div class="ttdef"><b>Definition:</b> <a href="a01028_source.html#l00027">mpivars_struct.h:27</a></div></div>
<div class="ttc" id="a01028_html_aa3c28612a64b8a97bde66b720e15c700"><div class="ttname"><a href="a01028.html#aa3c28612a64b8a97bde66b720e15c700">MPIVariables::ip</a></div><div class="ttdeci">int * ip</div><div class="ttdef"><b>Definition:</b> <a href="a01028_source.html#l00028">mpivars_struct.h:28</a></div></div>
<div class="ttc" id="a01418_html_ac69cac66cd56d57f21a094418a649714"><div class="ttname"><a href="a01418.html#ac69cac66cd56d57f21a094418a649714">ReadArrayMPI_IO</a></div><div class="ttdeci">static int ReadArrayMPI_IO(int, int, int *, int *, int, void *, void *, double *, double *, char *, int *)</div><div class="ttdef"><b>Definition:</b> <a href="a01418_source.html#l00513">ReadArray.c:513</a></div></div>
<div class="ttc" id="a01418_html_adad6ec70ca9a4a6fef53b7d2abc8b270"><div class="ttname"><a href="a01418.html#adad6ec70ca9a4a6fef53b7d2abc8b270">ReadArraySerial</a></div><div class="ttdeci">static int ReadArraySerial(int, int, int *, int *, int, void *, void *, double *, double *, char *, int *)</div><div class="ttdef"><b>Definition:</b> <a href="a01418_source.html#l00150">ReadArray.c:150</a></div></div>
<div class="ttc" id="a01028_html_a02329"><div class="ttname"><a href="a01028.html#a02329">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a01028_source.html#l00024">mpivars_struct.h:24</a></div></div>
<div class="ttc" id="a00965_html_a68f50121fb9a7daeaf60e50cdef82ef3"><div class="ttname"><a href="a00965.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a></div><div class="ttdeci">#define _DECLARE_IERR_</div><div class="ttdef"><b>Definition:</b> <a href="a00965_source.html#l00017">basic.h:17</a></div></div>
<div class="ttc" id="a01418_html_adaa1bd7f962777f3b7ce886a94a8338e"><div class="ttname"><a href="a01418.html#adaa1bd7f962777f3b7ce886a94a8338e">ReadArrayParallel</a></div><div class="ttdeci">static int ReadArrayParallel(int, int, int *, int *, int, void *, void *, double *, double *, char *, int *)</div><div class="ttdef"><b>Definition:</b> <a href="a01418_source.html#l00341">ReadArray.c:341</a></div></div>
<div class="ttc" id="a00965_html_ad6ab74942c9de13cf0b4c12eb0d91780"><div class="ttname"><a href="a00965.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a></div><div class="ttdeci">#define IERR</div><div class="ttdef"><b>Definition:</b> <a href="a00965_source.html#l00016">basic.h:16</a></div></div>
<div class="ttc" id="a02289_html"><div class="ttname"><a href="a02289.html">HyPar</a></div><div class="ttdoc">Structure containing all solver-specific variables and functions. </div><div class="ttdef"><b>Definition:</b> <a href="a00986_source.html#l00023">hypar.h:23</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">
var sc_project=10897352; 
var sc_invisible=1; 
var sc_security="83042f57"; 
var scJsHost = (("https:" == document.location.protocol) ?
"https://secure." : "http://www.");
document.write("<sc"+"ript type='text/javascript' src='" +
scJsHost+
"statcounter.com/counter/counter.js'></"+"script>");
</script>
<noscript><div class="statcounter"><a title="website
statistics" href="http://statcounter.com/"
target="_blank"><img class="statcounter"
src="//c.statcounter.com/10897352/0/83042f57/1/"
alt="website statistics"></a></div></noscript>
<!-- End of StatCounter Code for Default Guide -->
