<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>HyPar: src/IOFunctions/ReadArraywInterp.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_html_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">HyPar
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">Finite-Difference Hyperbolic-Parabolic PDE Solver on Cartesian Grids</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('a01421.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">ReadArraywInterp.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Read in a vector field from file.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;<a class="el" href="a00965_source.html">basic.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="a00956_source.html">arrayfunctions.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="a01010_source.html">mathfunctions.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="a01022_source.html">mpivars.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="a00986_source.html">hypar.h</a>&gt;</code><br />
</div>
<p><a href="a01421_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ac1fd9c1e0d7b79e7047db352b8aeb0b8"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a01421.html#ac1fd9c1e0d7b79e7047db352b8aeb0b8">ReadArraywInterpSerial</a> (int, int, int *, int *, int *, int, void *, void *, double *, double *, char *, int *)</td></tr>
<tr class="separator:ac1fd9c1e0d7b79e7047db352b8aeb0b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a84eb363896d58f78282bd0426638c13d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a01421.html#a84eb363896d58f78282bd0426638c13d">ReadArraywInterp</a> (int ndims, int nvars, int *dim_global, int *dim_local, int *dim_global_src, int ghosts, void *s, void *m, double *x, double *u, char *fname_root, int *read_flag)</td></tr>
<tr class="separator:a84eb363896d58f78282bd0426638c13d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Read in a vector field from file. </p>
<dl class="section author"><dt>Author</dt><dd>Debojyoti Ghosh </dd></dl>

<p class="definition">Definition in file <a class="el" href="a01421_source.html">ReadArraywInterp.c</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="ac1fd9c1e0d7b79e7047db352b8aeb0b8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac1fd9c1e0d7b79e7047db352b8aeb0b8">&#9670;&nbsp;</a></span>ReadArraywInterpSerial()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int ReadArraywInterpSerial </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ndims</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nvars</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>dim_global</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>dim_local</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>dim_global_src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ghosts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>fname_root</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>read_flag</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Read an array in a serial fashion: This version allows reading data with different dimensions than the array being read in. The data is read in and stored in a new global array with the appropriate size, and the array to be read is filled by interpolation. Currently, the dimensions of the array to be read and the those of the actual data can only differ by factors that are integer powers of 2.</p>
<p>For multi-processor simulation, only rank 0 reads in the entire solution from the file, interpolates it to desired resolution, and then distributes the relevant portions to each of the processors. This involves memory allocation for the global domain on rank 0 as well as interpolation between two global arrays. Thus, do not use for large domains. T his approach is not very scalable either, if running with a very large number of processors (&gt; 1000). Supports both binary and ASCII formats. <br />
<br />
The name of the file being read is &lt;fname_root&gt;.inp <br />
<br />
<b>ASCII</b> format:-<br />
The input file should contain the ASCII data as follows:<br />
<br />
x0_i (0 &lt;= i &lt; dim_global[0])<br />
x1_i (0 &lt;= i &lt; dim_global[1])<br />
...<br />
x{ndims-1}_i (0 &lt;= i &lt; dim_global[ndims-1])<br />
u0_p (0 &lt;= p &lt; N)<br />
u1_p (0 &lt;= p &lt; N)<br />
...<br />
u{nvars-1}_p (0 &lt;= p &lt; N)<br />
<br />
where <br />
x0, x1, ..., x{ndims-1} represent the spatial dimensions (for a 3D problem, x0 = x, x1 = y, x2 = z),<br />
u0, u1, ..., u{nvars-1} are each component of the vector u,<br />
N = dim_global[0]*dim_global[1]*...*dim_global[ndims-1] is the total number of points,<br />
and p = i0 + dim_global[0]*( i1 + dim_global[1]*( i2 + dim_global[2]*( ... + dim_global[ndims-2]*i{ndims-1} ))) (see <a class="el" href="a00956.html#a03f49e4d44ae8aca85cb04cfe91e4ce4">_ArrayIndexnD_</a>)<br />
with i0, i1, i2, etc representing grid indices along each spatial dimension, i.e.,<br />
0 &lt;= i0 &lt; dim_global[0]-1<br />
0 &lt;= i1 &lt; dim_global[1]-1<br />
...<br />
0 &lt;= i{ndims-1} &lt; dim_global[ndims=1]-1<br />
<br />
<br />
<b>Binary</b> format:-<br />
The input file should contain the binary data in as follows:<br />
<br />
x0_i (0 &lt;= i &lt; dim_global[0])<br />
x1_i (0 &lt;= i &lt; dim_global[1])<br />
...<br />
x{ndims-1}_i (0 &lt;= i &lt; dim_global[ndims-1])<br />
[u0,u1,...,u{nvars-1}]_p (0 &lt;= p &lt; N) (with no commas)<br />
<br />
where <br />
x0, x1, ..., x{ndims-1} represent the spatial dimensions (for a 3D problem, x0 = x, x1 = y, x2 = z),<br />
u0, u1, ..., u{nvars-1} are each component of the vector u at a grid point,<br />
N = dim_global[0]*dim_global[1]*...*dim_global[ndims-1] is the total number of points,<br />
and p = i0 + dim_global[0]*( i1 + dim_global[1]*( i2 + dim_global[2]*( ... + dim_global[ndims-2]*i{ndims-1} ))) (see <a class="el" href="a00956.html#a03f49e4d44ae8aca85cb04cfe91e4ce4">_ArrayIndexnD_</a>)<br />
with i0, i1, i2, etc representing grid indices along each spatial dimension, i.e.,<br />
0 &lt;= i0 &lt; dim_global[0]-1<br />
0 &lt;= i1 &lt; dim_global[1]-1<br />
...<br />
0 &lt;= i{ndims-1} &lt; dim_global[ndims=1]-1<br />
<br />
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ndims</td><td>Number of spatial dimensions </td></tr>
    <tr><td class="paramname">nvars</td><td>Number of variables per grid point </td></tr>
    <tr><td class="paramname">dim_global</td><td>Integer array of size ndims with global size in each dimension </td></tr>
    <tr><td class="paramname">dim_local</td><td>Integer array of size ndims with local size in each dimension </td></tr>
    <tr><td class="paramname">dim_global_src</td><td>Integer array of size ndims with global size of the data in each dimension </td></tr>
    <tr><td class="paramname">ghosts</td><td>Number of ghost points </td></tr>
    <tr><td class="paramname">s</td><td>Solver object of type <a class="el" href="a02289.html" title="Structure containing all solver-specific variables and functions. ">HyPar</a> </td></tr>
    <tr><td class="paramname">m</td><td>MPI object of type <a class="el" href="a01028.html#a02329" title="Structure of MPI-related variables. ">MPIVariables</a> </td></tr>
    <tr><td class="paramname">x</td><td>Grid associated with the array (can be NULL) </td></tr>
    <tr><td class="paramname">u</td><td>Array to hold the vector field being read </td></tr>
    <tr><td class="paramname">fname_root</td><td>Filename root </td></tr>
    <tr><td class="paramname">read_flag</td><td>Flag to indicate if the file was read </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="a01421_source.html#l00159">159</a> of file <a class="el" href="a01421_source.html">ReadArraywInterp.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;{</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  <a class="code" href="a02289.html">HyPar</a>         *solver = (<a class="code" href="a02289.html">HyPar</a>*)        s;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  <a class="code" href="a01028.html#a02329">MPIVariables</a>  *mpi    = (<a class="code" href="a01028.html#a02329">MPIVariables</a>*) m;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  <span class="keywordtype">int</span>           i, d, ferr, index[ndims];</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  <span class="keywordtype">double</span>        *ug_src = NULL, *xg_src = NULL;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  <span class="keywordtype">double</span>        *ug = NULL, *xg = NULL;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  <a class="code" href="a00965.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a>;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  *read_flag = 0;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  <span class="comment">/* Only root process reads from the file */</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a01028.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) {</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <span class="comment">/* read data from file - this data is of dimensions given by dim_global_sec */</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a02289.html#a83f3dcd022f744511a44f2a31a824ac8">ip_file_type</a>,<span class="stringliteral">&quot;ascii&quot;</span>)) {</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;      <span class="keywordtype">char</span> filename[<a class="code" href="a00965.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>];</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;      strcpy(filename,fname_root);</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;      strcat(filename,<span class="stringliteral">&quot;.inp&quot;</span>);</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;      FILE *in; in = fopen(filename,<span class="stringliteral">&quot;r&quot;</span>);</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      <span class="keywordflow">if</span> (!in) *read_flag = 0;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        *read_flag = 1;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        <span class="comment">/* Reading from file */</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        printf(<span class="stringliteral">&quot;Reading array from ASCII file %s (Serial mode).\n&quot;</span>,filename);</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        <span class="keywordtype">int</span> size,offset;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        <span class="comment">/* allocate global solution array */</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        size   = 1; <span class="keywordflow">for</span> (d=0; d&lt;ndims; d++) size *= dim_global_src[d]; size *= nvars;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        ug_src = (<span class="keywordtype">double</span>*) calloc(size,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        size   = 0; <span class="keywordflow">for</span> (d=0; d&lt;ndims; d++) size += dim_global_src[d];</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        xg_src = (<span class="keywordtype">double</span>*) calloc(size,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        <span class="comment">/* read grid */</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        offset = 0;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        <span class="keywordflow">for</span> (d = 0; d &lt; ndims; d++) {</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;          <span class="keywordflow">for</span> (i = 0; i &lt; dim_global_src[d]; i++) {</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;            ferr = fscanf(in,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;xg_src[i+offset]);</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;            <span class="keywordflow">if</span> (ferr != 1) {</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;              printf(<span class="stringliteral">&quot;Error in ReadArraySerial(): unable to read data. ferr=%d\n&quot;</span>, ferr);</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;              exit(1);</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;            }</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;          }</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;          offset += dim_global_src[d];</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        }</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        <span class="comment">/* read solution */</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        <span class="keywordflow">for</span> (i = 0; i &lt; nvars; i++) {</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;          <span class="keywordtype">int</span> done = 0; <a class="code" href="a00956.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(index,ndims,0);</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;          <span class="keywordflow">while</span> (!done) {</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;            <span class="keywordtype">int</span> p; <a class="code" href="a00956.html#afbb862a2fdf5b72b1f9ace42f64b556f">_ArrayIndex1D_</a>(ndims,dim_global_src,index,0,p);</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            ferr = fscanf(in,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;ug_src[p*nvars+i]);</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;            <span class="keywordflow">if</span> (ferr != 1) {</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;              printf(<span class="stringliteral">&quot;Error in ReadArraySerial(): unable to read data. ferr=%d\n&quot;</span>, ferr);</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;              exit(1);</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;            }</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;            <a class="code" href="a00956.html#ac5ec1371623f11d03b0f42adaa24acbc">_ArrayIncrementIndex_</a>(ndims,dim_global_src,index,done);</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;          }</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        }</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        fclose(in);</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;      }</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((!strcmp(solver-&gt;<a class="code" href="a02289.html#a83f3dcd022f744511a44f2a31a824ac8">ip_file_type</a>,<span class="stringliteral">&quot;bin&quot;</span>)) || (!strcmp(solver-&gt;<a class="code" href="a02289.html#a83f3dcd022f744511a44f2a31a824ac8">ip_file_type</a>,<span class="stringliteral">&quot;binary&quot;</span>))) {</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;      <span class="keywordtype">char</span> filename[<a class="code" href="a00965.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>];</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;      strcpy(filename,fname_root);</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;      strcat(filename,<span class="stringliteral">&quot;.inp&quot;</span>);</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;      FILE *in; in = fopen(filename,<span class="stringliteral">&quot;rb&quot;</span>);</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;      <span class="keywordflow">if</span> (!in) *read_flag = 0;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        *read_flag = 1;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        printf(<span class="stringliteral">&quot;Reading array from binary file %s (Serial mode).\n&quot;</span>,filename);</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        <span class="keywordtype">size_t</span> bytes;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        <span class="keywordtype">int</span> size;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        <span class="comment">/* allocate global solution array */</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        size   = 1; <span class="keywordflow">for</span> (d=0; d&lt;ndims; d++) size *= dim_global_src[d]; size *= nvars;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        ug_src = (<span class="keywordtype">double</span>*) calloc(size,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        size   = 0; <span class="keywordflow">for</span> (d=0; d&lt;ndims; d++) size += dim_global_src[d];</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        xg_src = (<span class="keywordtype">double</span>*) calloc(size,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        <span class="comment">/* read grid */</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        size = 0;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        <span class="keywordflow">for</span> (d = 0; d &lt; ndims; d++) size += dim_global_src[d];</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        bytes = fread(xg_src, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>), size, in);</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)bytes != size) {</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;          fprintf(stderr,<span class="stringliteral">&quot;Error in ReadArray(): Unable to read grid. Expected %d, Read %d.\n&quot;</span>,</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                  size, (<span class="keywordtype">int</span>)bytes);</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        }</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        <span class="comment">/* read solution */</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        size = 1;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        <span class="keywordflow">for</span> (d = 0; d &lt; ndims; d++) size *= dim_global_src[d]; size *= nvars;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        bytes = fread(ug_src, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>), size, in);</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)bytes != size) {</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;          fprintf(stderr,<span class="stringliteral">&quot;Error in ReadArray(): Unable to read solution. Expected %d, Read %d.\n&quot;</span>,</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                  size, (<span class="keywordtype">int</span>)bytes);</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        }</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        fclose(in);</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;      }</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    }</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="keywordtype">double</span> *ug_src_wg;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="keywordtype">long</span> size = nvars;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="keywordflow">for</span> (d=0; d&lt;ndims; d++) size *= (dim_global_src[d]+2*ghosts); </div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    ug_src_wg = (<span class="keywordtype">double</span>*) calloc (size, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <a class="code" href="a00956.html#ad9b36abcf37c1f675c71da3da16cc8f0">ArrayCopynD</a>(  ndims, </div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                  ug_src, </div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                  ug_src_wg, </div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                  dim_global_src, </div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                  0, </div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                  ghosts, </div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                  index, </div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                  nvars );</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <a class="code" href="a01010.html#a64242767d303af0cca9c33d324d4f79c">fillGhostCells</a>( dim_global_src, </div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                    ghosts, </div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                    ug_src_wg, </div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                    nvars, </div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                    ndims, </div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                    solver-&gt;<a class="code" href="a02289.html#a40e3f67b1530d5ea4e913fc60b594802">isPeriodic</a>);</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    free(ug_src);</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="comment">/* interpolate from the data read in to a global array </span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="comment">     * with specified dimensions */</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="keywordtype">int</span> ierr = <a class="code" href="a01010.html#a4293421dad25c62114f4a7453d6376aa">InterpolateGlobalnDVar</a>(  dim_global,</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                                        &amp;ug,</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                                        dim_global_src,</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                                        ug_src_wg,</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                                        nvars,</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                                        ghosts,</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                                        ndims,</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                                        solver-&gt;<a class="code" href="a02289.html#a40e3f67b1530d5ea4e913fc60b594802">isPeriodic</a> );</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="keywordflow">if</span> (ierr) {</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      fprintf(stderr, <span class="stringliteral">&quot;Error in ReadArraywInterpSerial()\n&quot;</span>);</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;      fprintf(stderr, <span class="stringliteral">&quot;  InterpolateGlobalnDVar() returned with error!\n&quot;</span>);</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;      <span class="keywordflow">return</span> ierr;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    }</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <span class="keywordflow">if</span> (x) {</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;      fprintf(stderr,<span class="stringliteral">&quot;Error in ReadArraywInterpSerial()\n&quot;</span>);</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      fprintf(stderr,<span class="stringliteral">&quot;  Not yet implemented for x\n&quot;</span>);</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      <span class="comment">//InterpolateGlobal1DVar(xg_src, dim_global_src, xg, dim_global);</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    }</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="keywordflow">if</span> (xg_src) free(xg_src);</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="keywordflow">if</span> (ug == NULL) {</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;      fprintf(stderr,<span class="stringliteral">&quot;Error in ReadArraywInterp() - ug is NULL!\n&quot;</span>);</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;      <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    }</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="keywordflow">if</span> ((xg == NULL) &amp;&amp; (x != NULL)) {</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      fprintf(stderr,<span class="stringliteral">&quot;Error in ReadArraywInterp() - xg is NULL!\n&quot;</span>);</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;      <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    }</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  }</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  <span class="comment">/* Broadcast read_flag to all processes */</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  <a class="code" href="a00965.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a01022.html#acd7957559b9206224c7da3cab4f22b27">MPIBroadcast_integer</a>(read_flag,1,0,&amp;mpi-&gt;<a class="code" href="a01028.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00965.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  <span class="keywordflow">if</span> (*read_flag) {</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="comment">/* partition global array to all processes */</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <a class="code" href="a00965.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a01022.html#a25eaada04db84ccf1c979d4301f5093f">MPIPartitionArraynDwGhosts</a>(  ndims,</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                                      mpi,</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                                      (mpi-&gt;<a class="code" href="a01028.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>?NULL:ug),</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                                      u,dim_global,</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                                      dim_local,</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                                      ghosts,</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                                      nvars ); <a class="code" href="a00965.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment">//    if (x) {</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="comment">//      /* partition x vector across the processes */</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment">//      int offset_global = 0, offset_local = 0;</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="comment">//      for (d=0; d&lt;ndims; d++) {</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment">//        IERR MPIPartitionArray1D(mpi,(mpi-&gt;rank?NULL:&amp;xg[offset_global]),</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment">//                                 &amp;x[offset_local+ghosts],</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment">//                                 mpi-&gt;is[d],mpi-&gt;ie[d],dim_local[d],0); CHECKERR(ierr);</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment">//        offset_global += dim_global[d];</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="comment">//        offset_local  += dim_local [d] + 2*ghosts;</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="comment">//      }</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="comment">//    }</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="comment">/* free global arrays */</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a01028.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) {</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;      free(ug);</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;      free(xg);</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    }</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  }</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  <span class="keywordflow">return</span>(0);</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;}</div><div class="ttc" id="a00965_html_add9cf96ae374934d245a1dc1ab697a42"><div class="ttname"><a href="a00965.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a></div><div class="ttdeci">#define CHECKERR(ierr)</div><div class="ttdef"><b>Definition:</b> <a href="a00965_source.html#l00018">basic.h:18</a></div></div>
<div class="ttc" id="a00956_html_ac5ec1371623f11d03b0f42adaa24acbc"><div class="ttname"><a href="a00956.html#ac5ec1371623f11d03b0f42adaa24acbc">_ArrayIncrementIndex_</a></div><div class="ttdeci">#define _ArrayIncrementIndex_(N, imax, i, done)</div><div class="ttdef"><b>Definition:</b> <a href="a00956_source.html#l00126">arrayfunctions.h:126</a></div></div>
<div class="ttc" id="a00965_html_a51efea86a4d76d1259893f606b776573"><div class="ttname"><a href="a00965.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a></div><div class="ttdeci">#define _MAX_STRING_SIZE_</div><div class="ttdef"><b>Definition:</b> <a href="a00965_source.html#l00014">basic.h:14</a></div></div>
<div class="ttc" id="a01028_html_adad7a6f85831f3ac84d854b6c80aef43"><div class="ttname"><a href="a01028.html#adad7a6f85831f3ac84d854b6c80aef43">MPIVariables::world</a></div><div class="ttdeci">MPI_Comm world</div><div class="ttdef"><b>Definition:</b> <a href="a01028_source.html#l00037">mpivars_struct.h:37</a></div></div>
<div class="ttc" id="a00956_html_ad9b36abcf37c1f675c71da3da16cc8f0"><div class="ttname"><a href="a00956.html#ad9b36abcf37c1f675c71da3da16cc8f0">ArrayCopynD</a></div><div class="ttdeci">INLINE int ArrayCopynD(int, const double *, double *, int *, int, int, int *, int)</div><div class="ttdef"><b>Definition:</b> <a href="a00956_source.html#l00410">arrayfunctions.h:410</a></div></div>
<div class="ttc" id="a01010_html_a4293421dad25c62114f4a7453d6376aa"><div class="ttname"><a href="a01010.html#a4293421dad25c62114f4a7453d6376aa">InterpolateGlobalnDVar</a></div><div class="ttdeci">int InterpolateGlobalnDVar(const int *const, double **const, const int *const, double *const, const int, const int, const int, const int *const)</div><div class="ttdef"><b>Definition:</b> <a href="a01460_source.html#l00317">InterpolateGlobalnDVar.c:317</a></div></div>
<div class="ttc" id="a00956_html_a2b2826031c0cd92495ab351d3e599fc5"><div class="ttname"><a href="a00956.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a></div><div class="ttdeci">#define _ArraySetValue_(x, size, value)</div><div class="ttdef"><b>Definition:</b> <a href="a00956_source.html#l00169">arrayfunctions.h:169</a></div></div>
<div class="ttc" id="a01028_html_a02329"><div class="ttname"><a href="a01028.html#a02329">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a01028_source.html#l00024">mpivars_struct.h:24</a></div></div>
<div class="ttc" id="a00965_html_a68f50121fb9a7daeaf60e50cdef82ef3"><div class="ttname"><a href="a00965.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a></div><div class="ttdeci">#define _DECLARE_IERR_</div><div class="ttdef"><b>Definition:</b> <a href="a00965_source.html#l00017">basic.h:17</a></div></div>
<div class="ttc" id="a00965_html_ad6ab74942c9de13cf0b4c12eb0d91780"><div class="ttname"><a href="a00965.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a></div><div class="ttdeci">#define IERR</div><div class="ttdef"><b>Definition:</b> <a href="a00965_source.html#l00016">basic.h:16</a></div></div>
<div class="ttc" id="a02289_html_a83f3dcd022f744511a44f2a31a824ac8"><div class="ttname"><a href="a02289.html#a83f3dcd022f744511a44f2a31a824ac8">HyPar::ip_file_type</a></div><div class="ttdeci">char ip_file_type[_MAX_STRING_SIZE_]</div><div class="ttdef"><b>Definition:</b> <a href="a00986_source.html#l00180">hypar.h:180</a></div></div>
<div class="ttc" id="a01010_html_a64242767d303af0cca9c33d324d4f79c"><div class="ttname"><a href="a01010.html#a64242767d303af0cca9c33d324d4f79c">fillGhostCells</a></div><div class="ttdeci">void fillGhostCells(const int *const, const int, double *const, const int, const int, const int *const)</div><div class="ttdef"><b>Definition:</b> <a href="a01454_source.html#l00017">FillGhostCells.c:17</a></div></div>
<div class="ttc" id="a02289_html_a40e3f67b1530d5ea4e913fc60b594802"><div class="ttname"><a href="a02289.html#a40e3f67b1530d5ea4e913fc60b594802">HyPar::isPeriodic</a></div><div class="ttdeci">int * isPeriodic</div><div class="ttdef"><b>Definition:</b> <a href="a00986_source.html#l00162">hypar.h:162</a></div></div>
<div class="ttc" id="a01022_html_acd7957559b9206224c7da3cab4f22b27"><div class="ttname"><a href="a01022.html#acd7957559b9206224c7da3cab4f22b27">MPIBroadcast_integer</a></div><div class="ttdeci">int MPIBroadcast_integer(int *, int, int, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a01466_source.html#l00023">MPIBroadcast.c:23</a></div></div>
<div class="ttc" id="a01022_html_a25eaada04db84ccf1c979d4301f5093f"><div class="ttname"><a href="a01022.html#a25eaada04db84ccf1c979d4301f5093f">MPIPartitionArraynDwGhosts</a></div><div class="ttdeci">int MPIPartitionArraynDwGhosts(int, void *, double *, double *, int *, int *, int, int)</div><div class="ttdef"><b>Definition:</b> <a href="a01511_source.html#l00114">MPIPartitionArraynD.c:114</a></div></div>
<div class="ttc" id="a01028_html_a6cfd95afd0afebd625b889fb6e58371c"><div class="ttname"><a href="a01028.html#a6cfd95afd0afebd625b889fb6e58371c">MPIVariables::rank</a></div><div class="ttdeci">int rank</div><div class="ttdef"><b>Definition:</b> <a href="a01028_source.html#l00025">mpivars_struct.h:25</a></div></div>
<div class="ttc" id="a02289_html"><div class="ttname"><a href="a02289.html">HyPar</a></div><div class="ttdoc">Structure containing all solver-specific variables and functions. </div><div class="ttdef"><b>Definition:</b> <a href="a00986_source.html#l00023">hypar.h:23</a></div></div>
<div class="ttc" id="a00956_html_afbb862a2fdf5b72b1f9ace42f64b556f"><div class="ttname"><a href="a00956.html#afbb862a2fdf5b72b1f9ace42f64b556f">_ArrayIndex1D_</a></div><div class="ttdeci">#define _ArrayIndex1D_(N, imax, i, ghost, index)</div><div class="ttdef"><b>Definition:</b> <a href="a00956_source.html#l00040">arrayfunctions.h:40</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a84eb363896d58f78282bd0426638c13d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a84eb363896d58f78282bd0426638c13d">&#9670;&nbsp;</a></span>ReadArraywInterp()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ReadArraywInterp </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ndims</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nvars</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>dim_global</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>dim_local</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>dim_global_src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ghosts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>fname_root</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>read_flag</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Read in a vector field from file: This version allows reading data with different dimensions than the array being read in. The data is read in and stored in a new global array with the appropriate size, and the array to be read is filled by interpolation. Currently, the dimensions of the array to be read and the those of the actual data can only differ by factors that are integer powers of 2.</p>
<p>This is a wrapper function that calls the appropriate function depending on input mode (<a class="el" href="a02289.html#a0a0b9dc97c7c278a019939d301db9399">HyPar::input_mode</a>).<br />
<br />
The mode and type of input are specified through <a class="el" href="a02289.html#a0a0b9dc97c7c278a019939d301db9399">HyPar::input_mode</a> and <a class="el" href="a02289.html#a83f3dcd022f744511a44f2a31a824ac8">HyPar::ip_file_type</a>. A vector field is read from file and stored in an array. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ndims</td><td>Number of spatial dimensions </td></tr>
    <tr><td class="paramname">nvars</td><td>Number of variables per grid point </td></tr>
    <tr><td class="paramname">dim_global</td><td>Integer array of size ndims with global size in each dimension </td></tr>
    <tr><td class="paramname">dim_local</td><td>Integer array of size ndims with local size in each dimension </td></tr>
    <tr><td class="paramname">dim_global_src</td><td>Integer array of size ndims with global size of the data in each dimension </td></tr>
    <tr><td class="paramname">ghosts</td><td>Number of ghost points </td></tr>
    <tr><td class="paramname">s</td><td>Solver object of type <a class="el" href="a02289.html" title="Structure containing all solver-specific variables and functions. ">HyPar</a> </td></tr>
    <tr><td class="paramname">m</td><td>MPI object of type <a class="el" href="a01028.html#a02329" title="Structure of MPI-related variables. ">MPIVariables</a> </td></tr>
    <tr><td class="paramname">x</td><td>Grid associated with the array (can be NULL) </td></tr>
    <tr><td class="paramname">u</td><td>Array to hold the vector field </td></tr>
    <tr><td class="paramname">fname_root</td><td>Filename root </td></tr>
    <tr><td class="paramname">read_flag</td><td>Flag to indicate if the file was read </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="a01421_source.html#l00028">28</a> of file <a class="el" href="a01421_source.html">ReadArraywInterp.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;{</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  <a class="code" href="a02289.html">HyPar</a>         *solver = (<a class="code" href="a02289.html">HyPar</a>*) s;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  <a class="code" href="a01028.html#a02329">MPIVariables</a>  *mpi    = (<a class="code" href="a01028.html#a02329">MPIVariables</a>*) m;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  <a class="code" href="a00965.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a>;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  <span class="keywordtype">int</span> retval = <a class="code" href="a01421.html#ac1fd9c1e0d7b79e7047db352b8aeb0b8">ReadArraywInterpSerial</a>(  ndims,</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;                                        nvars,</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;                                        dim_global,</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;                                        dim_local,</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;                                        dim_global_src,</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;                                        ghosts,</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;                                        s,</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;                                        m,</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;                                        x,</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;                                        u,</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;                                        fname_root,</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;                                        read_flag );</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <span class="keywordflow">if</span> (retval) <span class="keywordflow">return</span> retval;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <span class="keywordflow">if</span> (x) {</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="keywordtype">int</span> offset, d;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="comment">/* exchange MPI-boundary values of x between processors */</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    offset = 0;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="keywordflow">for</span> (d = 0; d &lt; ndims; d++) {</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;      <a class="code" href="a00965.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a01022.html#ac2f0cce702a9ce439753286ce227c7a2">MPIExchangeBoundaries1D</a>(mpi,&amp;x[offset],dim_local[d],</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;                                   ghosts,d,ndims); <a class="code" href="a00965.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;      offset  += (dim_local [d] + 2*ghosts);</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    }</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="comment">/* fill in ghost values of x at physical boundaries by extrapolation */</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    offset = 0;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="keywordflow">for</span> (d = 0; d &lt; ndims; d++) {</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;      <span class="keywordtype">double</span> *X     = &amp;x[offset];</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;      <span class="keywordtype">int</span>    *dim   = dim_local, i;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;      <span class="keywordflow">if</span> (mpi-&gt;<a class="code" href="a01028.html#aa3c28612a64b8a97bde66b720e15c700">ip</a>[d] == 0) {</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        <span class="comment">/* fill left boundary along this dimension */</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        <span class="keywordflow">for</span> (i = 0; i &lt; ghosts; i++) {</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;          <span class="keywordtype">int</span> delta = ghosts - i;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;          X[i] = X[ghosts] + ((double) delta) * (X[ghosts]-X[ghosts+1]);</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        }</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;      }</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;      <span class="keywordflow">if</span> (mpi-&gt;<a class="code" href="a01028.html#aa3c28612a64b8a97bde66b720e15c700">ip</a>[d] == mpi-&gt;<a class="code" href="a01028.html#a0be0f30a83bc3f3d9f6ee3a36bbf2716">iproc</a>[d]-1) {</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        <span class="comment">/* fill right boundary along this dimension */</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        <span class="keywordflow">for</span> (i = dim[d]+ghosts; i &lt; dim[d]+2*ghosts; i++) {</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;          <span class="keywordtype">int</span> delta = i - (dim[d]+ghosts-1);</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;          X[i] =  X[dim[d]+ghosts-1] </div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;                  + ((double) delta) * (X[dim[d]+ghosts-1]-X[dim[d]+ghosts-2]);</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        }</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;      }</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;      offset  += (dim[d] + 2*ghosts);</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    }</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  }</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;}</div><div class="ttc" id="a01022_html_ac2f0cce702a9ce439753286ce227c7a2"><div class="ttname"><a href="a01022.html#ac2f0cce702a9ce439753286ce227c7a2">MPIExchangeBoundaries1D</a></div><div class="ttdeci">int MPIExchangeBoundaries1D(void *, double *, int, int, int, int)</div><div class="ttdef"><b>Definition:</b> <a href="a01472_source.html#l00032">MPIExchangeBoundaries1D.c:32</a></div></div>
<div class="ttc" id="a00965_html_add9cf96ae374934d245a1dc1ab697a42"><div class="ttname"><a href="a00965.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a></div><div class="ttdeci">#define CHECKERR(ierr)</div><div class="ttdef"><b>Definition:</b> <a href="a00965_source.html#l00018">basic.h:18</a></div></div>
<div class="ttc" id="a01028_html_a0be0f30a83bc3f3d9f6ee3a36bbf2716"><div class="ttname"><a href="a01028.html#a0be0f30a83bc3f3d9f6ee3a36bbf2716">MPIVariables::iproc</a></div><div class="ttdeci">int * iproc</div><div class="ttdef"><b>Definition:</b> <a href="a01028_source.html#l00027">mpivars_struct.h:27</a></div></div>
<div class="ttc" id="a01028_html_aa3c28612a64b8a97bde66b720e15c700"><div class="ttname"><a href="a01028.html#aa3c28612a64b8a97bde66b720e15c700">MPIVariables::ip</a></div><div class="ttdeci">int * ip</div><div class="ttdef"><b>Definition:</b> <a href="a01028_source.html#l00028">mpivars_struct.h:28</a></div></div>
<div class="ttc" id="a01028_html_a02329"><div class="ttname"><a href="a01028.html#a02329">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a01028_source.html#l00024">mpivars_struct.h:24</a></div></div>
<div class="ttc" id="a00965_html_a68f50121fb9a7daeaf60e50cdef82ef3"><div class="ttname"><a href="a00965.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a></div><div class="ttdeci">#define _DECLARE_IERR_</div><div class="ttdef"><b>Definition:</b> <a href="a00965_source.html#l00017">basic.h:17</a></div></div>
<div class="ttc" id="a00965_html_ad6ab74942c9de13cf0b4c12eb0d91780"><div class="ttname"><a href="a00965.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a></div><div class="ttdeci">#define IERR</div><div class="ttdef"><b>Definition:</b> <a href="a00965_source.html#l00016">basic.h:16</a></div></div>
<div class="ttc" id="a01421_html_ac1fd9c1e0d7b79e7047db352b8aeb0b8"><div class="ttname"><a href="a01421.html#ac1fd9c1e0d7b79e7047db352b8aeb0b8">ReadArraywInterpSerial</a></div><div class="ttdeci">static int ReadArraywInterpSerial(int, int, int *, int *, int *, int, void *, void *, double *, double *, char *, int *)</div><div class="ttdef"><b>Definition:</b> <a href="a01421_source.html#l00159">ReadArraywInterp.c:159</a></div></div>
<div class="ttc" id="a02289_html"><div class="ttname"><a href="a02289.html">HyPar</a></div><div class="ttdoc">Structure containing all solver-specific variables and functions. </div><div class="ttdef"><b>Definition:</b> <a href="a00986_source.html#l00023">hypar.h:23</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">
var sc_project=10897352; 
var sc_invisible=1; 
var sc_security="83042f57"; 
var scJsHost = (("https:" == document.location.protocol) ?
"https://secure." : "http://www.");
document.write("<sc"+"ript type='text/javascript' src='" +
scJsHost+
"statcounter.com/counter/counter.js'></"+"script>");
</script>
<noscript><div class="statcounter"><a title="website
statistics" href="http://statcounter.com/"
target="_blank"><img class="statcounter"
src="//c.statcounter.com/10897352/0/83042f57/1/"
alt="website statistics"></a></div></noscript>
<!-- End of StatCounter Code for Default Guide -->
