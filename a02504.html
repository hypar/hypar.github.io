<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>HyPar: 2D Navier-Stokes Equations -  Lid-Driven Square Cavity (Time-Windowed DMD)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_html_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">HyPar
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">Finite-Difference Hyperbolic-Parabolic PDE Solver on Cartesian Grids</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('a02504.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">2D Navier-Stokes Equations - Lid-Driven Square Cavity (Time-Windowed DMD) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>See <a class="el" href="a02459.html">2D Navier-Stokes Equations - Lid-Driven Square Cavity</a> to familiarize yourself with this case.</p>
<p>Location: <b>hypar/Examples/2D/NavierStokes2D/LidDrivenCavity_libROM_DMD_Train</b> (This directory contains all the input files needed to run this case.)</p>
<p>Governing equations: 2D Navier-Stokes Equations (<a class="el" href="a01064.html" title="2D Navier Stokes equations (compressible flows) ">navierstokes2d.h</a>)</p>
<p>Reduced Order Modeling: This example trains a DMD object and then predicts the solution using the DMD at the same times that the actual <a class="el" href="a02289.html" title="Structure containing all solver-specific variables and functions. ">HyPar</a> solution is written at.</p>
<p>Reference:</p><ul>
<li>Erturk, E., Corke, T.C., and Gokcol, C., "Numerical Solutions of
  2-D Steady Incompressible Driven Cavity Flow at High Reynolds Numbers", International Journal for Numerical Methods in Fluids, 48, 2005, <a href="http://dx.doi.org/10.1002/fld.953">http://dx.doi.org/10.1002/fld.953</a>.</li>
<li>Ghia, U., Ghia, K.N., Shin, C.T., "High-Re Solutions for Incompressible
  Flow using the Navier-Stokes Equations and a Multigrid Method", Journal of Computational Physics, 48, 1982, <a href="http://dx.doi.org/10.1016/0021-9991(82)90058-4">http://dx.doi.org/10.1016/0021-9991(82)90058-4</a>.</li>
</ul>
<p>Note that this is an incompressible problem being solved here using the compressible Navier-Stokes equations in terms of non-dimensional flow variables. The density and pressure are taken such that the speed of sound is 1.0, and the flow velocities specified in the initial and boundary conditions correspond to a characteristic Mach number of 0.1 (thus, they are 0.1 times the values in the above reference).</p>
<p>Domain: \(0 \le x, y \le 1\)</p>
<p>Boundary conditions:</p><ul>
<li>No-slip wall BC on \(x=0,1, 0 \le y \le 1\) (<a class="el" href="a00971.html#affb6a9c452f92435e738bd59b9c98935">_NOSLIP_WALL_</a> with 0 wall velocity).</li>
<li>No-slip wall BC on \(y=0, 0 \le x \le 1\) (<a class="el" href="a00971.html#affb6a9c452f92435e738bd59b9c98935">_NOSLIP_WALL_</a> with 0 wall velocity).</li>
<li>Moving no-slip wall BC on \(y=1, 0 \le x \le 1\) (<a class="el" href="a00971.html#affb6a9c452f92435e738bd59b9c98935">_NOSLIP_WALL_</a> with specified wall velocity of 0.1 in the x-direction).</li>
</ul>
<p>Initial solution: \(\rho=1, p=1/\gamma\). The velocities are specified according to the references above, but scaled by a factor of 0.1 to ensure that the characteristic Mach number is 0.1.</p>
<p>Other parameters:</p><ul>
<li>\(\gamma = 1.4\) (<a class="el" href="a01064.html#a72f9e01745b3a8203067ab84aefc9aea">NavierStokes2D::gamma</a>)</li>
<li>\(Re = \frac {\rho u L } {\mu} = 100, 1000, 3200\) (Reynolds number) (<a class="el" href="a01064.html#a3b92a4b98cedf64473b3c13dfa7674b4">NavierStokes2D::Re</a>), where \(L=1\) is the cavity length and width.</li>
<li>\(Pr = 0.72\) (Prandtl number) (<a class="el" href="a01064.html#af0f6e03342b9eb912e25f94ce0249a2c">NavierStokes2D::Pr</a>)</li>
<li>\(M_\infty = 0.1\) (characteristic Mach number) (<a class="el" href="a01064.html#aa5f774fe7b4f69be5e085f1988ef2a6d">NavierStokes2D::Minf</a>)</li>
</ul>
<p><b>Note:</b> Pressure is taken as \(1/\gamma\) in the above so that the freestream speed of sound is 1.</p>
<p>Numerical method:</p><ul>
<li>Spatial discretization (hyperbolic): 5th order upwind (<a class="el" href="a00992.html#aea7c973ffe0c37bca0703c1bf6175aaa" title="5th order upwind reconstruction (component-wise) on a uniform grid ">Interp1PrimFifthOrderUpwind()</a>)</li>
<li>Spatial discretization (parabolic) : 4th order (<a class="el" href="a00983.html#a08c28e6bc4493172df7b7867e1f3d815">FirstDerivativeFourthOrderCentral()</a>) non-conservative 2-stage (<a class="el" href="a01277.html#a153eb91ec9b118a7b8c971facbc8d920">ParabolicFunctionNC2Stage()</a>)</li>
<li>Time integration: 4th order, 4-stage Runge-Kutta (<a class="el" href="a01112.html#aca6ebec6e6998f0c509bb38fa91f3321">TimeRK()</a>, <a class="el" href="a01118.html#a47de987716954223b3c26bb842b21bf8">_RK_44_</a>)</li>
</ul>
<p>Reduced Order Modeling:</p><ul>
<li>Mode: train (<a class="el" href="a02325.html#af323868d7651bdfd2c34ea076cfaceb7">libROMInterface::m_mode</a>, <a class="el" href="a01001.html#a8d7f058ce028038a98a49ad28176390e">_ROM_MODE_TRAIN_</a>)</li>
<li>Component Mode: monolithic (<a class="el" href="a02325.html#a3686e11d6075a6fd586dca42ab16b214">libROMInterface::m_comp_mode</a>, <a class="el" href="a01001.html#acdb79f8c89bd3e1e867e510b5546fad1">_ROM_COMP_MODE_MONOLITHIC_</a>)</li>
<li>Type: Dynamic Mode Decomposition (DMD) with time windowing (<a class="el" href="a02325.html#ac18cb5a4597cfb6fb48127fc2156a48d">libROMInterface::m_rom_type</a>)</li>
<li>Latent subspace dimension: 16 (<a class="el" href="a02401.html#a46716d3f1d496cde83a07bd6706d4da0">DMDROMObject::m_rdim</a>)</li>
<li>Sampling frequency: 50 (<a class="el" href="a02325.html#a963701fd6a399d7175c478e9c2e74cfb">libROMInterface::m_sampling_freq</a>)</li>
<li>Number of samples per time window: 200 (<a class="el" href="a02401.html#aa98d3c307daac6fc078ab36af24b6020">DMDROMObject::m_num_window_samples</a>)</li>
</ul>
<h2>Input files required: </h2>
<p><b>librom.inp</b> </p><div class="fragment"><div class="line">begin</div><div class="line">  rdim                16</div><div class="line">  sampling_frequency  50</div><div class="line">  mode                train</div><div class="line">  dmd_num_win_samples 200</div><div class="line">end</div></div><!-- fragment --><p><b>solver.inp</b> </p><div class="fragment"><div class="line">begin</div><div class="line">  ndims               2</div><div class="line">  nvars               4</div><div class="line">  size                128 128</div><div class="line">  iproc               4 4</div><div class="line">  ghost               3</div><div class="line">  n_iter              50000</div><div class="line">  time_scheme         rk</div><div class="line">  time_scheme_type    44</div><div class="line">  hyp_space_scheme    upw5</div><div class="line">  hyp_flux_split      no</div><div class="line">  hyp_interp_type     components</div><div class="line">  par_space_type      nonconservative-2stage</div><div class="line">  par_space_scheme    4</div><div class="line">  dt                  0.005</div><div class="line">  screen_op_iter      1000</div><div class="line">  file_op_iter        10000</div><div class="line">  input_mode          serial</div><div class="line">  ip_file_type        binary</div><div class="line">  output_mode         serial</div><div class="line">  op_file_format      binary</div><div class="line">  op_overwrite        yes</div><div class="line">  model               navierstokes2d</div><div class="line">end</div></div><!-- fragment --><p><b>boundary.inp</b> </p><div class="fragment"><div class="line">4</div><div class="line">noslip-wall   0     1     0     0      0   1.0</div><div class="line">0.0 0.0</div><div class="line">noslip-wall   0    -1     0     0      0   1.0</div><div class="line">0.0 0.0</div><div class="line">noslip-wall   1     1     0   1.0      0      0</div><div class="line">0.0 0.0</div><div class="line">noslip-wall   1    -1     0   1.0      0      0</div><div class="line">0.1 0.0</div></div><!-- fragment --><p><b>physics.inp</b> (<b>Note:</b> this file specifies \(Re = 3200\), change <em>Re</em> here for other Reynolds numbers.) </p><div class="fragment"><div class="line">begin</div><div class="line">  gamma     1.4</div><div class="line">  upwinding roe</div><div class="line">  Pr        0.72</div><div class="line">  Minf      0.1</div><div class="line">  Re        3200</div><div class="line">end</div></div><!-- fragment --><p>To generate <b>initial.inp</b> (initial solution), compile and run the following code in the run directory </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;math.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="a01451.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>()</div><div class="line">{</div><div class="line">  <span class="keywordtype">double</span> gamma  = 1.4;</div><div class="line">  </div><div class="line">    <span class="keywordtype">int</span>   NI,NJ,ndims;</div><div class="line">  <span class="keywordtype">char</span>  ip_file_type[50]; strcpy(ip_file_type,<span class="stringliteral">&quot;ascii&quot;</span>);</div><div class="line"></div><div class="line">  FILE *in;</div><div class="line">  printf(<span class="stringliteral">&quot;Reading file \&quot;solver.inp\&quot;...\n&quot;</span>);</div><div class="line">  in = fopen(<span class="stringliteral">&quot;solver.inp&quot;</span>,<span class="stringliteral">&quot;r&quot;</span>);</div><div class="line">  <span class="keywordflow">if</span> (!in) {</div><div class="line">    printf(<span class="stringliteral">&quot;Error: Input file \&quot;solver.inp\&quot; not found. Default values will be used.\n&quot;</span>);</div><div class="line">    <span class="keywordflow">return</span>(0);</div><div class="line">  } <span class="keywordflow">else</span> {</div><div class="line">    <span class="keywordtype">char</span> word[500];</div><div class="line">    fscanf(in,<span class="stringliteral">&quot;%s&quot;</span>,word);</div><div class="line">    <span class="keywordflow">if</span> (!strcmp(word, <span class="stringliteral">&quot;begin&quot;</span>)) {</div><div class="line">      <span class="keywordflow">while</span> (strcmp(word, <span class="stringliteral">&quot;end&quot;</span>)) {</div><div class="line">        fscanf(in,<span class="stringliteral">&quot;%s&quot;</span>,word);</div><div class="line">        <span class="keywordflow">if</span> (!strcmp(word, <span class="stringliteral">&quot;ndims&quot;</span>)) fscanf(in,<span class="stringliteral">&quot;%d&quot;</span>,&amp;ndims);</div><div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(word, <span class="stringliteral">&quot;size&quot;</span>)) {</div><div class="line">          fscanf(in,<span class="stringliteral">&quot;%d&quot;</span>,&amp;NI);</div><div class="line">          fscanf(in,<span class="stringliteral">&quot;%d&quot;</span>,&amp;NJ);</div><div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(word, <span class="stringliteral">&quot;ip_file_type&quot;</span>)) fscanf(in,<span class="stringliteral">&quot;%s&quot;</span>,ip_file_type);</div><div class="line">      }</div><div class="line">    } <span class="keywordflow">else</span> printf(<span class="stringliteral">&quot;Error: Illegal format in solver.inp. Crash and burn!\n&quot;</span>);</div><div class="line">  }</div><div class="line">  fclose(in);</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (ndims != 2) {</div><div class="line">    printf(<span class="stringliteral">&quot;ndims is not 2 in solver.inp. this code is to generate 2D initial conditions\n&quot;</span>);</div><div class="line">    <span class="keywordflow">return</span>(0);</div><div class="line">  }</div><div class="line">    printf(<span class="stringliteral">&quot;Grid:\t\t\t%d X %d\n&quot;</span>,NI,NJ);</div><div class="line"></div><div class="line">    <span class="keywordtype">int</span> i,j;</div><div class="line">    <span class="keywordtype">double</span> dx = 1.0 / ((double)NI-1);</div><div class="line">    <span class="keywordtype">double</span> dy = 1.0 / ((double)NJ-1);</div><div class="line"></div><div class="line">  <span class="keywordtype">double</span> Minf = 0.1;</div><div class="line"></div><div class="line">    <span class="keywordtype">double</span> *x, *y, *u0, *u1, *u2, *u3;</div><div class="line">    x   = (<span class="keywordtype">double</span>*) calloc (NI   , <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div><div class="line">    y   = (<span class="keywordtype">double</span>*) calloc (NJ   , <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div><div class="line">    u0  = (<span class="keywordtype">double</span>*) calloc (NI*NJ, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div><div class="line">    u1  = (<span class="keywordtype">double</span>*) calloc (NI*NJ, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div><div class="line">    u2  = (<span class="keywordtype">double</span>*) calloc (NI*NJ, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div><div class="line">    u3  = (<span class="keywordtype">double</span>*) calloc (NI*NJ, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; NI; i++){</div><div class="line">    <span class="keywordflow">for</span> (j = 0; j &lt; NJ; j++){</div><div class="line">        x[i] = i*dx;</div><div class="line">        y[j] = j*dy;</div><div class="line">      <span class="keywordtype">int</span> p = NJ*i + j;</div><div class="line">      <span class="keywordtype">double</span> rho, u, v, P;</div><div class="line">      rho = 1.0;</div><div class="line">      P   = 1.0/gamma;</div><div class="line">      u   =   Minf * (y[j]-0.5);</div><div class="line">      v   = - Minf * (x[i]-0.5);</div><div class="line">      u0[p] = rho;</div><div class="line">      u1[p] = rho*u;</div><div class="line">      u2[p] = rho*v;</div><div class="line">      u3[p] = P/(gamma-1.0) + 0.5*rho*(u*u+v*v);</div><div class="line">      }</div><div class="line">    }</div><div class="line"></div><div class="line">  FILE *out;</div><div class="line">  <span class="keywordflow">if</span> (!strcmp(ip_file_type,<span class="stringliteral">&quot;ascii&quot;</span>)) {</div><div class="line">    printf(<span class="stringliteral">&quot;Writing ASCII initial solution file initial.inp\n&quot;</span>);</div><div class="line">    out = fopen(<span class="stringliteral">&quot;initial.inp&quot;</span>,<span class="stringliteral">&quot;w&quot;</span>);</div><div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; NI; i++)  fprintf(out,<span class="stringliteral">&quot;%lf &quot;</span>,x[i]);</div><div class="line">    fprintf(out,<span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line">    <span class="keywordflow">for</span> (j = 0; j &lt; NJ; j++)  fprintf(out,<span class="stringliteral">&quot;%lf &quot;</span>,y[j]);</div><div class="line">    fprintf(out,<span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line">    <span class="keywordflow">for</span> (j = 0; j &lt; NJ; j++)    {</div><div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; NI; i++)    {</div><div class="line">        <span class="keywordtype">int</span> p = NJ*i + j;</div><div class="line">        fprintf(out,<span class="stringliteral">&quot;%lf &quot;</span>,u0[p]);</div><div class="line">      }</div><div class="line">    }</div><div class="line">    fprintf(out,<span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line">    <span class="keywordflow">for</span> (j = 0; j &lt; NJ; j++)    {</div><div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; NI; i++)    {</div><div class="line">        <span class="keywordtype">int</span> p = NJ*i + j;</div><div class="line">        fprintf(out,<span class="stringliteral">&quot;%lf &quot;</span>,u1[p]);</div><div class="line">      }</div><div class="line">    }</div><div class="line">    fprintf(out,<span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line">    <span class="keywordflow">for</span> (j = 0; j &lt; NJ; j++)    {</div><div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; NI; i++)    {</div><div class="line">        <span class="keywordtype">int</span> p = NJ*i + j;</div><div class="line">        fprintf(out,<span class="stringliteral">&quot;%lf &quot;</span>,u2[p]);</div><div class="line">      }</div><div class="line">    }</div><div class="line">    fprintf(out,<span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line">    <span class="keywordflow">for</span> (j = 0; j &lt; NJ; j++)    {</div><div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; NI; i++)    {</div><div class="line">        <span class="keywordtype">int</span> p = NJ*i + j;</div><div class="line">        fprintf(out,<span class="stringliteral">&quot;%lf &quot;</span>,u3[p]);</div><div class="line">      }</div><div class="line">    }</div><div class="line">    fprintf(out,<span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line">      fclose(out);</div><div class="line">  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((!strcmp(ip_file_type,<span class="stringliteral">&quot;binary&quot;</span>)) || (!strcmp(ip_file_type,<span class="stringliteral">&quot;bin&quot;</span>))) {</div><div class="line">    printf(<span class="stringliteral">&quot;Writing binary initial solution file initial.inp\n&quot;</span>);</div><div class="line">    out = fopen(<span class="stringliteral">&quot;initial.inp&quot;</span>,<span class="stringliteral">&quot;wb&quot;</span>);</div><div class="line">    fwrite(x,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>),NI,out);</div><div class="line">    fwrite(y,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>),NJ,out);</div><div class="line">    <span class="keywordtype">double</span> *U = (<span class="keywordtype">double</span>*) calloc (4*NI*NJ,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div><div class="line">    <span class="keywordflow">for</span> (i=0; i &lt; NI; i++) {</div><div class="line">      <span class="keywordflow">for</span> (j = 0; j &lt; NJ; j++) {</div><div class="line">        <span class="keywordtype">int</span> p = NJ*i + j;</div><div class="line">        <span class="keywordtype">int</span> q = NI*j + i;</div><div class="line">        U[4*q+0] = u0[p];</div><div class="line">        U[4*q+1] = u1[p];</div><div class="line">        U[4*q+2] = u2[p];</div><div class="line">        U[4*q+3] = u3[p];</div><div class="line">      }</div><div class="line">    }</div><div class="line">    fwrite(U,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>),4*NI*NJ,out);</div><div class="line">    free(U);</div><div class="line">    fclose(out);</div><div class="line">  }</div><div class="line"></div><div class="line">    free(x);</div><div class="line">    free(y);</div><div class="line">    free(u0);</div><div class="line">    free(u1);</div><div class="line">    free(u2);</div><div class="line">    free(u3);</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span>(0);</div><div class="line">}</div></div><!-- fragment --><h2>Output: </h2>
<p>Note that <b>iproc</b> is set to </p><pre class="fragment">  4 4
</pre><p>in <b>solver.inp</b> (i.e., 4 processors along <em>x</em>, and 4 processor along <em>y</em>). Thus, this example should be run with 16 MPI ranks (or change <b>iproc</b>).</p>
<p>After running the code, there should be the following output files:</p>
<ul>
<li>1 output file <b>op.bin</b>; this is the <b><a class="el" href="a02289.html" title="Structure containing all solver-specific variables and functions. ">HyPar</a></b> solutions<b></b>.</li>
<li>1 output file <b>op_rom.bin</b>; this is the <b>predicted</b> solutions from the DMD object(s)<b></b>.</li>
</ul>
<p>All the files are binary (<a class="el" href="a02289.html#a51a3b8c19b86e9e1df5be02b05a6613c">HyPar::op_file_format</a> is set to <em>binary</em> in <b>solver.inp</b>).</p>
<p>The provided Python script (<b>plotStreamlines.py</b>) can be used to generate plots from the binary files that compare the <a class="el" href="a02289.html" title="Structure containing all solver-specific variables and functions. ">HyPar</a> and DMD solutions. Alternatively, <a class="el" href="a02289.html#a51a3b8c19b86e9e1df5be02b05a6613c">HyPar::op_file_format</a> can be set to <em>tecplot2d</em>, and Tecplot/VisIt or something similar can be used to plot the resulting text files.</p>
<p>The following plot shows the final solution (velocity streamlines colored by the velocity magnitude) - FOM (full-order model) refers to the <a class="el" href="a02289.html" title="Structure containing all solver-specific variables and functions. ">HyPar</a> solution, ROM (reduced-order model) refers to the DMD solution, and Diff is the difference in the velocity magnitude between the two. </p><div class="image">
<img src="Solution_2DNavStokLDSC_Re3200_libROM_DMD.png" alt="Solution_2DNavStokLDSC_Re3200_libROM_DMD.png"/>
</div>
<p><b>Wall</b> <b>clock</b> <b>times:</b> </p><ul>
<li>PDE solution: 554.6 seconds</li>
<li>DMD training time: 58.6 seconds</li>
<li>DMD prediction/query time: 0.3 seconds</li>
</ul>
<p>The L1, L2, and Linf norms of the diff between the <a class="el" href="a02289.html" title="Structure containing all solver-specific variables and functions. ">HyPar</a> and ROM solution at the final time are calculated and reported on screen (see below) as well as <b>pde_rom_diff.dat:</b> </p><div class="fragment"><div class="line"> 128  128    4    4 5.0000000000000001E-03  1.7418241509090257E-02 1.7510056779346722E-02 1.8794021053187084E-02   5.7135094100000003E+02 5.7163283200000001E+02</div></div><!-- fragment --><p> The numbers are: number of grid points in each dimension (<a class="el" href="a02289.html#aa989ebb755986852177779cdf7bd8c85">HyPar::dim_global</a>), number of processors in each dimension (<a class="el" href="a01028.html#a0be0f30a83bc3f3d9f6ee3a36bbf2716">MPIVariables::iproc</a>), time step size (<a class="el" href="a02289.html#a03e28be41881b703c836edbfe9b51b17">HyPar::dt</a>), L1, L2, and L-infinity norms of the diff (<a class="el" href="a02289.html#aaacee284a041d53cf335ae299d5eb929">HyPar::rom_diff_norms</a>), solver wall time (seconds) (i.e., not accounting for initialization, and cleaning up), and total wall time.</p>
<p>By default, the code will write the trained DMD object(s) to files in a subdirectory (<a class="el" href="a02401.html#a4a2342bcda8d44940111704f8423f38f">DMDROMObject::m_dirname</a> - default value is "DMD"). If the subdirectory does not exist, the code <b>may</b> <b>not</b> report an error (or give some HDF5 file-writing error); the DMD objects will not be written! If the subdirectory exists, several files will exist after the simulation is complete - they are in a format that is readable by libROM.</p>
<p>Expected screen output: </p><div class="fragment"><div class="line">HyPar - Parallel (MPI) version with 16 processes</div><div class="line">Compiled with PETSc time integration.</div><div class="line">Allocated simulation object(s).</div><div class="line">Reading solver inputs from file &quot;solver.inp&quot;.</div><div class="line">  No. of dimensions                          : 2</div><div class="line">  No. of variables                           : 4</div><div class="line">  Domain size                                : 128 128 </div><div class="line">  Processes along each dimension             : 4 4 </div><div class="line">  Exact solution domain size                 : 128 128 </div><div class="line">  No. of ghosts pts                          : 3</div><div class="line">  No. of iter.                               : 50000</div><div class="line">  Restart iteration                          : 0</div><div class="line">  Time integration scheme                    : rk (44)</div><div class="line">  Spatial discretization scheme (hyperbolic) : upw5</div><div class="line">  Split hyperbolic flux term?                : no</div><div class="line">  Interpolation type for hyperbolic term     : components</div><div class="line">  Spatial discretization type   (parabolic ) : nonconservative-2stage</div><div class="line">  Spatial discretization scheme (parabolic ) : 4</div><div class="line">  Time Step                                  : 5.000000E-03</div><div class="line">  Check for conservation                     : no</div><div class="line">  Screen output iterations                   : 1000</div><div class="line">  File output iterations                     : 10000</div><div class="line">  Initial solution file type                 : binary</div><div class="line">  Initial solution read mode                 : serial</div><div class="line">  Solution file write mode                   : serial</div><div class="line">  Solution file format                       : binary</div><div class="line">  Overwrite solution file                    : yes</div><div class="line">  Physical model                             : navierstokes2d</div><div class="line">Partitioning domain and allocating data arrays.</div><div class="line">Reading array from binary file initial.inp (Serial mode).</div><div class="line">Volume integral of the initial solution:</div><div class="line"> 0:  1.0158100316200525E+00</div><div class="line"> 1:  -1.7347234759768071E-17</div><div class="line"> 2:  -8.6736173798840355E-19</div><div class="line"> 3:  1.8148063242358203E+00</div><div class="line">Reading boundary conditions from boundary.inp.</div><div class="line">  Boundary                    noslip-wall:  Along dimension  0 and face +1</div><div class="line">  Boundary                    noslip-wall:  Along dimension  0 and face -1</div><div class="line">  Boundary                    noslip-wall:  Along dimension  1 and face +1</div><div class="line">  Boundary                    noslip-wall:  Along dimension  1 and face -1</div><div class="line">4 boundary condition(s) read.</div><div class="line">Initializing solvers.</div><div class="line">Initializing physics. Model = &quot;navierstokes2d&quot;</div><div class="line">Reading physical model inputs from file &quot;physics.inp&quot;.</div><div class="line">Setting up time integration.</div><div class="line">Setting up libROM interface.</div><div class="line">libROM inputs and parameters:</div><div class="line">  reduced model dimensionality:  16</div><div class="line">  sampling frequency:  25</div><div class="line">  mode: train</div><div class="line">  type: DMD</div><div class="line">  save to file: true</div><div class="line">  local vector size: 4096</div><div class="line">libROM DMD inputs:</div><div class="line">  number of samples per window:   400</div><div class="line">  directory name for DMD onjects: DMD</div><div class="line">Solving in time (from 0 to 50000 iterations)</div><div class="line">Writing solution file op.bin.</div><div class="line">DMDROMObject::takeSample() - creating new DMD object, t=0.000000 (total: 1).</div><div class="line">iter=   1000  t=5.000E+00  CFL=7.012E-01  norm=2.9995E-03  wctime: 1.1E-02 (s)  </div><div class="line">iter=   2000  t=1.000E+01  CFL=7.023E-01  norm=2.1289E-03  wctime: 1.1E-02 (s)  </div><div class="line">iter=   3000  t=1.500E+01  CFL=7.092E-01  norm=2.1891E-03  wctime: 1.1E-02 (s)  </div><div class="line">iter=   4000  t=2.000E+01  CFL=7.039E-01  norm=1.7303E-03  wctime: 1.1E-02 (s)  </div><div class="line">iter=   5000  t=2.500E+01  CFL=7.004E-01  norm=1.3120E-03  wctime: 1.1E-02 (s)  </div><div class="line">iter=   6000  t=3.000E+01  CFL=6.968E-01  norm=1.1986E-03  wctime: 1.1E-02 (s)  </div><div class="line">iter=   7000  t=3.500E+01  CFL=6.961E-01  norm=1.2731E-03  wctime: 1.1E-02 (s)  </div><div class="line">iter=   8000  t=4.000E+01  CFL=6.955E-01  norm=9.5996E-04  wctime: 1.1E-02 (s)  </div><div class="line">iter=   9000  t=4.500E+01  CFL=6.956E-01  norm=8.6183E-04  wctime: 1.1E-02 (s)  </div><div class="line">iter=  10000  t=5.000E+01  CFL=6.964E-01  norm=8.1264E-04  wctime: 1.1E-02 (s)  </div><div class="line">Writing solution file op.bin.</div><div class="line">DMDROMObject::takeSample() - creating new DMD object, t=50.000000 (total: 2).</div><div class="line">iter=  11000  t=5.500E+01  CFL=6.987E-01  norm=7.8505E-04  wctime: 1.1E-02 (s)  </div><div class="line">iter=  12000  t=6.000E+01  CFL=6.989E-01  norm=6.2630E-04  wctime: 1.1E-02 (s)  </div><div class="line">iter=  13000  t=6.500E+01  CFL=6.927E-01  norm=5.2062E-04  wctime: 1.1E-02 (s)  </div><div class="line">iter=  14000  t=7.000E+01  CFL=6.943E-01  norm=5.6029E-04  wctime: 1.1E-02 (s)  </div><div class="line">iter=  15000  t=7.500E+01  CFL=6.929E-01  norm=4.6944E-04  wctime: 1.1E-02 (s)  </div><div class="line">iter=  16000  t=8.000E+01  CFL=6.949E-01  norm=3.8959E-04  wctime: 1.1E-02 (s)  </div><div class="line">iter=  17000  t=8.500E+01  CFL=6.947E-01  norm=3.1033E-04  wctime: 1.1E-02 (s)  </div><div class="line">iter=  18000  t=9.000E+01  CFL=6.957E-01  norm=3.7533E-04  wctime: 1.1E-02 (s)  </div><div class="line">iter=  19000  t=9.500E+01  CFL=6.951E-01  norm=3.0507E-04  wctime: 1.1E-02 (s)  </div><div class="line">iter=  20000  t=1.000E+02  CFL=6.932E-01  norm=2.4821E-04  wctime: 1.1E-02 (s)  </div><div class="line">Writing solution file op.bin.</div><div class="line">DMDROMObject::takeSample() - creating new DMD object, t=100.000000 (total: 3).</div><div class="line">iter=  21000  t=1.050E+02  CFL=6.934E-01  norm=2.7306E-04  wctime: 1.1E-02 (s)  </div><div class="line">iter=  22000  t=1.100E+02  CFL=6.926E-01  norm=2.4066E-04  wctime: 1.1E-02 (s)  </div><div class="line">iter=  23000  t=1.150E+02  CFL=6.931E-01  norm=2.1484E-04  wctime: 1.1E-02 (s)  </div><div class="line">iter=  24000  t=1.200E+02  CFL=6.933E-01  norm=1.7314E-04  wctime: 1.1E-02 (s)  </div><div class="line">iter=  25000  t=1.250E+02  CFL=6.943E-01  norm=1.7899E-04  wctime: 1.1E-02 (s)  </div><div class="line">iter=  26000  t=1.300E+02  CFL=6.944E-01  norm=1.6131E-04  wctime: 1.1E-02 (s)  </div><div class="line">iter=  27000  t=1.350E+02  CFL=6.941E-01  norm=1.4382E-04  wctime: 1.1E-02 (s)  </div><div class="line">iter=  28000  t=1.400E+02  CFL=6.933E-01  norm=1.3690E-04  wctime: 1.1E-02 (s)  </div><div class="line">iter=  29000  t=1.450E+02  CFL=6.934E-01  norm=1.2948E-04  wctime: 1.1E-02 (s)  </div><div class="line">iter=  30000  t=1.500E+02  CFL=6.930E-01  norm=1.3045E-04  wctime: 1.1E-02 (s)  </div><div class="line">Writing solution file op.bin.</div><div class="line">DMDROMObject::takeSample() - creating new DMD object, t=150.000000 (total: 4).</div><div class="line">iter=  31000  t=1.550E+02  CFL=6.937E-01  norm=9.0917E-05  wctime: 1.1E-02 (s)  </div><div class="line">iter=  32000  t=1.600E+02  CFL=6.943E-01  norm=8.2598E-05  wctime: 1.1E-02 (s)  </div><div class="line">iter=  33000  t=1.650E+02  CFL=6.944E-01  norm=9.3604E-05  wctime: 1.1E-02 (s)  </div><div class="line">iter=  34000  t=1.700E+02  CFL=6.941E-01  norm=8.2717E-05  wctime: 1.1E-02 (s)  </div><div class="line">iter=  35000  t=1.750E+02  CFL=6.937E-01  norm=6.0937E-05  wctime: 1.1E-02 (s)  </div><div class="line">iter=  36000  t=1.800E+02  CFL=6.935E-01  norm=6.9049E-05  wctime: 1.1E-02 (s)  </div><div class="line">iter=  37000  t=1.850E+02  CFL=6.933E-01  norm=8.1859E-05  wctime: 1.1E-02 (s)  </div><div class="line">iter=  38000  t=1.900E+02  CFL=6.937E-01  norm=6.5221E-05  wctime: 1.1E-02 (s)  </div><div class="line">iter=  39000  t=1.950E+02  CFL=6.939E-01  norm=5.3237E-05  wctime: 1.1E-02 (s)  </div><div class="line">iter=  40000  t=2.000E+02  CFL=6.942E-01  norm=5.6340E-05  wctime: 1.1E-02 (s)  </div><div class="line">Writing solution file op.bin.</div><div class="line">DMDROMObject::takeSample() - creating new DMD object, t=200.000000 (total: 5).</div><div class="line">iter=  41000  t=2.050E+02  CFL=6.941E-01  norm=5.5951E-05  wctime: 1.1E-02 (s)  </div><div class="line">iter=  42000  t=2.100E+02  CFL=6.941E-01  norm=4.3380E-05  wctime: 1.1E-02 (s)  </div><div class="line">iter=  43000  t=2.150E+02  CFL=6.938E-01  norm=4.1924E-05  wctime: 1.1E-02 (s)  </div><div class="line">iter=  44000  t=2.200E+02  CFL=6.938E-01  norm=5.1997E-05  wctime: 1.1E-02 (s)  </div><div class="line">iter=  45000  t=2.250E+02  CFL=6.938E-01  norm=4.4642E-05  wctime: 1.1E-02 (s)  </div><div class="line">iter=  46000  t=2.300E+02  CFL=6.941E-01  norm=2.8358E-05  wctime: 1.1E-02 (s)  </div><div class="line">iter=  47000  t=2.350E+02  CFL=6.941E-01  norm=2.9105E-05  wctime: 1.1E-02 (s)  </div><div class="line">iter=  48000  t=2.400E+02  CFL=6.942E-01  norm=3.3503E-05  wctime: 1.1E-02 (s)  </div><div class="line">iter=  49000  t=2.450E+02  CFL=6.940E-01  norm=2.4237E-05  wctime: 1.1E-02 (s)  </div><div class="line">iter=  50000  t=2.500E+02  CFL=6.939E-01  norm=1.8765E-05  wctime: 1.1E-02 (s)  </div><div class="line">Completed time integration (Final time: 250.000000), total wctime: 554.569953 (seconds).</div><div class="line">Writing solution file op.bin.</div><div class="line">libROM: Training ROM.</div><div class="line">DMDROMObject::train() - training DMD object 0 with 401 samples.</div><div class="line">Using 16 basis vectors out of 400.</div><div class="line">DMDROMObject::train() - training DMD object 1 with 401 samples.</div><div class="line">Using 16 basis vectors out of 400.</div><div class="line">DMDROMObject::train() - training DMD object 2 with 401 samples.</div><div class="line">Using 16 basis vectors out of 400.</div><div class="line">DMDROMObject::train() - training DMD object 3 with 401 samples.</div><div class="line">Using 16 basis vectors out of 400.</div><div class="line">DMDROMObject::train() - training DMD object 4 with 400 samples.</div><div class="line">Using 16 basis vectors out of 399.</div><div class="line">libROM: total training wallclock time: 58.575120 (seconds).</div><div class="line">libROM: Predicting solution at time 0.0000e+00 using ROM.</div><div class="line">libROM:   wallclock time: 0.053246 (seconds).</div><div class="line">Writing solution file op_rom.bin.</div><div class="line">libROM: Predicting solution at time 5.0000e+01 using ROM.</div><div class="line">libROM:   wallclock time: 0.052539 (seconds).</div><div class="line">Writing solution file op_rom.bin.</div><div class="line">libROM: Predicting solution at time 1.0000e+02 using ROM.</div><div class="line">libROM:   wallclock time: 0.051701 (seconds).</div><div class="line">Writing solution file op_rom.bin.</div><div class="line">libROM: Predicting solution at time 1.5000e+02 using ROM.</div><div class="line">libROM:   wallclock time: 0.051391 (seconds).</div><div class="line">Writing solution file op_rom.bin.</div><div class="line">libROM: Predicting solution at time 2.0000e+02 using ROM.</div><div class="line">libROM:   wallclock time: 0.051721 (seconds).</div><div class="line">Writing solution file op_rom.bin.</div><div class="line">libROM: Predicting solution at time 2.5000e+02 using ROM.</div><div class="line">libROM:   wallclock time: 0.051367 (seconds).</div><div class="line">libROM:   Calculating diff between PDE and ROM solutions.</div><div class="line">Writing solution file op_rom.bin.</div><div class="line">libROM: total prediction/query wallclock time: 0.311965 (seconds).</div><div class="line">libROMInterface::saveROM() - saving ROM objects.</div><div class="line">  Saving DMD object with filename root DMD/dmdobj_0000.</div><div class="line">  Saving DMD object with filename root DMD/dmdobj_0001.</div><div class="line">  Saving DMD object with filename root DMD/dmdobj_0002.</div><div class="line">  Saving DMD object with filename root DMD/dmdobj_0003.</div><div class="line">  Saving DMD object with filename root DMD/dmdobj_0004.</div><div class="line">Norms of the diff between ROM and PDE solutions for domain 0:</div><div class="line">  L1         Norm            : 8.5992357949730321E-03</div><div class="line">  L2         Norm            : 8.6116162558021424E-03</div><div class="line">  Linfinity  Norm            : 9.9877095768199000E-03</div><div class="line">Solver runtime (in seconds): 6.1712231799999995E+02</div><div class="line">Total  runtime (in seconds): 6.1738959499999999E+02</div><div class="line">Deallocating arrays.</div><div class="line">Finished.</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">
var sc_project=10897352; 
var sc_invisible=1; 
var sc_security="83042f57"; 
var scJsHost = (("https:" == document.location.protocol) ?
"https://secure." : "http://www.");
document.write("<sc"+"ript type='text/javascript' src='" +
scJsHost+
"statcounter.com/counter/counter.js'></"+"script>");
</script>
<noscript><div class="statcounter"><a title="website
statistics" href="http://statcounter.com/"
target="_blank"><img class="statcounter"
src="//c.statcounter.com/10897352/0/83042f57/1/"
alt="website statistics"></a></div></noscript>
<!-- End of StatCounter Code for Default Guide -->
