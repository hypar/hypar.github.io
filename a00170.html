<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>HyPar: 2D Euler Equations (with gravitational force) - Inertia-Gravity Waves (Time-Windowed DMD) with PETSc IMEX time integration</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_html_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">HyPar
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">Finite-Difference Hyperbolic-Parabolic PDE Solver on Cartesian Grids</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('a00170.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">2D Euler Equations (with gravitational force) - Inertia-Gravity Waves (Time-Windowed DMD) with PETSc IMEX time integration </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>See <a class="el" href="a00088.html">2D Euler Equations (with gravitational force) - Inertia-Gravity Waves</a> to familiarize yourself with this case.</p>
<p>Location: <b>hypar/Examples/2D/NavierStokes2D/InertiaGravityWave_PETSc_IMEX_libROM_DMD_Train</b> (This directory contains all the input files needed to run this case.)</p>
<p>Governing equations: 2D Euler Equations (<a class="el" href="a00201.html" title="2D Navier Stokes equations (compressible flows) ">navierstokes2d.h</a> - By default, <a class="el" href="a00201.html#a3b92a4b98cedf64473b3c13dfa7674b4">NavierStokes2D::Re</a> is set to <b>-1</b> which makes the code skip the parabolic terms, i.e., the 2D Euler equations are solved.)</p>
<p>Reduced Order Modeling: This example trains a DMD object and then predicts the solution using the DMD at the same times that the actual <a class="el" href="a00196.html" title="Structure containing all solver-specific variables and functions. ">HyPar</a> solution is written at.</p>
<p>Reference:</p>
<ul>
<li>W. C. Skamarock and J. B. Klemp, "Efficiency and accuracy of 
    the Klemp-Wilhelmson timesplitting technique", Monthly Weather Review, 122 (1994), pp. 2623–2630.</li>
<li>Giraldo, F.X., Restelli, M., "A study of spectral element and discontinuous Galerkin methods for the Navier–Stokes equations in nonhydrostatic mesoscale atmospheric modeling: Equation sets and test cases", J. Comput. Phys., 227, 2008, 3849&ndash;3877, (Section 3.1).</li>
</ul>
<p>The problem is solved here using <b>implicit-explicit (IMEX)</b> time integration, where the hyperbolic flux is partitioned into its entropy and acoustic components with the former integrated explicitly and the latter integrated implicitly. See the following reference:</p>
<ul>
<li>Ghosh, D., Constantinescu, E. M., "Semi-Implicit Time Integration of 
  Atmospheric Flows with Characteristic-Based Flux Partitioning", SIAM Journal on Scientific Computing, 38 (3), 2016, A1848-A1875, <a href="http://dx.doi.org/10.1137/15M1044369">http://dx.doi.org/10.1137/15M1044369</a>.</li>
</ul>
<p>Domain: \(0 \le x \le 300,000\,m, 0 \le y \le 10,000\,m\), <em>"periodic"</em> (<a class="el" href="a00221.html#a65ffa4253dee762c65092abcf04ecdee">_PERIODIC_</a>) boundary conditions along \(x\), "slip-wall" (<a class="el" href="a00221.html#af3a9f3ba15bc914ed0a88295aee147e8">_SLIP_WALL_</a>) boundary conditions along \(y\).</p>
<p>Initial solution: See references above.</p>
<p>Other parameters (all dimensional quantities are in SI units):</p>
<ul>
<li>Specific heat ratio \(\gamma = 1.4\) (<a class="el" href="a00201.html#a72f9e01745b3a8203067ab84aefc9aea">NavierStokes2D::gamma</a>)</li>
<li>Universal gas constant \(R = 287.058\) (<a class="el" href="a00201.html#a228eb5e837a644887ac6e7bab3f42485">NavierStokes2D::R</a>)</li>
<li>Gravitational force per unit mass \(g = 9.8\) along <em>y-axis</em> (<a class="el" href="a00201.html#adf08e308b453bd2d4e117576e493ed03">NavierStokes2D::grav_y</a>)</li>
<li>Reference density (at zero altitude) \(\rho_{ref} = 1.1612055171196529\) (<a class="el" href="a00201.html#a1e6f66261d19a1c1c272e8808bd2657b">NavierStokes2D::rho0</a>)</li>
<li>Reference pressure (at zero altitude) \(P_{ref} = 100000\) (<a class="el" href="a00201.html#a8be9de5ac626cddcd15c5ec181619694">NavierStokes2D::p0</a>)</li>
<li>Hydrostatic balance type 3 (<a class="el" href="a00201.html#a2e01ef077b0fedaea9e286ccdf2fe259">NavierStokes2D::HB</a>)</li>
<li>Brunt-Vaisala frequency 0.01 (<a class="el" href="a00201.html#aa79c64518f6e9127d9b201bacd398174">NavierStokes2D::N_bv</a>)</li>
</ul>
<p>Numerical method:</p>
<ul>
<li>Spatial discretization (hyperbolic): 5th order compact upwind (<a class="el" href="a00185.html#a3ac2a77b9fa5a50499c285e49cf91344" title="5th order compact upwind reconstruction (component-wise) on a uniform grid ">Interp1PrimFifthOrderCompactUpwind()</a>)</li>
<li>Time integration: PETSc (<a class="el" href="a00247.html#a1a054e1b92ee41a9e38926d18c6628bf" title="Integrate in time with PETSc. ">SolvePETSc()</a>)<ul>
<li>Method Class: <b>Additive Runge-Kutta method</b> (TSARKIMEX - <a href="https://petsc.org/release/docs/manualpages/TS/TSARKIMEX.html">https://petsc.org/release/docs/manualpages/TS/TSARKIMEX.html</a>)</li>
<li>Specific method: <b>Kennedy-Carpenter ARK4</b> (TSARKIMEX4 - <a href="https://petsc.org/release/docs/manualpages/TS/TSARKIMEX4.html">https://petsc.org/release/docs/manualpages/TS/TSARKIMEX4.html</a>)</li>
</ul>
</li>
</ul>
<p>Reduced Order Modeling:</p>
<ul>
<li>Mode: train (<a class="el" href="a00197.html#af323868d7651bdfd2c34ea076cfaceb7">libROMInterface::m_mode</a>, <a class="el" href="a00229.html#a8d7f058ce028038a98a49ad28176390e">_ROM_MODE_TRAIN_</a>)</li>
<li>Component Mode: monolithic (<a class="el" href="a00197.html#a3686e11d6075a6fd586dca42ab16b214">libROMInterface::m_comp_mode</a>, <a class="el" href="a00229.html#acdb79f8c89bd3e1e867e510b5546fad1">_ROM_COMP_MODE_MONOLITHIC_</a>)</li>
<li>Type: Dynamic Mode Decomposition (DMD) with time windowing (<a class="el" href="a00197.html#ac18cb5a4597cfb6fb48127fc2156a48d">libROMInterface::m_rom_type</a>)</li>
<li>Latent subspace dimension: 32 (<a class="el" href="a00186.html#a46716d3f1d496cde83a07bd6706d4da0">DMDROMObject::m_rdim</a>)</li>
<li>Sampling frequency: 1 (<a class="el" href="a00197.html#a963701fd6a399d7175c478e9c2e74cfb">libROMInterface::m_sampling_freq</a>)</li>
<li>Number of samples per time window: 50 (<a class="el" href="a00186.html#aa98d3c307daac6fc078ab36af24b6020">DMDROMObject::m_num_window_samples</a>)</li>
</ul>
<h2>Input files required: </h2>
<p><b>librom.inp</b> </p>
<div class="fragment"><div class="line">begin</div>
<div class="line">  rdim                    32</div>
<div class="line">  sampling_frequency      1</div>
<div class="line">  mode                    train</div>
<div class="line">  dmd_num_win_samples     50</div>
<div class="line">end</div>
</div><!-- fragment --><p><b>.petscrc</b> </p>
<div class="fragment"><div class="line"><span class="preprocessor"># See PETSc documentation for more details (https://petsc.org/release/overview/).</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># Note that if the following are specified in this file, the corresponding inputs in solver.inp are *ignored*.</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># + &quot;-ts_dt&quot; (time step size): ignores &quot;dt&quot; in solver.inp</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># + &quot;-ts_max_steps&quot; (maximum number of time iterations): ignores &quot;n_iter&quot; in solver.inp</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># + &quot;-ts_max_time&quot; (final simulation time): ignores &quot;n_iter&quot; X &quot;dt&quot; in solver.inp</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"># Use PETSc time-integration</span></div>
<div class="line"><span class="preprocessor"></span>-use-petscts</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Time integration scheme type - ARK</span></div>
<div class="line"><span class="preprocessor"></span>-ts_type arkimex</div>
<div class="line">-ts_arkimex_type 4</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Specify the terms to treat explicitly and implicitly</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># In this example, the hyperbolic flux is partitioned</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># into its entropy and acoustic components: f = [f-df] + [df]</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># [f-df] - entropy component</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># [df]   - acoustic component</span></div>
<div class="line"><span class="preprocessor"></span>-hyperbolic_f_explicit    # treat [f-df] explicitly</div>
<div class="line">-hyperbolic_df_implicit   # treat [df] implicitly</div>
<div class="line">-source_implicit          # treat source term implicitly</div>
<div class="line"><span class="preprocessor"># thus, time step size is limited by the [f-df] term, i.e.,</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># the flow velocity.</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"># no time-step adaptivity</span></div>
<div class="line"><span class="preprocessor"></span>-ts_adapt_type none</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># For linear problens, tell nonlinear solver (SNES) to only use the linear solver (KSP)</span></div>
<div class="line"><span class="preprocessor"></span>-snes_type ksponly</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Linear solver (KSP) type</span></div>
<div class="line"><span class="preprocessor"></span>-ksp_type gmres</div>
<div class="line"><span class="preprocessor"># Set relative tolerance</span></div>
<div class="line"><span class="preprocessor"></span>-ksp_rtol 1e-6</div>
<div class="line"><span class="preprocessor"># Set absolute tolerance</span></div>
<div class="line"><span class="preprocessor"></span>-ksp_atol 1e-6</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># use a preconditioner for solving the system</span></div>
<div class="line"><span class="preprocessor"></span>-with_pc</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># preconditioner type - SOR</span></div>
<div class="line"><span class="preprocessor"></span>-pc_type sor</div>
<div class="line">-pc_sor_omega 1.0</div>
<div class="line">-pc_sor_its 2</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># apply right preconditioner</span></div>
<div class="line"><span class="preprocessor"></span>-ksp_pc_side RIGHT</div>
</div><!-- fragment --><p><b>solver.inp</b> </p>
<div class="fragment"><div class="line">begin</div>
<div class="line">  ndims               2</div>
<div class="line">  nvars               4</div>
<div class="line">  size                1200 50</div>
<div class="line">  iproc               24 1</div>
<div class="line">  ghost               3</div>
<div class="line">  n_iter              300</div>
<div class="line">  restart_iter        0</div>
<div class="line">  hyp_space_scheme    cupw5</div>
<div class="line">  hyp_flux_split      yes</div>
<div class="line">  hyp_interp_type     components</div>
<div class="line">  dt                  10.0</div>
<div class="line">  screen_op_iter      10</div>
<div class="line">  file_op_iter        20</div>
<div class="line">  input_mode          serial</div>
<div class="line">  ip_file_type        binary</div>
<div class="line">  output_mode         serial</div>
<div class="line">  op_file_format      binary</div>
<div class="line">  op_overwrite        no</div>
<div class="line">  model               navierstokes2d</div>
<div class="line">end</div>
</div><!-- fragment --><p><b>boundary.inp</b> </p>
<div class="fragment"><div class="line">4</div>
<div class="line">periodic      0     1     0          0    0.0     10000.0</div>
<div class="line">periodic      0    -1     0          0    0.0     10000.0</div>
<div class="line">slip-wall     1     1   0.0   300000.0    0.0         0.0</div>
<div class="line">0.0 0.0</div>
<div class="line">slip-wall     1    -1   0.0   300000.0    0.0         0.0</div>
<div class="line">0.0 0.0</div>
</div><!-- fragment --><p><b>physics.inp</b> </p>
<div class="fragment"><div class="line">begin</div>
<div class="line">  gamma     1.4</div>
<div class="line">  upwinding rusanov</div>
<div class="line">  gravity   0.0 9.8</div>
<div class="line">  rho_ref   1.1612055171196529</div>
<div class="line">  p_ref     100000.0</div>
<div class="line">  HB        3 0.01</div>
<div class="line">  R         287.058</div>
<div class="line">end</div>
</div><!-- fragment --><p>To generate <b>initial.inp</b> (initial solution), compile and run the following code in the run directory. </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;math.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">double</span> <a class="code" href="a00231.html#a840eef18a5986381093ff8c176a2153c">raiseto</a>(<span class="keywordtype">double</span> x, <span class="keywordtype">double</span> a)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">return</span>(exp(a*log(x)));</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="a00353.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>()</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">double</span> gamma    = 1.4;</div>
<div class="line">  <span class="keywordtype">double</span> R        = 287.058;</div>
<div class="line">  <span class="keywordtype">double</span> rho_ref  = 1.1612055171196529;</div>
<div class="line">  <span class="keywordtype">double</span> p_ref    = 100000.0;</div>
<div class="line">  <span class="keywordtype">double</span> grav_x   = 0.0;</div>
<div class="line">  <span class="keywordtype">double</span> grav_y   = 9.8;</div>
<div class="line">  <span class="keywordtype">int</span>    HB       = 0;</div>
<div class="line">  <span class="keywordtype">double</span> BV       = 0.0;</div>
<div class="line">  </div>
<div class="line">    <span class="keywordtype">int</span> NI,NK,ndims;</div>
<div class="line">  <span class="keywordtype">char</span> ip_file_type[50];</div>
<div class="line">  strcpy(ip_file_type,<span class="stringliteral">&quot;ascii&quot;</span>);</div>
<div class="line"></div>
<div class="line">  FILE *in;</div>
<div class="line">  printf(<span class="stringliteral">&quot;Reading file \&quot;solver.inp\&quot;...\n&quot;</span>);</div>
<div class="line">  in = fopen(<span class="stringliteral">&quot;solver.inp&quot;</span>,<span class="stringliteral">&quot;r&quot;</span>);</div>
<div class="line">  <span class="keywordflow">if</span> (!in) {</div>
<div class="line">    printf (<span class="stringliteral">&quot;Error: Input file \&quot;solver.inp\&quot; not found.\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span>(1);</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="keywordtype">char</span> word[500];</div>
<div class="line">    fscanf(in,<span class="stringliteral">&quot;%s&quot;</span>,word);</div>
<div class="line">    <span class="keywordflow">if</span> (!strcmp(word, <span class="stringliteral">&quot;begin&quot;</span>)){</div>
<div class="line">      <span class="keywordflow">while</span> (strcmp(word, <span class="stringliteral">&quot;end&quot;</span>)){</div>
<div class="line">        fscanf(in,<span class="stringliteral">&quot;%s&quot;</span>,word);</div>
<div class="line">        <span class="keywordflow">if</span> (!strcmp(word, <span class="stringliteral">&quot;ndims&quot;</span>)) fscanf(in,<span class="stringliteral">&quot;%d&quot;</span>,&amp;ndims);</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(word, <span class="stringliteral">&quot;size&quot;</span>)) {</div>
<div class="line">          fscanf(in,<span class="stringliteral">&quot;%d&quot;</span>,&amp;NI);</div>
<div class="line">          fscanf(in,<span class="stringliteral">&quot;%d&quot;</span>,&amp;NK);</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(word, <span class="stringliteral">&quot;ip_file_type&quot;</span>)) fscanf(in,<span class="stringliteral">&quot;%s&quot;</span>,ip_file_type);</div>
<div class="line">      }</div>
<div class="line">    } <span class="keywordflow">else</span> printf(<span class="stringliteral">&quot;Error: Illegal format in solver.inp. Crash and burn!\n&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  fclose(in);</div>
<div class="line"></div>
<div class="line">  printf(<span class="stringliteral">&quot;Reading file \&quot;physics.inp\&quot;...\n&quot;</span>);</div>
<div class="line">  in = fopen(<span class="stringliteral">&quot;physics.inp&quot;</span>,<span class="stringliteral">&quot;r&quot;</span>);</div>
<div class="line">  <span class="keywordflow">if</span> (!in) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;Error: Input file \&quot;physics.inp\&quot; not found.\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span>(0);</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="keywordtype">char</span> word[500];</div>
<div class="line">    fscanf(in,<span class="stringliteral">&quot;%s&quot;</span>,word);</div>
<div class="line">    <span class="keywordflow">if</span> (!strcmp(word, <span class="stringliteral">&quot;begin&quot;</span>)) {</div>
<div class="line">      <span class="keywordflow">while</span> (strcmp(word, <span class="stringliteral">&quot;end&quot;</span>)) {</div>
<div class="line">        fscanf(in,<span class="stringliteral">&quot;%s&quot;</span>,word);</div>
<div class="line">        <span class="keywordflow">if</span>      (!strcmp(word, <span class="stringliteral">&quot;rho_ref&quot;</span>)) fscanf(in,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;rho_ref);</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(word, <span class="stringliteral">&quot;p_ref&quot;</span>  )) fscanf(in,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;p_ref  );</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(word, <span class="stringliteral">&quot;gamma&quot;</span>  )) fscanf(in,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;gamma  );</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(word, <span class="stringliteral">&quot;R&quot;</span>      )) fscanf(in,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;R      );</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(word, <span class="stringliteral">&quot;HB&quot;</span>     )) {</div>
<div class="line">          fscanf(in,<span class="stringliteral">&quot;%d&quot;</span> ,&amp;HB     );</div>
<div class="line">          <span class="keywordflow">if</span> (HB == 3) fscanf(in, <span class="stringliteral">&quot;%lf&quot;</span>, &amp;BV);</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(word, <span class="stringliteral">&quot;gravity&quot;</span>)) {</div>
<div class="line">          fscanf(in,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;grav_x );</div>
<div class="line">          fscanf(in,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;grav_y );</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">    } <span class="keywordflow">else</span> printf(<span class="stringliteral">&quot;Error: Illegal format in physics.inp. Crash and burn!\n&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  fclose(in);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (ndims != 2) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;ndims is not 2 in solver.inp. this code is to generate 2D initial conditions\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span>(0);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span> (HB != 3) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;Error: Specify \&quot;HB\&quot; as 3 in physics.inp.\n&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">    <span class="keywordflow">if</span> (grav_x != 0.0) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;Error: Gravity force along x must be zero for HB = 3.\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span>(0);</div>
<div class="line">  }</div>
<div class="line">  printf(<span class="stringliteral">&quot;Grid:\t\t\t%d X %d\n&quot;</span>,NI,NK);</div>
<div class="line">  printf(<span class="stringliteral">&quot;Reference density and pressure: %lf, %lf.\n&quot;</span>,rho_ref,p_ref);</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Define the domain */</span></div>
<div class="line">  <span class="keywordtype">double</span> xmin, xmax, zmin, zmax;</div>
<div class="line">  xmin    =  0.0;</div>
<div class="line">  xmax    =  300000;</div>
<div class="line">  zmin    =  0.0;</div>
<div class="line">  zmax    =  10000.0 ;</div>
<div class="line"></div>
<div class="line">  <span class="keywordtype">double</span> Lx = xmax - xmin;</div>
<div class="line">  <span class="keywordtype">double</span> Lz = zmax - zmin;</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">int</span> i,k;</div>
<div class="line">    <span class="keywordtype">double</span> dx = Lx / ((double)NI-1);</div>
<div class="line">    <span class="keywordtype">double</span> dz = Lz / ((double)NK-1);</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">double</span> *x, *z, *U;</div>
<div class="line">  FILE *out;</div>
<div class="line"></div>
<div class="line">    x   = (<span class="keywordtype">double</span>*) calloc (NI     , <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line">    z   = (<span class="keywordtype">double</span>*) calloc (NK     , <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line">    U   = (<span class="keywordtype">double</span>*) calloc (4*NI*NK, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"></div>
<div class="line">  <span class="keywordtype">double</span> inv_gamma_m1 = 1.0 / (gamma-1.0);</div>
<div class="line">  <span class="keywordtype">double</span> Cp = gamma * R * inv_gamma_m1;</div>
<div class="line">  <span class="keywordtype">double</span> Cv =         R * inv_gamma_m1;</div>
<div class="line">  <span class="keywordtype">double</span> T_ref = p_ref / (R*rho_ref);</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* initial perturbation parameters */</span></div>
<div class="line">  <span class="keywordtype">double</span> pi = 4.0*atan(1.0);</div>
<div class="line">  <span class="keywordtype">double</span> tc = 0.01;</div>
<div class="line">  <span class="keywordtype">double</span> hc = 10000;</div>
<div class="line">  <span class="keywordtype">double</span> ac = 5000;</div>
<div class="line">  <span class="keywordtype">double</span> xc = 100000;</div>
<div class="line">  <span class="keywordtype">double</span> uc = 20.0;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; NI; i++){</div>
<div class="line">    <span class="keywordflow">for</span> (k = 0; k &lt; NK; k++){</div>
<div class="line">        x[i] = xmin + i*dx;</div>
<div class="line">        z[k] = zmin + k*dz;</div>
<div class="line">      <span class="keywordtype">int</span> p = i + NI*k;</div>
<div class="line"></div>
<div class="line">      <span class="comment">/* temperature peturbation */</span></div>
<div class="line">      <span class="keywordtype">double</span> dtheta = tc * sin(pi*z[k]/hc) / (1.0 + ((x[i]-xc)/ac)*((x[i]-xc)/ac));</div>
<div class="line"></div>
<div class="line">      <span class="keywordtype">double</span> theta  = T_ref*exp(BV*BV*z[k]/grav_y) + dtheta;</div>
<div class="line">      <span class="keywordtype">double</span> Pexner = 1.0 + ((grav_y*grav_y)/(Cp*T_ref*BV*BV))*(exp(-BV*BV*z[k]/grav_y)-1.0);</div>
<div class="line">      <span class="keywordtype">double</span> rho    = (p_ref/(R*theta)) * <a class="code" href="a00231.html#a840eef18a5986381093ff8c176a2153c">raiseto</a>(Pexner,inv_gamma_m1);</div>
<div class="line">      <span class="keywordtype">double</span> E      = Cv * theta * Pexner + 0.5 * (uc * uc);</div>
<div class="line"></div>
<div class="line">      U[4*p+0] = rho;</div>
<div class="line">      U[4*p+1] = rho*uc;</div>
<div class="line">      U[4*p+2] = 0.0;</div>
<div class="line">      U[4*p+3] = rho*E;</div>
<div class="line">    }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (!strcmp(ip_file_type,<span class="stringliteral">&quot;ascii&quot;</span>)) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;ASCII not supported. Use binary format\n&quot;</span>);</div>
<div class="line">  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((!strcmp(ip_file_type,<span class="stringliteral">&quot;binary&quot;</span>)) || (!strcmp(ip_file_type,<span class="stringliteral">&quot;bin&quot;</span>))) {</div>
<div class="line"></div>
<div class="line">    printf(<span class="stringliteral">&quot;Writing binary initial solution file initial.inp\n&quot;</span>);</div>
<div class="line">    out = fopen(<span class="stringliteral">&quot;initial.inp&quot;</span>,<span class="stringliteral">&quot;wb&quot;</span>);</div>
<div class="line">    fwrite(x,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>),NI,out);</div>
<div class="line">    fwrite(z,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>),NK,out);</div>
<div class="line">    fwrite(U,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>),4*NI*NK,out);</div>
<div class="line">    fclose(out);</div>
<div class="line"></div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">    free(x);</div>
<div class="line">    free(z);</div>
<div class="line">    free(U);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span>(0);</div>
<div class="line">}</div>
</div><!-- fragment --><h2>Output: </h2>
<p>Note that <b>iproc</b> is set to </p>
<pre class="fragment">  24 1
</pre><p>in <b>solver.inp</b> (i.e., 24 processors along <em>x</em>, and 1 processor along <em>y</em>). Thus, this example should be run with 24 MPI ranks (or change <b>iproc</b>).</p>
<p>After running the code, there should be the following output files:</p>
<ul>
<li>16 output file <b>op_00000.bin</b>, ..., <b>op_00015.bin</b>; this is the <b><a class="el" href="a00196.html" title="Structure containing all solver-specific variables and functions. ">HyPar</a></b> solutions<b></b>.</li>
<li>16 output file <b>op_rom_00000.bin</b>, ..., <b>op_rom_00015.bin</b>; this is the <b>predicted</b> solutions from the DMD object(s)<b></b>.</li>
</ul>
<p>All the files are binary (<a class="el" href="a00196.html#a51a3b8c19b86e9e1df5be02b05a6613c">HyPar::op_file_format</a> is set to <em>binary</em> in <b>solver.inp</b>).</p>
<p><a class="el" href="a00196.html#a51a3b8c19b86e9e1df5be02b05a6613c">HyPar::op_file_format</a> is set to <em>binary</em> in <b>solver.inp</b>, and thus, all the files are written out in the binary format, see <a class="el" href="a00227.html#a067f454c26d85d6cfb4d7d878b3783c9">WriteBinary()</a>. The binary file contains the conserved variables \(\left(\rho, \rho u, \rho v, e\right)\). The following code converts these variables to the primitive variables of interest to atmospheric flows \(\left(\rho, u, v, p, \theta\right)\). It also writes out the hydrostatically balanced quantities \(\left(\rho_0,\pi_0, \theta_0\right)\) for this case that can be used to compute and plot the temperature and density perturbations. These variables are then written to either a tecplot2d or text file. (compile and run it in the run directory): </p>
<div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment">  Inertia-Gravity Waves:-</span></div>
<div class="line"><span class="comment">  The code takes a binary solution file (that contains the </span></div>
<div class="line"><span class="comment">  conserved variable (rho, rho*u, rho*v, e) as its input </span></div>
<div class="line"><span class="comment">  and calculates the primitive atmospheric flow variables:</span></div>
<div class="line"><span class="comment">  rho, u, v, P, theta, pi, rho0, P0, theta0, pi0</span></div>
<div class="line"><span class="comment">  and writes them to a tecplot file.</span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;math.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>_parameters_{</div>
<div class="line">  <span class="keywordtype">double</span> g, R, gamma, P_ref, rho_ref, Nbv;</div>
<div class="line">  <span class="keywordtype">int</span> HB;</div>
<div class="line">} Parameters;</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> IncrementFilename(<span class="keywordtype">char</span> *f)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">if</span> (f[7] == <span class="charliteral">&#39;9&#39;</span>) {</div>
<div class="line">    f[7] = <span class="charliteral">&#39;0&#39;</span>;</div>
<div class="line">    <span class="keywordflow">if</span> (f[6] == <span class="charliteral">&#39;9&#39;</span>) {</div>
<div class="line">      f[6] = <span class="charliteral">&#39;0&#39;</span>;</div>
<div class="line">      <span class="keywordflow">if</span> (f[5] == <span class="charliteral">&#39;9&#39;</span>) {</div>
<div class="line">        f[5] = <span class="charliteral">&#39;0&#39;</span>;</div>
<div class="line">        <span class="keywordflow">if</span> (f[4] == <span class="charliteral">&#39;9&#39;</span>) {</div>
<div class="line">          f[4] = <span class="charliteral">&#39;0&#39;</span>;</div>
<div class="line">          <span class="keywordflow">if</span> (f[3] == <span class="charliteral">&#39;9&#39;</span>) {</div>
<div class="line">            f[3] = <span class="charliteral">&#39;0&#39;</span>;</div>
<div class="line">            fprintf(stderr,<span class="stringliteral">&quot;Warning: file increment hit max limit. Resetting to zero.\n&quot;</span>);</div>
<div class="line">          } <span class="keywordflow">else</span> {</div>
<div class="line">            f[3]++;</div>
<div class="line">          }</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">          f[4]++;</div>
<div class="line">        }</div>
<div class="line">      } <span class="keywordflow">else</span> {</div>
<div class="line">        f[5]++;</div>
<div class="line">      }</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      f[6]++;</div>
<div class="line">    }</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    f[7]++;</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">double</span> <a class="code" href="a00231.html#a840eef18a5986381093ff8c176a2153c">raiseto</a>(<span class="keywordtype">double</span> x, <span class="keywordtype">double</span> a)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">return</span>(exp(a*log(x)));</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="a00227.html#a265b0583afb79edd2f2f5d5087e5c3bf">WriteTecplot2D</a>(<span class="keywordtype">int</span> nvars,<span class="keywordtype">int</span> imax, <span class="keywordtype">int</span> jmax,<span class="keywordtype">double</span> *x,<span class="keywordtype">double</span> *u,<span class="keywordtype">char</span> *f)</div>
<div class="line">{</div>
<div class="line">  printf(<span class="stringliteral">&quot;\tWriting tecplot solution file %s.\n&quot;</span>,f);</div>
<div class="line">  FILE *out;</div>
<div class="line">  out = fopen(f,<span class="stringliteral">&quot;w&quot;</span>);</div>
<div class="line">  <span class="keywordflow">if</span> (!out) {</div>
<div class="line">    fprintf(stderr,<span class="stringliteral">&quot;Error: could not open %s for writing.\n&quot;</span>,f);</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordtype">double</span> *X = x;</div>
<div class="line">  <span class="keywordtype">double</span> *Y = x+imax;</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* writing tecplot data file headers */</span></div>
<div class="line">  fprintf(out,<span class="stringliteral">&quot;VARIABLES=\&quot;I\&quot;,\&quot;J\&quot;,\&quot;X\&quot;,\&quot;Y\&quot;,&quot;</span>);</div>
<div class="line">  fprintf(out,<span class="stringliteral">&quot;\&quot;RHO\&quot;,\&quot;U\&quot;,\&quot;V\&quot;,\&quot;P\&quot;,&quot;</span>);</div>
<div class="line">  fprintf(out,<span class="stringliteral">&quot;\&quot;THETA\&quot;,\&quot;RHO0\&quot;,\&quot;P0\&quot;,&quot;</span>);</div>
<div class="line">  fprintf(out,<span class="stringliteral">&quot;\&quot;PI0\&quot;,\&quot;THETA0\&quot;,\n&quot;</span>);</div>
<div class="line">  fprintf(out,<span class="stringliteral">&quot;ZONE I=%d,J=%d,F=POINT\n&quot;</span>,imax,jmax);</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* writing the data */</span></div>
<div class="line">  <span class="keywordtype">int</span> i,j;</div>
<div class="line">  <span class="keywordflow">for</span> (j=0; j&lt;jmax; j++) {</div>
<div class="line">    <span class="keywordflow">for</span> (i=0; i&lt;imax; i++) {</div>
<div class="line">      <span class="keywordtype">int</span> v, p = i + imax*j;</div>
<div class="line">      fprintf(out,<span class="stringliteral">&quot;%4d %4d &quot;</span>,i,j);</div>
<div class="line">      fprintf(out,<span class="stringliteral">&quot;%1.16E %1.16E &quot;</span>,X[i],Y[j]);</div>
<div class="line">      <span class="keywordflow">for</span> (v=0; v&lt;nvars; v++) fprintf(out,<span class="stringliteral">&quot;%1.16E &quot;</span>,u[nvars*p+v]);</div>
<div class="line">      fprintf(out,<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  fclose(out);</div>
<div class="line">  <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> WriteText2D(<span class="keywordtype">int</span> nvars,<span class="keywordtype">int</span> imax, <span class="keywordtype">int</span> jmax,<span class="keywordtype">double</span> *x,<span class="keywordtype">double</span> *u,<span class="keywordtype">char</span> *f)</div>
<div class="line">{</div>
<div class="line">  printf(<span class="stringliteral">&quot;\tWriting text solution file %s.\n&quot;</span>,f);</div>
<div class="line">  FILE *out;</div>
<div class="line">  out = fopen(f,<span class="stringliteral">&quot;w&quot;</span>);</div>
<div class="line">  <span class="keywordflow">if</span> (!out) {</div>
<div class="line">    fprintf(stderr,<span class="stringliteral">&quot;Error: could not open %s for writing.\n&quot;</span>,f);</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordtype">double</span> *X = x;</div>
<div class="line">  <span class="keywordtype">double</span> *Y = x+imax;</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* writing the data */</span></div>
<div class="line">  <span class="keywordtype">int</span> i,j;</div>
<div class="line">  <span class="keywordflow">for</span> (j=0; j&lt;jmax; j++) {</div>
<div class="line">    <span class="keywordflow">for</span> (i=0; i&lt;imax; i++) {</div>
<div class="line">      <span class="keywordtype">int</span> v, p = i + imax*j;</div>
<div class="line">      fprintf(out,<span class="stringliteral">&quot;%4d %4d &quot;</span>,i,j);</div>
<div class="line">      fprintf(out,<span class="stringliteral">&quot;%1.16E %1.16E &quot;</span>,X[i],Y[j]);</div>
<div class="line">      <span class="keywordflow">for</span> (v=0; v&lt;nvars; v++) fprintf(out,<span class="stringliteral">&quot;%1.16E &quot;</span>,u[nvars*p+v]);</div>
<div class="line">      fprintf(out,<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  fclose(out);</div>
<div class="line">  <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> PostProcess(<span class="keywordtype">char</span> *fname, <span class="keywordtype">char</span> *oname, <span class="keywordtype">void</span> *p, <span class="keywordtype">int</span> flag)</div>
<div class="line">{</div>
<div class="line">  Parameters *params = (Parameters*) p;</div>
<div class="line">  FILE *in; in = fopen(fname,<span class="stringliteral">&quot;rb&quot;</span>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (!in) <span class="keywordflow">return</span>(-1);</div>
<div class="line"></div>
<div class="line">  printf(<span class="stringliteral">&quot;Reading file %s.\n&quot;</span>,fname);</div>
<div class="line">  <span class="keywordtype">int</span> ndims, nvars;</div>
<div class="line">  <span class="keywordtype">double</span> *U,*x;</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* read the file headers */</span></div>
<div class="line">  fread(&amp;ndims,<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>),1,in);</div>
<div class="line">  fread(&amp;nvars,<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>),1,in);</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* some checks */</span></div>
<div class="line">  <span class="keywordflow">if</span> (ndims != 2) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;Error: ndims in %s not equal to 2!\n&quot;</span>,fname);</div>
<div class="line">    <span class="keywordflow">return</span>(1);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span> (nvars != 4) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;Error: nvars in %s not equal to 4!\n&quot;</span>,fname);</div>
<div class="line">    <span class="keywordflow">return</span>(1);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* read dimensions */</span></div>
<div class="line">  <span class="keywordtype">int</span> dims[ndims];</div>
<div class="line">  fread(dims,<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>),ndims,in);</div>
<div class="line">  printf(<span class="stringliteral">&quot;Dimensions: %d x %d\n&quot;</span>,dims[0],dims[1]);</div>
<div class="line">  printf(<span class="stringliteral">&quot;Nvars     : %d\n&quot;</span>,nvars);</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* allocate grid and solution arrays */</span></div>
<div class="line">  x = (<span class="keywordtype">double</span>*) calloc (dims[0]+dims[1]       ,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line">  U = (<span class="keywordtype">double</span>*) calloc (dims[0]*dims[1]*nvars ,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* read grid and solution */</span></div>
<div class="line">  fread(x,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>),dims[0]+dims[1]      ,in);</div>
<div class="line">  fread(U,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>),dims[0]*dims[1]*nvars,in);</div>
<div class="line">  <span class="comment">/* done reading */</span></div>
<div class="line">  fclose(in);</div>
<div class="line"></div>
<div class="line">  <span class="keywordtype">int</span> imax = dims[0];</div>
<div class="line">  <span class="keywordtype">int</span> jmax = dims[1];</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* allocate primitive variable array (rho, u, v, P, theta, rho0, P0, pi0, theta0) */</span></div>
<div class="line">  <span class="keywordtype">int</span> evars = 5;</div>
<div class="line">  <span class="keywordtype">double</span> *Q = (<span class="keywordtype">double</span>*) calloc ((nvars+evars)*imax*jmax,<span class="keyword">sizeof</span>(double));</div>
<div class="line">    </div>
<div class="line">  <span class="comment">/* calculate primitive variables */</span></div>
<div class="line">  <span class="keywordtype">int</span> i, j;</div>
<div class="line">  <span class="keywordtype">double</span> *X           = x;</div>
<div class="line">  <span class="keywordtype">double</span> *Y           = x+imax;</div>
<div class="line">  <span class="keywordtype">double</span> g            = params-&gt;g;</div>
<div class="line">  <span class="keywordtype">double</span> R            = params-&gt;R;</div>
<div class="line">  <span class="keywordtype">double</span> gamma        = params-&gt;gamma;</div>
<div class="line">  <span class="keywordtype">double</span> P_ref        = params-&gt;P_ref;</div>
<div class="line">  <span class="keywordtype">double</span> rho_ref      = params-&gt;rho_ref;</div>
<div class="line">  <span class="keywordtype">double</span> T_ref        = P_ref / (R*rho_ref);</div>
<div class="line">  <span class="keywordtype">double</span> inv_gamma_m1 = 1.0 / (gamma-1.0);</div>
<div class="line">  <span class="keywordtype">double</span> Cp           = gamma * inv_gamma_m1 * R;</div>
<div class="line">  <span class="keywordtype">double</span> BV           = params-&gt;Nbv;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">for</span> (i=0; i&lt;imax; i++) {</div>
<div class="line">    <span class="keywordflow">for</span> (j=0; j&lt;jmax; j++) {</div>
<div class="line">      <span class="keywordtype">int</span> p = i + imax*j;</div>
<div class="line"></div>
<div class="line">      <span class="keywordtype">double</span> rho0, theta0, Pexner, P0;</div>
<div class="line">      Pexner = 1.0 + ((g*g)/(Cp*T_ref*BV*BV))*(exp(-BV*BV*Y[j]/g)-1.0);</div>
<div class="line">      theta0 = T_ref   * exp(BV*BV*Y[j]/g);</div>
<div class="line">      P0     = P_ref   * <a class="code" href="a00231.html#a840eef18a5986381093ff8c176a2153c">raiseto</a>(Pexner, gamma*inv_gamma_m1);</div>
<div class="line">      rho0   = rho_ref * <a class="code" href="a00231.html#a840eef18a5986381093ff8c176a2153c">raiseto</a>(Pexner, inv_gamma_m1      ) * exp(-BV*BV*Y[j]/g);</div>
<div class="line"></div>
<div class="line">      <span class="keywordtype">double</span> rho, uvel, vvel, E, P, theta;</div>
<div class="line">      rho   = U[nvars*p+0];</div>
<div class="line">      uvel  = U[nvars*p+1] / rho;</div>
<div class="line">      vvel  = U[nvars*p+2] / rho;</div>
<div class="line">      E     = U[nvars*p+3];</div>
<div class="line">      P     = (gamma-1.0) * (E - 0.5*rho*(uvel*uvel+vvel*vvel));</div>
<div class="line">      theta = (E-0.5*rho*(uvel*uvel+vvel*vvel))/(Pexner*rho) * ((gamma-1.0)/R);</div>
<div class="line"></div>
<div class="line">      Q[(nvars+evars)*p+0] = rho;</div>
<div class="line">      Q[(nvars+evars)*p+1] = uvel;</div>
<div class="line">      Q[(nvars+evars)*p+2] = vvel;</div>
<div class="line">      Q[(nvars+evars)*p+3] = P;</div>
<div class="line">      Q[(nvars+evars)*p+4] = theta;</div>
<div class="line">      Q[(nvars+evars)*p+5] = rho0;</div>
<div class="line">      Q[(nvars+evars)*p+6] = P0;</div>
<div class="line">      Q[(nvars+evars)*p+7] = Pexner;</div>
<div class="line">      Q[(nvars+evars)*p+8] = theta0;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* write Tecplot/Text file */</span></div>
<div class="line">  <span class="keywordflow">if</span> (flag) <a class="code" href="a00227.html#a265b0583afb79edd2f2f5d5087e5c3bf">WriteTecplot2D</a>(nvars+evars,imax,jmax,x,Q,oname);</div>
<div class="line">  <span class="keywordflow">else</span>      WriteText2D   (nvars+evars,imax,jmax,x,Q,oname);</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* clean up */</span></div>
<div class="line">  free(U);</div>
<div class="line">  free(Q);</div>
<div class="line">  free(x);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="a00353.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>()</div>
<div class="line">{</div>
<div class="line">  FILE *out1, *out2, *in, *inputs;</div>
<div class="line">  <span class="keywordtype">char</span> filename[50], op_file_format[50], tecfile[50], overwrite[50];</div>
<div class="line"></div>
<div class="line">  <span class="keywordtype">int</span> flag;</div>
<div class="line">  printf(<span class="stringliteral">&quot;Write tecplot file (1) or plain text file (0): &quot;</span>);</div>
<div class="line">  scanf(<span class="stringliteral">&quot;%d&quot;</span>,&amp;flag);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> ((flag != 1) &amp;&amp; (flag != 0)) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;Error: Invalid input. Should be 1 or 0.\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span>(0);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  printf(<span class="stringliteral">&quot;Reading solver.inp.\n&quot;</span>);</div>
<div class="line">  inputs = fopen(<span class="stringliteral">&quot;solver.inp&quot;</span>,<span class="stringliteral">&quot;r&quot;</span>);</div>
<div class="line">  <span class="keywordflow">if</span> (!inputs) {</div>
<div class="line">    fprintf(stderr,<span class="stringliteral">&quot;Error: File \&quot;solver.inp\&quot; not found.\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span>(1);</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">      <span class="keywordtype">char</span> word[100];</div>
<div class="line">    fscanf(inputs,<span class="stringliteral">&quot;%s&quot;</span>,word);</div>
<div class="line">    <span class="keywordflow">if</span> (!strcmp(word, <span class="stringliteral">&quot;begin&quot;</span>)){</div>
<div class="line">        <span class="keywordflow">while</span> (strcmp(word, <span class="stringliteral">&quot;end&quot;</span>)){</div>
<div class="line">            fscanf(inputs,<span class="stringliteral">&quot;%s&quot;</span>,word);</div>
<div class="line">            <span class="keywordflow">if</span>      (!strcmp(word, <span class="stringliteral">&quot;op_file_format&quot;</span>   ))  fscanf(inputs,<span class="stringliteral">&quot;%s&quot;</span> ,op_file_format);</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(word, <span class="stringliteral">&quot;op_overwrite&quot;</span>     ))  fscanf(inputs,<span class="stringliteral">&quot;%s&quot;</span> ,overwrite      );</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    fclose(inputs);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span> (strcmp(op_file_format,<span class="stringliteral">&quot;binary&quot;</span>) &amp;&amp; strcmp(op_file_format,<span class="stringliteral">&quot;bin&quot;</span>)) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;Error: solution output needs to be in binary files.\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span>(0);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  Parameters params;</div>
<div class="line">  <span class="comment">/* default values */</span></div>
<div class="line">  params.g        = 9.8;</div>
<div class="line">  params.R        = 287.058;</div>
<div class="line">  params.gamma    = 1.4;</div>
<div class="line">  params.P_ref    = 100000.0;</div>
<div class="line">  params.rho_ref  = 100000.0 / (params.R * 300.0);</div>
<div class="line">  params.HB       = 0;</div>
<div class="line">  params.Nbv      = 0.0;</div>
<div class="line">  <span class="comment">/* read these parameters from file */</span></div>
<div class="line">  printf(<span class="stringliteral">&quot;Reading physics.inp.\n&quot;</span>);</div>
<div class="line">  inputs = fopen(<span class="stringliteral">&quot;physics.inp&quot;</span>,<span class="stringliteral">&quot;r&quot;</span>);</div>
<div class="line">  <span class="keywordflow">if</span> (!inputs) {</div>
<div class="line">    fprintf(stderr,<span class="stringliteral">&quot;Error: File \&quot;physics.inp\&quot; not found.\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span>(1);</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">      <span class="keywordtype">char</span> word[100];</div>
<div class="line">    fscanf(inputs,<span class="stringliteral">&quot;%s&quot;</span>,word);</div>
<div class="line">    <span class="keywordflow">if</span> (!strcmp(word, <span class="stringliteral">&quot;begin&quot;</span>)){</div>
<div class="line">        <span class="keywordflow">while</span> (strcmp(word, <span class="stringliteral">&quot;end&quot;</span>)){</div>
<div class="line">            fscanf(inputs,<span class="stringliteral">&quot;%s&quot;</span>,word);</div>
<div class="line">            <span class="keywordflow">if</span>      (!strcmp(word, <span class="stringliteral">&quot;gamma&quot;</span>))    fscanf(inputs,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;params.gamma);</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(word, <span class="stringliteral">&quot;gravity&quot;</span>)) {</div>
<div class="line">          <span class="keywordtype">double</span> crap; fscanf(inputs,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;crap);</div>
<div class="line">          fscanf(inputs,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;params.g);</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(word,<span class="stringliteral">&quot;p_ref&quot;</span>))   fscanf(inputs,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;params.P_ref);</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>   (!strcmp(word,<span class="stringliteral">&quot;rho_ref&quot;</span>)) fscanf(inputs,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;params.rho_ref);</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>   (!strcmp(word,<span class="stringliteral">&quot;HB&quot;</span>)) {</div>
<div class="line">          fscanf(inputs,<span class="stringliteral">&quot;%d&quot;</span>,&amp;params.HB);</div>
<div class="line">          <span class="keywordflow">if</span> (params.HB == 3) fscanf(inputs,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;params.Nbv);</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    fclose(inputs);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span> (params.HB != 3) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;Error: \&quot;HB\&quot; must be specified as 3 in physics.inp.\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span>(0);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (!strcmp(overwrite,<span class="stringliteral">&quot;no&quot;</span>)) {</div>
<div class="line">    strcpy(filename,<span class="stringliteral">&quot;op_00000.bin&quot;</span>);</div>
<div class="line">    <span class="keywordflow">while</span>(1) {</div>
<div class="line">      <span class="comment">/* set filename */</span></div>
<div class="line">      strcpy(tecfile,filename);</div>
<div class="line">      tecfile[9]  = <span class="charliteral">&#39;d&#39;</span>;</div>
<div class="line">      tecfile[10] = <span class="charliteral">&#39;a&#39;</span>;</div>
<div class="line">      tecfile[11] = <span class="charliteral">&#39;t&#39;</span>;</div>
<div class="line">      <span class="keywordtype">int</span> err = PostProcess(filename, tecfile, &amp;params, flag);</div>
<div class="line">      <span class="keywordflow">if</span> (err == -1) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;No more files found. Exiting.\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      }</div>
<div class="line">      IncrementFilename(filename);</div>
<div class="line">    }</div>
<div class="line">  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(overwrite,<span class="stringliteral">&quot;yes&quot;</span>)) {</div>
<div class="line">    strcpy(filename,<span class="stringliteral">&quot;op.bin&quot;</span>);</div>
<div class="line">    <span class="comment">/* set filename */</span></div>
<div class="line">    strcpy(tecfile,filename);</div>
<div class="line">    tecfile[3] = <span class="charliteral">&#39;d&#39;</span>;</div>
<div class="line">    tecfile[4] = <span class="charliteral">&#39;a&#39;</span>;</div>
<div class="line">    tecfile[5] = <span class="charliteral">&#39;t&#39;</span>;</div>
<div class="line">    <span class="keywordtype">int</span> err = PostProcess(filename, tecfile, &amp;params, flag);</div>
<div class="line">    <span class="keywordflow">if</span> (err == -1) {</div>
<div class="line">      printf(<span class="stringliteral">&quot;Error: op.bin not found.\n&quot;</span>);</div>
<div class="line">      <span class="keywordflow">return</span>(0);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span>(0);</div>
<div class="line">}</div>
</div><!-- fragment --><p>Alternatively, the provided Python script (<b>plotSolution.py</b>) can be used to generate plots from the binary files of the atmospheric flow variables and compare the <a class="el" href="a00196.html" title="Structure containing all solver-specific variables and functions. ">HyPar</a> and DMD solutions. It will plot the potential temperature perturbation but can be modified easily to plot other quantities.</p>
<p>The following plot shows the potential temperature perturbation contours at the final time t=3000 (FOM is the <a class="el" href="a00196.html" title="Structure containing all solver-specific variables and functions. ">HyPar</a> solution, ROM is the DMD prediction, and diff is the difference between the two): </p>
<div class="image">
<img src="Solution_2DNavStokIGWavePETSc_libROMDMD_Train.png" alt="Solution_2DNavStokIGWavePETSc_libROMDMD_Train.png"/>
</div>
<p><b>Wall</b> <b>clock</b> <b>times:</b> </p>
<ul>
<li>PDE solution: 521 seconds</li>
<li>DMD training time: 15.1 seconds</li>
<li>DMD prediction/query time: 8.7 seconds</li>
</ul>
<p>The L1, L2, and Linf norms of the diff between the <a class="el" href="a00196.html" title="Structure containing all solver-specific variables and functions. ">HyPar</a> and ROM solution at the final time are calculated and reported on screen (see below) as well as <b>pde_rom_diff.dat:</b> </p>
<div class="fragment"><div class="line">1200   50   24    1 1.0000000000000000E+01  1.6823397339748363E-07 2.0644508136507202E-07 6.2271161570040760E-07   5.4798857799999996E+02 5.4807861200000002E+02</div>
</div><!-- fragment --><p> The numbers are: number of grid points in each dimension (<a class="el" href="a00196.html#aa989ebb755986852177779cdf7bd8c85">HyPar::dim_global</a>), number of processors in each dimension (<a class="el" href="a00199.html#a0be0f30a83bc3f3d9f6ee3a36bbf2716">MPIVariables::iproc</a>), time step size (<a class="el" href="a00196.html#a03e28be41881b703c836edbfe9b51b17">HyPar::dt</a>), L1, L2, and L-infinity norms of the diff (<a class="el" href="a00196.html#aaacee284a041d53cf335ae299d5eb929">HyPar::rom_diff_norms</a>), solver wall time (seconds) (i.e., not accounting for initialization, and cleaning up), and total wall time.</p>
<p>Expected screen output: </p>
<div class="fragment"><div class="line">srun: job 10160167 queued and waiting <span class="keywordflow">for</span> resources</div>
<div class="line">srun: job 10160167 has been allocated resources</div>
<div class="line"><a class="code" href="a00196.html">HyPar</a> - Parallel (MPI) version with 24 processes</div>
<div class="line">Compiled with PETSc time integration.</div>
<div class="line">Allocated simulation <span class="keywordtype">object</span>(s).</div>
<div class="line">Reading solver inputs from file &quot;solver.inp&quot;.</div>
<div class="line">  No. of dimensions                          : 2</div>
<div class="line">  No. of variables                           : 4</div>
<div class="line">  Domain size                                : 1200 50 </div>
<div class="line">  Processes along each dimension             : 24 1 </div>
<div class="line">  Exact solution domain size                 : 1200 50 </div>
<div class="line">  No. of ghosts pts                          : 3</div>
<div class="line">  No. of iter.                               : 300</div>
<div class="line">  Restart iteration                          : 0</div>
<div class="line">  Time integration scheme                    : PETSc </div>
<div class="line">  Spatial discretization scheme (hyperbolic) : cupw5</div>
<div class="line">  Split hyperbolic flux term?                : yes</div>
<div class="line">  Interpolation type for hyperbolic term     : components</div>
<div class="line">  Spatial discretization type   (parabolic ) : nonconservative-1stage</div>
<div class="line">  Spatial discretization scheme (parabolic ) : 2</div>
<div class="line">  Time Step                                  : 1.000000E+01</div>
<div class="line">  Check for conservation                     : no</div>
<div class="line">  Screen output iterations                   : 10</div>
<div class="line">  File output iterations                     : 20</div>
<div class="line">  Initial solution file type                 : binary</div>
<div class="line">  Initial solution read mode                 : serial</div>
<div class="line">  Solution file write mode                   : serial</div>
<div class="line">  Solution file format                       : binary</div>
<div class="line">  Overwrite solution file                    : no</div>
<div class="line">  Physical model                             : navierstokes2d</div>
<div class="line">Partitioning domain and allocating data arrays.</div>
<div class="line">Reading array from binary file initial.inp (Serial mode).</div>
<div class="line">Volume integral of the initial solution:</div>
<div class="line"> 0:  2.2722878895077395E+09</div>
<div class="line"> 1:  4.5445757790154785E+10</div>
<div class="line"> 2:  0.0000000000000000E+00</div>
<div class="line"> 3:  4.4309563899845638E+14</div>
<div class="line">Reading boundary conditions from boundary.inp.</div>
<div class="line">  Boundary                       periodic:  Along dimension  0 and face +1</div>
<div class="line">  Boundary                       periodic:  Along dimension  0 and face -1</div>
<div class="line">  Boundary                      slip-wall:  Along dimension  1 and face +1</div>
<div class="line">  Boundary                      slip-wall:  Along dimension  1 and face -1</div>
<div class="line">4 boundary condition(s) read.</div>
<div class="line">Initializing solvers.</div>
<div class="line"><a class="code" href="a00214.html#a52d21dfe1d76916811879bf0d7a29d72">tridiagLUInit</a>: File &quot;lusolver.inp&quot; not found. Using default values.</div>
<div class="line">Initializing physics. Model = &quot;navierstokes2d&quot;</div>
<div class="line">Reading physical model inputs from file &quot;physics.inp&quot;.</div>
<div class="line">Setting up PETSc time integration... </div>
<div class="line">Setting up libROM interface.</div>
<div class="line"><a class="code" href="a00197.html">libROMInterface</a> inputs and parameters:</div>
<div class="line">  reduced model dimensionality:  32</div>
<div class="line">  sampling frequency:  1</div>
<div class="line">  mode: train</div>
<div class="line">  component mode: monolithic</div>
<div class="line">  type: DMD</div>
<div class="line">  save to file: true</div>
<div class="line"><a class="code" href="a00186.html">DMDROMObject</a> details:</div>
<div class="line">  number of samples per window:   50</div>
<div class="line">  directory name for DMD onjects: DMD</div>
<div class="line">  write snapshot matrix to file:  false</div>
<div class="line">  simulation domain:  0</div>
<div class="line">PETSc:    total number of computational points is 60000.</div>
<div class="line">PETSc:    total number of computational DOFs is 240000.</div>
<div class="line">Implicit-Explicit time-integration:-</div>
<div class="line">Hyperbolic (f-df) term: Explicit</div>
<div class="line">Hyperbolic (df)   term: Implicit</div>
<div class="line">Parabolic         term: Implicit</div>
<div class="line">Source            term: Implicit</div>
<div class="line"><a class="code" href="a00247.html#a1a054e1b92ee41a9e38926d18c6628bf">SolvePETSc</a>(): Problem type is linear.</div>
<div class="line">** Starting PETSc time integration **</div>
<div class="line">Writing solution file op_00000.bin.</div>
<div class="line"><a class="code" href="a00186.html">DMDROMObject</a>::takeSample() - creating new DMD <span class="keywordtype">object</span> for sim. domain 0, var -1, t=0.000000 (total: 1).</div>
<div class="line">iter=     10  dt=1.000E+01  t=1.000E+02  CFL=1.701E+01  norm=1.0002E-01  wctime: 1.7E+00 (s)  </div>
<div class="line">iter=     20  dt=1.000E+01  t=2.000E+02  CFL=1.701E+01  norm=1.6347E-01  wctime: 1.7E+00 (s)  </div>
<div class="line">Writing solution file op_00001.bin.</div>
<div class="line">iter=     30  dt=1.000E+01  t=3.000E+02  CFL=1.701E+01  norm=1.4808E-01  wctime: 1.7E+00 (s)  </div>
<div class="line">iter=     40  dt=1.000E+01  t=4.000E+02  CFL=1.701E+01  norm=1.1472E-01  wctime: 1.7E+00 (s)  </div>
<div class="line">Writing solution file op_00002.bin.</div>
<div class="line">iter=     50  dt=1.000E+01  t=5.000E+02  CFL=1.701E+01  norm=1.0850E-01  wctime: 1.7E+00 (s)  </div>
<div class="line"><a class="code" href="a00186.html">DMDROMObject</a>::train() - training DMD <span class="keywordtype">object</span> 0 for sim. domain 0, var -1 with 51 samples.</div>
<div class="line">Using 32 basis vectors out of 50.</div>
<div class="line"><a class="code" href="a00186.html">DMDROMObject</a>::takeSample() - creating new DMD <span class="keywordtype">object</span> for sim. domain 0, var -1, t=500.000000 (total: 2).</div>
<div class="line">iter=     60  dt=1.000E+01  t=6.000E+02  CFL=1.701E+01  norm=1.4884E-01  wctime: 1.7E+00 (s)  </div>
<div class="line">Writing solution file op_00003.bin.</div>
<div class="line">iter=     70  dt=1.000E+01  t=7.000E+02  CFL=1.701E+01  norm=1.4899E-01  wctime: 1.7E+00 (s)  </div>
<div class="line">iter=     80  dt=1.000E+01  t=8.000E+02  CFL=1.701E+01  norm=1.1894E-01  wctime: 1.7E+00 (s)  </div>
<div class="line">Writing solution file op_00004.bin.</div>
<div class="line">iter=     90  dt=1.000E+01  t=9.000E+02  CFL=1.701E+01  norm=1.0875E-01  wctime: 1.7E+00 (s)  </div>
<div class="line">iter=    100  dt=1.000E+01  t=1.000E+03  CFL=1.701E+01  norm=1.4186E-01  wctime: 1.7E+00 (s)  </div>
<div class="line">Writing solution file op_00005.bin.</div>
<div class="line"><a class="code" href="a00186.html">DMDROMObject</a>::train() - training DMD <span class="keywordtype">object</span> 1 for sim. domain 0, var -1 with 51 samples.</div>
<div class="line">Using 32 basis vectors out of 50.</div>
<div class="line"><a class="code" href="a00186.html">DMDROMObject</a>::takeSample() - creating new DMD <span class="keywordtype">object</span> for sim. domain 0, var -1, t=1000.000000 (total: 3).</div>
<div class="line">iter=    110  dt=1.000E+01  t=1.100E+03  CFL=1.701E+01  norm=1.4984E-01  wctime: 1.7E+00 (s)  </div>
<div class="line">iter=    120  dt=1.000E+01  t=1.200E+03  CFL=1.701E+01  norm=1.3136E-01  wctime: 1.7E+00 (s)  </div>
<div class="line">Writing solution file op_00006.bin.</div>
<div class="line">iter=    130  dt=1.000E+01  t=1.300E+03  CFL=1.701E+01  norm=1.1261E-01  wctime: 1.7E+00 (s)  </div>
<div class="line">iter=    140  dt=1.000E+01  t=1.400E+03  CFL=1.701E+01  norm=1.3477E-01  wctime: 1.7E+00 (s)  </div>
<div class="line">Writing solution file op_00007.bin.</div>
<div class="line">iter=    150  dt=1.000E+01  t=1.500E+03  CFL=1.701E+01  norm=1.3695E-01  wctime: 1.7E+00 (s)  </div>
<div class="line"><a class="code" href="a00186.html">DMDROMObject</a>::train() - training DMD <span class="keywordtype">object</span> 2 for sim. domain 0, var -1 with 51 samples.</div>
<div class="line">Using 32 basis vectors out of 50.</div>
<div class="line"><a class="code" href="a00186.html">DMDROMObject</a>::takeSample() - creating new DMD <span class="keywordtype">object</span> for sim. domain 0, var -1, t=1500.000000 (total: 4).</div>
<div class="line">iter=    160  dt=1.000E+01  t=1.600E+03  CFL=1.701E+01  norm=1.4525E-01  wctime: 1.7E+00 (s)  </div>
<div class="line">Writing solution file op_00008.bin.</div>
<div class="line">iter=    170  dt=1.000E+01  t=1.700E+03  CFL=1.701E+01  norm=1.0836E-01  wctime: 1.7E+00 (s)  </div>
<div class="line">iter=    180  dt=1.000E+01  t=1.800E+03  CFL=1.701E+01  norm=1.1849E-01  wctime: 1.7E+00 (s)  </div>
<div class="line">Writing solution file op_00009.bin.</div>
<div class="line">iter=    190  dt=1.000E+01  t=1.900E+03  CFL=1.701E+01  norm=1.5889E-01  wctime: 1.7E+00 (s)  </div>
<div class="line">iter=    200  dt=1.000E+01  t=2.000E+03  CFL=1.701E+01  norm=1.3183E-01  wctime: 1.7E+00 (s)  </div>
<div class="line">Writing solution file op_00010.bin.</div>
<div class="line"><a class="code" href="a00186.html">DMDROMObject</a>::train() - training DMD <span class="keywordtype">object</span> 3 for sim. domain 0, var -1 with 51 samples.</div>
<div class="line">Using 32 basis vectors out of 50.</div>
<div class="line"><a class="code" href="a00186.html">DMDROMObject</a>::takeSample() - creating new DMD <span class="keywordtype">object</span> for sim. domain 0, var -1, t=2000.000000 (total: 5).</div>
<div class="line">iter=    210  dt=1.000E+01  t=2.100E+03  CFL=1.701E+01  norm=1.1340E-01  wctime: 1.7E+00 (s)  </div>
<div class="line">iter=    220  dt=1.000E+01  t=2.200E+03  CFL=1.701E+01  norm=1.3901E-01  wctime: 1.7E+00 (s)  </div>
<div class="line">Writing solution file op_00011.bin.</div>
<div class="line">iter=    230  dt=1.000E+01  t=2.300E+03  CFL=1.701E+01  norm=1.2231E-01  wctime: 1.7E+00 (s)  </div>
<div class="line">iter=    240  dt=1.000E+01  t=2.400E+03  CFL=1.701E+01  norm=1.3908E-01  wctime: 1.7E+00 (s)  </div>
<div class="line">Writing solution file op_00012.bin.</div>
<div class="line">iter=    250  dt=1.000E+01  t=2.500E+03  CFL=1.701E+01  norm=1.2931E-01  wctime: 1.7E+00 (s)  </div>
<div class="line"><a class="code" href="a00186.html">DMDROMObject</a>::train() - training DMD <span class="keywordtype">object</span> 4 for sim. domain 0, var -1 with 51 samples.</div>
<div class="line">Using 32 basis vectors out of 50.</div>
<div class="line"><a class="code" href="a00186.html">DMDROMObject</a>::takeSample() - creating new DMD <span class="keywordtype">object</span> for sim. domain 0, var -1, t=2500.000000 (total: 6).</div>
<div class="line">iter=    260  dt=1.000E+01  t=2.600E+03  CFL=1.701E+01  norm=1.3253E-01  wctime: 1.7E+00 (s)  </div>
<div class="line">Writing solution file op_00013.bin.</div>
<div class="line">iter=    270  dt=1.000E+01  t=2.700E+03  CFL=1.701E+01  norm=1.1236E-01  wctime: 1.7E+00 (s)  </div>
<div class="line">iter=    280  dt=1.000E+01  t=2.800E+03  CFL=1.701E+01  norm=1.5150E-01  wctime: 1.7E+00 (s)  </div>
<div class="line">Writing solution file op_00014.bin.</div>
<div class="line">iter=    290  dt=1.000E+01  t=2.900E+03  CFL=1.701E+01  norm=1.4059E-01  wctime: 1.7E+00 (s)  </div>
<div class="line">iter=    300  dt=1.000E+01  t=3.000E+03  CFL=1.701E+01  norm=1.0576E-01  wctime: 1.7E+00 (s)  </div>
<div class="line">Writing solution file op_00015.bin.</div>
<div class="line">** Completed PETSc time integration (Final time: 3000.000000), total wctime: 521.165210 (seconds) **</div>
<div class="line"><a class="code" href="a00186.html">DMDROMObject</a>::train() - training DMD <span class="keywordtype">object</span> 5 for sim. domain 0, var -1 with 50 samples.</div>
<div class="line">Using 32 basis vectors out of 49.</div>
<div class="line">libROM: total training wallclock time: 15.078729 (seconds).</div>
<div class="line">libROM: Predicted solution at time 0.0000e+00 using ROM, wallclock time: 0.530589.</div>
<div class="line">Writing solution file op_rom_00000.bin.</div>
<div class="line">libROM: Predicted solution at time 2.0000e+02 using ROM, wallclock time: 0.598458.</div>
<div class="line">Writing solution file op_rom_00001.bin.</div>
<div class="line">libROM: Predicted solution at time 4.0000e+02 using ROM, wallclock time: 0.558467.</div>
<div class="line">Writing solution file op_rom_00002.bin.</div>
<div class="line">libROM: Predicted solution at time 6.0000e+02 using ROM, wallclock time: 0.495275.</div>
<div class="line">Writing solution file op_rom_00003.bin.</div>
<div class="line">libROM: Predicted solution at time 8.0000e+02 using ROM, wallclock time: 0.492773.</div>
<div class="line">Writing solution file op_rom_00004.bin.</div>
<div class="line">libROM: Predicted solution at time 1.0000e+03 using ROM, wallclock time: 0.495487.</div>
<div class="line">Writing solution file op_rom_00005.bin.</div>
<div class="line">libROM: Predicted solution at time 1.2000e+03 using ROM, wallclock time: 0.495699.</div>
<div class="line">Writing solution file op_rom_00006.bin.</div>
<div class="line">libROM: Predicted solution at time 1.4000e+03 using ROM, wallclock time: 0.497169.</div>
<div class="line">Writing solution file op_rom_00007.bin.</div>
<div class="line">libROM: Predicted solution at time 1.6000e+03 using ROM, wallclock time: 0.518542.</div>
<div class="line">Writing solution file op_rom_00008.bin.</div>
<div class="line">libROM: Predicted solution at time 1.8000e+03 using ROM, wallclock time: 0.518565.</div>
<div class="line">Writing solution file op_rom_00009.bin.</div>
<div class="line">libROM: Predicted solution at time 2.0000e+03 using ROM, wallclock time: 0.503544.</div>
<div class="line">Writing solution file op_rom_00010.bin.</div>
<div class="line">libROM: Predicted solution at time 2.2000e+03 using ROM, wallclock time: 0.500226.</div>
<div class="line">Writing solution file op_rom_00011.bin.</div>
<div class="line">libROM: Predicted solution at time 2.4000e+03 using ROM, wallclock time: 0.518636.</div>
<div class="line">Writing solution file op_rom_00012.bin.</div>
<div class="line">libROM: Predicted solution at time 2.6000e+03 using ROM, wallclock time: 0.498987.</div>
<div class="line">Writing solution file op_rom_00013.bin.</div>
<div class="line">libROM: Predicted solution at time 2.8000e+03 using ROM, wallclock time: 0.496688.</div>
<div class="line">Writing solution file op_rom_00014.bin.</div>
<div class="line">libROM: Predicted solution at time 3.0000e+03 using ROM, wallclock time: 0.494127.</div>
<div class="line">Writing solution file op_rom_00015.bin.</div>
<div class="line">libROM: Predicted solution at time 3.0000e+03 using ROM, wallclock time: 0.499386.</div>
<div class="line">libROM:   Calculating diff between PDE and ROM solutions.</div>
<div class="line">Writing solution file op_rom_00016.bin.</div>
<div class="line">libROM: total prediction/query wallclock time: 8.712618 (seconds).</div>
<div class="line"><a class="code" href="a00197.html">libROMInterface</a>::saveROM() - saving ROM objects.</div>
<div class="line">  Saving DMD <span class="keywordtype">object</span> and summary (DMD/dmdobj_0000, DMD/dmd_summary_0000).</div>
<div class="line">  Saving DMD <span class="keywordtype">object</span> and summary (DMD/dmdobj_0001, DMD/dmd_summary_0001).</div>
<div class="line">  Saving DMD <span class="keywordtype">object</span> and summary (DMD/dmdobj_0002, DMD/dmd_summary_0002).</div>
<div class="line">  Saving DMD <span class="keywordtype">object</span> and summary (DMD/dmdobj_0003, DMD/dmd_summary_0003).</div>
<div class="line">  Saving DMD <span class="keywordtype">object</span> and summary (DMD/dmdobj_0004, DMD/dmd_summary_0004).</div>
<div class="line">  Saving DMD <span class="keywordtype">object</span> and summary (DMD/dmdobj_0005, DMD/dmd_summary_0005).</div>
<div class="line">Norms of the diff between ROM and PDE solutions for domain 0:</div>
<div class="line">  L1         Norm            : 1.6823397339748363E-07</div>
<div class="line">  L2         Norm            : 2.0644508136507202E-07</div>
<div class="line">  Linfinity  Norm            : 6.2271161570040760E-07</div>
<div class="line">Solver runtime (in seconds): 5.4798857799999996E+02</div>
<div class="line">Total  runtime (in seconds): 5.4807861200000002E+02</div>
<div class="line">Deallocating arrays.</div>
<div class="line">Finished.</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">
var sc_project=10897352; 
var sc_invisible=1; 
var sc_security="83042f57"; 
var scJsHost = (("https:" == document.location.protocol) ?
"https://secure." : "http://www.");
document.write("<sc"+"ript type='text/javascript' src='" +
scJsHost+
"statcounter.com/counter/counter.js'></"+"script>");
</script>
<noscript><div class="statcounter"><a title="website
statistics" href="http://statcounter.com/"
target="_blank"><img class="statcounter"
src="//c.statcounter.com/10897352/0/83042f57/1/"
alt="website statistics"></a></div></noscript>
<!-- End of StatCounter Code for Default Guide -->
