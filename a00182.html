<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>HyPar: include/mpivars_cpp.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_html_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">HyPar
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">Finite-Difference Hyperbolic-Parabolic PDE Solver on Cartesian Grids</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('a00182.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">mpivars_cpp.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>C++ declarations for MPI-related functions.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;<a class="el" href="a00146_source.html">mpivars_struct.h</a>&gt;</code><br />
</div>
<p><a href="a00182_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a45dcb265863a65d862bb16222e7e623c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00182.html#a45dcb265863a65d862bb16222e7e623c">MPIBroadcast_double</a> (double *, int, int, void *)</td></tr>
<tr class="separator:a45dcb265863a65d862bb16222e7e623c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acd7957559b9206224c7da3cab4f22b27"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00182.html#acd7957559b9206224c7da3cab4f22b27">MPIBroadcast_integer</a> (int *, int, int, void *)</td></tr>
<tr class="separator:acd7957559b9206224c7da3cab4f22b27"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad408e5a44e863cca50112d1e2f728597"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00182.html#ad408e5a44e863cca50112d1e2f728597">MPIBroadcast_character</a> (char *, int, int, void *)</td></tr>
<tr class="separator:ad408e5a44e863cca50112d1e2f728597"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ade449de8860c4b1060ca15bf7a80476f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00182.html#ade449de8860c4b1060ca15bf7a80476f">MPICreateCommunicators</a> (int, void *)</td></tr>
<tr class="separator:ade449de8860c4b1060ca15bf7a80476f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af59eb9eb78e6e99df5630429e5383617"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00182.html#af59eb9eb78e6e99df5630429e5383617">MPIFreeCommunicators</a> (int, void *)</td></tr>
<tr class="separator:af59eb9eb78e6e99df5630429e5383617"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a87419c70e96bbafe1e63821ba1d2e975"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00182.html#a87419c70e96bbafe1e63821ba1d2e975">MPICreateIOGroups</a> (void *)</td></tr>
<tr class="separator:a87419c70e96bbafe1e63821ba1d2e975"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac2f0cce702a9ce439753286ce227c7a2"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00182.html#ac2f0cce702a9ce439753286ce227c7a2">MPIExchangeBoundaries1D</a> (void *, double *, int, int, int, int)</td></tr>
<tr class="separator:ac2f0cce702a9ce439753286ce227c7a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a60ace5964c051fa481e6a1e6f1ef75d7"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00182.html#a60ace5964c051fa481e6a1e6f1ef75d7">MPIExchangeBoundariesnD</a> (int, int, int *, int, void *, double *)</td></tr>
<tr class="separator:a60ace5964c051fa481e6a1e6f1ef75d7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac4c9e0736d7419f96307c6e6298d3f45"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00182.html#ac4c9e0736d7419f96307c6e6298d3f45">MPIGatherArray1D</a> (void *, double *, double *, int, int, int, int)</td></tr>
<tr class="separator:ac4c9e0736d7419f96307c6e6298d3f45"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4cea2f7d5b8d6fad35c84c59da86631a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00182.html#a4cea2f7d5b8d6fad35c84c59da86631a">MPIGatherArraynD</a> (int, void *, double *, double *, int *, int *, int, int)</td></tr>
<tr class="separator:a4cea2f7d5b8d6fad35c84c59da86631a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a81ef82bfd40dff69eb5b975c102133f2"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00182.html#a81ef82bfd40dff69eb5b975c102133f2">MPIGatherArraynDwGhosts</a> (int, void *, double *, double *, int *, int *, int, int)</td></tr>
<tr class="separator:a81ef82bfd40dff69eb5b975c102133f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a690395a8c8453cdfb455de275a46be07"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00182.html#a690395a8c8453cdfb455de275a46be07">MPIPartitionArraynD</a> (int, void *, double *, double *, int *, int *, int, int)</td></tr>
<tr class="separator:a690395a8c8453cdfb455de275a46be07"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a25eaada04db84ccf1c979d4301f5093f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00182.html#a25eaada04db84ccf1c979d4301f5093f">MPIPartitionArraynDwGhosts</a> (int, void *, double *, double *, int *, int *, int, int)</td></tr>
<tr class="separator:a25eaada04db84ccf1c979d4301f5093f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a77f4e7a03979d9fabce2a536a113ff42"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00182.html#a77f4e7a03979d9fabce2a536a113ff42">MPIPartitionArray1D</a> (void *, double *, double *, int, int, int, int)</td></tr>
<tr class="separator:a77f4e7a03979d9fabce2a536a113ff42"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5795cc6a69ea39684662afc8c2557272"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00182.html#a5795cc6a69ea39684662afc8c2557272">MPIGetArrayDatanD</a> (double *, double *, int *, int *, int *, int *, int, int, int, void *)</td></tr>
<tr class="separator:a5795cc6a69ea39684662afc8c2557272"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9a3fc32b7d4bea6a1dac44ab21c9202e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00182.html#a9a3fc32b7d4bea6a1dac44ab21c9202e">MPILocalDomainLimits</a> (int, int, void *, int *, int *, int *)</td></tr>
<tr class="separator:a9a3fc32b7d4bea6a1dac44ab21c9202e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a184fc81a4d6618de22a60c9d8436fc83"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00182.html#a184fc81a4d6618de22a60c9d8436fc83">MPIMax_integer</a> (int *, int *, int, void *)</td></tr>
<tr class="separator:a184fc81a4d6618de22a60c9d8436fc83"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a42b8065bc8e4830aef4c26e58ab4d38d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00182.html#a42b8065bc8e4830aef4c26e58ab4d38d">MPIMax_long</a> (long *, long *, int, void *)</td></tr>
<tr class="separator:a42b8065bc8e4830aef4c26e58ab4d38d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a33aa37e0050ec72dadb8d63851df51ec"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00182.html#a33aa37e0050ec72dadb8d63851df51ec">MPIMax_double</a> (double *, double *, int, void *)</td></tr>
<tr class="separator:a33aa37e0050ec72dadb8d63851df51ec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac57453b9ebabb57bbadd0521c9151aaf"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00182.html#ac57453b9ebabb57bbadd0521c9151aaf">MPIMin_integer</a> (int *, int *, int, void *)</td></tr>
<tr class="separator:ac57453b9ebabb57bbadd0521c9151aaf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a754822278a5d215ecfafa28f1beed7bf"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00182.html#a754822278a5d215ecfafa28f1beed7bf">MPIMin_double</a> (double *, double *, int, void *)</td></tr>
<tr class="separator:a754822278a5d215ecfafa28f1beed7bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abd61f932b070ee84262d9d98b6dd854f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00182.html#abd61f932b070ee84262d9d98b6dd854f">MPISum_double</a> (double *, double *, int, void *)</td></tr>
<tr class="separator:abd61f932b070ee84262d9d98b6dd854f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a25c7df0ff2e4f81a64368ea72894a4f8"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00182.html#a25c7df0ff2e4f81a64368ea72894a4f8">MPISum_integer</a> (int *, int *, int, void *)</td></tr>
<tr class="separator:a25c7df0ff2e4f81a64368ea72894a4f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af8194ca5a460534fdbe391035a95c69d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00182.html#af8194ca5a460534fdbe391035a95c69d">MPIPartition1D</a> (int, int, int)</td></tr>
<tr class="separator:af8194ca5a460534fdbe391035a95c69d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a36e2be86c7dc0d9dd088ed2f5842f556"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00182.html#a36e2be86c7dc0d9dd088ed2f5842f556">MPIRank1D</a> (int, int *, int *)</td></tr>
<tr class="separator:a36e2be86c7dc0d9dd088ed2f5842f556"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afe59a0480bb81cc0d7877ba547b3e28c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00182.html#afe59a0480bb81cc0d7877ba547b3e28c">MPIRanknD</a> (int, int, int *, int *)</td></tr>
<tr class="separator:afe59a0480bb81cc0d7877ba547b3e28c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad9bc49863d543b6251903e9150c46a9c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00182.html#ad9bc49863d543b6251903e9150c46a9c">MPIGetFilename</a> (char *, void *, char *)</td></tr>
<tr class="separator:ad9bc49863d543b6251903e9150c46a9c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>C++ declarations for MPI-related functions. </p>
<dl class="section author"><dt>Author</dt><dd>Debojyoti Ghosh </dd></dl>

<p>Definition in file <a class="el" href="a00182_source.html">mpivars_cpp.h</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a45dcb265863a65d862bb16222e7e623c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int MPIBroadcast_double </td>
          <td>(</td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>root</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>comm</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Broadcast a double to all ranks</p>
<p>Broadcast an array of type <em>double</em> to all MPI ranks </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">x</td><td>array to broadcast to all ranks </td></tr>
    <tr><td class="paramname">size</td><td>size of array to broadcast </td></tr>
    <tr><td class="paramname">root</td><td>rank from which to broadcast </td></tr>
    <tr><td class="paramname">comm</td><td>MPI communicator within which to broadcast </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00297_source.html#l00009">9</a> of file <a class="el" href="a00297_source.html">MPIBroadcast.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;{</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#ifndef serial</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;  MPI_Bcast(x,size,MPI_DOUBLE,root,*((MPI_Comm*)comm));</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="acd7957559b9206224c7da3cab4f22b27"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int MPIBroadcast_integer </td>
          <td>(</td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>root</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>comm</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Broadcast an integer to all ranks</p>
<p>Broadcast an array of type <em>int</em> to all MPI ranks </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">x</td><td>array to broadcast to all ranks </td></tr>
    <tr><td class="paramname">size</td><td>size of array to broadcast </td></tr>
    <tr><td class="paramname">root</td><td>rank from which to broadcast </td></tr>
    <tr><td class="paramname">comm</td><td>MPI communicator within which to broadcast </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00297_source.html#l00023">23</a> of file <a class="el" href="a00297_source.html">MPIBroadcast.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;{</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#ifndef serial</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  MPI_Bcast(x,size,MPI_INT,root,*((MPI_Comm*)comm));</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad408e5a44e863cca50112d1e2f728597"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int MPIBroadcast_character </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>root</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>comm</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Broadcast a character to all ranks</p>
<p>Broadcast an array of type <em>char</em> to all MPI ranks </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">x</td><td>array to broadcast to all ranks </td></tr>
    <tr><td class="paramname">size</td><td>size of array to broadcast </td></tr>
    <tr><td class="paramname">root</td><td>rank from which to broadcast </td></tr>
    <tr><td class="paramname">comm</td><td>MPI communicator within which to broadcast </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00297_source.html#l00037">37</a> of file <a class="el" href="a00297_source.html">MPIBroadcast.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;{</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#ifndef serial</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  MPI_Bcast(x,size,MPI_CHAR,root,*((MPI_Comm*)comm));</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ade449de8860c4b1060ca15bf7a80476f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int MPICreateCommunicators </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ndims</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>m</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Create communicators required for the tridiagonal solver in compact schemes</p>
<p>Create subcommunicators from MPI_WORLD, where each subcommunicator contains MPI ranks along a spatial dimension. Consider a two-dimensional problem, partitioned on 21 MPI ranks as follows: </p><div class="image">
<img src="mpi_ranks.png" alt="mpi_ranks.png"/>
</div>
 <p>This function will create 10 subcommunicators with the following ranks:</p><ul>
<li>0,1,2,3,4,5,6</li>
<li>7,8,9,10,11,12,13</li>
<li>14,15,16,17,18,19,20</li>
<li>0,7,14</li>
<li>1,8,15</li>
<li>2,9,16</li>
<li>3,10,17</li>
<li>4,11,18</li>
<li>5,12,19</li>
<li>6,13,20</li>
</ul>
<p>These subcommunicators are useful for parallel computations along grid lines. For example, a compact finite-difference scheme solves implicit systems along grid lines in every spatial dimension. Thus, the subcommunicator may be passed on to the parallel systems solver instead of MPI_WORLD. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ndims</td><td>Number of spatial dimensions </td></tr>
    <tr><td class="paramname">m</td><td>MPI object of type <a class="el" href="a00146.html#a00559" title="Structure of MPI-related variables. ">MPIVariables</a> </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00298_source.html#l00035">35</a> of file <a class="el" href="a00298_source.html">MPICommunicators.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;{</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <a class="code" href="a00146.html#a00559">MPIVariables</a> *mpi = (<a class="code" href="a00146.html#a00559">MPIVariables</a>*) m;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#ifdef serial</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  mpi-&gt;<a class="code" href="a00146.html#a45a2dae130e8ef21ae3aa9c7a9e7a138">comm</a> = NULL;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  <span class="keywordtype">int</span>          i,n,color,key;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  <span class="keywordtype">int</span>          *ip,*iproc;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  mpi-&gt;<a class="code" href="a00146.html#a45a2dae130e8ef21ae3aa9c7a9e7a138">comm</a> = (MPI_Comm*) calloc (ndims, <span class="keyword">sizeof</span>(MPI_Comm));</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  <span class="keywordflow">if</span> (ndims == 1) MPI_Comm_dup(mpi-&gt;<a class="code" href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>,mpi-&gt;<a class="code" href="a00146.html#a45a2dae130e8ef21ae3aa9c7a9e7a138">comm</a>);</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    ip    = (<span class="keywordtype">int</span>*) calloc (ndims-1,<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    iproc = (<span class="keywordtype">int</span>*) calloc (ndims-1,<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="keywordflow">for</span> (n=0; n&lt;ndims; n++) {</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;      <span class="keywordtype">int</span> tick=0; </div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;      <span class="keywordflow">for</span> (i=0; i&lt;ndims; i++) {</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        <span class="keywordflow">if</span> (i != n) {</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;          ip[tick]    = mpi-&gt;<a class="code" href="a00146.html#aa3c28612a64b8a97bde66b720e15c700">ip</a>[i];</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;          iproc[tick] = mpi-&gt;<a class="code" href="a00146.html#a0be0f30a83bc3f3d9f6ee3a36bbf2716">iproc</a>[i];</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;          tick++;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        }</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;      }</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;      <a class="code" href="a00165.html#afbb862a2fdf5b72b1f9ace42f64b556f">_ArrayIndex1D_</a>(ndims-1,iproc,ip,0,color); </div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;      key   = mpi-&gt;<a class="code" href="a00146.html#aa3c28612a64b8a97bde66b720e15c700">ip</a>[n];</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;      MPI_Comm_split(mpi-&gt;<a class="code" href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>,color,key,&amp;mpi-&gt;<a class="code" href="a00146.html#a45a2dae130e8ef21ae3aa9c7a9e7a138">comm</a>[n]);</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    }</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    free(ip);</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    free(iproc);</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  }</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;}</div>
<div class="ttc" id="a00146_html_a0be0f30a83bc3f3d9f6ee3a36bbf2716"><div class="ttname"><a href="a00146.html#a0be0f30a83bc3f3d9f6ee3a36bbf2716">MPIVariables::iproc</a></div><div class="ttdeci">int * iproc</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00027">mpivars_struct.h:27</a></div></div>
<div class="ttc" id="a00146_html_aa3c28612a64b8a97bde66b720e15c700"><div class="ttname"><a href="a00146.html#aa3c28612a64b8a97bde66b720e15c700">MPIVariables::ip</a></div><div class="ttdeci">int * ip</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00028">mpivars_struct.h:28</a></div></div>
<div class="ttc" id="a00146_html_a45a2dae130e8ef21ae3aa9c7a9e7a138"><div class="ttname"><a href="a00146.html#a45a2dae130e8ef21ae3aa9c7a9e7a138">MPIVariables::comm</a></div><div class="ttdeci">MPI_Comm * comm</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00038">mpivars_struct.h:38</a></div></div>
<div class="ttc" id="a00146_html_adad7a6f85831f3ac84d854b6c80aef43"><div class="ttname"><a href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">MPIVariables::world</a></div><div class="ttdeci">MPI_Comm world</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00037">mpivars_struct.h:37</a></div></div>
<div class="ttc" id="a00165_html_afbb862a2fdf5b72b1f9ace42f64b556f"><div class="ttname"><a href="a00165.html#afbb862a2fdf5b72b1f9ace42f64b556f">_ArrayIndex1D_</a></div><div class="ttdeci">#define _ArrayIndex1D_(N, imax, i, ghost, index)</div><div class="ttdef"><b>Definition:</b> <a href="a00165_source.html#l00039">arrayfunctions.h:39</a></div></div>
<div class="ttc" id="a00146_html_a00559"><div class="ttname"><a href="a00146.html#a00559">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00024">mpivars_struct.h:24</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af59eb9eb78e6e99df5630429e5383617"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int MPIFreeCommunicators </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ndims</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>m</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Free/destroy communicators created</p>
<p>Free the subcommunicators created in <a class="el" href="a00298.html#a8f52d58fa2c0c94914befd51b6d413a1">MPICreateCommunicators()</a>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ndims</td><td>Number of spatial dimensions </td></tr>
    <tr><td class="paramname">m</td><td>MPI object of type <a class="el" href="a00146.html#a00559" title="Structure of MPI-related variables. ">MPIVariables</a> </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00298_source.html#l00075">75</a> of file <a class="el" href="a00298_source.html">MPICommunicators.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;{</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="preprocessor">#ifndef serial</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <a class="code" href="a00146.html#a00559">MPIVariables</a> *mpi = (<a class="code" href="a00146.html#a00559">MPIVariables</a>*) m;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <span class="keywordtype">int</span>          n;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <span class="keywordflow">for</span> (n=0; n&lt;ndims; n++) MPI_Comm_free(&amp;mpi-&gt;<a class="code" href="a00146.html#a45a2dae130e8ef21ae3aa9c7a9e7a138">comm</a>[n]);</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  free(mpi-&gt;<a class="code" href="a00146.html#a45a2dae130e8ef21ae3aa9c7a9e7a138">comm</a>);</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="keywordflow">if</span> (mpi-&gt;<a class="code" href="a00146.html#a92096d6b87420d0e71b38c6dc5e10b14">IOParticipant</a>) MPI_Comm_free(&amp;mpi-&gt;<a class="code" href="a00146.html#ae297d101be8576bfb36202ebb61085e6">IOWorld</a>);</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  MPI_Comm_free(&amp;mpi-&gt;<a class="code" href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;}</div>
<div class="ttc" id="a00146_html_a45a2dae130e8ef21ae3aa9c7a9e7a138"><div class="ttname"><a href="a00146.html#a45a2dae130e8ef21ae3aa9c7a9e7a138">MPIVariables::comm</a></div><div class="ttdeci">MPI_Comm * comm</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00038">mpivars_struct.h:38</a></div></div>
<div class="ttc" id="a00146_html_a92096d6b87420d0e71b38c6dc5e10b14"><div class="ttname"><a href="a00146.html#a92096d6b87420d0e71b38c6dc5e10b14">MPIVariables::IOParticipant</a></div><div class="ttdeci">int IOParticipant</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00042">mpivars_struct.h:42</a></div></div>
<div class="ttc" id="a00146_html_adad7a6f85831f3ac84d854b6c80aef43"><div class="ttname"><a href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">MPIVariables::world</a></div><div class="ttdeci">MPI_Comm world</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00037">mpivars_struct.h:37</a></div></div>
<div class="ttc" id="a00146_html_ae297d101be8576bfb36202ebb61085e6"><div class="ttname"><a href="a00146.html#ae297d101be8576bfb36202ebb61085e6">MPIVariables::IOWorld</a></div><div class="ttdeci">MPI_Comm IOWorld</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00048">mpivars_struct.h:48</a></div></div>
<div class="ttc" id="a00146_html_a00559"><div class="ttname"><a href="a00146.html#a00559">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00024">mpivars_struct.h:24</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a87419c70e96bbafe1e63821ba1d2e975"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int MPICreateIOGroups </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>m</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Create I/O groups for file reading and writing &ndash; Group leaders gather data from all other ranks in the group and write to file, and read from file and sends the data to the appropriate ranks in the group. Thus, number of ranks participating in file I/O is equal to the number of groups (which is an input), and can be set to the number of I/O nodes available.</p>
<p>Create I/O groups of MPI ranks: A scalable approach to file I/O when running simulations on a large number of processors (&gt;10,000) is partitioning all the MPI ranks into I/O group. Each group has a "leader" that:</p><ul>
<li>Input - reads the local data of each member rank from the file and sends it to that member.</li>
<li>Output - gets the local data of each member rank and writes it to a file.</li>
</ul>
<p>The number of I/O groups (and hence, the number of I/O ranks reading and writing to files) is specified through <a class="el" href="a00146.html#a297fca986fa3aa27de07a0c746ffaaa8">MPIVariables::N_IORanks</a>. Ideally, this would correspond to the number of I/O nodes available for the total number of compute nodes being used on a HPC platform.</p>
<p>Two extreme cases are:</p><ul>
<li>Number of I/O ranks is 1, i.e., just one rank (typically rank 0) is responsible for reading and writing the local data of every rank.</li>
<li>Number of I/O ranks is equal to the total number of MPI ranks, i.e., each MPI rank reads and writes from and to its own files.</li>
</ul>
<p>Neither of the extreme cases are scalable.</p>
<p>Notes:</p><ul>
<li>If the total number of MPI ranks (<a class="el" href="a00146.html#ae68326adc3b3862f1162832f70727b06">MPIVariables::nproc</a>) is not an integer multiple of the specified number of I/O groups (<a class="el" href="a00146.html#a297fca986fa3aa27de07a0c746ffaaa8">MPIVariables::N_IORanks</a>), then only 1 rank is used. </li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">m</td><td>MPI object of type <a class="el" href="a00146.html#a00559" title="Structure of MPI-related variables. ">MPIVariables</a> </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00305_source.html#l00037">37</a> of file <a class="el" href="a00305_source.html">MPIIOGroups.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;{</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  <a class="code" href="a00146.html#a00559">MPIVariables</a> *mpi = (<a class="code" href="a00146.html#a00559">MPIVariables</a>*) m;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#ifndef serial</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  <span class="keywordtype">int</span> nproc         = mpi-&gt;<a class="code" href="a00146.html#ae68326adc3b3862f1162832f70727b06">nproc</a>;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  <span class="keywordtype">int</span> rank          = mpi-&gt;<a class="code" href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  <span class="keywordtype">int</span> N_IORanks     = mpi-&gt;<a class="code" href="a00146.html#a297fca986fa3aa27de07a0c746ffaaa8">N_IORanks</a>;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  <span class="keywordtype">int</span> GroupSize;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  <span class="keywordflow">if</span> (nproc%N_IORanks==0) GroupSize = nproc/N_IORanks;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="keywordflow">if</span> (!rank) {</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;      printf(<span class="stringliteral">&quot;Note: in MPICreateIOGroups() - Number of &quot;</span>);</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;      printf(<span class="stringliteral">&quot;ranks (nproc) is not divisible by number &quot;</span>);</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;      printf(<span class="stringliteral">&quot;of IO ranks (N_IORanks). Readjusting number &quot;</span>);</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;      printf(<span class="stringliteral">&quot;of IO ranks to fix this.\n&quot;</span>);</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    }</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    N_IORanks = 1;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="keywordflow">if</span> (!rank) {</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;      printf(<span class="stringliteral">&quot;Number of IO Ranks: %d\n&quot;</span>,N_IORanks);</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    }</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    GroupSize = nproc;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  }</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  mpi-&gt;<a class="code" href="a00146.html#a1654ada98aca560c6cb1dc79bb6576c3">CommGroup</a>  = rank/GroupSize;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  mpi-&gt;<a class="code" href="a00146.html#a1e6b9b6dca494aa45e43214f120e6630">IORank</a>     = mpi-&gt;<a class="code" href="a00146.html#a1654ada98aca560c6cb1dc79bb6576c3">CommGroup</a> * GroupSize;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  <span class="comment">/* set flag for whether this rank does file I/O */</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="keywordflow">if</span> (rank == mpi-&gt;<a class="code" href="a00146.html#a1e6b9b6dca494aa45e43214f120e6630">IORank</a>)  mpi-&gt;<a class="code" href="a00146.html#a92096d6b87420d0e71b38c6dc5e10b14">IOParticipant</a> = 1;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <span class="keywordflow">else</span>                      mpi-&gt;<a class="code" href="a00146.html#a92096d6b87420d0e71b38c6dc5e10b14">IOParticipant</a> = 0;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <span class="comment">/* save the first and last process of this group */</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  mpi-&gt;<a class="code" href="a00146.html#aff30abd72b51ad067b03ec6d574973a1">GroupStartRank</a> = mpi-&gt;<a class="code" href="a00146.html#a1e6b9b6dca494aa45e43214f120e6630">IORank</a>;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  mpi-&gt;<a class="code" href="a00146.html#ada7c6833a6ee759beee80a693cf86072">GroupEndRank</a>   = (mpi-&gt;<a class="code" href="a00146.html#a1654ada98aca560c6cb1dc79bb6576c3">CommGroup</a>+1)*GroupSize;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <span class="comment">/* create a new communicator with the IO participants */</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  <span class="keywordtype">int</span> i,*FileIORanks;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  MPI_Group WorldGroup, IOGroup;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  FileIORanks = (<span class="keywordtype">int</span>*) calloc (N_IORanks,<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  <span class="keywordflow">for</span> (i=0; i&lt;N_IORanks; i++) FileIORanks[i] = i*GroupSize;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  MPI_Comm_group(mpi-&gt;<a class="code" href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>,&amp;WorldGroup);</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  MPI_Group_incl(WorldGroup,N_IORanks,FileIORanks,&amp;IOGroup);</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  MPI_Comm_create(mpi-&gt;<a class="code" href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>,IOGroup,&amp;mpi-&gt;<a class="code" href="a00146.html#ae297d101be8576bfb36202ebb61085e6">IOWorld</a>);</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  MPI_Group_free(&amp;IOGroup);</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  MPI_Group_free(&amp;WorldGroup);</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  free(FileIORanks);</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;}</div>
<div class="ttc" id="a00146_html_ae68326adc3b3862f1162832f70727b06"><div class="ttname"><a href="a00146.html#ae68326adc3b3862f1162832f70727b06">MPIVariables::nproc</a></div><div class="ttdeci">int nproc</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00026">mpivars_struct.h:26</a></div></div>
<div class="ttc" id="a00146_html_a6cfd95afd0afebd625b889fb6e58371c"><div class="ttname"><a href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">MPIVariables::rank</a></div><div class="ttdeci">int rank</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00025">mpivars_struct.h:25</a></div></div>
<div class="ttc" id="a00146_html_a1e6b9b6dca494aa45e43214f120e6630"><div class="ttname"><a href="a00146.html#a1e6b9b6dca494aa45e43214f120e6630">MPIVariables::IORank</a></div><div class="ttdeci">int IORank</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00044">mpivars_struct.h:44</a></div></div>
<div class="ttc" id="a00146_html_a297fca986fa3aa27de07a0c746ffaaa8"><div class="ttname"><a href="a00146.html#a297fca986fa3aa27de07a0c746ffaaa8">MPIVariables::N_IORanks</a></div><div class="ttdeci">int N_IORanks</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00041">mpivars_struct.h:41</a></div></div>
<div class="ttc" id="a00146_html_aff30abd72b51ad067b03ec6d574973a1"><div class="ttname"><a href="a00146.html#aff30abd72b51ad067b03ec6d574973a1">MPIVariables::GroupStartRank</a></div><div class="ttdeci">int GroupStartRank</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00045">mpivars_struct.h:45</a></div></div>
<div class="ttc" id="a00146_html_ada7c6833a6ee759beee80a693cf86072"><div class="ttname"><a href="a00146.html#ada7c6833a6ee759beee80a693cf86072">MPIVariables::GroupEndRank</a></div><div class="ttdeci">int GroupEndRank</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00046">mpivars_struct.h:46</a></div></div>
<div class="ttc" id="a00146_html_a92096d6b87420d0e71b38c6dc5e10b14"><div class="ttname"><a href="a00146.html#a92096d6b87420d0e71b38c6dc5e10b14">MPIVariables::IOParticipant</a></div><div class="ttdeci">int IOParticipant</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00042">mpivars_struct.h:42</a></div></div>
<div class="ttc" id="a00146_html_a1654ada98aca560c6cb1dc79bb6576c3"><div class="ttname"><a href="a00146.html#a1654ada98aca560c6cb1dc79bb6576c3">MPIVariables::CommGroup</a></div><div class="ttdeci">int CommGroup</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00043">mpivars_struct.h:43</a></div></div>
<div class="ttc" id="a00146_html_adad7a6f85831f3ac84d854b6c80aef43"><div class="ttname"><a href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">MPIVariables::world</a></div><div class="ttdeci">MPI_Comm world</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00037">mpivars_struct.h:37</a></div></div>
<div class="ttc" id="a00146_html_ae297d101be8576bfb36202ebb61085e6"><div class="ttname"><a href="a00146.html#ae297d101be8576bfb36202ebb61085e6">MPIVariables::IOWorld</a></div><div class="ttdeci">MPI_Comm IOWorld</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00048">mpivars_struct.h:48</a></div></div>
<div class="ttc" id="a00146_html_a00559"><div class="ttname"><a href="a00146.html#a00559">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00024">mpivars_struct.h:24</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac2f0cce702a9ce439753286ce227c7a2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int MPIExchangeBoundaries1D </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>N</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ghosts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ndims</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Exchange boundary (ghost point) values for an essentially 1D array (like grid coordinates)</p>
<p>Exchange the data across MPI ranks and fill in ghost points for a 1D array. In a multidimensional simulation, a 1D array is an array of data along one of the spatial dimensions, i.e. its an array storing a variable that varies in only one of the spatial dimension. For example, for a 2D problem on a Cartesian grid (with spatial dimensions x and y), the array of x-coordinates is a 1D array along x, and the array of y-coordinates is a 1D array along y. Thus, the size of the 1D array is equal to the size of the domain along the spatial dimension corresponding to that array.</p>
<p>Consider a two-dimensional problem, partitioned on 21 MPI ranks as follows: </p><div class="image">
<img src="mpi_ranks.png" alt="mpi_ranks.png"/>
</div>
  and consider rank 9.</p>
<p>If the argument <em>dir</em> is specified as 0, and thus we are dealing with a 1D array along dimension 0, then</p><ul>
<li>Rank 9 will exchange data with ranks 8 and 10, and fill in its ghost points.</li>
</ul>
<p>If <em>dir</em> is specified as 1, and thus we are dealing with a 1D array along dimension 1, then</p><ul>
<li>Rank 9 will exchange data with ranks 2 and 16, and fill in its ghost points. </li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">m</td><td>MPI object of type <a class="el" href="a00146.html#a00559" title="Structure of MPI-related variables. ">MPIVariables</a> </td></tr>
    <tr><td class="paramname">x</td><td>The 1D array for which to exchange data </td></tr>
    <tr><td class="paramname">N</td><td>Size of the array </td></tr>
    <tr><td class="paramname">ghosts</td><td>Number of ghost points </td></tr>
    <tr><td class="paramname">dir</td><td>Spatial dimension corresponding to the 1D array </td></tr>
    <tr><td class="paramname">ndims</td><td>Number of spatial dimensions in the simulation </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00299_source.html#l00032">32</a> of file <a class="el" href="a00299_source.html">MPIExchangeBoundaries1D.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;{</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#ifndef serial</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  <a class="code" href="a00146.html#a00559">MPIVariables</a>  *mpi = (<a class="code" href="a00146.html#a00559">MPIVariables</a>*) m;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  <span class="keywordtype">int</span>           i;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  </div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  <span class="keywordtype">int</span> *ip     = mpi-&gt;<a class="code" href="a00146.html#aa3c28612a64b8a97bde66b720e15c700">ip</a>;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  <span class="keywordtype">int</span> *iproc  = mpi-&gt;<a class="code" href="a00146.html#a0be0f30a83bc3f3d9f6ee3a36bbf2716">iproc</a>;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  <span class="keywordtype">int</span> non      = 0; <span class="comment">/* number of neighbours */</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  <span class="keywordtype">int</span> neighbor_rank[2] = {-1,-1};</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="keywordtype">int</span> nip[ndims];</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <span class="comment">/* each process has 2 neighbors (except at physical boundaries)       */</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <span class="comment">/* calculate the rank of these neighbors (-1 -&gt; none)                 */</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <a class="code" href="a00165.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>(ip,nip,ndims);  nip[dir]--;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  <span class="keywordflow">if</span> (ip[dir] == 0)             neighbor_rank[0] = -1;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <span class="keywordflow">else</span>                          neighbor_rank[0] = <a class="code" href="a00181.html#a36e2be86c7dc0d9dd088ed2f5842f556">MPIRank1D</a>(ndims,iproc,nip);</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <a class="code" href="a00165.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>(ip,nip,ndims);  nip[dir]++;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <span class="keywordflow">if</span> (ip[dir] == (iproc[dir]-1))neighbor_rank[1] = -1;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <span class="keywordflow">else</span>                          neighbor_rank[1] = <a class="code" href="a00181.html#a36e2be86c7dc0d9dd088ed2f5842f556">MPIRank1D</a>(ndims,iproc,nip);</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <span class="comment">/* Allocate send and receive buffers */</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  <span class="keywordtype">double</span> sendbuf[2][ghosts], recvbuf[2][ghosts];</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  <span class="comment">/* count number of neighbors and copy data to send buffers */</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  non = 0;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  <span class="keywordflow">if</span> (neighbor_rank[0] != -1) {</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    non++;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; ghosts; i++) sendbuf[0][i] = x[i+ghosts];</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  }</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <span class="keywordflow">if</span> (neighbor_rank[1] != -1) {</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    non++;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; ghosts; i++) sendbuf[1][i] = x[i+N];</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  }</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  MPI_Request requests[2*non];</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  MPI_Status  statuses[2*non];</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  <span class="comment">/* exchange the data */</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  <span class="keywordtype">int</span> tick = 0;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  <span class="keywordflow">if</span> (neighbor_rank[0]!= -1) {</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    MPI_Irecv(recvbuf[0],ghosts,MPI_DOUBLE,neighbor_rank[0],1631,mpi-&gt;<a class="code" href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>,&amp;requests[tick]);</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    MPI_Isend(sendbuf[0],ghosts,MPI_DOUBLE,neighbor_rank[0],1631,mpi-&gt;<a class="code" href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>,&amp;requests[tick+non]);</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    tick++;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  }</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <span class="keywordflow">if</span> (neighbor_rank[1] != -1) {</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    MPI_Irecv(recvbuf[1],ghosts,MPI_DOUBLE,neighbor_rank[1],1631,mpi-&gt;<a class="code" href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>,&amp;requests[tick]);</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    MPI_Isend(sendbuf[1],ghosts,MPI_DOUBLE,neighbor_rank[1],1631,mpi-&gt;<a class="code" href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>,&amp;requests[tick+non]);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    tick++;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  }</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <span class="comment">/* Wait till data transfer is done */</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  MPI_Waitall(2*non,requests,statuses);</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <span class="comment">/* copy received data to ghost points */</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <span class="keywordflow">if</span> (neighbor_rank[0] != -1) <span class="keywordflow">for</span> (i = 0; i &lt; ghosts; i++) x[i]          = recvbuf[0][i];</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="keywordflow">if</span> (neighbor_rank[1] != -1) <span class="keywordflow">for</span> (i = 0; i &lt; ghosts; i++) x[i+N+ghosts] = recvbuf[1][i];</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  </div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;}</div>
<div class="ttc" id="a00146_html_a0be0f30a83bc3f3d9f6ee3a36bbf2716"><div class="ttname"><a href="a00146.html#a0be0f30a83bc3f3d9f6ee3a36bbf2716">MPIVariables::iproc</a></div><div class="ttdeci">int * iproc</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00027">mpivars_struct.h:27</a></div></div>
<div class="ttc" id="a00146_html_aa3c28612a64b8a97bde66b720e15c700"><div class="ttname"><a href="a00146.html#aa3c28612a64b8a97bde66b720e15c700">MPIVariables::ip</a></div><div class="ttdeci">int * ip</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00028">mpivars_struct.h:28</a></div></div>
<div class="ttc" id="a00165_html_a89e8330d9e06dd0666c50833628a125c"><div class="ttname"><a href="a00165.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a></div><div class="ttdeci">#define _ArrayCopy1D_(x, y, size)</div><div class="ttdef"><b>Definition:</b> <a href="a00165_source.html#l00318">arrayfunctions.h:318</a></div></div>
<div class="ttc" id="a00181_html_a36e2be86c7dc0d9dd088ed2f5842f556"><div class="ttname"><a href="a00181.html#a36e2be86c7dc0d9dd088ed2f5842f556">MPIRank1D</a></div><div class="ttdeci">int MPIRank1D(int, int *, int *)</div><div class="ttdef"><b>Definition:</b> <a href="a00312_source.html#l00026">MPIRank1D.c:26</a></div></div>
<div class="ttc" id="a00146_html_adad7a6f85831f3ac84d854b6c80aef43"><div class="ttname"><a href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">MPIVariables::world</a></div><div class="ttdeci">MPI_Comm world</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00037">mpivars_struct.h:37</a></div></div>
<div class="ttc" id="a00146_html_a00559"><div class="ttname"><a href="a00146.html#a00559">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00024">mpivars_struct.h:24</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a60ace5964c051fa481e6a1e6f1ef75d7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int MPIExchangeBoundariesnD </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ndims</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nvars</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>dim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ghosts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>var</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Exchange boundary (ghost point) values for an n-dimensional array (like the solution array)</p>
<p>Exchange data across MPI ranks, and fill in ghost points for an n-dimensional array (where <em>n</em> is the total number of spatial dimensions). If any of the physical boundaries are periodic, this function also exchanges data and fills in the ghost points for these boundaries.</p>
<p>The n-dimensional array must be stored in the memory as a single-index array, with the following order of mapping:</p><ul>
<li>Number of variables (vector components)</li>
<li>Spatial dimension 0</li>
<li>Spatial dimension 1</li>
<li>...</li>
<li>Spatial dimensions <em>ndims-1</em> </li>
</ul>
<p>For example, consider a 2D simulation (<em>ndims</em> = 2), of size \(7 \times 3\), with \(4\) vector components (<em>nvars</em> = 4). The following figure shows the layout (without the ghost points): </p><div class="image">
<img src="layout.png" alt="layout.png"/>
</div>
 <p>The bold numbers in parentheses represent the 2D indices. The numbers below them are the indices of the array that correspond to that 2D location. Thus, elements 40,41,42, and 43 in the array are the 1st, 2nd, 3rd, and 4th vector components at location (1,3).</p>
<p>If \({\bf i}\left[{\rm ndims}\right]\) is an integer array representing an n-dimensional index (for example, \(\left(5,4\right)\) in 2D, \(\left(3,5,2\right)\) in 3D), and the number of vector components is <em>nvars</em>, then:</p><ul>
<li><a class="el" href="a00165.html#afbb862a2fdf5b72b1f9ace42f64b556f">_ArrayIndex1D_</a> computes the index \(p\) in the array corresponding to \({\bf i}\). In the above example, \({\bf i} = \left(1,3\right) \rightarrow p = 10\).</li>
<li><em>var</em>[nvars*p+v] accesses the <em>v-th</em> component of the n-dimensional array <em>var</em> at location \({\bf i}\). In the above example, to access the 3rd vector component at location \(\left(1,3\right)\), we have \(p=10\), so <em>var</em> [4*10+2] = <em>var</em> [42]. </li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ndims</td><td>Number of spatial dimensions </td></tr>
    <tr><td class="paramname">nvars</td><td>Number of variables (vector components) at each grid location </td></tr>
    <tr><td class="paramname">dim</td><td>Integer array whose elements are the local size along each spatial dimension </td></tr>
    <tr><td class="paramname">ghosts</td><td>Number of ghost points </td></tr>
    <tr><td class="paramname">m</td><td>MPI object of type <a class="el" href="a00146.html#a00559" title="Structure of MPI-related variables. ">MPIVariables</a> </td></tr>
    <tr><td class="paramname">var</td><td>The array for which to exchange data and fill in ghost points </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00300_source.html#l00042">42</a> of file <a class="el" href="a00300_source.html">MPIExchangeBoundariesnD.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;{</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#ifndef serial</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <a class="code" href="a00146.html#a00559">MPIVariables</a>  *mpi = (<a class="code" href="a00146.html#a00559">MPIVariables</a>*) m;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <span class="keywordtype">int</span>           d;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  </div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  <span class="keywordtype">int</span> *ip     = mpi-&gt;<a class="code" href="a00146.html#aa3c28612a64b8a97bde66b720e15c700">ip</a>;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <span class="keywordtype">int</span> *iproc  = mpi-&gt;<a class="code" href="a00146.html#a0be0f30a83bc3f3d9f6ee3a36bbf2716">iproc</a>;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <span class="keywordtype">int</span> *bcflag = mpi-&gt;<a class="code" href="a00146.html#af40a5a3066fdb53a47e4627071abc2bc">bcperiodic</a>;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <span class="keywordtype">int</span> neighbor_rank[2*ndims], nip[ndims], index[ndims], bounds[ndims], offset[ndims];</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  MPI_Request rcvreq[2*ndims], sndreq[2*ndims];</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <span class="keywordflow">for</span> (d=0; d&lt;2*ndims; d++) rcvreq[d] = sndreq[d] = MPI_REQUEST_NULL;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  <span class="comment">/* each process has 2*ndims neighbors (except at non-periodic physical boundaries)  */</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  <span class="comment">/* calculate the rank of these neighbors (-1 -&gt; none)                               */</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  <span class="keywordflow">for</span> (d = 0; d &lt; ndims; d++) {</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <a class="code" href="a00165.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>(ip,nip,ndims); </div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="keywordflow">if</span> (ip[d] == 0) nip[d] = iproc[d]-1;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="keywordflow">else</span>            nip[d]--;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="keywordflow">if</span> ((ip[d] == 0) &amp;&amp; (!bcflag[d])) neighbor_rank[2*d]   = -1;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="keywordflow">else</span>                              neighbor_rank[2*d]   = <a class="code" href="a00181.html#a36e2be86c7dc0d9dd088ed2f5842f556">MPIRank1D</a>(ndims,iproc,nip);</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <a class="code" href="a00165.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>(ip,nip,ndims); </div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keywordflow">if</span> (ip[d] == (iproc[d]-1)) nip[d] = 0;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="keywordflow">else</span>                       nip[d]++;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="keywordflow">if</span> ((ip[d] == (iproc[d]-1)) &amp;&amp; (!bcflag[d]))  neighbor_rank[2*d+1] = -1;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="keywordflow">else</span>                                          neighbor_rank[2*d+1] = <a class="code" href="a00181.html#a36e2be86c7dc0d9dd088ed2f5842f556">MPIRank1D</a>(ndims,iproc,nip);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  }</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  <span class="comment">/* calculate dimensions of each of the send-receive regions */</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  <span class="keywordtype">double</span> *sendbuf = mpi-&gt;<a class="code" href="a00146.html#aba3b15034da676474db917f9f5533085">sendbuf</a>;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  <span class="keywordtype">double</span> *recvbuf = mpi-&gt;<a class="code" href="a00146.html#afc23e46e08649e112e8d64d780cea5cb">recvbuf</a>;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <span class="keywordtype">int</span>    stride   = mpi-&gt;<a class="code" href="a00146.html#a4c12bdea025b404c7dd79f368fc03efd">maxbuf</a>;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <span class="keywordtype">int</span>    bufdim[ndims];</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <span class="keywordflow">for</span> (d = 0; d &lt; ndims; d++) {</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    bufdim[d] = 1;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; ndims; i++) {</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;      <span class="keywordflow">if</span> (i == d) bufdim[d] *= ghosts;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;      <span class="keywordflow">else</span>        bufdim[d] *= dim[i];</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    }</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  }</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <span class="comment">/* post the receive requests */</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <span class="keywordflow">for</span> (d = 0; d &lt; ndims; d++) {</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="keywordflow">if</span> (neighbor_rank[2*d  ] != -1) {</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;      MPI_Irecv(&amp;recvbuf[2*d*stride],bufdim[d]*nvars,MPI_DOUBLE,neighbor_rank[2*d  ],1630,</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                mpi-&gt;<a class="code" href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>,&amp;rcvreq[2*d]);</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    }</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="keywordflow">if</span> (neighbor_rank[2*d+1] != -1) {</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;      MPI_Irecv(&amp;recvbuf[(2*d+1)*stride],bufdim[d]*nvars,MPI_DOUBLE,neighbor_rank[2*d+1],1631,</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                mpi-&gt;<a class="code" href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>,&amp;rcvreq[2*d+1]);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    }</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  }</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <span class="comment">/* count number of neighbors and copy data to send buffers */</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  <span class="keywordflow">for</span> (d = 0; d &lt; ndims; d++) {</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <a class="code" href="a00165.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>(dim,bounds,ndims); bounds[d] = ghosts;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="keywordflow">if</span> (neighbor_rank[2*d] != -1) {</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;      <a class="code" href="a00165.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(offset,ndims,0);</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;      <span class="keywordtype">int</span> done = 0; <a class="code" href="a00165.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(index,ndims,0);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;      <span class="keywordflow">while</span> (!done) {</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        <span class="keywordtype">int</span> p1; <a class="code" href="a00165.html#a0739cb538f4d301fad3b45059ddd0738">_ArrayIndex1DWO_</a>(ndims,dim,index,offset,ghosts,p1);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        <span class="keywordtype">int</span> p2; <a class="code" href="a00165.html#afbb862a2fdf5b72b1f9ace42f64b556f">_ArrayIndex1D_</a>(ndims,bounds,index,0,p2);</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        <a class="code" href="a00165.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>((var+nvars*p1),(sendbuf+2*d*stride+nvars*p2),nvars);</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        <a class="code" href="a00165.html#ac5ec1371623f11d03b0f42adaa24acbc">_ArrayIncrementIndex_</a>(ndims,bounds,index,done);</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;      }</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    }</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="keywordflow">if</span> (neighbor_rank[2*d+1] != -1) {</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;      <a class="code" href="a00165.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(offset,ndims,0);offset[d] = dim[d]-ghosts;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;      <span class="keywordtype">int</span> done = 0; <a class="code" href="a00165.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(index,ndims,0);</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;      <span class="keywordflow">while</span> (!done) {</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        <span class="keywordtype">int</span> p1; <a class="code" href="a00165.html#a0739cb538f4d301fad3b45059ddd0738">_ArrayIndex1DWO_</a>(ndims,dim,index,offset,ghosts,p1);</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        <span class="keywordtype">int</span> p2; <a class="code" href="a00165.html#afbb862a2fdf5b72b1f9ace42f64b556f">_ArrayIndex1D_</a>(ndims,bounds,index,0,p2);</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        <a class="code" href="a00165.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>((var+nvars*p1),(sendbuf+(2*d+1)*stride+nvars*p2),nvars);</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        <a class="code" href="a00165.html#ac5ec1371623f11d03b0f42adaa24acbc">_ArrayIncrementIndex_</a>(ndims,bounds,index,done);</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;      }</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    }</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  }</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  <span class="comment">/* send the data */</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  <span class="keywordflow">for</span> (d = 0; d &lt; ndims; d++) {</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="keywordflow">if</span> (neighbor_rank[2*d  ] != -1) {</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;      MPI_Isend(&amp;sendbuf[2*d*stride],bufdim[d]*nvars,MPI_DOUBLE,neighbor_rank[2*d  ],1631,</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                mpi-&gt;<a class="code" href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>,&amp;sndreq[2*d]);</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    }</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="keywordflow">if</span> (neighbor_rank[2*d+1] != -1) {</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;      MPI_Isend(&amp;sendbuf[(2*d+1)*stride],bufdim[d]*nvars,MPI_DOUBLE,neighbor_rank[2*d+1],1630,</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;                mpi-&gt;<a class="code" href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>,&amp;sndreq[2*d+1]);</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    }</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  }</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <span class="comment">/* Wait till data is done received */</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  MPI_Waitall(2*ndims,rcvreq,MPI_STATUS_IGNORE);</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <span class="comment">/* copy received data to ghost points */</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <span class="keywordflow">for</span> (d = 0; d &lt; ndims; d++) {</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <a class="code" href="a00165.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>(dim,bounds,ndims); bounds[d] = ghosts;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="keywordflow">if</span> (neighbor_rank[2*d] != -1) {</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;      <a class="code" href="a00165.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(offset,ndims,0); offset[d] = -ghosts;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;      <span class="keywordtype">int</span> done = 0; <a class="code" href="a00165.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(index,ndims,0);</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;      <span class="keywordflow">while</span> (!done) {</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        <span class="keywordtype">int</span> p1; <a class="code" href="a00165.html#a0739cb538f4d301fad3b45059ddd0738">_ArrayIndex1DWO_</a>(ndims,dim,index,offset,ghosts,p1);</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        <span class="keywordtype">int</span> p2; <a class="code" href="a00165.html#afbb862a2fdf5b72b1f9ace42f64b556f">_ArrayIndex1D_</a>(ndims,bounds,index,0,p2);</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <a class="code" href="a00165.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>((recvbuf+2*d*stride+nvars*p2),(var+nvars*p1),nvars);</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        <a class="code" href="a00165.html#ac5ec1371623f11d03b0f42adaa24acbc">_ArrayIncrementIndex_</a>(ndims,bounds,index,done);</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;      }</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    }</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="keywordflow">if</span> (neighbor_rank[2*d+1] != -1) {</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;      <a class="code" href="a00165.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(offset,ndims,0); offset[d] = dim[d];</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      <span class="keywordtype">int</span> done = 0; <a class="code" href="a00165.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(index,ndims,0);</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;      <span class="keywordflow">while</span> (!done) {</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <span class="keywordtype">int</span> p1; <a class="code" href="a00165.html#a0739cb538f4d301fad3b45059ddd0738">_ArrayIndex1DWO_</a>(ndims,dim,index,offset,ghosts,p1);</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        <span class="keywordtype">int</span> p2; <a class="code" href="a00165.html#afbb862a2fdf5b72b1f9ace42f64b556f">_ArrayIndex1D_</a>(ndims,bounds,index,0,p2);</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        <a class="code" href="a00165.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>((recvbuf+(2*d+1)*stride+nvars*p2),(var+nvars*p1),nvars);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        <a class="code" href="a00165.html#ac5ec1371623f11d03b0f42adaa24acbc">_ArrayIncrementIndex_</a>(ndims,bounds,index,done);</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      }</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    }</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  }</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  </div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  <span class="comment">/* Wait till send requests are complete before freeing memory */</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  MPI_Waitall(2*ndims,sndreq,MPI_STATUS_IGNORE);</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;}</div>
<div class="ttc" id="a00146_html_a0be0f30a83bc3f3d9f6ee3a36bbf2716"><div class="ttname"><a href="a00146.html#a0be0f30a83bc3f3d9f6ee3a36bbf2716">MPIVariables::iproc</a></div><div class="ttdeci">int * iproc</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00027">mpivars_struct.h:27</a></div></div>
<div class="ttc" id="a00146_html_aa3c28612a64b8a97bde66b720e15c700"><div class="ttname"><a href="a00146.html#aa3c28612a64b8a97bde66b720e15c700">MPIVariables::ip</a></div><div class="ttdeci">int * ip</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00028">mpivars_struct.h:28</a></div></div>
<div class="ttc" id="a00165_html_a89e8330d9e06dd0666c50833628a125c"><div class="ttname"><a href="a00165.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a></div><div class="ttdeci">#define _ArrayCopy1D_(x, y, size)</div><div class="ttdef"><b>Definition:</b> <a href="a00165_source.html#l00318">arrayfunctions.h:318</a></div></div>
<div class="ttc" id="a00165_html_a2b2826031c0cd92495ab351d3e599fc5"><div class="ttname"><a href="a00165.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a></div><div class="ttdeci">#define _ArraySetValue_(x, size, value)</div><div class="ttdef"><b>Definition:</b> <a href="a00165_source.html#l00168">arrayfunctions.h:168</a></div></div>
<div class="ttc" id="a00165_html_ac5ec1371623f11d03b0f42adaa24acbc"><div class="ttname"><a href="a00165.html#ac5ec1371623f11d03b0f42adaa24acbc">_ArrayIncrementIndex_</a></div><div class="ttdeci">#define _ArrayIncrementIndex_(N, imax, i, done)</div><div class="ttdef"><b>Definition:</b> <a href="a00165_source.html#l00125">arrayfunctions.h:125</a></div></div>
<div class="ttc" id="a00146_html_aba3b15034da676474db917f9f5533085"><div class="ttname"><a href="a00146.html#aba3b15034da676474db917f9f5533085">MPIVariables::sendbuf</a></div><div class="ttdeci">double * sendbuf</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00051">mpivars_struct.h:51</a></div></div>
<div class="ttc" id="a00181_html_a36e2be86c7dc0d9dd088ed2f5842f556"><div class="ttname"><a href="a00181.html#a36e2be86c7dc0d9dd088ed2f5842f556">MPIRank1D</a></div><div class="ttdeci">int MPIRank1D(int, int *, int *)</div><div class="ttdef"><b>Definition:</b> <a href="a00312_source.html#l00026">MPIRank1D.c:26</a></div></div>
<div class="ttc" id="a00146_html_adad7a6f85831f3ac84d854b6c80aef43"><div class="ttname"><a href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">MPIVariables::world</a></div><div class="ttdeci">MPI_Comm world</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00037">mpivars_struct.h:37</a></div></div>
<div class="ttc" id="a00146_html_afc23e46e08649e112e8d64d780cea5cb"><div class="ttname"><a href="a00146.html#afc23e46e08649e112e8d64d780cea5cb">MPIVariables::recvbuf</a></div><div class="ttdeci">double * recvbuf</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00051">mpivars_struct.h:51</a></div></div>
<div class="ttc" id="a00146_html_af40a5a3066fdb53a47e4627071abc2bc"><div class="ttname"><a href="a00146.html#af40a5a3066fdb53a47e4627071abc2bc">MPIVariables::bcperiodic</a></div><div class="ttdeci">int * bcperiodic</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00031">mpivars_struct.h:31</a></div></div>
<div class="ttc" id="a00165_html_afbb862a2fdf5b72b1f9ace42f64b556f"><div class="ttname"><a href="a00165.html#afbb862a2fdf5b72b1f9ace42f64b556f">_ArrayIndex1D_</a></div><div class="ttdeci">#define _ArrayIndex1D_(N, imax, i, ghost, index)</div><div class="ttdef"><b>Definition:</b> <a href="a00165_source.html#l00039">arrayfunctions.h:39</a></div></div>
<div class="ttc" id="a00165_html_a0739cb538f4d301fad3b45059ddd0738"><div class="ttname"><a href="a00165.html#a0739cb538f4d301fad3b45059ddd0738">_ArrayIndex1DWO_</a></div><div class="ttdeci">#define _ArrayIndex1DWO_(N, imax, i, offset, ghost, index)</div><div class="ttdef"><b>Definition:</b> <a href="a00165_source.html#l00082">arrayfunctions.h:82</a></div></div>
<div class="ttc" id="a00146_html_a00559"><div class="ttname"><a href="a00146.html#a00559">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00024">mpivars_struct.h:24</a></div></div>
<div class="ttc" id="a00146_html_a4c12bdea025b404c7dd79f368fc03efd"><div class="ttname"><a href="a00146.html#a4c12bdea025b404c7dd79f368fc03efd">MPIVariables::maxbuf</a></div><div class="ttdeci">int maxbuf</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00053">mpivars_struct.h:53</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac4c9e0736d7419f96307c6e6298d3f45"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int MPIGatherArray1D </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>xg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>istart</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>iend</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>N_local</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ghosts</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Gather local arrays into a global array for an essentially 1D array</p>
<p>Gathers the contents of a 1D array (partitioned amongst MPI ranks) into a global 1D array on the root rank (rank 0). See documentation of <a class="el" href="a00181.html#ac2f0cce702a9ce439753286ce227c7a2">MPIExchangeBoundaries1D()</a> on what a "1D 
array" is in the context of a multidimensional simulation. The 1D array must be the same along spatial dimensions normal to the one it represents.</p>
<p>Notes:</p><ul>
<li>The global array must not have ghost points.</li>
<li>The global array must be preallocated on only rank 0. On other ranks, it must be NULL.</li>
<li>Since this function deals with a 1D array, more than one rank may be sending the same piece of data to rank 0 (i.e. if there are more than one MPI rank along the dimensions normal to one corresponding to <em>x</em> ). The implementation of this function ignores this and overwrites that portion with the latest data sent. </li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">m</td><td>MPI object of type <a class="el" href="a00146.html#a00559" title="Structure of MPI-related variables. ">MPIVariables</a> </td></tr>
    <tr><td class="paramname">xg</td><td>Global 1D array (must be preallocated) without ghost points </td></tr>
    <tr><td class="paramname">x</td><td>Local 1D array to be gathered </td></tr>
    <tr><td class="paramname">istart</td><td>Starting index (global) of this rank's portion of the array </td></tr>
    <tr><td class="paramname">iend</td><td>Ending index (global) of this rank's portion of the array + 1 </td></tr>
    <tr><td class="paramname">N_local</td><td>Local size of the array </td></tr>
    <tr><td class="paramname">ghosts</td><td>Number of ghost points </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00301_source.html#l00026">26</a> of file <a class="el" href="a00301_source.html">MPIGatherArray1D.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;{</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  <a class="code" href="a00146.html#a00559">MPIVariables</a> *mpi = (<a class="code" href="a00146.html#a00559">MPIVariables</a>*) m;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  <span class="keywordtype">int</span>          ierr = 0;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  <span class="comment">/* xg should be non-null only on root */</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <span class="keywordflow">if</span> (mpi-&gt;<a class="code" href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a> &amp;&amp; xg) {</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    fprintf(stderr,<span class="stringliteral">&quot;Error in MPIGatherArray1D(): global array exists on non-root processors (rank %d).\n&quot;</span>,</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;            mpi-&gt;<a class="code" href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>);</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    ierr = 1;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  }</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  <span class="keywordflow">if</span> ((!mpi-&gt;<a class="code" href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) &amp;&amp; (!xg)) {</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    fprintf(stderr,<span class="stringliteral">&quot;Error in MPIGatherArray1D(): global array is not allocated on root processor.\n&quot;</span>);</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    ierr = 1;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  }</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="comment">/* create and copy data to a buffer to send to the root process */</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <span class="keywordtype">double</span> *buffer = (<span class="keywordtype">double</span>*) calloc (N_local,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <a class="code" href="a00165.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>((x+ghosts),(buffer),N_local);</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) {</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">#ifndef serial</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    MPI_Status status;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="keywordtype">int</span> proc;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="keywordflow">for</span> (proc = 0; proc &lt; mpi-&gt;<a class="code" href="a00146.html#ae68326adc3b3862f1162832f70727b06">nproc</a>; proc++) {</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;      <span class="comment">/* Find out the domain limits for each process */</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;      <span class="keywordtype">int</span> is,ie;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;      <span class="keywordflow">if</span> (proc) {</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="preprocessor">#ifndef serial</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        MPI_Recv(&amp;is,1,MPI_INT,proc,1442,mpi-&gt;<a class="code" href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>,&amp;status);</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        MPI_Recv(&amp;ie,1,MPI_INT,proc,1443,mpi-&gt;<a class="code" href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>,&amp;status);</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;      } <span class="keywordflow">else</span> { is = istart; ie = iend; }</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;      <span class="keywordtype">int</span> size = ie - is;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;      <span class="keywordflow">if</span> (proc) {</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="preprocessor">#ifndef serial</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        <span class="keywordtype">double</span> *recvbuf = (<span class="keywordtype">double</span>*) calloc (size,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        MPI_Recv(recvbuf,size,MPI_DOUBLE,proc,1916,mpi-&gt;<a class="code" href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>,&amp;status);</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        <a class="code" href="a00165.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>((recvbuf),(xg+is),size);</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        free(recvbuf);</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;      } <span class="keywordflow">else</span> <a class="code" href="a00165.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>(buffer,(xg+is),size);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    }</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="preprocessor">#ifndef serial</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="comment">/* Meanwhile, on other processes - send stuff to root */</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    MPI_Send(&amp;istart,1      ,MPI_INT   ,0,1442,mpi-&gt;<a class="code" href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    MPI_Send(&amp;iend  ,1      ,MPI_INT   ,0,1443,mpi-&gt;<a class="code" href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    MPI_Send(buffer ,N_local,MPI_DOUBLE,0,1916,mpi-&gt;<a class="code" href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  }</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  free(buffer);</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <span class="keywordflow">return</span>(ierr);</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;}</div>
<div class="ttc" id="a00146_html_ae68326adc3b3862f1162832f70727b06"><div class="ttname"><a href="a00146.html#ae68326adc3b3862f1162832f70727b06">MPIVariables::nproc</a></div><div class="ttdeci">int nproc</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00026">mpivars_struct.h:26</a></div></div>
<div class="ttc" id="a00146_html_a6cfd95afd0afebd625b889fb6e58371c"><div class="ttname"><a href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">MPIVariables::rank</a></div><div class="ttdeci">int rank</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00025">mpivars_struct.h:25</a></div></div>
<div class="ttc" id="a00165_html_a89e8330d9e06dd0666c50833628a125c"><div class="ttname"><a href="a00165.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a></div><div class="ttdeci">#define _ArrayCopy1D_(x, y, size)</div><div class="ttdef"><b>Definition:</b> <a href="a00165_source.html#l00318">arrayfunctions.h:318</a></div></div>
<div class="ttc" id="a00146_html_adad7a6f85831f3ac84d854b6c80aef43"><div class="ttname"><a href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">MPIVariables::world</a></div><div class="ttdeci">MPI_Comm world</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00037">mpivars_struct.h:37</a></div></div>
<div class="ttc" id="a00146_html_a00559"><div class="ttname"><a href="a00146.html#a00559">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00024">mpivars_struct.h:24</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4cea2f7d5b8d6fad35c84c59da86631a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int MPIGatherArraynD </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ndims</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>xg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>dim_global</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>dim_local</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ghosts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nvars</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Gather local arrays into a global array for an n-dimensional array</p>
<p>Gathers the contents of an n-dimensional array, partitioned amongst the MPI ranks, in to a global array on rank 0. See documentation of <a class="el" href="a00181.html#a60ace5964c051fa481e6a1e6f1ef75d7">MPIExchangeBoundariesnD()</a> for how the n-dimensional array is stored in the memory as a single-index array.</p>
<p>Notes:</p><ul>
<li>The global array must have no ghost points.</li>
<li>The global array must be allocated only on rank 0. On other ranks, it must be NULL. </li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ndims</td><td>Number of spatial dimensions </td></tr>
    <tr><td class="paramname">m</td><td>MPI object of type <a class="el" href="a00146.html#a00559" title="Structure of MPI-related variables. ">MPIVariables</a> </td></tr>
    <tr><td class="paramname">xg</td><td>Global array (preallocated) without ghost points </td></tr>
    <tr><td class="paramname">x</td><td>Local array </td></tr>
    <tr><td class="paramname">dim_global</td><td>Integer array with elements as global size along each spatial dimension </td></tr>
    <tr><td class="paramname">dim_local</td><td>Integer array with elements as local size along each spatial dimension </td></tr>
    <tr><td class="paramname">ghosts</td><td>Number of ghost points </td></tr>
    <tr><td class="paramname">nvars</td><td>Number of variables (vector components) </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00302_source.html#l00021">21</a> of file <a class="el" href="a00302_source.html">MPIGatherArraynD.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;{</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  <a class="code" href="a00146.html#a00559">MPIVariables</a> *mpi = (<a class="code" href="a00146.html#a00559">MPIVariables</a>*) m;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  <span class="keywordtype">int</span>          d, size;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <a class="code" href="a00166.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a>;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  <span class="keywordtype">int</span> is[ndims], ie[ndims], index[ndims], bounds[ndims];</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <span class="comment">/* xg should be non-null only on root */</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  <span class="keywordflow">if</span> (mpi-&gt;<a class="code" href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a> &amp;&amp; xg) {</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    fprintf(stderr,<span class="stringliteral">&quot;Error in MPIGatherArraynD(): global array exists on non-root processors (rank %d).\n&quot;</span>,</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;            mpi-&gt;<a class="code" href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>);</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  }</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  <span class="keywordflow">if</span> ((!mpi-&gt;<a class="code" href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) &amp;&amp; (!xg)) {</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    fprintf(stderr,<span class="stringliteral">&quot;Error in MPIGatherArraynD(): global array is not allocated on root processor.\n&quot;</span>);</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  }</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  <span class="comment">/* calculate total size of local domain (w/o ghosts) */</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  size = 1;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <span class="keywordflow">for</span> (d = 0; d &lt; ndims; d++) size *= dim_local[d];</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <span class="comment">/* create and copy data to send to root process */</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <span class="keywordtype">double</span> *buffer = (<span class="keywordtype">double</span>*) calloc (size*nvars, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  <a class="code" href="a00166.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00165.html#ac4ae1109cf287763cef63cc38d52589f">ArrayCopynD</a>(ndims,x,buffer,dim_local,ghosts,0,index,nvars); <a class="code" href="a00166.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) {</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="keywordtype">int</span> proc;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="keywordflow">for</span> (proc = 0; proc &lt; mpi-&gt;<a class="code" href="a00146.html#ae68326adc3b3862f1162832f70727b06">nproc</a>; proc++) {</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;      <span class="keywordtype">int</span> d,done,size;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;      <span class="comment">/* Find out the domain limits for each process */</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;      <a class="code" href="a00166.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00181.html#a9a3fc32b7d4bea6a1dac44ab21c9202e">MPILocalDomainLimits</a>(ndims,proc,mpi,dim_global,is,ie); <a class="code" href="a00166.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;      size = 1;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;      <span class="keywordflow">for</span> (d=0; d&lt;ndims; d++) {</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        size *= (ie[d]-is[d]);</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        bounds[d] = ie[d] - is[d];</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;      }</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;      <span class="keywordflow">if</span> (proc) {</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="preprocessor">#ifndef serial</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        MPI_Status status;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        <span class="keywordtype">double</span> *recvbuf = (<span class="keywordtype">double</span>*) calloc (size*nvars, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        MPI_Recv(recvbuf,size*nvars,MPI_DOUBLE,proc,1902,mpi-&gt;<a class="code" href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>,&amp;status);</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        <span class="keywordtype">int</span> done = 0; <a class="code" href="a00165.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(index,ndims,0);</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        <span class="keywordflow">while</span> (!done) {</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;          <span class="keywordtype">int</span> p1; <a class="code" href="a00165.html#afbb862a2fdf5b72b1f9ace42f64b556f">_ArrayIndex1D_</a>(ndims,bounds,index,0,p1);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;          <span class="keywordtype">int</span> p2; <a class="code" href="a00165.html#a0739cb538f4d301fad3b45059ddd0738">_ArrayIndex1DWO_</a>(ndims,dim_global,index,is,0,p2);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;          <a class="code" href="a00165.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>((recvbuf+nvars*p1),(xg+nvars*p2),nvars);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;          <a class="code" href="a00165.html#ac5ec1371623f11d03b0f42adaa24acbc">_ArrayIncrementIndex_</a>(ndims,bounds,index,done);</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        }</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        free(recvbuf);</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        done = 0; <a class="code" href="a00165.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(index,ndims,0);</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        <span class="keywordflow">while</span> (!done) {</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;          <span class="keywordtype">int</span> p1; <a class="code" href="a00165.html#afbb862a2fdf5b72b1f9ace42f64b556f">_ArrayIndex1D_</a>(ndims,bounds,index,0,p1);</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;          <span class="keywordtype">int</span> p2; <a class="code" href="a00165.html#a0739cb538f4d301fad3b45059ddd0738">_ArrayIndex1DWO_</a>(ndims,dim_global,index,is,0,p2);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;          <a class="code" href="a00165.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>((buffer+nvars*p1),(xg+nvars*p2),nvars);</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;          <a class="code" href="a00165.html#ac5ec1371623f11d03b0f42adaa24acbc">_ArrayIncrementIndex_</a>(ndims,bounds,index,done);</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        }</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;      }</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    }</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="preprocessor">#ifndef serial</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="comment">/* Meanwhile, on other processes */</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    MPI_Send(buffer,size*nvars,MPI_DOUBLE,0,1902,mpi-&gt;<a class="code" href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  }</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  free(buffer);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;}</div>
<div class="ttc" id="a00146_html_ae68326adc3b3862f1162832f70727b06"><div class="ttname"><a href="a00146.html#ae68326adc3b3862f1162832f70727b06">MPIVariables::nproc</a></div><div class="ttdeci">int nproc</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00026">mpivars_struct.h:26</a></div></div>
<div class="ttc" id="a00146_html_a6cfd95afd0afebd625b889fb6e58371c"><div class="ttname"><a href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">MPIVariables::rank</a></div><div class="ttdeci">int rank</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00025">mpivars_struct.h:25</a></div></div>
<div class="ttc" id="a00181_html_a9a3fc32b7d4bea6a1dac44ab21c9202e"><div class="ttname"><a href="a00181.html#a9a3fc32b7d4bea6a1dac44ab21c9202e">MPILocalDomainLimits</a></div><div class="ttdeci">int MPILocalDomainLimits(int, int, void *, int *, int *, int *)</div><div class="ttdef"><b>Definition:</b> <a href="a00306_source.html#l00018">MPILocalDomainLimits.c:18</a></div></div>
<div class="ttc" id="a00165_html_a89e8330d9e06dd0666c50833628a125c"><div class="ttname"><a href="a00165.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a></div><div class="ttdeci">#define _ArrayCopy1D_(x, y, size)</div><div class="ttdef"><b>Definition:</b> <a href="a00165_source.html#l00318">arrayfunctions.h:318</a></div></div>
<div class="ttc" id="a00165_html_ac4ae1109cf287763cef63cc38d52589f"><div class="ttname"><a href="a00165.html#ac4ae1109cf287763cef63cc38d52589f">ArrayCopynD</a></div><div class="ttdeci">INLINE int ArrayCopynD(int, double *, double *, int *, int, int, int *, int)</div><div class="ttdef"><b>Definition:</b> <a href="a00165_source.html#l00407">arrayfunctions.h:407</a></div></div>
<div class="ttc" id="a00165_html_a2b2826031c0cd92495ab351d3e599fc5"><div class="ttname"><a href="a00165.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a></div><div class="ttdeci">#define _ArraySetValue_(x, size, value)</div><div class="ttdef"><b>Definition:</b> <a href="a00165_source.html#l00168">arrayfunctions.h:168</a></div></div>
<div class="ttc" id="a00166_html_add9cf96ae374934d245a1dc1ab697a42"><div class="ttname"><a href="a00166.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a></div><div class="ttdeci">#define CHECKERR(ierr)</div><div class="ttdef"><b>Definition:</b> <a href="a00166_source.html#l00014">basic.h:14</a></div></div>
<div class="ttc" id="a00165_html_ac5ec1371623f11d03b0f42adaa24acbc"><div class="ttname"><a href="a00165.html#ac5ec1371623f11d03b0f42adaa24acbc">_ArrayIncrementIndex_</a></div><div class="ttdeci">#define _ArrayIncrementIndex_(N, imax, i, done)</div><div class="ttdef"><b>Definition:</b> <a href="a00165_source.html#l00125">arrayfunctions.h:125</a></div></div>
<div class="ttc" id="a00166_html_a68f50121fb9a7daeaf60e50cdef82ef3"><div class="ttname"><a href="a00166.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a></div><div class="ttdeci">#define _DECLARE_IERR_</div><div class="ttdef"><b>Definition:</b> <a href="a00166_source.html#l00013">basic.h:13</a></div></div>
<div class="ttc" id="a00166_html_ad6ab74942c9de13cf0b4c12eb0d91780"><div class="ttname"><a href="a00166.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a></div><div class="ttdeci">#define IERR</div><div class="ttdef"><b>Definition:</b> <a href="a00166_source.html#l00012">basic.h:12</a></div></div>
<div class="ttc" id="a00146_html_adad7a6f85831f3ac84d854b6c80aef43"><div class="ttname"><a href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">MPIVariables::world</a></div><div class="ttdeci">MPI_Comm world</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00037">mpivars_struct.h:37</a></div></div>
<div class="ttc" id="a00165_html_afbb862a2fdf5b72b1f9ace42f64b556f"><div class="ttname"><a href="a00165.html#afbb862a2fdf5b72b1f9ace42f64b556f">_ArrayIndex1D_</a></div><div class="ttdeci">#define _ArrayIndex1D_(N, imax, i, ghost, index)</div><div class="ttdef"><b>Definition:</b> <a href="a00165_source.html#l00039">arrayfunctions.h:39</a></div></div>
<div class="ttc" id="a00165_html_a0739cb538f4d301fad3b45059ddd0738"><div class="ttname"><a href="a00165.html#a0739cb538f4d301fad3b45059ddd0738">_ArrayIndex1DWO_</a></div><div class="ttdeci">#define _ArrayIndex1DWO_(N, imax, i, offset, ghost, index)</div><div class="ttdef"><b>Definition:</b> <a href="a00165_source.html#l00082">arrayfunctions.h:82</a></div></div>
<div class="ttc" id="a00146_html_a00559"><div class="ttname"><a href="a00146.html#a00559">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00024">mpivars_struct.h:24</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a81ef82bfd40dff69eb5b975c102133f2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int MPIGatherArraynDwGhosts </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ndims</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>xg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>dim_global</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>dim_local</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ghosts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nvars</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Gather local arrays into a global array for an n-dimensional array (with ghosts)</p>
<p>Gathers the contents of an n-dimensional array, partitioned amongst the MPI ranks, in to a global array on rank 0. See documentation of <a class="el" href="a00181.html#a60ace5964c051fa481e6a1e6f1ef75d7">MPIExchangeBoundariesnD()</a> for how the n-dimensional array is stored in the memory as a single-index array. This is same as <a class="el" href="a00302.html#a169eaecbc7a45469c78354f9cb1fed64">MPIGatherArraynD()</a> but where the global array <em>has</em> ghost points.</p>
<p>Notes:</p><ul>
<li>The global array must have ghost points (the same number as the local arrays).</li>
<li>The global array must be allocated only on rank 0. On other ranks, it must be NULL. </li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ndims</td><td>Number of spatial dimensions </td></tr>
    <tr><td class="paramname">m</td><td>MPI object of type <a class="el" href="a00146.html#a00559" title="Structure of MPI-related variables. ">MPIVariables</a> </td></tr>
    <tr><td class="paramname">xg</td><td>Global array (preallocated) with ghost points </td></tr>
    <tr><td class="paramname">x</td><td>Local array </td></tr>
    <tr><td class="paramname">dim_global</td><td>Integer array with elements as global size along each spatial dimension </td></tr>
    <tr><td class="paramname">dim_local</td><td>Integer array with elements as local size along each spatial dimension </td></tr>
    <tr><td class="paramname">ghosts</td><td>Number of ghost points </td></tr>
    <tr><td class="paramname">nvars</td><td>Number of variables (vector components) </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00302_source.html#l00115">115</a> of file <a class="el" href="a00302_source.html">MPIGatherArraynD.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;{</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <a class="code" href="a00146.html#a00559">MPIVariables</a> *mpi = (<a class="code" href="a00146.html#a00559">MPIVariables</a>*) m;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <span class="keywordtype">int</span>          d, size;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  <a class="code" href="a00166.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a>;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  <span class="comment">/* do an exchange to make sure interior/periodic ghost points are filled with consistent values */</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <a class="code" href="a00166.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00181.html#a60ace5964c051fa481e6a1e6f1ef75d7">MPIExchangeBoundariesnD</a>(ndims, nvars, dim_local, ghosts, mpi, x);</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="keywordtype">int</span> is[ndims], ie[ndims], index[ndims], bounds[ndims];</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  <span class="keywordtype">int</span> dim_global_wghosts[ndims];</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  <span class="keywordflow">for</span> (d = 0; d &lt; ndims; d++) dim_global_wghosts[d] = dim_global[d] + 2*ghosts;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <span class="comment">/* xg should be non-null only on root */</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  <span class="keywordflow">if</span> (mpi-&gt;<a class="code" href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a> &amp;&amp; xg) {</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    fprintf(stderr,<span class="stringliteral">&quot;Error in MPIGatherArraynD(): global array exists on non-root processors (rank %d).\n&quot;</span>,</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;            mpi-&gt;<a class="code" href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>);</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  }</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <span class="keywordflow">if</span> ((!mpi-&gt;<a class="code" href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) &amp;&amp; (!xg)) {</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    fprintf(stderr,<span class="stringliteral">&quot;Error in MPIGatherArraynD(): global array is not allocated on root processor.\n&quot;</span>);</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  }</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  <span class="comment">/* calculate total size of local domain (w/ ghosts) */</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  size = 1;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  <span class="keywordflow">for</span> (d = 0; d &lt; ndims; d++) size *= (dim_local[d]+2*ghosts);</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  <span class="comment">/* create and copy data (incl. ghost points) to send to root process */</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <span class="keywordtype">double</span> *buffer = (<span class="keywordtype">double</span>*) calloc (size*nvars, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  <a class="code" href="a00165.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>(x, buffer, size*nvars);</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) {</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="keywordtype">int</span> proc;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="keywordflow">for</span> (proc = 0; proc &lt; mpi-&gt;<a class="code" href="a00146.html#ae68326adc3b3862f1162832f70727b06">nproc</a>; proc++) {</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      <span class="keywordtype">int</span> d,done;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;      <span class="comment">/* Find out the domain limits for each process */</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;      <a class="code" href="a00166.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00181.html#a9a3fc32b7d4bea6a1dac44ab21c9202e">MPILocalDomainLimits</a>(ndims,proc,mpi,dim_global,is,ie); <a class="code" href="a00166.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;      <span class="keywordflow">for</span> (d=0; d&lt;ndims; d++) {</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        bounds[d] = ie[d] - is[d];</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;      }</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      <span class="keywordflow">if</span> (proc) {</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="preprocessor">#ifndef serial</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        <span class="keywordtype">int</span> size = 1;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        <span class="keywordflow">for</span> (d=0; d&lt;ndims; d++) {</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;          size *= (ie[d]-is[d]+2*ghosts);</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;          bounds[d] = ie[d] - is[d];</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        }</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        MPI_Status status;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        <span class="keywordtype">double</span> *recvbuf = (<span class="keywordtype">double</span>*) calloc (size*nvars, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        MPI_Recv(recvbuf,size*nvars,MPI_DOUBLE,proc,1902,mpi-&gt;<a class="code" href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>,&amp;status);</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        <span class="keywordtype">int</span> done = 0; <a class="code" href="a00165.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(index,ndims,0);</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        <span class="keywordflow">while</span> (!done) {</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;          <span class="keywordtype">int</span> p1; <a class="code" href="a00165.html#afbb862a2fdf5b72b1f9ace42f64b556f">_ArrayIndex1D_</a>(ndims,bounds,index,ghosts,p1);</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;          <span class="keywordtype">int</span> p2; <a class="code" href="a00165.html#a0739cb538f4d301fad3b45059ddd0738">_ArrayIndex1DWO_</a>(ndims,dim_global,index,is,ghosts,p2);</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;          <a class="code" href="a00165.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>((recvbuf+nvars*p1),(xg+nvars*p2),nvars);</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;          <a class="code" href="a00165.html#ac5ec1371623f11d03b0f42adaa24acbc">_ArrayIncrementIndex_</a>(ndims,bounds,index,done);</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        }</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        free(recvbuf);</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        done = 0; <a class="code" href="a00165.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(index,ndims,0);</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        <span class="keywordflow">while</span> (!done) {</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;          <span class="keywordtype">int</span> p1; <a class="code" href="a00165.html#afbb862a2fdf5b72b1f9ace42f64b556f">_ArrayIndex1D_</a>(ndims,bounds,index,ghosts,p1);</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;          <span class="keywordtype">int</span> p2; <a class="code" href="a00165.html#a0739cb538f4d301fad3b45059ddd0738">_ArrayIndex1DWO_</a>(ndims,dim_global,index,is,ghosts,p2);</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;          <a class="code" href="a00165.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>((buffer+nvars*p1),(xg+nvars*p2),nvars);</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;          <a class="code" href="a00165.html#ac5ec1371623f11d03b0f42adaa24acbc">_ArrayIncrementIndex_</a>(ndims,bounds,index,done);</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        }</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      }</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    }</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="preprocessor">#ifndef serial</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="comment">/* Meanwhile, on other processes */</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    MPI_Send(buffer,size*nvars,MPI_DOUBLE,0,1902,mpi-&gt;<a class="code" href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  }</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  free(buffer);</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;}</div>
<div class="ttc" id="a00146_html_ae68326adc3b3862f1162832f70727b06"><div class="ttname"><a href="a00146.html#ae68326adc3b3862f1162832f70727b06">MPIVariables::nproc</a></div><div class="ttdeci">int nproc</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00026">mpivars_struct.h:26</a></div></div>
<div class="ttc" id="a00146_html_a6cfd95afd0afebd625b889fb6e58371c"><div class="ttname"><a href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">MPIVariables::rank</a></div><div class="ttdeci">int rank</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00025">mpivars_struct.h:25</a></div></div>
<div class="ttc" id="a00181_html_a9a3fc32b7d4bea6a1dac44ab21c9202e"><div class="ttname"><a href="a00181.html#a9a3fc32b7d4bea6a1dac44ab21c9202e">MPILocalDomainLimits</a></div><div class="ttdeci">int MPILocalDomainLimits(int, int, void *, int *, int *, int *)</div><div class="ttdef"><b>Definition:</b> <a href="a00306_source.html#l00018">MPILocalDomainLimits.c:18</a></div></div>
<div class="ttc" id="a00165_html_a89e8330d9e06dd0666c50833628a125c"><div class="ttname"><a href="a00165.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a></div><div class="ttdeci">#define _ArrayCopy1D_(x, y, size)</div><div class="ttdef"><b>Definition:</b> <a href="a00165_source.html#l00318">arrayfunctions.h:318</a></div></div>
<div class="ttc" id="a00165_html_a2b2826031c0cd92495ab351d3e599fc5"><div class="ttname"><a href="a00165.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a></div><div class="ttdeci">#define _ArraySetValue_(x, size, value)</div><div class="ttdef"><b>Definition:</b> <a href="a00165_source.html#l00168">arrayfunctions.h:168</a></div></div>
<div class="ttc" id="a00166_html_add9cf96ae374934d245a1dc1ab697a42"><div class="ttname"><a href="a00166.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a></div><div class="ttdeci">#define CHECKERR(ierr)</div><div class="ttdef"><b>Definition:</b> <a href="a00166_source.html#l00014">basic.h:14</a></div></div>
<div class="ttc" id="a00165_html_ac5ec1371623f11d03b0f42adaa24acbc"><div class="ttname"><a href="a00165.html#ac5ec1371623f11d03b0f42adaa24acbc">_ArrayIncrementIndex_</a></div><div class="ttdeci">#define _ArrayIncrementIndex_(N, imax, i, done)</div><div class="ttdef"><b>Definition:</b> <a href="a00165_source.html#l00125">arrayfunctions.h:125</a></div></div>
<div class="ttc" id="a00166_html_a68f50121fb9a7daeaf60e50cdef82ef3"><div class="ttname"><a href="a00166.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a></div><div class="ttdeci">#define _DECLARE_IERR_</div><div class="ttdef"><b>Definition:</b> <a href="a00166_source.html#l00013">basic.h:13</a></div></div>
<div class="ttc" id="a00166_html_ad6ab74942c9de13cf0b4c12eb0d91780"><div class="ttname"><a href="a00166.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a></div><div class="ttdeci">#define IERR</div><div class="ttdef"><b>Definition:</b> <a href="a00166_source.html#l00012">basic.h:12</a></div></div>
<div class="ttc" id="a00146_html_adad7a6f85831f3ac84d854b6c80aef43"><div class="ttname"><a href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">MPIVariables::world</a></div><div class="ttdeci">MPI_Comm world</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00037">mpivars_struct.h:37</a></div></div>
<div class="ttc" id="a00181_html_a60ace5964c051fa481e6a1e6f1ef75d7"><div class="ttname"><a href="a00181.html#a60ace5964c051fa481e6a1e6f1ef75d7">MPIExchangeBoundariesnD</a></div><div class="ttdeci">int MPIExchangeBoundariesnD(int, int, int *, int, void *, double *)</div><div class="ttdef"><b>Definition:</b> <a href="a00300_source.html#l00042">MPIExchangeBoundariesnD.c:42</a></div></div>
<div class="ttc" id="a00165_html_afbb862a2fdf5b72b1f9ace42f64b556f"><div class="ttname"><a href="a00165.html#afbb862a2fdf5b72b1f9ace42f64b556f">_ArrayIndex1D_</a></div><div class="ttdeci">#define _ArrayIndex1D_(N, imax, i, ghost, index)</div><div class="ttdef"><b>Definition:</b> <a href="a00165_source.html#l00039">arrayfunctions.h:39</a></div></div>
<div class="ttc" id="a00165_html_a0739cb538f4d301fad3b45059ddd0738"><div class="ttname"><a href="a00165.html#a0739cb538f4d301fad3b45059ddd0738">_ArrayIndex1DWO_</a></div><div class="ttdeci">#define _ArrayIndex1DWO_(N, imax, i, offset, ghost, index)</div><div class="ttdef"><b>Definition:</b> <a href="a00165_source.html#l00082">arrayfunctions.h:82</a></div></div>
<div class="ttc" id="a00146_html_a00559"><div class="ttname"><a href="a00146.html#a00559">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00024">mpivars_struct.h:24</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a690395a8c8453cdfb455de275a46be07"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int MPIPartitionArraynD </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ndims</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>xg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>dim_global</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>dim_local</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ghosts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nvars</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Partition a global array into local arrays for an n-dimensional array</p>
<p>Partitions the contents of a global n-dimensional array on rank 0 (root) to local n-dimensional arrays on all the MPI ranks. See documentation of <a class="el" href="a00181.html#a60ace5964c051fa481e6a1e6f1ef75d7">MPIExchangeBoundariesnD()</a> for how the n-dimensional array is stored in the memory as a single-index array.</p>
<p>Notes:</p><ul>
<li>The global array must have no ghost points.</li>
<li>The global array must be allocated only on rank 0. On other ranks, it must be NULL. </li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ndims</td><td>Number of spatial dimensions </td></tr>
    <tr><td class="paramname">m</td><td>MPI object of type <a class="el" href="a00146.html#a00559" title="Structure of MPI-related variables. ">MPIVariables</a> </td></tr>
    <tr><td class="paramname">xg</td><td>Global array (preallocated) without ghost points </td></tr>
    <tr><td class="paramname">x</td><td>Local array </td></tr>
    <tr><td class="paramname">dim_global</td><td>Integer array with elements as global size along each spatial dimension </td></tr>
    <tr><td class="paramname">dim_local</td><td>Integer array with elements as local size along each spatial dimension </td></tr>
    <tr><td class="paramname">ghosts</td><td>Number of ghost points </td></tr>
    <tr><td class="paramname">nvars</td><td>Number of variables (vector components) </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00311_source.html#l00021">21</a> of file <a class="el" href="a00311_source.html">MPIPartitionArraynD.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;{</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  <a class="code" href="a00146.html#a00559">MPIVariables</a> *mpi = (<a class="code" href="a00146.html#a00559">MPIVariables</a>*) m;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  <a class="code" href="a00166.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a>;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  <span class="keywordtype">int</span> is[ndims], ie[ndims], index[ndims], bounds[ndims];</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  <span class="comment">/* xg should be non-null only on root */</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <span class="keywordflow">if</span> (mpi-&gt;<a class="code" href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a> &amp;&amp; xg) {</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    fprintf(stderr,<span class="stringliteral">&quot;Error in MPIPartitionArraynD(): global array exists on non-root processors (rank %d).\n&quot;</span>,</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;            mpi-&gt;<a class="code" href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>);</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  }</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  <span class="keywordflow">if</span> ((!mpi-&gt;<a class="code" href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) &amp;&amp; (!xg)) {</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    fprintf(stderr,<span class="stringliteral">&quot;Error in MPIPartitionArraynD(): global array is not allocated on root processor.\n&quot;</span>);</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  }</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) {</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="keywordtype">int</span> proc;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="keywordflow">for</span> (proc = 0; proc &lt; mpi-&gt;<a class="code" href="a00146.html#ae68326adc3b3862f1162832f70727b06">nproc</a>; proc++) {</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;      <span class="keywordtype">int</span> d,done,size;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;      <span class="comment">/* Find out the domain limits for each process */</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;      <a class="code" href="a00166.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00181.html#a9a3fc32b7d4bea6a1dac44ab21c9202e">MPILocalDomainLimits</a>(ndims,proc,mpi,dim_global,is,ie); <a class="code" href="a00166.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;      size = 1;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;      <span class="keywordflow">for</span> (d=0; d&lt;ndims; d++) {</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;        size *= (ie[d]-is[d]);</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        bounds[d] = ie[d] - is[d];</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;      }</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;      <span class="keywordtype">double</span> *buffer = (<span class="keywordtype">double</span>*) calloc (size*nvars, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;      done = 0; <a class="code" href="a00165.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(index,ndims,0);</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;      <span class="keywordflow">while</span> (!done) {</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        <span class="keywordtype">int</span> p1; <a class="code" href="a00165.html#a0739cb538f4d301fad3b45059ddd0738">_ArrayIndex1DWO_</a>(ndims,dim_global,index,is,0,p1);</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        <span class="keywordtype">int</span> p2; <a class="code" href="a00165.html#afbb862a2fdf5b72b1f9ace42f64b556f">_ArrayIndex1D_</a>(ndims,bounds,index,0,p2);</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        <a class="code" href="a00165.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>((xg+nvars*p1),(buffer+nvars*p2),nvars);</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        <a class="code" href="a00165.html#ac5ec1371623f11d03b0f42adaa24acbc">_ArrayIncrementIndex_</a>(ndims,bounds,index,done);</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;      }</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;      <span class="keywordflow">if</span> (proc) {</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="preprocessor">#ifndef serial</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        MPI_Send(buffer,size*nvars,MPI_DOUBLE,proc,1538,mpi-&gt;<a class="code" href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        done = 0; <a class="code" href="a00165.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(index,ndims,0);</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        <span class="keywordflow">while</span> (!done) {</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;          <span class="keywordtype">int</span> p1; <a class="code" href="a00165.html#afbb862a2fdf5b72b1f9ace42f64b556f">_ArrayIndex1D_</a>(ndims,dim_local,index,ghosts,p1);</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;          <span class="keywordtype">int</span> p2; <a class="code" href="a00165.html#afbb862a2fdf5b72b1f9ace42f64b556f">_ArrayIndex1D_</a>(ndims,dim_local,index,0,p2);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;          <a class="code" href="a00165.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>((buffer+nvars*p2),(x+nvars*p1),nvars);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;          <a class="code" href="a00165.html#ac5ec1371623f11d03b0f42adaa24acbc">_ArrayIncrementIndex_</a>(ndims,dim_local,index,done);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        }</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;      }</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;      free(buffer);</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    }</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="preprocessor">#ifndef serial</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="comment">/* Meanwhile, on other processes */</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    MPI_Status  status;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="keywordtype">int</span> d, done, size;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    size = 1; <span class="keywordflow">for</span> (d=0; d&lt;ndims; d++) size *= dim_local[d];</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="keywordtype">double</span> *buffer = (<span class="keywordtype">double</span>*) calloc (size*nvars, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    MPI_Recv(buffer,size*nvars,MPI_DOUBLE,0,1538,mpi-&gt;<a class="code" href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>,&amp;status);</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    done = 0; <a class="code" href="a00165.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(index,ndims,0);</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="keywordflow">while</span> (!done) {</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;      <span class="keywordtype">int</span> p1; <a class="code" href="a00165.html#afbb862a2fdf5b72b1f9ace42f64b556f">_ArrayIndex1D_</a>(ndims,dim_local,index,ghosts,p1);</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;      <span class="keywordtype">int</span> p2; <a class="code" href="a00165.html#afbb862a2fdf5b72b1f9ace42f64b556f">_ArrayIndex1D_</a>(ndims,dim_local,index,0,p2);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;      <a class="code" href="a00165.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>((buffer+nvars*p2),(x+nvars*p1),nvars);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;      <a class="code" href="a00165.html#ac5ec1371623f11d03b0f42adaa24acbc">_ArrayIncrementIndex_</a>(ndims,dim_local,index,done);</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    }</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    free(buffer);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  }</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;}</div>
<div class="ttc" id="a00146_html_ae68326adc3b3862f1162832f70727b06"><div class="ttname"><a href="a00146.html#ae68326adc3b3862f1162832f70727b06">MPIVariables::nproc</a></div><div class="ttdeci">int nproc</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00026">mpivars_struct.h:26</a></div></div>
<div class="ttc" id="a00146_html_a6cfd95afd0afebd625b889fb6e58371c"><div class="ttname"><a href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">MPIVariables::rank</a></div><div class="ttdeci">int rank</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00025">mpivars_struct.h:25</a></div></div>
<div class="ttc" id="a00181_html_a9a3fc32b7d4bea6a1dac44ab21c9202e"><div class="ttname"><a href="a00181.html#a9a3fc32b7d4bea6a1dac44ab21c9202e">MPILocalDomainLimits</a></div><div class="ttdeci">int MPILocalDomainLimits(int, int, void *, int *, int *, int *)</div><div class="ttdef"><b>Definition:</b> <a href="a00306_source.html#l00018">MPILocalDomainLimits.c:18</a></div></div>
<div class="ttc" id="a00165_html_a89e8330d9e06dd0666c50833628a125c"><div class="ttname"><a href="a00165.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a></div><div class="ttdeci">#define _ArrayCopy1D_(x, y, size)</div><div class="ttdef"><b>Definition:</b> <a href="a00165_source.html#l00318">arrayfunctions.h:318</a></div></div>
<div class="ttc" id="a00165_html_a2b2826031c0cd92495ab351d3e599fc5"><div class="ttname"><a href="a00165.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a></div><div class="ttdeci">#define _ArraySetValue_(x, size, value)</div><div class="ttdef"><b>Definition:</b> <a href="a00165_source.html#l00168">arrayfunctions.h:168</a></div></div>
<div class="ttc" id="a00166_html_add9cf96ae374934d245a1dc1ab697a42"><div class="ttname"><a href="a00166.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a></div><div class="ttdeci">#define CHECKERR(ierr)</div><div class="ttdef"><b>Definition:</b> <a href="a00166_source.html#l00014">basic.h:14</a></div></div>
<div class="ttc" id="a00165_html_ac5ec1371623f11d03b0f42adaa24acbc"><div class="ttname"><a href="a00165.html#ac5ec1371623f11d03b0f42adaa24acbc">_ArrayIncrementIndex_</a></div><div class="ttdeci">#define _ArrayIncrementIndex_(N, imax, i, done)</div><div class="ttdef"><b>Definition:</b> <a href="a00165_source.html#l00125">arrayfunctions.h:125</a></div></div>
<div class="ttc" id="a00166_html_a68f50121fb9a7daeaf60e50cdef82ef3"><div class="ttname"><a href="a00166.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a></div><div class="ttdeci">#define _DECLARE_IERR_</div><div class="ttdef"><b>Definition:</b> <a href="a00166_source.html#l00013">basic.h:13</a></div></div>
<div class="ttc" id="a00166_html_ad6ab74942c9de13cf0b4c12eb0d91780"><div class="ttname"><a href="a00166.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a></div><div class="ttdeci">#define IERR</div><div class="ttdef"><b>Definition:</b> <a href="a00166_source.html#l00012">basic.h:12</a></div></div>
<div class="ttc" id="a00146_html_adad7a6f85831f3ac84d854b6c80aef43"><div class="ttname"><a href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">MPIVariables::world</a></div><div class="ttdeci">MPI_Comm world</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00037">mpivars_struct.h:37</a></div></div>
<div class="ttc" id="a00165_html_afbb862a2fdf5b72b1f9ace42f64b556f"><div class="ttname"><a href="a00165.html#afbb862a2fdf5b72b1f9ace42f64b556f">_ArrayIndex1D_</a></div><div class="ttdeci">#define _ArrayIndex1D_(N, imax, i, ghost, index)</div><div class="ttdef"><b>Definition:</b> <a href="a00165_source.html#l00039">arrayfunctions.h:39</a></div></div>
<div class="ttc" id="a00165_html_a0739cb538f4d301fad3b45059ddd0738"><div class="ttname"><a href="a00165.html#a0739cb538f4d301fad3b45059ddd0738">_ArrayIndex1DWO_</a></div><div class="ttdeci">#define _ArrayIndex1DWO_(N, imax, i, offset, ghost, index)</div><div class="ttdef"><b>Definition:</b> <a href="a00165_source.html#l00082">arrayfunctions.h:82</a></div></div>
<div class="ttc" id="a00146_html_a00559"><div class="ttname"><a href="a00146.html#a00559">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00024">mpivars_struct.h:24</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a25eaada04db84ccf1c979d4301f5093f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int MPIPartitionArraynDwGhosts </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ndims</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>xg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>dim_global</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>dim_local</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ghosts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nvars</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Partition a global array into local arrays for an n-dimensional array</p>
<p>Partitions the contents of a global n-dimensional array on rank 0 (root) to local n-dimensional arrays on all the MPI ranks. See documentation of <a class="el" href="a00181.html#a60ace5964c051fa481e6a1e6f1ef75d7">MPIExchangeBoundariesnD()</a> for how the n-dimensional array is stored in the memory as a single-index array. This is same as <a class="el" href="a00311.html#a01e91e5f4675fae1698339a4028c09c1">MPIPartitionArraynD()</a> but where the global array <em>has</em> ghost points.</p>
<p>Notes:</p><ul>
<li>The global array must have ghost points (the same number as the local arrays).</li>
<li>The global array must be allocated only on rank 0. On other ranks, it must be NULL. </li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ndims</td><td>Number of spatial dimensions </td></tr>
    <tr><td class="paramname">m</td><td>MPI object of type <a class="el" href="a00146.html#a00559" title="Structure of MPI-related variables. ">MPIVariables</a> </td></tr>
    <tr><td class="paramname">xg</td><td>Global array (preallocated) without ghost points </td></tr>
    <tr><td class="paramname">x</td><td>Local array </td></tr>
    <tr><td class="paramname">dim_global</td><td>Integer array with elements as global size along each spatial dimension </td></tr>
    <tr><td class="paramname">dim_local</td><td>Integer array with elements as local size along each spatial dimension </td></tr>
    <tr><td class="paramname">ghosts</td><td>Number of ghost points </td></tr>
    <tr><td class="paramname">nvars</td><td>Number of variables (vector components) </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00311_source.html#l00114">114</a> of file <a class="el" href="a00311_source.html">MPIPartitionArraynD.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;{</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  <a class="code" href="a00146.html#a00559">MPIVariables</a> *mpi = (<a class="code" href="a00146.html#a00559">MPIVariables</a>*) m;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <span class="keywordtype">int</span> d;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <a class="code" href="a00166.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a>;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  <span class="keywordtype">int</span> is[ndims], ie[ndims], index[ndims], bounds[ndims];</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  <span class="keywordtype">int</span> dim_global_wghosts[ndims];</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <span class="keywordflow">for</span> (d = 0; d &lt; ndims; d++) dim_global_wghosts[d] = dim_global[d] + 2*ghosts;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="comment">/* xg should be non-null only on root */</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  <span class="keywordflow">if</span> (mpi-&gt;<a class="code" href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a> &amp;&amp; xg) {</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    fprintf(stderr,<span class="stringliteral">&quot;Error in MPIPartitionArraynD(): global array exists on non-root processors (rank %d).\n&quot;</span>,</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;            mpi-&gt;<a class="code" href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>);</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  }</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  <span class="keywordflow">if</span> ((!mpi-&gt;<a class="code" href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) &amp;&amp; (!xg)) {</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    fprintf(stderr,<span class="stringliteral">&quot;Error in MPIPartitionArraynD(): global array is not allocated on root processor.\n&quot;</span>);</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  }</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) {</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="keywordtype">int</span> proc;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="keywordflow">for</span> (proc = 0; proc &lt; mpi-&gt;<a class="code" href="a00146.html#ae68326adc3b3862f1162832f70727b06">nproc</a>; proc++) {</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;      <span class="keywordtype">int</span> done,size;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;      <span class="comment">/* Find out the domain limits for each process */</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;      <a class="code" href="a00166.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00181.html#a9a3fc32b7d4bea6a1dac44ab21c9202e">MPILocalDomainLimits</a>(ndims,proc,mpi,dim_global,is,ie); <a class="code" href="a00166.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;      size = 1;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;      <span class="keywordflow">for</span> (d=0; d&lt;ndims; d++) {</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        size *= (ie[d]-is[d]+2*ghosts);</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        bounds[d] = ie[d] - is[d] + 2*ghosts;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;      }</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;      <span class="keywordtype">double</span> *buffer = (<span class="keywordtype">double</span>*) calloc (size*nvars, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;      done = 0; <a class="code" href="a00165.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(index,ndims,0);</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;      <span class="keywordflow">while</span> (!done) {</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        <span class="keywordtype">int</span> p1; <a class="code" href="a00165.html#a0739cb538f4d301fad3b45059ddd0738">_ArrayIndex1DWO_</a>(ndims,dim_global_wghosts,index,is,0,p1);</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        <span class="keywordtype">int</span> p2; <a class="code" href="a00165.html#afbb862a2fdf5b72b1f9ace42f64b556f">_ArrayIndex1D_</a>(ndims,bounds,index,0,p2);</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        <a class="code" href="a00165.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>((xg+nvars*p1),(buffer+nvars*p2),nvars);</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <a class="code" href="a00165.html#ac5ec1371623f11d03b0f42adaa24acbc">_ArrayIncrementIndex_</a>(ndims,bounds,index,done);</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;      }</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;      <span class="keywordflow">if</span> (proc) {</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="preprocessor">#ifndef serial</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        MPI_Send(buffer,size*nvars,MPI_DOUBLE,proc,1538,mpi-&gt;<a class="code" href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        done = 0; <a class="code" href="a00165.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(index,ndims,0);</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        <a class="code" href="a00165.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>(buffer, x, size*nvars);</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;      }</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;      free(buffer);</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    }</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="preprocessor">#ifndef serial</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="comment">/* Meanwhile, on other processes */</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    MPI_Status  status;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="keywordtype">int</span> done, size;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    size = 1; <span class="keywordflow">for</span> (d=0; d&lt;ndims; d++) size *= (dim_local[d]+2*ghosts);</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="keywordtype">double</span> *buffer = (<span class="keywordtype">double</span>*) calloc (size*nvars, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    MPI_Recv(buffer,size*nvars,MPI_DOUBLE,0,1538,mpi-&gt;<a class="code" href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>,&amp;status);</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <a class="code" href="a00165.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>(buffer, x, size*nvars);</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    free(buffer);</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  }</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;}</div>
<div class="ttc" id="a00146_html_ae68326adc3b3862f1162832f70727b06"><div class="ttname"><a href="a00146.html#ae68326adc3b3862f1162832f70727b06">MPIVariables::nproc</a></div><div class="ttdeci">int nproc</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00026">mpivars_struct.h:26</a></div></div>
<div class="ttc" id="a00146_html_a6cfd95afd0afebd625b889fb6e58371c"><div class="ttname"><a href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">MPIVariables::rank</a></div><div class="ttdeci">int rank</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00025">mpivars_struct.h:25</a></div></div>
<div class="ttc" id="a00181_html_a9a3fc32b7d4bea6a1dac44ab21c9202e"><div class="ttname"><a href="a00181.html#a9a3fc32b7d4bea6a1dac44ab21c9202e">MPILocalDomainLimits</a></div><div class="ttdeci">int MPILocalDomainLimits(int, int, void *, int *, int *, int *)</div><div class="ttdef"><b>Definition:</b> <a href="a00306_source.html#l00018">MPILocalDomainLimits.c:18</a></div></div>
<div class="ttc" id="a00165_html_a89e8330d9e06dd0666c50833628a125c"><div class="ttname"><a href="a00165.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a></div><div class="ttdeci">#define _ArrayCopy1D_(x, y, size)</div><div class="ttdef"><b>Definition:</b> <a href="a00165_source.html#l00318">arrayfunctions.h:318</a></div></div>
<div class="ttc" id="a00165_html_a2b2826031c0cd92495ab351d3e599fc5"><div class="ttname"><a href="a00165.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a></div><div class="ttdeci">#define _ArraySetValue_(x, size, value)</div><div class="ttdef"><b>Definition:</b> <a href="a00165_source.html#l00168">arrayfunctions.h:168</a></div></div>
<div class="ttc" id="a00166_html_add9cf96ae374934d245a1dc1ab697a42"><div class="ttname"><a href="a00166.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a></div><div class="ttdeci">#define CHECKERR(ierr)</div><div class="ttdef"><b>Definition:</b> <a href="a00166_source.html#l00014">basic.h:14</a></div></div>
<div class="ttc" id="a00165_html_ac5ec1371623f11d03b0f42adaa24acbc"><div class="ttname"><a href="a00165.html#ac5ec1371623f11d03b0f42adaa24acbc">_ArrayIncrementIndex_</a></div><div class="ttdeci">#define _ArrayIncrementIndex_(N, imax, i, done)</div><div class="ttdef"><b>Definition:</b> <a href="a00165_source.html#l00125">arrayfunctions.h:125</a></div></div>
<div class="ttc" id="a00166_html_a68f50121fb9a7daeaf60e50cdef82ef3"><div class="ttname"><a href="a00166.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a></div><div class="ttdeci">#define _DECLARE_IERR_</div><div class="ttdef"><b>Definition:</b> <a href="a00166_source.html#l00013">basic.h:13</a></div></div>
<div class="ttc" id="a00166_html_ad6ab74942c9de13cf0b4c12eb0d91780"><div class="ttname"><a href="a00166.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a></div><div class="ttdeci">#define IERR</div><div class="ttdef"><b>Definition:</b> <a href="a00166_source.html#l00012">basic.h:12</a></div></div>
<div class="ttc" id="a00146_html_adad7a6f85831f3ac84d854b6c80aef43"><div class="ttname"><a href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">MPIVariables::world</a></div><div class="ttdeci">MPI_Comm world</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00037">mpivars_struct.h:37</a></div></div>
<div class="ttc" id="a00165_html_afbb862a2fdf5b72b1f9ace42f64b556f"><div class="ttname"><a href="a00165.html#afbb862a2fdf5b72b1f9ace42f64b556f">_ArrayIndex1D_</a></div><div class="ttdeci">#define _ArrayIndex1D_(N, imax, i, ghost, index)</div><div class="ttdef"><b>Definition:</b> <a href="a00165_source.html#l00039">arrayfunctions.h:39</a></div></div>
<div class="ttc" id="a00165_html_a0739cb538f4d301fad3b45059ddd0738"><div class="ttname"><a href="a00165.html#a0739cb538f4d301fad3b45059ddd0738">_ArrayIndex1DWO_</a></div><div class="ttdeci">#define _ArrayIndex1DWO_(N, imax, i, offset, ghost, index)</div><div class="ttdef"><b>Definition:</b> <a href="a00165_source.html#l00082">arrayfunctions.h:82</a></div></div>
<div class="ttc" id="a00146_html_a00559"><div class="ttname"><a href="a00146.html#a00559">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00024">mpivars_struct.h:24</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a77f4e7a03979d9fabce2a536a113ff42"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int MPIPartitionArray1D </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>xg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>istart</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>iend</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>N_local</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ghosts</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Partition a global array into local arrays for an essentially 1D array</p>
<p>Partitions the contents of a global 1D array on the root rank (rank 0) to local arrays on all the MPI ranks. See documentation of <a class="el" href="a00181.html#ac2f0cce702a9ce439753286ce227c7a2">MPIExchangeBoundaries1D()</a> on what a "1D 
array" is in the context of a multidimensional simulation. The 1D array must be the same along spatial dimensions normal to the one it represents.</p>
<p>Notes:</p><ul>
<li>The global array must not have ghost points.</li>
<li>The global array must be preallocated on only rank 0. On other ranks, it must be NULL.</li>
<li>Since this function deals with a 1D array, more than one rank may be receiving the same piece of data from rank 0 (i.e. if there are more than one MPI rank along the dimensions normal to one corresponding to <em>x</em> ). </li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">m</td><td>MPI object of type <a class="el" href="a00146.html#a00559" title="Structure of MPI-related variables. ">MPIVariables</a> </td></tr>
    <tr><td class="paramname">xg</td><td>Global 1D array (must be preallocated) without ghost points </td></tr>
    <tr><td class="paramname">x</td><td>Local 1D array to be gathered </td></tr>
    <tr><td class="paramname">istart</td><td>Starting index (global) of this rank's portion of the array </td></tr>
    <tr><td class="paramname">iend</td><td>Ending index (global) of this rank's portion of the array + 1 </td></tr>
    <tr><td class="paramname">N_local</td><td>Local size of the array </td></tr>
    <tr><td class="paramname">ghosts</td><td>Number of ghost points </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00310_source.html#l00025">25</a> of file <a class="el" href="a00310_source.html">MPIPartitionArray1D.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;{</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  <a class="code" href="a00146.html#a00559">MPIVariables</a> *mpi = (<a class="code" href="a00146.html#a00559">MPIVariables</a>*) m;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  <span class="keywordtype">int</span>          ierr = 0;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#ifndef serial</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  MPI_Status   status;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <span class="comment">/* xg should be non-null only on root */</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  <span class="keywordflow">if</span> (mpi-&gt;<a class="code" href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a> &amp;&amp; xg) {</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    fprintf(stderr,<span class="stringliteral">&quot;Error in MPIPartitionArray1D(): global array exists on non-root processors (rank %d).\n&quot;</span>,</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;            mpi-&gt;<a class="code" href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>);</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    ierr = 1;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  }</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  <span class="keywordflow">if</span> ((!mpi-&gt;<a class="code" href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) &amp;&amp; (!xg)) {</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    fprintf(stderr,<span class="stringliteral">&quot;Error in MPIPartitionArray1D(): global array is not allocated on root processor.\n&quot;</span>);</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    ierr = 1;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  }</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) {</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="keywordtype">int</span> proc;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="keywordflow">for</span> (proc = 0; proc &lt; mpi-&gt;<a class="code" href="a00146.html#ae68326adc3b3862f1162832f70727b06">nproc</a>; proc++) {</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;      <span class="comment">/* Find out the domain limits for each process */</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;      <span class="keywordtype">int</span> is,ie;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;      <span class="keywordflow">if</span> (proc) {</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">#ifndef serial</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        MPI_Recv(&amp;is,1,MPI_INT,proc,1442,mpi-&gt;<a class="code" href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>,&amp;status);</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        MPI_Recv(&amp;ie,1,MPI_INT,proc,1443,mpi-&gt;<a class="code" href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>,&amp;status);</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        is = istart;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        ie = iend;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;      }</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;      <span class="keywordtype">int</span> size = ie - is;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;      <span class="keywordtype">double</span> *buffer = (<span class="keywordtype">double</span>*) calloc (size, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;      <a class="code" href="a00165.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>((xg+is),buffer,size);</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;      <span class="keywordflow">if</span> (proc) {</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="preprocessor">#ifndef serial</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        MPI_Send(buffer,size,MPI_DOUBLE,proc,1539,mpi-&gt;<a class="code" href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;      } <span class="keywordflow">else</span> <a class="code" href="a00165.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>(buffer,x,N_local);</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;      free(buffer);</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    }</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="preprocessor">#ifndef serial</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="comment">/* Meanwhile, on other processes */</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="comment">/* send local start and end indices to root */</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    MPI_Send(&amp;istart,1,MPI_INT,0,1442,mpi-&gt;<a class="code" href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    MPI_Send(&amp;iend  ,1,MPI_INT,0,1443,mpi-&gt;<a class="code" href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="keywordtype">double</span> *buffer = (<span class="keywordtype">double</span>*) calloc (N_local, <span class="keyword">sizeof</span>(buffer));</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    MPI_Recv(buffer,N_local,MPI_DOUBLE,0,1539,mpi-&gt;<a class="code" href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>,&amp;status);</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <a class="code" href="a00165.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>(buffer,x,N_local);</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    free(buffer);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  }</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <span class="keywordflow">return</span>(ierr);</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;}</div>
<div class="ttc" id="a00146_html_ae68326adc3b3862f1162832f70727b06"><div class="ttname"><a href="a00146.html#ae68326adc3b3862f1162832f70727b06">MPIVariables::nproc</a></div><div class="ttdeci">int nproc</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00026">mpivars_struct.h:26</a></div></div>
<div class="ttc" id="a00146_html_a6cfd95afd0afebd625b889fb6e58371c"><div class="ttname"><a href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">MPIVariables::rank</a></div><div class="ttdeci">int rank</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00025">mpivars_struct.h:25</a></div></div>
<div class="ttc" id="a00165_html_a89e8330d9e06dd0666c50833628a125c"><div class="ttname"><a href="a00165.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a></div><div class="ttdeci">#define _ArrayCopy1D_(x, y, size)</div><div class="ttdef"><b>Definition:</b> <a href="a00165_source.html#l00318">arrayfunctions.h:318</a></div></div>
<div class="ttc" id="a00146_html_adad7a6f85831f3ac84d854b6c80aef43"><div class="ttname"><a href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">MPIVariables::world</a></div><div class="ttdeci">MPI_Comm world</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00037">mpivars_struct.h:37</a></div></div>
<div class="ttc" id="a00146_html_a00559"><div class="ttname"><a href="a00146.html#a00559">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00024">mpivars_struct.h:24</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5795cc6a69ea39684662afc8c2557272"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int MPIGetArrayDatanD </td>
          <td>(</td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>xbuf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>source</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>limits</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>dim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ghosts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ndims</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nvars</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>m</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>fetch data from an n-dimensional local array on another rank</p>
<p>This function lets one rank get a portion of a local n-dimensional array on another rank. The n-dimensional array must be stored in the memory as a single-index array as described in the documentation of <a class="el" href="a00181.html#a60ace5964c051fa481e6a1e6f1ef75d7">MPIExchangeBoundariesnD()</a>. The <em>source</em> rank sends to the <em>dest</em> rank a logically rectangular n-dimensional portion of its local copy of an array <em>x</em>. The extent of this logically rectangular portion is defined by <em>limits</em>.</p><ul>
<li><em>limits</em> is an array of size 2x the number of spatial dimensions, with elements as: [ is[0], ie[0], is[1], ie[1], ..., is[ndims-1], ie[ndims-1] ], where is[n] is the starting index along spatial dimension n, and ie[n] is the end index (+1) along spatial dimension n. </li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">xbuf</td><td>preallocated memory on destination rank to hold the received data </td></tr>
    <tr><td class="paramname">x</td><td>local array of which a part is needed </td></tr>
    <tr><td class="paramname">source</td><td>MPI rank of the source </td></tr>
    <tr><td class="paramname">dest</td><td>MPI rank of the destination </td></tr>
    <tr><td class="paramname">limits</td><td>Integer array (of size 2*ndims) with the start and end indices along each spatial dimension of the desired portion of the array </td></tr>
    <tr><td class="paramname">dim</td><td>Integer array whose elements are the local size of x in each spatial dimension </td></tr>
    <tr><td class="paramname">ghosts</td><td>Number of ghost points </td></tr>
    <tr><td class="paramname">ndims</td><td>Number of spatial dimensions </td></tr>
    <tr><td class="paramname">nvars</td><td>Number of variables (vector components) </td></tr>
    <tr><td class="paramname">m</td><td>MPI object of type <a class="el" href="a00146.html#a00559" title="Structure of MPI-related variables. ">MPIVariables</a> </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00303_source.html#l00021">21</a> of file <a class="el" href="a00303_source.html">MPIGetArrayDatanD.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;{</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  <a class="code" href="a00146.html#a00559">MPIVariables</a> *mpi  = (<a class="code" href="a00146.html#a00559">MPIVariables</a>*) m;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  <span class="keywordtype">int</span>          d;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <span class="keywordtype">int</span> source_rank = <a class="code" href="a00181.html#a36e2be86c7dc0d9dd088ed2f5842f556">MPIRank1D</a>(ndims,mpi-&gt;<a class="code" href="a00146.html#a0be0f30a83bc3f3d9f6ee3a36bbf2716">iproc</a>,source);</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  <span class="keywordtype">int</span> dest_rank   = <a class="code" href="a00181.html#a36e2be86c7dc0d9dd088ed2f5842f556">MPIRank1D</a>(ndims,mpi-&gt;<a class="code" href="a00146.html#a0be0f30a83bc3f3d9f6ee3a36bbf2716">iproc</a>,dest  );</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <span class="keywordtype">int</span> is[ndims], ie[ndims], index[ndims], bounds[ndims], size;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  size    = 1;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  <span class="keywordflow">for</span> (d=0; d&lt;ndims; d++) {</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    is[d] =  limits[2*d  ];</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    ie[d] =  limits[2*d+1];</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    size  *= (ie[d] - is[d]);</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  }</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  <a class="code" href="a00165.html#ab49d0f261ea751a17d6beca0504daf78">_ArraySubtract1D_</a>(bounds,ie,is,ndims);</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="keywordflow">if</span> (source_rank == dest_rank) {</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="comment">/* source and dest are the same process */</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="keywordtype">int</span> done = 0; <a class="code" href="a00165.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(index,ndims,0);</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="keywordflow">while</span> (!done) {</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;      <span class="keywordtype">int</span> p1; <a class="code" href="a00165.html#afbb862a2fdf5b72b1f9ace42f64b556f">_ArrayIndex1D_</a>(ndims,bounds,index,0,p1);</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;      <span class="keywordtype">int</span> p2; <a class="code" href="a00165.html#a0739cb538f4d301fad3b45059ddd0738">_ArrayIndex1DWO_</a>(ndims,dim,index,is,ghosts,p2);</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;      <a class="code" href="a00165.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>((x+nvars*p2),(xbuf+nvars*p1),nvars);</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;      <a class="code" href="a00165.html#ac5ec1371623f11d03b0f42adaa24acbc">_ArrayIncrementIndex_</a>(ndims,bounds,index,done);</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    }</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor">#ifdef serial</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    fprintf(stderr,<span class="stringliteral">&quot;Error in MPIGetArrayDatanD(): This is a serial run. Source and &quot;</span>);</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    fprintf(stderr,<span class="stringliteral">&quot;destination ranks must be equal. Instead they are %d and %d.\n&quot;</span>,</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;                    source_rank,dest_rank);</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keywordflow">if</span> (mpi-&gt;<a class="code" href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a> == source_rank) {</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;      <span class="keywordtype">double</span> *buf = (<span class="keywordtype">double</span>*) calloc (size*nvars, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;      <span class="keywordtype">int</span> done = 0; <a class="code" href="a00165.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(index,ndims,0);</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;      <span class="keywordflow">while</span> (!done) {</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        <span class="keywordtype">int</span> p1; <a class="code" href="a00165.html#afbb862a2fdf5b72b1f9ace42f64b556f">_ArrayIndex1D_</a>(ndims,bounds,index,0,p1);</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        <span class="keywordtype">int</span> p2; <a class="code" href="a00165.html#a0739cb538f4d301fad3b45059ddd0738">_ArrayIndex1DWO_</a>(ndims,dim,index,is,ghosts,p2);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        <a class="code" href="a00165.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>((x+nvars*p2),(buf+nvars*p1),nvars);</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        <a class="code" href="a00165.html#ac5ec1371623f11d03b0f42adaa24acbc">_ArrayIncrementIndex_</a>(ndims,bounds,index,done);</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;      }</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;      MPI_Send(buf,size*nvars,MPI_DOUBLE,dest_rank,2211,mpi-&gt;<a class="code" href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;      free(buf);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mpi-&gt;<a class="code" href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a> == dest_rank) {</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;      MPI_Status status;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;      MPI_Recv(xbuf,size*nvars,MPI_DOUBLE,source_rank,2211,mpi-&gt;<a class="code" href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>,&amp;status);</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;      fprintf(stderr,<span class="stringliteral">&quot;Error in MPIGetArrayData3D(): Process %d shouldn&#39;t have entered this function.\n&quot;</span>,</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;              mpi-&gt;<a class="code" href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>);</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;      <span class="keywordflow">return</span>(1);</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    }</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  }</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;}</div>
<div class="ttc" id="a00146_html_a6cfd95afd0afebd625b889fb6e58371c"><div class="ttname"><a href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">MPIVariables::rank</a></div><div class="ttdeci">int rank</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00025">mpivars_struct.h:25</a></div></div>
<div class="ttc" id="a00146_html_a0be0f30a83bc3f3d9f6ee3a36bbf2716"><div class="ttname"><a href="a00146.html#a0be0f30a83bc3f3d9f6ee3a36bbf2716">MPIVariables::iproc</a></div><div class="ttdeci">int * iproc</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00027">mpivars_struct.h:27</a></div></div>
<div class="ttc" id="a00165_html_a89e8330d9e06dd0666c50833628a125c"><div class="ttname"><a href="a00165.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a></div><div class="ttdeci">#define _ArrayCopy1D_(x, y, size)</div><div class="ttdef"><b>Definition:</b> <a href="a00165_source.html#l00318">arrayfunctions.h:318</a></div></div>
<div class="ttc" id="a00165_html_ab49d0f261ea751a17d6beca0504daf78"><div class="ttname"><a href="a00165.html#ab49d0f261ea751a17d6beca0504daf78">_ArraySubtract1D_</a></div><div class="ttdeci">#define _ArraySubtract1D_(x, a, b, size)</div><div class="ttdef"><b>Definition:</b> <a href="a00165_source.html#l00200">arrayfunctions.h:200</a></div></div>
<div class="ttc" id="a00165_html_a2b2826031c0cd92495ab351d3e599fc5"><div class="ttname"><a href="a00165.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a></div><div class="ttdeci">#define _ArraySetValue_(x, size, value)</div><div class="ttdef"><b>Definition:</b> <a href="a00165_source.html#l00168">arrayfunctions.h:168</a></div></div>
<div class="ttc" id="a00165_html_ac5ec1371623f11d03b0f42adaa24acbc"><div class="ttname"><a href="a00165.html#ac5ec1371623f11d03b0f42adaa24acbc">_ArrayIncrementIndex_</a></div><div class="ttdeci">#define _ArrayIncrementIndex_(N, imax, i, done)</div><div class="ttdef"><b>Definition:</b> <a href="a00165_source.html#l00125">arrayfunctions.h:125</a></div></div>
<div class="ttc" id="a00181_html_a36e2be86c7dc0d9dd088ed2f5842f556"><div class="ttname"><a href="a00181.html#a36e2be86c7dc0d9dd088ed2f5842f556">MPIRank1D</a></div><div class="ttdeci">int MPIRank1D(int, int *, int *)</div><div class="ttdef"><b>Definition:</b> <a href="a00312_source.html#l00026">MPIRank1D.c:26</a></div></div>
<div class="ttc" id="a00146_html_adad7a6f85831f3ac84d854b6c80aef43"><div class="ttname"><a href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">MPIVariables::world</a></div><div class="ttdeci">MPI_Comm world</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00037">mpivars_struct.h:37</a></div></div>
<div class="ttc" id="a00165_html_afbb862a2fdf5b72b1f9ace42f64b556f"><div class="ttname"><a href="a00165.html#afbb862a2fdf5b72b1f9ace42f64b556f">_ArrayIndex1D_</a></div><div class="ttdeci">#define _ArrayIndex1D_(N, imax, i, ghost, index)</div><div class="ttdef"><b>Definition:</b> <a href="a00165_source.html#l00039">arrayfunctions.h:39</a></div></div>
<div class="ttc" id="a00165_html_a0739cb538f4d301fad3b45059ddd0738"><div class="ttname"><a href="a00165.html#a0739cb538f4d301fad3b45059ddd0738">_ArrayIndex1DWO_</a></div><div class="ttdeci">#define _ArrayIndex1DWO_(N, imax, i, offset, ghost, index)</div><div class="ttdef"><b>Definition:</b> <a href="a00165_source.html#l00082">arrayfunctions.h:82</a></div></div>
<div class="ttc" id="a00146_html_a00559"><div class="ttname"><a href="a00146.html#a00559">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00024">mpivars_struct.h:24</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a9a3fc32b7d4bea6a1dac44ab21c9202e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int MPILocalDomainLimits </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ndims</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>dim_global</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>is</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>ie</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Calculate the local domain limits/extend in terms of the global domain</p>
<p>Computes the local domain limites: Given a MPI rank <em>p</em>, this function will compute the starting and ending indices of the local domain on this rank. These indices are global.</p><ul>
<li>The starting and ending indices are stored in preallocated integer arrays, whose elements are these indices in each spatial dimension.</li>
<li>The ending index is 1 + actual last index; thus the one can write the loop as (i=start; i&lt;end; i++) and <b>not</b> (i=start; i&lt;=end; i++). </li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ndims</td><td>Number of spatial dimensions </td></tr>
    <tr><td class="paramname">p</td><td>MPI rank </td></tr>
    <tr><td class="paramname">m</td><td>MPI object of type <a class="el" href="a00146.html#a00559" title="Structure of MPI-related variables. ">MPIVariables</a> </td></tr>
    <tr><td class="paramname">dim_global</td><td>Integer array with elements as global size in each spatial dimension </td></tr>
    <tr><td class="paramname">is</td><td>Integer array whose elements will contain the starting index of the local domain on rank <em>p</em> </td></tr>
    <tr><td class="paramname">ie</td><td>Integer array whose elements will contain the ending index of the local domain on rank <em>p</em> </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00306_source.html#l00018">18</a> of file <a class="el" href="a00306_source.html">MPILocalDomainLimits.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;{</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  <a class="code" href="a00146.html#a00559">MPIVariables</a> *mpi = (<a class="code" href="a00146.html#a00559">MPIVariables</a>*) m;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  <span class="keywordtype">int</span>          i;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  <a class="code" href="a00166.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a>;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  <span class="keywordtype">int</span> ip[ndims];</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  <a class="code" href="a00166.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00181.html#afe59a0480bb81cc0d7877ba547b3e28c">MPIRanknD</a>(ndims,p,mpi-&gt;<a class="code" href="a00146.html#a0be0f30a83bc3f3d9f6ee3a36bbf2716">iproc</a>,ip); <a class="code" href="a00166.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <span class="keywordflow">for</span> (i=0; i&lt;ndims; i++) {</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="keywordtype">int</span> imax_local, isize, root = 0;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    imax_local = <a class="code" href="a00181.html#af8194ca5a460534fdbe391035a95c69d">MPIPartition1D</a>(dim_global[i],mpi-&gt;<a class="code" href="a00146.html#a0be0f30a83bc3f3d9f6ee3a36bbf2716">iproc</a>[i],root );</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    isize      = <a class="code" href="a00181.html#af8194ca5a460534fdbe391035a95c69d">MPIPartition1D</a>(dim_global[i],mpi-&gt;<a class="code" href="a00146.html#a0be0f30a83bc3f3d9f6ee3a36bbf2716">iproc</a>[i],ip[i]);</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <span class="keywordflow">if</span> (is)  is[i] = ip[i]*imax_local;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="keywordflow">if</span> (ie)  ie[i] = ip[i]*imax_local + isize;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  }</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;}</div>
<div class="ttc" id="a00146_html_a0be0f30a83bc3f3d9f6ee3a36bbf2716"><div class="ttname"><a href="a00146.html#a0be0f30a83bc3f3d9f6ee3a36bbf2716">MPIVariables::iproc</a></div><div class="ttdeci">int * iproc</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00027">mpivars_struct.h:27</a></div></div>
<div class="ttc" id="a00181_html_afe59a0480bb81cc0d7877ba547b3e28c"><div class="ttname"><a href="a00181.html#afe59a0480bb81cc0d7877ba547b3e28c">MPIRanknD</a></div><div class="ttdeci">int MPIRanknD(int, int, int *, int *)</div><div class="ttdef"><b>Definition:</b> <a href="a00313_source.html#l00027">MPIRanknD.c:27</a></div></div>
<div class="ttc" id="a00166_html_add9cf96ae374934d245a1dc1ab697a42"><div class="ttname"><a href="a00166.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a></div><div class="ttdeci">#define CHECKERR(ierr)</div><div class="ttdef"><b>Definition:</b> <a href="a00166_source.html#l00014">basic.h:14</a></div></div>
<div class="ttc" id="a00181_html_af8194ca5a460534fdbe391035a95c69d"><div class="ttname"><a href="a00181.html#af8194ca5a460534fdbe391035a95c69d">MPIPartition1D</a></div><div class="ttdeci">int MPIPartition1D(int, int, int)</div><div class="ttdef"><b>Definition:</b> <a href="a00309_source.html#l00014">MPIPartition1D.c:14</a></div></div>
<div class="ttc" id="a00166_html_a68f50121fb9a7daeaf60e50cdef82ef3"><div class="ttname"><a href="a00166.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a></div><div class="ttdeci">#define _DECLARE_IERR_</div><div class="ttdef"><b>Definition:</b> <a href="a00166_source.html#l00013">basic.h:13</a></div></div>
<div class="ttc" id="a00166_html_ad6ab74942c9de13cf0b4c12eb0d91780"><div class="ttname"><a href="a00166.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a></div><div class="ttdeci">#define IERR</div><div class="ttdef"><b>Definition:</b> <a href="a00166_source.html#l00012">basic.h:12</a></div></div>
<div class="ttc" id="a00146_html_a00559"><div class="ttname"><a href="a00146.html#a00559">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00024">mpivars_struct.h:24</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a184fc81a4d6618de22a60c9d8436fc83"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int MPIMax_integer </td>
          <td>(</td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>global</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>var</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>comm</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Find the maximum in an integer array over all ranks</p>
<p>Compute the global maximum over all MPI ranks in a given communicator for <em>int</em> datatype.</p><ul>
<li>If <em>var</em> is an array of size greater than 1, <em>global</em> will be an array of the same size with each element as the maximum value of that element in <em>var</em> on all the MPI ranks in the given communicator. </li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">global</td><td>array to contain the global maximums </td></tr>
    <tr><td class="paramname">var</td><td>the local array </td></tr>
    <tr><td class="paramname">size</td><td>size of the local array </td></tr>
    <tr><td class="paramname">comm</td><td>MPI communicator </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00307_source.html#l00015">15</a> of file <a class="el" href="a00307_source.html">MPIMax.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;{</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#ifdef serial</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;  <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; size; i++)  global[i] = var[i];</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;  MPI_Allreduce((var==global?MPI_IN_PLACE:var),global,size,MPI_INT,MPI_MAX,*((MPI_Comm*)comm));</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a42b8065bc8e4830aef4c26e58ab4d38d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int MPIMax_long </td>
          <td>(</td>
          <td class="paramtype">long *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Find the maximum in a long integer array over all ranks </p>

</div>
</div>
<a class="anchor" id="a33aa37e0050ec72dadb8d63851df51ec"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int MPIMax_double </td>
          <td>(</td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>global</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>var</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>comm</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Find the maximum in a double array over all ranks</p>
<p>Compute the global maximum over all MPI ranks in a given communicator for <em>double</em> datatype.</p><ul>
<li>If <em>var</em> is an array of size greater than 1, <em>global</em> will be an array of the same size with each element as the maximum value of that element in <em>var</em> on all the MPI ranks in the given communicator. </li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">global</td><td>array to contain the global maximums </td></tr>
    <tr><td class="paramname">var</td><td>the local array </td></tr>
    <tr><td class="paramname">size</td><td>size of the local array </td></tr>
    <tr><td class="paramname">comm</td><td>MPI communicator </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00307_source.html#l00038">38</a> of file <a class="el" href="a00307_source.html">MPIMax.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;{</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#ifdef serial</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; size; i++)  global[i] = var[i];</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  MPI_Allreduce((var==global?MPI_IN_PLACE:var),global,size,MPI_DOUBLE,MPI_MAX,*((MPI_Comm*)comm));</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac57453b9ebabb57bbadd0521c9151aaf"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int MPIMin_integer </td>
          <td>(</td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>global</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>var</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>comm</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Find the minimum in an integer array over all ranks</p>
<p>Compute the global minimum over all MPI ranks in a given communicator for <em>int</em> datatype.</p><ul>
<li>If <em>var</em> is an array of size greater than 1, <em>global</em> will be an array of the same size with each element as the minimum value of he that element in <em>var</em> on all the MPI ranks in the given communicator. </li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">global</td><td>array to contain the global minimums </td></tr>
    <tr><td class="paramname">var</td><td>the local array </td></tr>
    <tr><td class="paramname">size</td><td>size of the local array </td></tr>
    <tr><td class="paramname">comm</td><td>MPI communicator </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00308_source.html#l00015">15</a> of file <a class="el" href="a00308_source.html">MPIMin.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;{</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#ifdef serial</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;  <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; size; i++)  global[i] = var[i];</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;  MPI_Allreduce((var==global?MPI_IN_PLACE:var),global,size,MPI_INT,MPI_MIN,*((MPI_Comm*)comm));</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a754822278a5d215ecfafa28f1beed7bf"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int MPIMin_double </td>
          <td>(</td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>global</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>var</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>comm</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Find the minimum in a double array over all ranks</p>
<p>Compute the global minimum over all MPI ranks in a given communicator for <em>double</em> datatype.</p><ul>
<li>If <em>var</em> is an array of size greater than 1, <em>global</em> will be an array of the same size with each element as the minimum value of that element in <em>var</em> on all the MPI ranks in the given communicator. </li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">global</td><td>array to contain the global minimums </td></tr>
    <tr><td class="paramname">var</td><td>the local array </td></tr>
    <tr><td class="paramname">size</td><td>size of the local array </td></tr>
    <tr><td class="paramname">comm</td><td>MPI communicator </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00308_source.html#l00038">38</a> of file <a class="el" href="a00308_source.html">MPIMin.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;{</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#ifdef serial</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; size; i++)  global[i] = var[i];</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  MPI_Allreduce((var==global?MPI_IN_PLACE:var),global,size,MPI_DOUBLE,MPI_MIN,*((MPI_Comm*)comm));</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="abd61f932b070ee84262d9d98b6dd854f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int MPISum_double </td>
          <td>(</td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>global</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>var</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>comm</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Calculate the sum of an array of doubles over all ranks</p>
<p>Compute the global sum over all MPI ranks in a given communicator for <em>double</em> datatype.</p><ul>
<li>If <em>var</em> is an array of size greater than 1, <em>global</em> will be an array of the same size with each element as the sum of that element in <em>var</em> on all the MPI ranks in the given communicator. </li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">global</td><td>array to contain the global sums </td></tr>
    <tr><td class="paramname">var</td><td>the local array </td></tr>
    <tr><td class="paramname">size</td><td>size of the local array </td></tr>
    <tr><td class="paramname">comm</td><td>MPI communicator </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00314_source.html#l00039">39</a> of file <a class="el" href="a00314_source.html">MPISum.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;{</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#ifdef serial</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; size; i++)  global[i] = var[i];</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  MPI_Allreduce((var==global?MPI_IN_PLACE:var),global,size,MPI_DOUBLE,MPI_SUM,*((MPI_Comm*)comm));</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a25c7df0ff2e4f81a64368ea72894a4f8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int MPISum_integer </td>
          <td>(</td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>global</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>var</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>comm</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Calculate the sum of an array of integers over all ranks</p>
<p>Compute the global sum over all MPI ranks in a given communicator for <em>int</em> datatype.</p><ul>
<li>If <em>var</em> is an array of size greater than 1, <em>global</em> will be an array of the same size with each element as the sum of that element in <em>var</em> on all the MPI ranks in the given communicator. </li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">global</td><td>array to contain the global sums </td></tr>
    <tr><td class="paramname">var</td><td>the local array </td></tr>
    <tr><td class="paramname">size</td><td>size of the local array </td></tr>
    <tr><td class="paramname">comm</td><td>MPI communicator </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00314_source.html#l00016">16</a> of file <a class="el" href="a00314_source.html">MPISum.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;{</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#ifdef serial</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;  <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; size; i++)  global[i] = var[i];</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  MPI_Allreduce((var==global?MPI_IN_PLACE:var),global,size,MPI_INT,MPI_SUM,*((MPI_Comm*)comm));</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af8194ca5a460534fdbe391035a95c69d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int MPIPartition1D </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nglobal</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nproc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>rank</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Partition (along a dimension) the domain given global size and number of ranks</p>
<p>Given a 1D array of a given global size <em>nglobal</em>, and the total number of MPI ranks <em>nproc</em> on which it will be partitioned, this function computes the size of the local part of the 1D array on <em>rank</em>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">nglobal</td><td>Global size </td></tr>
    <tr><td class="paramname">nproc</td><td>Total number of ranks </td></tr>
    <tr><td class="paramname">rank</td><td>Rank </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00309_source.html#l00014">14</a> of file <a class="el" href="a00309_source.html">MPIPartition1D.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;{</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;  <span class="keywordtype">int</span> nlocal;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;  <span class="keywordflow">if</span> (nglobal%nproc == 0) nlocal = nglobal/nproc;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    <span class="keywordflow">if</span> (rank == nproc-1)  nlocal = nglobal/nproc + nglobal%nproc;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    <span class="keywordflow">else</span>                  nlocal = nglobal/nproc;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  }</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;  <span class="keywordflow">return</span>(nlocal);</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a36e2be86c7dc0d9dd088ed2f5842f556"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int MPIRank1D </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ndims</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>iproc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>ip</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Calculate 1D rank from the n-dimensional rank</p>
<p>This function returns the 1D rank, given the n-dimensional rank and the total number of MPI ranks along each spatial dimension.</p>
<p><b>1D</b> <b>Rank:</b> This is the rank of the process in the communicator.<br />
<b>n-Dimensional</b> <b>Rank:</b> This represents an integer array, where each element is the rank of the process along a spatial dimension.</p>
<p>Consider a 2D simulation running with 21 MPI ranks - 7 along the <em>x</em> direction, and 3 along the <em>y</em> direction, as shown in the following figure: </p><div class="image">
<img src="nd_ranks.png" alt="nd_ranks.png"/>
</div>
  The boldface number in the parentheses is the n-dimensional rank (n=2), while the number below it in normal typeface is the 1D rank, corresponding to the rank in the MPI communicator. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ndims</td><td>Number of spatial dimensions </td></tr>
    <tr><td class="paramname">iproc</td><td>Integer array whose elements are the number of MPI ranks along each dimension </td></tr>
    <tr><td class="paramname">ip</td><td>Integer array whose elements are the rank of this process along each dimension </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00312_source.html#l00026">26</a> of file <a class="el" href="a00312_source.html">MPIRank1D.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;{</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  <span class="keywordtype">int</span> i,rank = 0, term = 1;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  <span class="keywordflow">for</span> (i=0; i&lt;ndims; i++) {</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    rank += (ip[i]*term);</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    term *= iproc[i];</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  }</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  </div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <span class="keywordflow">return</span>(rank);</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="afe59a0480bb81cc0d7877ba547b3e28c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int MPIRanknD </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ndims</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>rank</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>iproc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>ip</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Calculate the n-dimensional rank from the 1D rank</p>
<p>This function computes the n-dimensional rank, given the 1D rank and the total number of MPI ranks along each spatial dimension.</p>
<p><b>1D</b> <b>Rank:</b> This is the rank of the process in the communicator.<br />
<b>n-Dimensional</b> <b>Rank:</b> This represents an integer array, where each element is the rank of the process along a spatial dimension.</p>
<p>Consider a 2D simulation running with 21 MPI ranks - 7 along the <em>x</em> direction, and 3 along the <em>y</em> direction, as shown in the following figure: </p><div class="image">
<img src="nd_ranks.png" alt="nd_ranks.png"/>
</div>
  The boldface number in the parentheses is the n-dimensional rank (n=2), while the number below it in normal typeface is the 1D rank, corresponding to the rank in the MPI communicator.</p>
<p>Note:</p><ul>
<li>the array to hold the computed n-dimensional rank must be preallocated and the size must be equal to the number of spatial dimensions. </li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ndims</td><td>Number of spatial dimensions </td></tr>
    <tr><td class="paramname">rank</td><td>1D rank </td></tr>
    <tr><td class="paramname">iproc</td><td>Integer array whose elements are the number of MPI ranks along each dimension </td></tr>
    <tr><td class="paramname">ip</td><td>Integer array whose elements are the rank of this process along each dimesion </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00313_source.html#l00027">27</a> of file <a class="el" href="a00313_source.html">MPIRanknD.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;{</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <span class="keywordtype">int</span> i,term    = 1;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  <span class="keywordflow">for</span> (i=0; i&lt;ndims; i++) term *= iproc[i];</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  <span class="keywordflow">for</span> (i=ndims-1; i&gt;=0; i--) {</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    term /= iproc[i];</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    ip[i] = rank/term;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    rank -= ip[i]*term;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  }</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad9bc49863d543b6251903e9150c46a9c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MPIGetFilename </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>root</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>filename</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Generate a unique filename given the rank of the process to let that process write to its own file</p>
<p>Get a string representing a filename indexed by the MPI rank: <em>filename</em> = <em>root.index</em>, where <em>index</em> is the string corresponding to the MPI rank. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">root</td><td>filename root </td></tr>
    <tr><td class="paramname">c</td><td>MPI communicator </td></tr>
    <tr><td class="paramname">filename</td><td>filename </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00304_source.html#l00019">19</a> of file <a class="el" href="a00304_source.html">MPIGetFilename.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;{</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  <span class="keywordtype">char</span>  tail[<a class="code" href="a00166.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>]=<span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;  <span class="keywordtype">int</span>   rank;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#ifndef serial</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  MPI_Comm  comm = *((MPI_Comm*)c);</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  MPI_Comm_rank(comm,&amp;rank);</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  rank = 0;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  <a class="code" href="a00168.html#a3e3ad5aed581d9ae563190c365dadc41">GetStringFromInteger</a>(rank,tail,4);</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  strcpy(filename,<span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  strcat(filename,root);</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  strcat(filename,<span class="stringliteral">&quot;.&quot;</span> );</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  strcat(filename,tail);</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;}</div>
<div class="ttc" id="a00168_html_a3e3ad5aed581d9ae563190c365dadc41"><div class="ttname"><a href="a00168.html#a3e3ad5aed581d9ae563190c365dadc41">GetStringFromInteger</a></div><div class="ttdeci">void GetStringFromInteger(int, char *, int)</div><div class="ttdef"><b>Definition:</b> <a href="a00222_source.html#l00015">CommonFunctions.c:15</a></div></div>
<div class="ttc" id="a00166_html_a51efea86a4d76d1259893f606b776573"><div class="ttname"><a href="a00166.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a></div><div class="ttdeci">#define _MAX_STRING_SIZE_</div><div class="ttdef"><b>Definition:</b> <a href="a00166_source.html#l00010">basic.h:10</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">
var sc_project=10897352; 
var sc_invisible=1; 
var sc_security="83042f57"; 
var scJsHost = (("https:" == document.location.protocol) ?
"https://secure." : "http://www.");
document.write("<sc"+"ript type='text/javascript' src='" +
scJsHost+
"statcounter.com/counter/counter.js'></"+"script>");
</script>
<noscript><div class="statcounter"><a title="website
statistics" href="http://statcounter.com/"
target="_blank"><img class="statcounter"
src="//c.statcounter.com/10897352/0/83042f57/1/"
alt="website statistics"></a></div></noscript>
<!-- End of StatCounter Code for Default Guide -->
