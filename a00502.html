<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>HyPar: src/Simulation/SolvePETSc.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_html_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">HyPar
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">Finite-Difference Hyperbolic-Parabolic PDE Solver on Cartesian Grids</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('a00502.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">SolvePETSc.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Integrate in time using PETSc.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;math.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;<a class="el" href="a00166_source.html">basic.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="a00165_source.html">arrayfunctions.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="a00173_source.html">io.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="a00167_source.html">boundaryconditions.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="a00152_source.html">petscinterface.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="a00181_source.html">mpivars.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="a00156_source.html">simulation_object.h</a>&gt;</code><br />
</div>
<p><a href="a00502_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ae60511a9aa5cbf216a00a1bb81006bc5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00502.html#ae60511a9aa5cbf216a00a1bb81006bc5">__FUNCT__</a>&#160;&#160;&#160;&quot;SolvePETSc&quot;</td></tr>
<tr class="separator:ae60511a9aa5cbf216a00a1bb81006bc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a116876aaf447559b6cc9fff36a501843"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00502.html#a116876aaf447559b6cc9fff36a501843">CalculateError</a> (void *, void *)</td></tr>
<tr class="separator:a116876aaf447559b6cc9fff36a501843"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5981de613724cb667e98aa872157534e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00502.html#a5981de613724cb667e98aa872157534e">OutputSolution</a> (void *, int)</td></tr>
<tr class="separator:a5981de613724cb667e98aa872157534e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a63727f86c19e70bc897c86edd5015b75"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00502.html#a63727f86c19e70bc897c86edd5015b75">SolvePETSc</a> (void *s, int nsims, int rank, int nproc)</td></tr>
<tr class="memdesc:a63727f86c19e70bc897c86edd5015b75"><td class="mdescLeft">&#160;</td><td class="mdescRight">Integrate in time with PETSc.  <a href="#a63727f86c19e70bc897c86edd5015b75">More...</a><br /></td></tr>
<tr class="separator:a63727f86c19e70bc897c86edd5015b75"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Integrate in time using PETSc. </p>
<dl class="section author"><dt>Author</dt><dd>Debojyoti Ghosh</dd></dl>
<p>Integrate the spatially discretized system in time using PETSc's TS module.<br />
(<a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/index.html">http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/index.html</a>) </p>

<p>Definition in file <a class="el" href="a00502_source.html">SolvePETSc.c</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="ae60511a9aa5cbf216a00a1bb81006bc5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define __FUNCT__&#160;&#160;&#160;&quot;SolvePETSc&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00502_source.html#l00024">24</a> of file <a class="el" href="a00502_source.html">SolvePETSc.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a116876aaf447559b6cc9fff36a501843"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int CalculateError </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>m</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Calculate the error in the final solution</p>
<p>Calculates the error in the solution if the exact solution is available. If the exact solution is not available, the errors are reported as zero. The exact solution should be provided in the file "exact.inp" in the same format as the initial solution. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>Solver object of type <a class="el" href="a00144.html" title="Structure containing all solver-specific variables and functions. ">HyPar</a> </td></tr>
    <tr><td class="paramname">m</td><td>MPI object of type <a class="el" href="a00146.html#a00559" title="Structure of MPI-related variables. ">MPIVariables</a> </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00230_source.html#l00025">25</a> of file <a class="el" href="a00230_source.html">CalculateError.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;{</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  <a class="code" href="a00144.html">HyPar</a>         *solver     = (<a class="code" href="a00144.html">HyPar</a>*)        s;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  <a class="code" href="a00146.html#a00559">MPIVariables</a>  *mpi        = (<a class="code" href="a00146.html#a00559">MPIVariables</a>*) m;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  <span class="keywordtype">int</span>           exact_flag  = 0, i, size;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  <span class="keywordtype">double</span>        <a class="code" href="a00542.html#aca1295e3cf52d990f4cd1d5872f1385a">sum</a>         = 0, global_sum = 0;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <span class="keywordtype">double</span>        *uex        = NULL;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  <a class="code" href="a00166.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a>;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  size = solver-&gt;<a class="code" href="a00144.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; solver-&gt;<a class="code" href="a00144.html#a484873c74138512e41bc50d17b7d955a">ndims</a>; i++) </div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    size *= (solver-&gt;<a class="code" href="a00144.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>[i]+2*solver-&gt;<a class="code" href="a00144.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>);</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  uex = (<span class="keywordtype">double</span>*) calloc (size, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  <span class="keywordtype">char</span> fname_root[<a class="code" href="a00166.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>] = <span class="stringliteral">&quot;exact&quot;</span>;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  <span class="keywordflow">if</span> (solver-&gt;<a class="code" href="a00144.html#a9a0e87291e0e8b9c1445e5482e814c92">nsims</a> &gt; 1) {</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="keywordtype">char</span> index[<a class="code" href="a00166.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>];</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <a class="code" href="a00168.html#a3e3ad5aed581d9ae563190c365dadc41">GetStringFromInteger</a>(solver-&gt;<a class="code" href="a00144.html#a34488172a8ec6e0aaa03cbea46092d3a">my_idx</a>, index, (<span class="keywordtype">int</span>)log10(solver-&gt;<a class="code" href="a00144.html#a9a0e87291e0e8b9c1445e5482e814c92">nsims</a>)+1);</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    strcat(fname_root, <span class="stringliteral">&quot;_&quot;</span>);</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    strcat(fname_root, index);</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  }</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> tolerance = 1e-15;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <a class="code" href="a00166.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00230.html#aef6e3464d167cab9e23a9eacb8f62882">ExactSolution</a>( solver,</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;                      mpi,</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;                      uex,</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;                      fname_root,</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;                      &amp;exact_flag ); <a class="code" href="a00166.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <span class="keywordflow">if</span> (!exact_flag) {</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="comment">/* No exact solution */</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <a class="code" href="a00166.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00194.html#aacd05babc2fa0650f3047f955c38319c">TimeError</a>(solver,mpi,NULL); <a class="code" href="a00166.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    solver-&gt;<a class="code" href="a00144.html#aa40f27cb2afa2db0f0468962be8b3679">error</a>[0] = solver-&gt;<a class="code" href="a00144.html#aa40f27cb2afa2db0f0468962be8b3679">error</a>[1] = solver-&gt;<a class="code" href="a00144.html#aa40f27cb2afa2db0f0468962be8b3679">error</a>[2] = -1;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <a class="code" href="a00166.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00194.html#aacd05babc2fa0650f3047f955c38319c">TimeError</a>(solver,mpi,uex); <a class="code" href="a00166.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="comment">/* calculate solution norms (for relative error) */</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="keywordtype">double</span> solution_norm[3] = {0.0,0.0,0.0};</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="comment">/* L1 */</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    sum = <a class="code" href="a00165.html#a60a3d838d95d860a21de20936f7bb910">ArraySumAbsnD</a>   (solver-&gt;<a class="code" href="a00144.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00144.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00144.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;                           solver-&gt;<a class="code" href="a00144.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,solver-&gt;<a class="code" href="a00144.html#a95e9e0f8a692321b83a2e0ce2789c485">index</a>,uex);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    global_sum = 0; <a class="code" href="a00181.html#abd61f932b070ee84262d9d98b6dd854f">MPISum_double</a>(&amp;global_sum,&amp;sum,1,&amp;mpi-&gt;<a class="code" href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    solution_norm[0] = global_sum/((double)solver-&gt;<a class="code" href="a00144.html#a4e67f54563a3c4ff005dfaf0130f957c">npoints_global</a>);</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="comment">/* L2 */</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    sum = <a class="code" href="a00165.html#a8c279db0af78d8ff386cf1a023a405dd">ArraySumSquarenD</a>(solver-&gt;<a class="code" href="a00144.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00144.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00144.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                           solver-&gt;<a class="code" href="a00144.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,solver-&gt;<a class="code" href="a00144.html#a95e9e0f8a692321b83a2e0ce2789c485">index</a>,uex);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    global_sum = 0; <a class="code" href="a00181.html#abd61f932b070ee84262d9d98b6dd854f">MPISum_double</a>(&amp;global_sum,&amp;sum,1,&amp;mpi-&gt;<a class="code" href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    solution_norm[1] = sqrt(global_sum/((<span class="keywordtype">double</span>)solver-&gt;<a class="code" href="a00144.html#a4e67f54563a3c4ff005dfaf0130f957c">npoints_global</a>));</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="comment">/* Linf */</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    sum = <a class="code" href="a00165.html#ac20bd4916c6169956e5bf80777c6ab8f">ArrayMaxnD</a>      (solver-&gt;<a class="code" href="a00144.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00144.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00144.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                           solver-&gt;<a class="code" href="a00144.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,solver-&gt;<a class="code" href="a00144.html#a95e9e0f8a692321b83a2e0ce2789c485">index</a>,uex);</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    global_sum = 0; <a class="code" href="a00181.html#a33aa37e0050ec72dadb8d63851df51ec">MPIMax_double</a>(&amp;global_sum,&amp;sum,1,&amp;mpi-&gt;<a class="code" href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    solution_norm[2] = global_sum;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="comment">/* compute error = difference between exact and numerical solution */</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <a class="code" href="a00165.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00144.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>,-1.0,uex,size);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="comment">/* calculate L1 norm of error */</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    sum = <a class="code" href="a00165.html#a60a3d838d95d860a21de20936f7bb910">ArraySumAbsnD</a>   (solver-&gt;<a class="code" href="a00144.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00144.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00144.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                           solver-&gt;<a class="code" href="a00144.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,solver-&gt;<a class="code" href="a00144.html#a95e9e0f8a692321b83a2e0ce2789c485">index</a>,uex);</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    global_sum = 0; <a class="code" href="a00181.html#abd61f932b070ee84262d9d98b6dd854f">MPISum_double</a>(&amp;global_sum,&amp;sum,1,&amp;mpi-&gt;<a class="code" href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    solver-&gt;<a class="code" href="a00144.html#aa40f27cb2afa2db0f0468962be8b3679">error</a>[0] = global_sum/((double)solver-&gt;<a class="code" href="a00144.html#a4e67f54563a3c4ff005dfaf0130f957c">npoints_global</a>);</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="comment">/* calculate L2 norm of error */</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    sum = <a class="code" href="a00165.html#a8c279db0af78d8ff386cf1a023a405dd">ArraySumSquarenD</a>(solver-&gt;<a class="code" href="a00144.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00144.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00144.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                           solver-&gt;<a class="code" href="a00144.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,solver-&gt;<a class="code" href="a00144.html#a95e9e0f8a692321b83a2e0ce2789c485">index</a>,uex);</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    global_sum = 0; <a class="code" href="a00181.html#abd61f932b070ee84262d9d98b6dd854f">MPISum_double</a>(&amp;global_sum,&amp;sum,1,&amp;mpi-&gt;<a class="code" href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    solver-&gt;<a class="code" href="a00144.html#aa40f27cb2afa2db0f0468962be8b3679">error</a>[1] = sqrt(global_sum/((<span class="keywordtype">double</span>)solver-&gt;<a class="code" href="a00144.html#a4e67f54563a3c4ff005dfaf0130f957c">npoints_global</a>));</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="comment">/* calculate Linf norm of error */</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    sum = <a class="code" href="a00165.html#ac20bd4916c6169956e5bf80777c6ab8f">ArrayMaxnD</a>      (solver-&gt;<a class="code" href="a00144.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00144.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00144.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                           solver-&gt;<a class="code" href="a00144.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,solver-&gt;<a class="code" href="a00144.html#a95e9e0f8a692321b83a2e0ce2789c485">index</a>,uex);</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    global_sum = 0; <a class="code" href="a00181.html#a33aa37e0050ec72dadb8d63851df51ec">MPIMax_double</a>(&amp;global_sum,&amp;sum,1,&amp;mpi-&gt;<a class="code" href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    solver-&gt;<a class="code" href="a00144.html#aa40f27cb2afa2db0f0468962be8b3679">error</a>[2] = global_sum;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="comment">/* </span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">      decide whether to normalize and report relative errors, </span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">      or report absolute errors.</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">    */</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="keywordflow">if</span> (    (solution_norm[0] &gt; tolerance) </div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        &amp;&amp;  (solution_norm[1] &gt; tolerance) </div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        &amp;&amp;  (solution_norm[2] &gt; tolerance) ) {</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;      solver-&gt;<a class="code" href="a00144.html#aa40f27cb2afa2db0f0468962be8b3679">error</a>[0] /= solution_norm[0];</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;      solver-&gt;<a class="code" href="a00144.html#aa40f27cb2afa2db0f0468962be8b3679">error</a>[1] /= solution_norm[1];</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;      solver-&gt;<a class="code" href="a00144.html#aa40f27cb2afa2db0f0468962be8b3679">error</a>[2] /= solution_norm[2];</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    }</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  }</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  free(uex);</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;}</div>
<div class="ttc" id="a00194_html_aacd05babc2fa0650f3047f955c38319c"><div class="ttname"><a href="a00194.html#aacd05babc2fa0650f3047f955c38319c">TimeError</a></div><div class="ttdeci">int TimeError(void *, void *, double *)</div><div class="ttdef"><b>Definition:</b> <a href="a00520_source.html#l00027">TimeError.c:27</a></div></div>
<div class="ttc" id="a00165_html_ac20bd4916c6169956e5bf80777c6ab8f"><div class="ttname"><a href="a00165.html#ac20bd4916c6169956e5bf80777c6ab8f">ArrayMaxnD</a></div><div class="ttdeci">INLINE double ArrayMaxnD(int, int, int *, int, int *, double *)</div><div class="ttdef"><b>Definition:</b> <a href="a00165_source.html#l00439">arrayfunctions.h:439</a></div></div>
<div class="ttc" id="a00168_html_a3e3ad5aed581d9ae563190c365dadc41"><div class="ttname"><a href="a00168.html#a3e3ad5aed581d9ae563190c365dadc41">GetStringFromInteger</a></div><div class="ttdeci">void GetStringFromInteger(int, char *, int)</div><div class="ttdef"><b>Definition:</b> <a href="a00222_source.html#l00015">CommonFunctions.c:15</a></div></div>
<div class="ttc" id="a00144_html_a38e0371f331cecbe63a77fa03e202afe"><div class="ttname"><a href="a00144.html#a38e0371f331cecbe63a77fa03e202afe">HyPar::dim_local</a></div><div class="ttdeci">int * dim_local</div><div class="ttdef"><b>Definition:</b> <a href="a00172_source.html#l00035">hypar.h:35</a></div></div>
<div class="ttc" id="a00144_html"><div class="ttname"><a href="a00144.html">HyPar</a></div><div class="ttdoc">Structure containing all solver-specific variables and functions. </div><div class="ttdef"><b>Definition:</b> <a href="a00172_source.html#l00023">hypar.h:23</a></div></div>
<div class="ttc" id="a00542_html_aca1295e3cf52d990f4cd1d5872f1385a"><div class="ttname"><a href="a00542.html#aca1295e3cf52d990f4cd1d5872f1385a">StdVecOps::sum</a></div><div class="ttdeci">long sum(const std::vector&lt; int &gt; &amp;a_iv)</div><div class="ttdef"><b>Definition:</b> <a href="a00193_source.html#l00018">std_vec_ops.h:18</a></div></div>
<div class="ttc" id="a00181_html_a33aa37e0050ec72dadb8d63851df51ec"><div class="ttname"><a href="a00181.html#a33aa37e0050ec72dadb8d63851df51ec">MPIMax_double</a></div><div class="ttdeci">int MPIMax_double(double *, double *, int, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00307_source.html#l00038">MPIMax.c:38</a></div></div>
<div class="ttc" id="a00166_html_add9cf96ae374934d245a1dc1ab697a42"><div class="ttname"><a href="a00166.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a></div><div class="ttdeci">#define CHECKERR(ierr)</div><div class="ttdef"><b>Definition:</b> <a href="a00166_source.html#l00014">basic.h:14</a></div></div>
<div class="ttc" id="a00144_html_ae8f6d2fd6490d3153cb4133bf183a404"><div class="ttname"><a href="a00144.html#ae8f6d2fd6490d3153cb4133bf183a404">HyPar::nvars</a></div><div class="ttdeci">int nvars</div><div class="ttdef"><b>Definition:</b> <a href="a00172_source.html#l00029">hypar.h:29</a></div></div>
<div class="ttc" id="a00165_html_a8c279db0af78d8ff386cf1a023a405dd"><div class="ttname"><a href="a00165.html#a8c279db0af78d8ff386cf1a023a405dd">ArraySumSquarenD</a></div><div class="ttdeci">INLINE double ArraySumSquarenD(int, int, int *, int, int *, double *)</div><div class="ttdef"><b>Definition:</b> <a href="a00165_source.html#l00482">arrayfunctions.h:482</a></div></div>
<div class="ttc" id="a00144_html_a95e9e0f8a692321b83a2e0ce2789c485"><div class="ttname"><a href="a00144.html#a95e9e0f8a692321b83a2e0ce2789c485">HyPar::index</a></div><div class="ttdeci">int * index</div><div class="ttdef"><b>Definition:</b> <a href="a00172_source.html#l00086">hypar.h:86</a></div></div>
<div class="ttc" id="a00165_html_a60a3d838d95d860a21de20936f7bb910"><div class="ttname"><a href="a00165.html#a60a3d838d95d860a21de20936f7bb910">ArraySumAbsnD</a></div><div class="ttdeci">INLINE double ArraySumAbsnD(int, int, int *, int, int *, double *)</div><div class="ttdef"><b>Definition:</b> <a href="a00165_source.html#l00463">arrayfunctions.h:463</a></div></div>
<div class="ttc" id="a00144_html_a484873c74138512e41bc50d17b7d955a"><div class="ttname"><a href="a00144.html#a484873c74138512e41bc50d17b7d955a">HyPar::ndims</a></div><div class="ttdeci">int ndims</div><div class="ttdef"><b>Definition:</b> <a href="a00172_source.html#l00026">hypar.h:26</a></div></div>
<div class="ttc" id="a00166_html_a68f50121fb9a7daeaf60e50cdef82ef3"><div class="ttname"><a href="a00166.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a></div><div class="ttdeci">#define _DECLARE_IERR_</div><div class="ttdef"><b>Definition:</b> <a href="a00166_source.html#l00013">basic.h:13</a></div></div>
<div class="ttc" id="a00144_html_a4e67f54563a3c4ff005dfaf0130f957c"><div class="ttname"><a href="a00144.html#a4e67f54563a3c4ff005dfaf0130f957c">HyPar::npoints_global</a></div><div class="ttdeci">int npoints_global</div><div class="ttdef"><b>Definition:</b> <a href="a00172_source.html#l00038">hypar.h:38</a></div></div>
<div class="ttc" id="a00166_html_ad6ab74942c9de13cf0b4c12eb0d91780"><div class="ttname"><a href="a00166.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a></div><div class="ttdeci">#define IERR</div><div class="ttdef"><b>Definition:</b> <a href="a00166_source.html#l00012">basic.h:12</a></div></div>
<div class="ttc" id="a00144_html_a34488172a8ec6e0aaa03cbea46092d3a"><div class="ttname"><a href="a00144.html#a34488172a8ec6e0aaa03cbea46092d3a">HyPar::my_idx</a></div><div class="ttdeci">int my_idx</div><div class="ttdef"><b>Definition:</b> <a href="a00172_source.html#l00053">hypar.h:53</a></div></div>
<div class="ttc" id="a00166_html_a51efea86a4d76d1259893f606b776573"><div class="ttname"><a href="a00166.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a></div><div class="ttdeci">#define _MAX_STRING_SIZE_</div><div class="ttdef"><b>Definition:</b> <a href="a00166_source.html#l00010">basic.h:10</a></div></div>
<div class="ttc" id="a00146_html_adad7a6f85831f3ac84d854b6c80aef43"><div class="ttname"><a href="a00146.html#adad7a6f85831f3ac84d854b6c80aef43">MPIVariables::world</a></div><div class="ttdeci">MPI_Comm world</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00037">mpivars_struct.h:37</a></div></div>
<div class="ttc" id="a00181_html_abd61f932b070ee84262d9d98b6dd854f"><div class="ttname"><a href="a00181.html#abd61f932b070ee84262d9d98b6dd854f">MPISum_double</a></div><div class="ttdeci">int MPISum_double(double *, double *, int, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00314_source.html#l00039">MPISum.c:39</a></div></div>
<div class="ttc" id="a00144_html_a3b6b999a764f1e2ea94bb5f28c7a558c"><div class="ttname"><a href="a00144.html#a3b6b999a764f1e2ea94bb5f28c7a558c">HyPar::u</a></div><div class="ttdeci">double * u</div><div class="ttdef"><b>Definition:</b> <a href="a00172_source.html#l00100">hypar.h:100</a></div></div>
<div class="ttc" id="a00144_html_aafc992b5fa79d5a4036024615d03bce6"><div class="ttname"><a href="a00144.html#aafc992b5fa79d5a4036024615d03bce6">HyPar::ghosts</a></div><div class="ttdeci">int ghosts</div><div class="ttdef"><b>Definition:</b> <a href="a00172_source.html#l00044">hypar.h:44</a></div></div>
<div class="ttc" id="a00230_html_aef6e3464d167cab9e23a9eacb8f62882"><div class="ttname"><a href="a00230.html#aef6e3464d167cab9e23a9eacb8f62882">ExactSolution</a></div><div class="ttdeci">int ExactSolution(void *, void *, double *, char *, int *)</div><div class="ttdef"><b>Definition:</b> <a href="a00232_source.html#l00016">ExactSolution.c:16</a></div></div>
<div class="ttc" id="a00144_html_aa40f27cb2afa2db0f0468962be8b3679"><div class="ttname"><a href="a00144.html#aa40f27cb2afa2db0f0468962be8b3679">HyPar::error</a></div><div class="ttdeci">double error[3]</div><div class="ttdef"><b>Definition:</b> <a href="a00172_source.html#l00339">hypar.h:339</a></div></div>
<div class="ttc" id="a00165_html_a4cd66304bc41a7751842230af3063b62"><div class="ttname"><a href="a00165.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a></div><div class="ttdeci">#define _ArrayAXPY_(x, a, y, size)</div><div class="ttdef"><b>Definition:</b> <a href="a00165_source.html#l00270">arrayfunctions.h:270</a></div></div>
<div class="ttc" id="a00144_html_a9a0e87291e0e8b9c1445e5482e814c92"><div class="ttname"><a href="a00144.html#a9a0e87291e0e8b9c1445e5482e814c92">HyPar::nsims</a></div><div class="ttdeci">int nsims</div><div class="ttdef"><b>Definition:</b> <a href="a00172_source.html#l00056">hypar.h:56</a></div></div>
<div class="ttc" id="a00146_html_a00559"><div class="ttname"><a href="a00146.html#a00559">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00024">mpivars_struct.h:24</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5981de613724cb667e98aa872157534e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int OutputSolution </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nsims</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Write solutions to file</p>
<p>Write out the solution to file </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>Array of simulation objects of type <a class="el" href="a00156.html#a00563" title="Structure defining a simulation. ">SimulationObject</a> </td></tr>
    <tr><td class="paramname">nsims</td><td>Number of simulation objects </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00497_source.html#l00022">22</a> of file <a class="el" href="a00497_source.html">OutputSolution.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;{</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;  <a class="code" href="a00156.html#a00563">SimulationObject</a>* simobj = (<a class="code" href="a00156.html#a00563">SimulationObject</a>*) s;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  <span class="keywordtype">int</span> ns;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  <a class="code" href="a00166.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a>;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  <span class="keywordflow">for</span> (ns = 0; ns &lt; nsims; ns++) {</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <a class="code" href="a00144.html">HyPar</a>*        solver = &amp;(simobj[ns].<a class="code" href="a00156.html#a523947ce4fa7128c4c767163953253b9">solver</a>);</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <a class="code" href="a00146.html#a00559">MPIVariables</a>* mpi    = &amp;(simobj[ns].<a class="code" href="a00156.html#a4afd2c7b3eb8fda452474ebdbe71c8c0">mpi</a>);</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    </div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="comment">/* if WriteOutput() is NULL, then return */</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="keywordflow">if</span> (!solver-&gt;<a class="code" href="a00144.html#a860eb760680191b057e06768287554be">WriteOutput</a>) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  </div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <span class="comment">/* time integration module may have auxiliary arrays to write out, so get them */</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="keywordtype">int</span> NSolutions = 0;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <a class="code" href="a00166.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00194.html#a9bff7fe5ca4249dd82bfad78a1fa09dd">TimeGetAuxSolutions</a>(&amp;NSolutions,NULL,solver,-1,ns); <a class="code" href="a00166.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="keywordflow">if</span> (NSolutions &gt; 10) NSolutions = 10;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  </div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="keywordtype">int</span>  nu;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="keywordtype">char</span> fname_root[<a class="code" href="a00166.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>];</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="keywordtype">char</span> aux_fname_root[<a class="code" href="a00166.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>];</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    strcpy(fname_root, solver-&gt;<a class="code" href="a00144.html#a2f63f9a875bb76e6107cb2e7c725d935">op_fname_root</a>);</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    strcpy(aux_fname_root, solver-&gt;<a class="code" href="a00144.html#a5d741833915983fdcb695f262a73ae7e">aux_op_fname_root</a>);</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="keywordflow">if</span> (nsims &gt; 1) {</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;      <span class="keywordtype">char</span> index[<a class="code" href="a00166.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>];</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;      <a class="code" href="a00168.html#a3e3ad5aed581d9ae563190c365dadc41">GetStringFromInteger</a>(ns, index, (<span class="keywordtype">int</span>)log10(nsims)+1);</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;      strcat(fname_root, <span class="stringliteral">&quot;_&quot;</span>);</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;      strcat(fname_root, index);</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;      strcat(aux_fname_root, <span class="stringliteral">&quot;_&quot;</span>);</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;      strcat(aux_fname_root, index);</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    }</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  </div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="keywordflow">for</span> (nu=0; nu&lt;NSolutions; nu++) {</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;      <span class="keywordtype">double</span>  *uaux = NULL;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;      <a class="code" href="a00166.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00194.html#a9bff7fe5ca4249dd82bfad78a1fa09dd">TimeGetAuxSolutions</a>(&amp;NSolutions,&amp;uaux,solver,nu,ns); <a class="code" href="a00166.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;      <a class="code" href="a00166.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00173.html#aaf888c739c5200d9c58a7154347069b0">WriteArray</a>(  solver-&gt;<a class="code" href="a00144.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;                        solver-&gt;<a class="code" href="a00144.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;                        solver-&gt;<a class="code" href="a00144.html#aa989ebb755986852177779cdf7bd8c85">dim_global</a>,</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;                        solver-&gt;<a class="code" href="a00144.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;                        solver-&gt;<a class="code" href="a00144.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;                        solver-&gt;<a class="code" href="a00144.html#a711aad4cbe735871dd9e91ab575c878b">x</a>,</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;                        uaux,</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;                        solver,</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;                        mpi,</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;                        aux_fname_root ); <a class="code" href="a00166.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;      aux_fname_root[2]++;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    }</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    </div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <a class="code" href="a00166.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00173.html#aaf888c739c5200d9c58a7154347069b0">WriteArray</a>(  solver-&gt;<a class="code" href="a00144.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;                      solver-&gt;<a class="code" href="a00144.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;                      solver-&gt;<a class="code" href="a00144.html#aa989ebb755986852177779cdf7bd8c85">dim_global</a>,</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;                      solver-&gt;<a class="code" href="a00144.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                      solver-&gt;<a class="code" href="a00144.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;                      solver-&gt;<a class="code" href="a00144.html#a711aad4cbe735871dd9e91ab575c878b">x</a>,</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;                      solver-&gt;<a class="code" href="a00144.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>,</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                      solver,</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;                      mpi,</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;                      fname_root ); <a class="code" href="a00166.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  </div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="comment">/* increment the index string, if required */</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="keywordflow">if</span> ((!strcmp(solver-&gt;<a class="code" href="a00144.html#a5f89e286a9eaffdb66d966fa6a290d3f">output_mode</a>,<span class="stringliteral">&quot;serial&quot;</span>)) &amp;&amp; (!strcmp(solver-&gt;<a class="code" href="a00144.html#a4e93cb107e180ef982b74cef7726b70f">op_overwrite</a>,<span class="stringliteral">&quot;no&quot;</span>))) {</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;      <a class="code" href="a00497.html#a55a796b622e90a00d1cb9164ab40c1c3">IncrementFilenameIndex</a>(solver-&gt;<a class="code" href="a00144.html#a0805db42e429173752189696c3c96909">filename_index</a>,solver-&gt;<a class="code" href="a00144.html#af474ca4577de91b658e4399ad0a6d7b3">index_length</a>);</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    }</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  }</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  </div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;}</div>
<div class="ttc" id="a00156_html_a523947ce4fa7128c4c767163953253b9"><div class="ttname"><a href="a00156.html#a523947ce4fa7128c4c767163953253b9">SimulationObject::solver</a></div><div class="ttdeci">HyPar solver</div><div class="ttdef"><b>Definition:</b> <a href="a00156_source.html#l00026">simulation_object.h:26</a></div></div>
<div class="ttc" id="a00168_html_a3e3ad5aed581d9ae563190c365dadc41"><div class="ttname"><a href="a00168.html#a3e3ad5aed581d9ae563190c365dadc41">GetStringFromInteger</a></div><div class="ttdeci">void GetStringFromInteger(int, char *, int)</div><div class="ttdef"><b>Definition:</b> <a href="a00222_source.html#l00015">CommonFunctions.c:15</a></div></div>
<div class="ttc" id="a00144_html_a38e0371f331cecbe63a77fa03e202afe"><div class="ttname"><a href="a00144.html#a38e0371f331cecbe63a77fa03e202afe">HyPar::dim_local</a></div><div class="ttdeci">int * dim_local</div><div class="ttdef"><b>Definition:</b> <a href="a00172_source.html#l00035">hypar.h:35</a></div></div>
<div class="ttc" id="a00144_html"><div class="ttname"><a href="a00144.html">HyPar</a></div><div class="ttdoc">Structure containing all solver-specific variables and functions. </div><div class="ttdef"><b>Definition:</b> <a href="a00172_source.html#l00023">hypar.h:23</a></div></div>
<div class="ttc" id="a00194_html_a9bff7fe5ca4249dd82bfad78a1fa09dd"><div class="ttname"><a href="a00194.html#a9bff7fe5ca4249dd82bfad78a1fa09dd">TimeGetAuxSolutions</a></div><div class="ttdeci">int TimeGetAuxSolutions(int *, double **, void *, int, int)</div><div class="ttdef"><b>Definition:</b> <a href="a00524_source.html#l00029">TimeGetAuxSolutions.c:29</a></div></div>
<div class="ttc" id="a00144_html_a711aad4cbe735871dd9e91ab575c878b"><div class="ttname"><a href="a00144.html#a711aad4cbe735871dd9e91ab575c878b">HyPar::x</a></div><div class="ttdeci">double * x</div><div class="ttdef"><b>Definition:</b> <a href="a00172_source.html#l00091">hypar.h:91</a></div></div>
<div class="ttc" id="a00173_html_aaf888c739c5200d9c58a7154347069b0"><div class="ttname"><a href="a00173.html#aaf888c739c5200d9c58a7154347069b0">WriteArray</a></div><div class="ttdeci">int WriteArray(int, int, int *, int *, int, double *, double *, void *, void *, char *)</div><div class="ttdef"><b>Definition:</b> <a href="a00283_source.html#l00027">WriteArray.c:27</a></div></div>
<div class="ttc" id="a00144_html_aa989ebb755986852177779cdf7bd8c85"><div class="ttname"><a href="a00144.html#aa989ebb755986852177779cdf7bd8c85">HyPar::dim_global</a></div><div class="ttdeci">int * dim_global</div><div class="ttdef"><b>Definition:</b> <a href="a00172_source.html#l00032">hypar.h:32</a></div></div>
<div class="ttc" id="a00166_html_add9cf96ae374934d245a1dc1ab697a42"><div class="ttname"><a href="a00166.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a></div><div class="ttdeci">#define CHECKERR(ierr)</div><div class="ttdef"><b>Definition:</b> <a href="a00166_source.html#l00014">basic.h:14</a></div></div>
<div class="ttc" id="a00144_html_a5f89e286a9eaffdb66d966fa6a290d3f"><div class="ttname"><a href="a00144.html#a5f89e286a9eaffdb66d966fa6a290d3f">HyPar::output_mode</a></div><div class="ttdeci">char output_mode[_MAX_STRING_SIZE_]</div><div class="ttdef"><b>Definition:</b> <a href="a00172_source.html#l00167">hypar.h:167</a></div></div>
<div class="ttc" id="a00144_html_a860eb760680191b057e06768287554be"><div class="ttname"><a href="a00144.html#a860eb760680191b057e06768287554be">HyPar::WriteOutput</a></div><div class="ttdeci">int(* WriteOutput)(int, int, int *, double *, double *, char *, int *)</div><div class="ttdef"><b>Definition:</b> <a href="a00172_source.html#l00190">hypar.h:190</a></div></div>
<div class="ttc" id="a00144_html_a0805db42e429173752189696c3c96909"><div class="ttname"><a href="a00144.html#a0805db42e429173752189696c3c96909">HyPar::filename_index</a></div><div class="ttdeci">char * filename_index</div><div class="ttdef"><b>Definition:</b> <a href="a00172_source.html#l00178">hypar.h:178</a></div></div>
<div class="ttc" id="a00144_html_ae8f6d2fd6490d3153cb4133bf183a404"><div class="ttname"><a href="a00144.html#ae8f6d2fd6490d3153cb4133bf183a404">HyPar::nvars</a></div><div class="ttdeci">int nvars</div><div class="ttdef"><b>Definition:</b> <a href="a00172_source.html#l00029">hypar.h:29</a></div></div>
<div class="ttc" id="a00144_html_af474ca4577de91b658e4399ad0a6d7b3"><div class="ttname"><a href="a00144.html#af474ca4577de91b658e4399ad0a6d7b3">HyPar::index_length</a></div><div class="ttdeci">int index_length</div><div class="ttdef"><b>Definition:</b> <a href="a00172_source.html#l00180">hypar.h:180</a></div></div>
<div class="ttc" id="a00144_html_a484873c74138512e41bc50d17b7d955a"><div class="ttname"><a href="a00144.html#a484873c74138512e41bc50d17b7d955a">HyPar::ndims</a></div><div class="ttdeci">int ndims</div><div class="ttdef"><b>Definition:</b> <a href="a00172_source.html#l00026">hypar.h:26</a></div></div>
<div class="ttc" id="a00144_html_a5d741833915983fdcb695f262a73ae7e"><div class="ttname"><a href="a00144.html#a5d741833915983fdcb695f262a73ae7e">HyPar::aux_op_fname_root</a></div><div class="ttdeci">char aux_op_fname_root[_MAX_STRING_SIZE_]</div><div class="ttdef"><b>Definition:</b> <a href="a00172_source.html#l00187">hypar.h:187</a></div></div>
<div class="ttc" id="a00166_html_a68f50121fb9a7daeaf60e50cdef82ef3"><div class="ttname"><a href="a00166.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a></div><div class="ttdeci">#define _DECLARE_IERR_</div><div class="ttdef"><b>Definition:</b> <a href="a00166_source.html#l00013">basic.h:13</a></div></div>
<div class="ttc" id="a00156_html_a4afd2c7b3eb8fda452474ebdbe71c8c0"><div class="ttname"><a href="a00156.html#a4afd2c7b3eb8fda452474ebdbe71c8c0">SimulationObject::mpi</a></div><div class="ttdeci">MPIVariables mpi</div><div class="ttdef"><b>Definition:</b> <a href="a00156_source.html#l00025">simulation_object.h:25</a></div></div>
<div class="ttc" id="a00166_html_ad6ab74942c9de13cf0b4c12eb0d91780"><div class="ttname"><a href="a00166.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a></div><div class="ttdeci">#define IERR</div><div class="ttdef"><b>Definition:</b> <a href="a00166_source.html#l00012">basic.h:12</a></div></div>
<div class="ttc" id="a00497_html_a55a796b622e90a00d1cb9164ab40c1c3"><div class="ttname"><a href="a00497.html#a55a796b622e90a00d1cb9164ab40c1c3">IncrementFilenameIndex</a></div><div class="ttdeci">void IncrementFilenameIndex(char *, int)</div><div class="ttdef"><b>Definition:</b> <a href="a00234_source.html#l00046">IncrementFilename.c:46</a></div></div>
<div class="ttc" id="a00166_html_a51efea86a4d76d1259893f606b776573"><div class="ttname"><a href="a00166.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a></div><div class="ttdeci">#define _MAX_STRING_SIZE_</div><div class="ttdef"><b>Definition:</b> <a href="a00166_source.html#l00010">basic.h:10</a></div></div>
<div class="ttc" id="a00144_html_a4e93cb107e180ef982b74cef7726b70f"><div class="ttname"><a href="a00144.html#a4e93cb107e180ef982b74cef7726b70f">HyPar::op_overwrite</a></div><div class="ttdeci">char op_overwrite[_MAX_STRING_SIZE_]</div><div class="ttdef"><b>Definition:</b> <a href="a00172_source.html#l00175">hypar.h:175</a></div></div>
<div class="ttc" id="a00144_html_a3b6b999a764f1e2ea94bb5f28c7a558c"><div class="ttname"><a href="a00144.html#a3b6b999a764f1e2ea94bb5f28c7a558c">HyPar::u</a></div><div class="ttdeci">double * u</div><div class="ttdef"><b>Definition:</b> <a href="a00172_source.html#l00100">hypar.h:100</a></div></div>
<div class="ttc" id="a00144_html_a2f63f9a875bb76e6107cb2e7c725d935"><div class="ttname"><a href="a00144.html#a2f63f9a875bb76e6107cb2e7c725d935">HyPar::op_fname_root</a></div><div class="ttdeci">char op_fname_root[_MAX_STRING_SIZE_]</div><div class="ttdef"><b>Definition:</b> <a href="a00172_source.html#l00185">hypar.h:185</a></div></div>
<div class="ttc" id="a00144_html_aafc992b5fa79d5a4036024615d03bce6"><div class="ttname"><a href="a00144.html#aafc992b5fa79d5a4036024615d03bce6">HyPar::ghosts</a></div><div class="ttdeci">int ghosts</div><div class="ttdef"><b>Definition:</b> <a href="a00172_source.html#l00044">hypar.h:44</a></div></div>
<div class="ttc" id="a00156_html_a00563"><div class="ttname"><a href="a00156.html#a00563">SimulationObject</a></div><div class="ttdoc">Structure defining a simulation. </div><div class="ttdef"><b>Definition:</b> <a href="a00156_source.html#l00023">simulation_object.h:23</a></div></div>
<div class="ttc" id="a00146_html_a00559"><div class="ttname"><a href="a00146.html#a00559">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00024">mpivars_struct.h:24</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a63727f86c19e70bc897c86edd5015b75"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int SolvePETSc </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nsims</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>rank</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nproc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Integrate in time with PETSc. </p>
<p>This function integrates the semi-discrete ODE (obtained from discretizing the PDE in space) using the time-integration module of PETSc (<a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/index.html">http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/index.html</a>). The time-integration context is set up using the parameters specified in the input file. However, they can also be specified using PETSc's command line inputs.<br />
<br />
See PETSc's documentation and examples for more details on how to use its TS module. All functions and data types whose names start with Vec, Mat, PC, KSP, SNES, and TS are PETSc functions - refer to the PETSc documentation (usually googling with the function name shows the man page for that function on PETSc's website). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>Array of simulation objects of type <a class="el" href="a00156.html#a00563" title="Structure defining a simulation. ">SimulationObject</a> </td></tr>
    <tr><td class="paramname">nsims</td><td>number of simulation objects </td></tr>
    <tr><td class="paramname">rank</td><td>MPI rank of this process </td></tr>
    <tr><td class="paramname">nproc</td><td>Number of MPI processes </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00502_source.html#l00045">45</a> of file <a class="el" href="a00502_source.html">SolvePETSc.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;{</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <a class="code" href="a00156.html#a00563">SimulationObject</a>* sim = (<a class="code" href="a00156.html#a00563">SimulationObject</a>*) s;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <span class="keywordflow">if</span> (nsims &gt; 1) {</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    fprintf(stderr,<span class="stringliteral">&quot;Error in SolvePETSc: Ensemble simulations with nsims &gt; 1 not yet supported!\n&quot;</span>);</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  }</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <a class="code" href="a00144.html">HyPar</a>           *solver = &amp;(sim[0].<a class="code" href="a00156.html#a523947ce4fa7128c4c767163953253b9">solver</a>);</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <a class="code" href="a00146.html#a00559">MPIVariables</a>    *mpi    = &amp;(sim[0].<a class="code" href="a00156.html#a4afd2c7b3eb8fda452474ebdbe71c8c0">mpi</a>);</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  PetscErrorCode  ierr    = 0, d;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  TS              ts;     <span class="comment">/* time integration object               */</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  Vec             Y,Z;    <span class="comment">/* PETSc solution vectors                */</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  Mat             A, B;   <span class="comment">/* Jacobian and preconditioning matrices */</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  TSType          time_scheme;  <span class="comment">/* time integration method         */</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  TSProblemType   ptype;  <span class="comment">/* problem type - nonlinear or linear    */</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="keywordtype">int</span>             flag_mat_a = 0, flag_mat_b = 0, iAuxSize = 0, i;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  PetscFunctionBegin;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <span class="comment">/* Register custom time-integration methods, if specified */</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  ierr = <a class="code" href="a00152.html#a005fac516715e5fb65baa1540a79c82c">PetscRegisterTIMethods</a>(mpi-&gt;<a class="code" href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>); <a class="code" href="a00166.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <span class="keywordflow">if</span>(!mpi-&gt;<a class="code" href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) printf(<span class="stringliteral">&quot;Setting up PETSc time integration... \n&quot;</span>);</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  <span class="comment">/* create and set a PETSc context */</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  <a class="code" href="a00152.html#a00562">PETScContext</a> context;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  context.<a class="code" href="a00152.html#ade1bc5cad8c6735a891a28f637cbfb06">solver</a> = solver;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  context.<a class="code" href="a00152.html#abaa15763a88d05dc68ff230ce570eee9">mpi</a>    = mpi;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  context.<a class="code" href="a00152.html#a34cbd56d5136d5e8b5ea2cbb901c04cd">tic</a>    = 0;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  context.<a class="code" href="a00152.html#a376b6b34e162357d201827d01a5aa2a4">flag_hyperbolic</a>     = <a class="code" href="a00152.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>; </div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  context.<a class="code" href="a00152.html#a6a0edd627a2b2cc687d1031e3884dd6a">flag_hyperbolic_f</a>   = <a class="code" href="a00152.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>; </div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  context.<a class="code" href="a00152.html#a21b4785029b7597816341479bc3260b4">flag_hyperbolic_df</a>  = <a class="code" href="a00152.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>; </div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  context.<a class="code" href="a00152.html#ac48ad2561e5e125d2789133e848db1d9">flag_parabolic</a>      = <a class="code" href="a00152.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>; </div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  context.<a class="code" href="a00152.html#a54c0451c4ae9650a54f54246f1f8823b">flag_source</a>         = <a class="code" href="a00152.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>; </div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  context.<a class="code" href="a00152.html#a200f63fcca813d56a5cf3209546cedb2">flag_is_linear</a>      = 0;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  context.<a class="code" href="a00152.html#a0c5f291f027b0928672b89121f44c0fc">globalDOF</a>           = NULL;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  context.<a class="code" href="a00152.html#ab991f69858c9aada0736623db264237e">points</a>              = NULL;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  ierr = <a class="code" href="a00152.html#ae4a99505d5f322bfc1c590e3d31fcc0b">PetscCreatePointList</a>(&amp;context);</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <span class="comment">/* create and initialize PETSc solution vector and other parameters */</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <span class="comment">/* PETSc solution vector does not have ghost points */</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <span class="keywordtype">int</span> total_size = context.<a class="code" href="a00152.html#a515ec0fe2abce5449e37ae520974cf5f">npoints</a> * solver-&gt;<a class="code" href="a00144.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  ierr = VecCreate(MPI_COMM_WORLD,&amp;Y); CHKERRQ(ierr);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  ierr = VecSetSizes(Y,total_size,PETSC_DECIDE); CHKERRQ(ierr);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  ierr = VecSetUp(Y); CHKERRQ(ierr);</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <span class="comment">/* copy initial solution to PETSc&#39;s vector */</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  ierr = <a class="code" href="a00152.html#a94499efe0f52b5174ce7105de5ab1a37">TransferVecToPETSc</a>(solver-&gt;<a class="code" href="a00144.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>,Y,&amp;context); <a class="code" href="a00166.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <span class="comment">/* Create the global DOF mapping for all the grid points */</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  ierr = <a class="code" href="a00152.html#ae4815491f5992839fdb3949e5dedec8e">PetscGlobalDOF</a>(&amp;context);</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <span class="comment">/* Define and initialize the time-integration object */</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  ierr = TSCreate(MPI_COMM_WORLD,&amp;ts); CHKERRQ(ierr);</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  ierr = TSSetMaxSteps(ts,solver-&gt;<a class="code" href="a00144.html#af0d8e0d5d3de3869b941b66b6caaf964">n_iter</a>); CHKERRQ(ierr);</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  ierr = TSSetMaxTime(ts,solver-&gt;<a class="code" href="a00144.html#a03e28be41881b703c836edbfe9b51b17">dt</a>*solver-&gt;<a class="code" href="a00144.html#af0d8e0d5d3de3869b941b66b6caaf964">n_iter</a>); CHKERRQ(ierr);</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  ierr = TSSetTimeStep(ts,solver-&gt;<a class="code" href="a00144.html#a03e28be41881b703c836edbfe9b51b17">dt</a>); CHKERRQ(ierr);</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  ierr = TSSetTime(ts,0.0); CHKERRQ(ierr);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  ierr = TSSetExactFinalTime(ts,TS_EXACTFINALTIME_MATCHSTEP); CHKERRQ(ierr);</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  ierr = TSSetType(ts,TSBEULER); CHKERRQ(ierr);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  <span class="comment">/* set default time step adaptivity to none */</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  TSAdapt adapt;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  ierr = TSGetAdapt(ts,&amp;adapt);</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  TSAdaptSetType(adapt,TSADAPTNONE);</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <span class="comment">/* set options from input */</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  ierr = TSSetFromOptions(ts); CHKERRQ(ierr);</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  <span class="comment">/* Define the right and left -hand side functions for each time-integration scheme */</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  ierr = TSGetType(ts,&amp;time_scheme); CHKERRQ(ierr);</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  ierr = TSGetProblemType(ts,&amp;ptype); CHKERRQ(ierr);</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  <span class="keywordflow">if</span> (!strcmp(time_scheme,TSARKIMEX)) {</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="comment">/* implicit - explicit time integration */</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    ierr = TSSetRHSFunction(ts,PETSC_NULL,<a class="code" href="a00152.html#ac7d9b0a219eb22bfd37482b741bd79c9">PetscRHSFunctionIMEX</a>,&amp;context); CHKERRQ(ierr);</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    ierr = TSSetIFunction  (ts,PETSC_NULL,<a class="code" href="a00152.html#a9d093c3140369a1178dd5b9589a926b1">PetscIFunctionIMEX</a>,  &amp;context); CHKERRQ(ierr);</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    SNES     snes;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    KSP      ksp;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    PC       pc;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    SNESType snestype;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    ierr = TSGetSNES(ts,&amp;snes); CHKERRQ(ierr);</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    ierr = SNESGetType(snes,&amp;snestype); CHKERRQ(ierr);</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="comment">/* Matrix-free representation of the Jacobian */</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    flag_mat_a = 1;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    ierr = MatCreateShell(MPI_COMM_WORLD,total_size,total_size,PETSC_DETERMINE,</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                          PETSC_DETERMINE,&amp;context,&amp;A); CHKERRQ(ierr);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="keywordflow">if</span> ((!strcmp(snestype,SNESKSPONLY)) || (ptype == TS_LINEAR)) {</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;      <span class="comment">/* linear problem */</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;      context.<a class="code" href="a00152.html#a200f63fcca813d56a5cf3209546cedb2">flag_is_linear</a> = 1;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;      ierr = MatShellSetOperation(A,MATOP_MULT,(<span class="keywordtype">void</span> (*)(<span class="keywordtype">void</span>))<a class="code" href="a00152.html#a8778c346e27f42f0583c63909c2ea544">PetscJacobianFunctionIMEX_Linear</a>); CHKERRQ(ierr);</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;      ierr = SNESSetType(snes,SNESKSPONLY); CHKERRQ(ierr);</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;      <span class="comment">/* nonlinear problem */</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;      context.<a class="code" href="a00152.html#a200f63fcca813d56a5cf3209546cedb2">flag_is_linear</a> = 0;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;      context.<a class="code" href="a00152.html#ad62e14c19e38497048380c4a7fe10e12">jfnk_eps</a> = 1e-7;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;      ierr = PetscOptionsGetReal(NULL,NULL,<span class="stringliteral">&quot;-jfnk_epsilon&quot;</span>,&amp;context.<a class="code" href="a00152.html#ad62e14c19e38497048380c4a7fe10e12">jfnk_eps</a>,NULL); CHKERRQ(ierr);</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;      ierr = MatShellSetOperation(A,MATOP_MULT,(<span class="keywordtype">void</span> (*)(<span class="keywordtype">void</span>))<a class="code" href="a00152.html#a4edf057726501be3e8fe54e16fafe07b">PetscJacobianFunctionIMEX_JFNK</a>); CHKERRQ(ierr);</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    }</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    ierr = MatSetUp(A); CHKERRQ(ierr);</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    context.<a class="code" href="a00152.html#a271fbbfea71118710d4a2fb13eb4c1cc">flag_use_precon</a> = 0;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    ierr = PetscOptionsGetBool(PETSC_NULL,PETSC_NULL,<span class="stringliteral">&quot;-with_pc&quot;</span>,(PetscBool*)(&amp;context.<a class="code" href="a00152.html#a271fbbfea71118710d4a2fb13eb4c1cc">flag_use_precon</a>),PETSC_NULL); CHKERRQ(ierr);</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="keywordflow">if</span> (context.<a class="code" href="a00152.html#a271fbbfea71118710d4a2fb13eb4c1cc">flag_use_precon</a>) {</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;      <span class="comment">/* check if flux Jacobian of the physical model is defined */</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;      <span class="keywordflow">if</span> (!solver-&gt;<a class="code" href="a00144.html#a25c87c7c874c7e08981688fe6c51167b">JFunction</a>) {</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) {</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;          fprintf(stderr,<span class="stringliteral">&quot;Error in SolvePETSc(): solver-&gt;JFunction (point-wise flux Jacobian) must &quot;</span>);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;          fprintf(stderr,<span class="stringliteral">&quot;be defined for preconditioning.\n&quot;</span>);</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        }</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        PetscFunctionReturn(1);</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;      }</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;      <span class="comment">/* Set up preconditioner matrix */</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;      flag_mat_b = 1;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;      ierr = MatCreateAIJ(MPI_COMM_WORLD,total_size,total_size,PETSC_DETERMINE,PETSC_DETERMINE,</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                          (solver-&gt;<a class="code" href="a00144.html#a484873c74138512e41bc50d17b7d955a">ndims</a>*2+1)*solver-&gt;<a class="code" href="a00144.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,NULL,</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                          2*solver-&gt;<a class="code" href="a00144.html#a484873c74138512e41bc50d17b7d955a">ndims</a>*solver-&gt;<a class="code" href="a00144.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,NULL,&amp;B); CHKERRQ(ierr);</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;      ierr = MatSetBlockSize(B,solver-&gt;<a class="code" href="a00144.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;      <span class="comment">/* Set the IJacobian function for TS */</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      ierr = TSSetIJacobian(ts,A,B,<a class="code" href="a00152.html#a82aacb94c1481144ce3e43d40d1f04d4">PetscIJacobianIMEX</a>,&amp;context); CHKERRQ(ierr);</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;      <span class="comment">/* Set the IJacobian function for TS */</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;      ierr = TSSetIJacobian(ts,A,A,<a class="code" href="a00152.html#a82aacb94c1481144ce3e43d40d1f04d4">PetscIJacobianIMEX</a>,&amp;context); CHKERRQ(ierr);</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;      <span class="comment">/* Set PC (preconditioner) to none */</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;      ierr = SNESGetKSP(snes,&amp;ksp); CHKERRQ(ierr);</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;      ierr = KSPGetPC(ksp,&amp;pc); CHKERRQ(ierr);</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      ierr = PCSetType(pc,PCNONE); CHKERRQ(ierr);</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    }</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="comment">/* read the implicit/explicit flags for each of the terms for IMEX schemes */</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="comment">/* default -&gt; hyperbolic - explicit, parabolic and source - implicit       */</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    PetscBool flag = PETSC_FALSE;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    context.<a class="code" href="a00152.html#a376b6b34e162357d201827d01a5aa2a4">flag_hyperbolic</a>     = <a class="code" href="a00152.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>; </div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    context.<a class="code" href="a00152.html#a6a0edd627a2b2cc687d1031e3884dd6a">flag_hyperbolic_f</a>   = <a class="code" href="a00152.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>; </div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    context.<a class="code" href="a00152.html#a21b4785029b7597816341479bc3260b4">flag_hyperbolic_df</a>  = <a class="code" href="a00152.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>; </div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    context.<a class="code" href="a00152.html#ac48ad2561e5e125d2789133e848db1d9">flag_parabolic</a>      = <a class="code" href="a00152.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>; </div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    context.<a class="code" href="a00152.html#a54c0451c4ae9650a54f54246f1f8823b">flag_source</a>         = <a class="code" href="a00152.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>; </div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00144.html#a5bed0cb9665daad89f4377c4f7609df4">SplitHyperbolicFlux</a>,<span class="stringliteral">&quot;yes&quot;</span>)) {</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      flag = PETSC_FALSE; </div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;      ierr = PetscOptionsGetBool(PETSC_NULL,PETSC_NULL,<span class="stringliteral">&quot;-hyperbolic_f_explicit&quot;</span>,&amp;flag,PETSC_NULL); CHKERRQ(ierr);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;      <span class="keywordflow">if</span> (flag == PETSC_TRUE) context.<a class="code" href="a00152.html#a6a0edd627a2b2cc687d1031e3884dd6a">flag_hyperbolic_f</a> = <a class="code" href="a00152.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>; </div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;      flag = PETSC_FALSE; </div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;      ierr = PetscOptionsGetBool(PETSC_NULL,PETSC_NULL,<span class="stringliteral">&quot;-hyperbolic_f_implicit&quot;</span>,&amp;flag,PETSC_NULL); CHKERRQ(ierr);</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      <span class="keywordflow">if</span> (flag == PETSC_TRUE) context.<a class="code" href="a00152.html#a6a0edd627a2b2cc687d1031e3884dd6a">flag_hyperbolic_f</a> = <a class="code" href="a00152.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>; </div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;      flag = PETSC_FALSE; </div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      ierr = PetscOptionsGetBool(PETSC_NULL,PETSC_NULL,<span class="stringliteral">&quot;-hyperbolic_df_explicit&quot;</span>,&amp;flag,PETSC_NULL); CHKERRQ(ierr);</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;      <span class="keywordflow">if</span> (flag == PETSC_TRUE) context.<a class="code" href="a00152.html#a21b4785029b7597816341479bc3260b4">flag_hyperbolic_df</a> = <a class="code" href="a00152.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>; </div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;      flag = PETSC_FALSE; </div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;      ierr = PetscOptionsGetBool(PETSC_NULL,PETSC_NULL,<span class="stringliteral">&quot;-hyperbolic_df_implicit&quot;</span>,&amp;flag,PETSC_NULL); CHKERRQ(ierr);</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      <span class="keywordflow">if</span> (flag == PETSC_TRUE) context.<a class="code" href="a00152.html#a21b4785029b7597816341479bc3260b4">flag_hyperbolic_df</a> = <a class="code" href="a00152.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>; </div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;      flag = PETSC_FALSE; </div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;      ierr = PetscOptionsGetBool(PETSC_NULL,PETSC_NULL,<span class="stringliteral">&quot;-hyperbolic_explicit&quot;</span>,&amp;flag,PETSC_NULL); CHKERRQ(ierr);</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      <span class="keywordflow">if</span> (flag == PETSC_TRUE) context.<a class="code" href="a00152.html#a376b6b34e162357d201827d01a5aa2a4">flag_hyperbolic</a> = <a class="code" href="a00152.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>; </div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      flag = PETSC_FALSE; </div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      ierr = PetscOptionsGetBool(PETSC_NULL,PETSC_NULL,<span class="stringliteral">&quot;-hyperbolic_implicit&quot;</span>,&amp;flag,PETSC_NULL); CHKERRQ(ierr);</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;      <span class="keywordflow">if</span> (flag == PETSC_TRUE) context.<a class="code" href="a00152.html#a376b6b34e162357d201827d01a5aa2a4">flag_hyperbolic</a> = <a class="code" href="a00152.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>; </div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    }</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    flag = PETSC_FALSE; </div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    ierr = PetscOptionsGetBool(PETSC_NULL,PETSC_NULL,<span class="stringliteral">&quot;-parabolic_explicit&quot;</span>,&amp;flag,PETSC_NULL); CHKERRQ(ierr);</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="keywordflow">if</span> (flag == PETSC_TRUE) context.<a class="code" href="a00152.html#ac48ad2561e5e125d2789133e848db1d9">flag_parabolic</a> = <a class="code" href="a00152.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>; </div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    flag = PETSC_FALSE; </div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    ierr = PetscOptionsGetBool(PETSC_NULL,PETSC_NULL,<span class="stringliteral">&quot;-parabolic_implicit&quot;</span>,&amp;flag,PETSC_NULL); CHKERRQ(ierr);</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="keywordflow">if</span> (flag == PETSC_TRUE) context.<a class="code" href="a00152.html#ac48ad2561e5e125d2789133e848db1d9">flag_parabolic</a> = <a class="code" href="a00152.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>; </div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    flag = PETSC_FALSE; </div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    ierr = PetscOptionsGetBool(PETSC_NULL,PETSC_NULL,<span class="stringliteral">&quot;-source_explicit&quot;</span>,&amp;flag,PETSC_NULL); CHKERRQ(ierr);</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="keywordflow">if</span> (flag == PETSC_TRUE) context.<a class="code" href="a00152.html#a54c0451c4ae9650a54f54246f1f8823b">flag_source</a> = <a class="code" href="a00152.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>; </div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    flag = PETSC_FALSE; </div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    ierr = PetscOptionsGetBool(PETSC_NULL,PETSC_NULL,<span class="stringliteral">&quot;-source_implicit&quot;</span>,&amp;flag,PETSC_NULL); CHKERRQ(ierr);</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="keywordflow">if</span> (flag == PETSC_TRUE) context.<a class="code" href="a00152.html#a54c0451c4ae9650a54f54246f1f8823b">flag_source</a> = <a class="code" href="a00152.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>; </div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    flag = PETSC_FALSE;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    ierr = PetscOptionsGetBool(PETSC_NULL,PETSC_NULL,<span class="stringliteral">&quot;-ts_arkimex_fully_implicit&quot;</span>,&amp;flag,PETSC_NULL); CHKERRQ(ierr);</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="keywordflow">if</span> (flag == PETSC_TRUE) {</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;      context.<a class="code" href="a00152.html#a6a0edd627a2b2cc687d1031e3884dd6a">flag_hyperbolic_f</a>   = <a class="code" href="a00152.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;      context.<a class="code" href="a00152.html#a21b4785029b7597816341479bc3260b4">flag_hyperbolic_df</a>  = <a class="code" href="a00152.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;      context.<a class="code" href="a00152.html#a376b6b34e162357d201827d01a5aa2a4">flag_hyperbolic</a>     = <a class="code" href="a00152.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;      context.<a class="code" href="a00152.html#ac48ad2561e5e125d2789133e848db1d9">flag_parabolic</a>      = <a class="code" href="a00152.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;      context.<a class="code" href="a00152.html#a54c0451c4ae9650a54f54246f1f8823b">flag_source</a>         = <a class="code" href="a00152.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    }</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <span class="comment">/* print out a summary of the treatment of each term */</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) {</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      printf(<span class="stringliteral">&quot;Implicit-Explicit time-integration:-\n&quot;</span>);</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00144.html#a5bed0cb9665daad89f4377c4f7609df4">SplitHyperbolicFlux</a>,<span class="stringliteral">&quot;yes&quot;</span>)) {</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        <span class="keywordflow">if</span> (context.<a class="code" href="a00152.html#a6a0edd627a2b2cc687d1031e3884dd6a">flag_hyperbolic_f</a> == <a class="code" href="a00152.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>)  printf(<span class="stringliteral">&quot;Hyperbolic (f-df) term: Explicit\n&quot;</span>);</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        <span class="keywordflow">else</span>                                          printf(<span class="stringliteral">&quot;Hyperbolic (f-df) term: Implicit\n&quot;</span>);</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        <span class="keywordflow">if</span> (context.<a class="code" href="a00152.html#a21b4785029b7597816341479bc3260b4">flag_hyperbolic_df</a> == <a class="code" href="a00152.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>) printf(<span class="stringliteral">&quot;Hyperbolic (df)   term: Explicit\n&quot;</span>);</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        <span class="keywordflow">else</span>                                          printf(<span class="stringliteral">&quot;Hyperbolic (df)   term: Implicit\n&quot;</span>);</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        <span class="keywordflow">if</span> (context.<a class="code" href="a00152.html#a376b6b34e162357d201827d01a5aa2a4">flag_hyperbolic</a> == <a class="code" href="a00152.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>)    printf(<span class="stringliteral">&quot;Hyperbolic        term: Explicit\n&quot;</span>);</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        <span class="keywordflow">else</span>                                          printf(<span class="stringliteral">&quot;Hyperbolic        term: Implicit\n&quot;</span>);</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;      }</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;      <span class="keywordflow">if</span> (context.<a class="code" href="a00152.html#ac48ad2561e5e125d2789133e848db1d9">flag_parabolic</a> == <a class="code" href="a00152.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>)       printf(<span class="stringliteral">&quot;Parabolic         term: Explicit\n&quot;</span>);</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;      <span class="keywordflow">else</span>                                            printf(<span class="stringliteral">&quot;Parabolic         term: Implicit\n&quot;</span>);</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      <span class="keywordflow">if</span> (context.<a class="code" href="a00152.html#a54c0451c4ae9650a54f54246f1f8823b">flag_source</a>    == <a class="code" href="a00152.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>)       printf(<span class="stringliteral">&quot;Source            term: Explicit\n&quot;</span>);</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      <span class="keywordflow">else</span>                                            printf(<span class="stringliteral">&quot;Source            term: Implicit\n&quot;</span>);</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    }</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((!strcmp(time_scheme,TSEULER)) || (!strcmp(time_scheme,TSRK)) || (!strcmp(time_scheme,TSSSP))) {</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="comment">/* Explicit time integration */</span>    </div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    ierr = TSSetRHSFunction(ts,PETSC_NULL,<a class="code" href="a00152.html#ac67533553372ed2b44b32d095c775f5c">PetscRHSFunctionExpl</a>,&amp;context); CHKERRQ(ierr);</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="comment">/* Implicit or explicit time integration */</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    ierr = TSSetRHSFunction(ts,PETSC_NULL,<a class="code" href="a00152.html#a91eb21ee4374b79a74f413d926344d7e">PetscRHSFunctionImpl</a>,&amp;context); CHKERRQ(ierr);</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    SNES     snes;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    KSP      ksp;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    PC       pc;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    SNESType snestype;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    ierr = TSGetSNES(ts,&amp;snes); CHKERRQ(ierr);</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    ierr = SNESGetType(snes,&amp;snestype); CHKERRQ(ierr);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="comment">/* Matrix-free representation of the Jacobian */</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    flag_mat_a = 1;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    ierr = MatCreateShell(MPI_COMM_WORLD,total_size,total_size,PETSC_DETERMINE,</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                          PETSC_DETERMINE,&amp;context,&amp;A); CHKERRQ(ierr);</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="keywordflow">if</span> ((!strcmp(snestype,SNESKSPONLY)) || (ptype == TS_LINEAR)) {</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;      <span class="comment">/* linear problem */</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;      context.<a class="code" href="a00152.html#a200f63fcca813d56a5cf3209546cedb2">flag_is_linear</a> = 1;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      ierr = MatShellSetOperation(A,MATOP_MULT,(<span class="keywordtype">void</span> (*)(<span class="keywordtype">void</span>))<a class="code" href="a00152.html#abed41de2efef801be98f8338aa2672f2">PetscJacobianFunction_Linear</a>); CHKERRQ(ierr);</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;      ierr = SNESSetType(snes,SNESKSPONLY); CHKERRQ(ierr);</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;      <span class="comment">/* nonlinear problem */</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      context.<a class="code" href="a00152.html#a200f63fcca813d56a5cf3209546cedb2">flag_is_linear</a> = 0;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;      context.<a class="code" href="a00152.html#ad62e14c19e38497048380c4a7fe10e12">jfnk_eps</a> = 1e-7;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      ierr = PetscOptionsGetReal(NULL,NULL,<span class="stringliteral">&quot;-jfnk_epsilon&quot;</span>,&amp;context.<a class="code" href="a00152.html#ad62e14c19e38497048380c4a7fe10e12">jfnk_eps</a>,NULL); CHKERRQ(ierr);</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;      ierr = MatShellSetOperation(A,MATOP_MULT,(<span class="keywordtype">void</span> (*)(<span class="keywordtype">void</span>))<a class="code" href="a00152.html#a68f5a93a79d56fcb964224f649af4ac9">PetscJacobianFunction_JFNK</a>); CHKERRQ(ierr);</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    }</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    ierr = MatSetUp(A); CHKERRQ(ierr);</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    context.<a class="code" href="a00152.html#a271fbbfea71118710d4a2fb13eb4c1cc">flag_use_precon</a> = 0;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    ierr = PetscOptionsGetBool(PETSC_NULL,PETSC_NULL,<span class="stringliteral">&quot;-with_pc&quot;</span>,(PetscBool*)(&amp;context.<a class="code" href="a00152.html#a271fbbfea71118710d4a2fb13eb4c1cc">flag_use_precon</a>),PETSC_NULL); CHKERRQ(ierr);</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="comment">/* </span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment">       Since we are using a MatShell to represent the action of the Jacobian on a vector (Jacobian-free approach),</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment">       we need to define the Jacobian through TSSetIJacobian, and not TSSetRHSJacobian, so that we can define the </span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment">       complete operator (the shifted Jacobian aI - J )</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment">    */</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <span class="keywordflow">if</span> (context.<a class="code" href="a00152.html#a271fbbfea71118710d4a2fb13eb4c1cc">flag_use_precon</a>) {</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      <span class="comment">/* check if flux Jacobian of the physical model is defined */</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      <span class="keywordflow">if</span> (!solver-&gt;<a class="code" href="a00144.html#a25c87c7c874c7e08981688fe6c51167b">JFunction</a>) {</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) {</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;          fprintf(stderr,<span class="stringliteral">&quot;Error in SolvePETSc(): solver-&gt;JFunction (point-wise flux Jacobian) must &quot;</span>);</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;          fprintf(stderr,<span class="stringliteral">&quot;be defined for preconditioning.\n&quot;</span>);</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        }</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        PetscFunctionReturn(1);</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;      }</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;      <span class="comment">/* Set up preconditioner matrix */</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;      flag_mat_b = 1;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      ierr = MatCreateAIJ(MPI_COMM_WORLD,total_size,total_size,PETSC_DETERMINE,PETSC_DETERMINE,</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                          (solver-&gt;<a class="code" href="a00144.html#a484873c74138512e41bc50d17b7d955a">ndims</a>*2+1)*solver-&gt;<a class="code" href="a00144.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,NULL,</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                          2*solver-&gt;<a class="code" href="a00144.html#a484873c74138512e41bc50d17b7d955a">ndims</a>*solver-&gt;<a class="code" href="a00144.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,NULL,&amp;B); CHKERRQ(ierr);</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      ierr = MatSetBlockSize(B,solver-&gt;<a class="code" href="a00144.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;      <span class="comment">/* Set the RHSJacobian function for TS */</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;      ierr = TSSetIJacobian(ts,A,B,<a class="code" href="a00152.html#a3d6a695a879ec54937525109ac912355">PetscIJacobian</a>,&amp;context); CHKERRQ(ierr);</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;      <span class="comment">/* Set the RHSJacobian function for TS */</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;      ierr = TSSetIJacobian(ts,A,A,<a class="code" href="a00152.html#a3d6a695a879ec54937525109ac912355">PetscIJacobian</a>,&amp;context); CHKERRQ(ierr);</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;      <span class="comment">/* Set PC (preconditioner) to none */</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;      ierr = SNESGetKSP(snes,&amp;ksp); CHKERRQ(ierr);</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;      ierr = KSPGetPC(ksp,&amp;pc); CHKERRQ(ierr);</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      ierr = PCSetType(pc,PCNONE); CHKERRQ(ierr);</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    }</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  }</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  <span class="comment">/* Set pre/post-stage and post-timestep function */</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  ierr = TSSetPreStep (ts,<a class="code" href="a00152.html#ace222db5eadd0e0bd27229641e43fa9b">PetscPreTimeStep</a> ); CHKERRQ(ierr);</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  ierr = TSSetPreStage(ts,<a class="code" href="a00152.html#aa52bad03c15488a2119b794d0e70deed">PetscPreStage</a>    ); CHKERRQ(ierr);</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  ierr = TSSetPostStage(ts,<a class="code" href="a00152.html#ad1f357f94c228ba9ff45275064ca162b">PetscPostStage</a>  ); CHKERRQ(ierr);</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  ierr = TSSetPostStep(ts,<a class="code" href="a00152.html#a3f7397f8cd5e90306fb7f02edecb3782">PetscPostTimeStep</a>); CHKERRQ(ierr);</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  <span class="comment">/* Set solution vector for TS */</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  ierr = TSSetSolution(ts,Y); CHKERRQ(ierr);</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  <span class="comment">/* Set it all up */</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  ierr = TSSetUp(ts); CHKERRQ(ierr);</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  <span class="comment">/* Set application context */</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  ierr = TSSetApplicationContext(ts,&amp;context); CHKERRQ(ierr);</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) {</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="keywordflow">if</span> (context.<a class="code" href="a00152.html#a200f63fcca813d56a5cf3209546cedb2">flag_is_linear</a>) printf(<span class="stringliteral">&quot;SolvePETSc(): Problem type is linear.\n&quot;</span>);</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="keywordflow">else</span>                        printf(<span class="stringliteral">&quot;SolvePETSc(): Problem type is nonlinear.\n&quot;</span>);</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  }</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) printf(<span class="stringliteral">&quot;** Starting PETSc time integration **\n&quot;</span>);</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  ierr = TSSolve(ts,Y); CHKERRQ(ierr);</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) printf(<span class="stringliteral">&quot;** Completed PETSc time integration **\n&quot;</span>);</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  <span class="comment">/* Get the number of time steps */</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  ierr = TSGetStepNumber(ts,&amp;solver-&gt;<a class="code" href="a00144.html#af0d8e0d5d3de3869b941b66b6caaf964">n_iter</a>); CHKERRQ(ierr);</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  <span class="comment">/* get and write to file any auxiliary solutions */</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  <span class="keywordtype">char</span> aux_fname_root[4] = <span class="stringliteral">&quot;ts0&quot;</span>;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;  ierr = TSGetSolutionComponents(ts,&amp;iAuxSize,NULL);CHKERRQ(ierr);</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;  <span class="keywordflow">if</span> (iAuxSize) {</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="keywordflow">if</span> (iAuxSize &gt; 10) iAuxSize = 10;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) printf(<span class="stringliteral">&quot;Number of auxiliary solutions from time integration: %d\n&quot;</span>,iAuxSize);</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    ierr = VecDuplicate(Y,&amp;Z);</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="keywordflow">for</span> (i=0; i&lt;iAuxSize; i++) {</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;      ierr = TSGetSolutionComponents(ts,&amp;i,&amp;Z);CHKERRQ(ierr);</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;      ierr = <a class="code" href="a00152.html#aba47a541676718cced51875b1c3a4ba6">TransferVecFromPETSc</a>(solver-&gt;<a class="code" href="a00144.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>,Z,&amp;context); <a class="code" href="a00166.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;      <a class="code" href="a00166.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00173.html#aaf888c739c5200d9c58a7154347069b0">WriteArray</a>(solver-&gt;<a class="code" href="a00144.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00144.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00144.html#aa989ebb755986852177779cdf7bd8c85">dim_global</a>,solver-&gt;<a class="code" href="a00144.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                      solver-&gt;<a class="code" href="a00144.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,solver-&gt;<a class="code" href="a00144.html#a711aad4cbe735871dd9e91ab575c878b">x</a>,solver-&gt;<a class="code" href="a00144.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>,solver,mpi,aux_fname_root); <a class="code" href="a00166.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;      aux_fname_root[2]++;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    }</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    ierr = VecDestroy(&amp;Z); CHKERRQ(ierr);</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  }</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;  <span class="comment">/* if available, get error estimates */</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  ierr = <a class="code" href="a00152.html#ab501847c597b0c20dff03d95a663b9b4">PetscTimeError</a>(ts); <a class="code" href="a00166.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  <span class="comment">/* copy final solution from PETSc&#39;s vector */</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  ierr = <a class="code" href="a00152.html#aba47a541676718cced51875b1c3a4ba6">TransferVecFromPETSc</a>(solver-&gt;<a class="code" href="a00144.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>,Y,&amp;context); <a class="code" href="a00166.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  <span class="comment">/* clean up */</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  <span class="keywordflow">if</span> (flag_mat_a) { ierr = MatDestroy(&amp;A); CHKERRQ(ierr); }</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  <span class="keywordflow">if</span> (flag_mat_b) { ierr = MatDestroy(&amp;B); CHKERRQ(ierr); }</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;  ierr = TSDestroy(&amp;ts); CHKERRQ(ierr);</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  ierr = VecDestroy(&amp;Y); CHKERRQ(ierr);</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  <span class="comment">/* write a final solution file, if last iteration did not write one */</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  <span class="keywordflow">if</span> (context.<a class="code" href="a00152.html#a34cbd56d5136d5e8b5ea2cbb901c04cd">tic</a>) { </div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <span class="keywordflow">if</span> (solver-&gt;<a class="code" href="a00144.html#a1c247fc17b5919c384f8426052037f28">PhysicsOutput</a>) {</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;      <a class="code" href="a00166.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00144.html#a1c247fc17b5919c384f8426052037f28">PhysicsOutput</a>(solver,mpi); <a class="code" href="a00166.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    }</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <a class="code" href="a00166.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00502.html#a5981de613724cb667e98aa872157534e">OutputSolution</a>(sim, nsims); <a class="code" href="a00166.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr); </div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  }</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  <span class="comment">/* calculate error if exact solution has been provided */</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  <a class="code" href="a00166.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00502.html#a116876aaf447559b6cc9fff36a501843">CalculateError</a>(solver,mpi); <a class="code" href="a00166.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  ierr = <a class="code" href="a00152.html#a52781b615afd6404c69c93dd0aa82924">PetscCleanup</a>(&amp;context);</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  PetscFunctionReturn(0);</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;}</div>
<div class="ttc" id="a00156_html_a523947ce4fa7128c4c767163953253b9"><div class="ttname"><a href="a00156.html#a523947ce4fa7128c4c767163953253b9">SimulationObject::solver</a></div><div class="ttdeci">HyPar solver</div><div class="ttdef"><b>Definition:</b> <a href="a00156_source.html#l00026">simulation_object.h:26</a></div></div>
<div class="ttc" id="a00146_html_a6cfd95afd0afebd625b889fb6e58371c"><div class="ttname"><a href="a00146.html#a6cfd95afd0afebd625b889fb6e58371c">MPIVariables::rank</a></div><div class="ttdeci">int rank</div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00025">mpivars_struct.h:25</a></div></div>
<div class="ttc" id="a00144_html_a38e0371f331cecbe63a77fa03e202afe"><div class="ttname"><a href="a00144.html#a38e0371f331cecbe63a77fa03e202afe">HyPar::dim_local</a></div><div class="ttdeci">int * dim_local</div><div class="ttdef"><b>Definition:</b> <a href="a00172_source.html#l00035">hypar.h:35</a></div></div>
<div class="ttc" id="a00152_html_ace222db5eadd0e0bd27229641e43fa9b"><div class="ttname"><a href="a00152.html#ace222db5eadd0e0bd27229641e43fa9b">PetscPreTimeStep</a></div><div class="ttdeci">PetscErrorCode PetscPreTimeStep(TS)</div><div class="ttdef"><b>Definition:</b> <a href="a00328_source.html#l00023">PetscPreTimeStep.c:23</a></div></div>
<div class="ttc" id="a00502_html_a5981de613724cb667e98aa872157534e"><div class="ttname"><a href="a00502.html#a5981de613724cb667e98aa872157534e">OutputSolution</a></div><div class="ttdeci">int OutputSolution(void *, int)</div><div class="ttdef"><b>Definition:</b> <a href="a00497_source.html#l00022">OutputSolution.c:22</a></div></div>
<div class="ttc" id="a00144_html"><div class="ttname"><a href="a00144.html">HyPar</a></div><div class="ttdoc">Structure containing all solver-specific variables and functions. </div><div class="ttdef"><b>Definition:</b> <a href="a00172_source.html#l00023">hypar.h:23</a></div></div>
<div class="ttc" id="a00152_html_a54c0451c4ae9650a54f54246f1f8823b"><div class="ttname"><a href="a00152.html#a54c0451c4ae9650a54f54246f1f8823b">PETScContext::flag_source</a></div><div class="ttdeci">int flag_source</div><div class="ttdef"><b>Definition:</b> <a href="a00152_source.html#l00068">petscinterface.h:68</a></div></div>
<div class="ttc" id="a00152_html_a9d093c3140369a1178dd5b9589a926b1"><div class="ttname"><a href="a00152.html#a9d093c3140369a1178dd5b9589a926b1">PetscIFunctionIMEX</a></div><div class="ttdeci">PetscErrorCode PetscIFunctionIMEX(TS, PetscReal, Vec, Vec, Vec, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00322_source.html#l00053">PetscIFunctionIMEX.c:53</a></div></div>
<div class="ttc" id="a00152_html_aa52bad03c15488a2119b794d0e70deed"><div class="ttname"><a href="a00152.html#aa52bad03c15488a2119b794d0e70deed">PetscPreStage</a></div><div class="ttdeci">PetscErrorCode PetscPreStage(TS, PetscReal)</div><div class="ttdef"><b>Definition:</b> <a href="a00327_source.html#l00014">PetscPreStage.c:14</a></div></div>
<div class="ttc" id="a00152_html_a376b6b34e162357d201827d01a5aa2a4"><div class="ttname"><a href="a00152.html#a376b6b34e162357d201827d01a5aa2a4">PETScContext::flag_hyperbolic</a></div><div class="ttdeci">int flag_hyperbolic</div><div class="ttdef"><b>Definition:</b> <a href="a00152_source.html#l00060">petscinterface.h:60</a></div></div>
<div class="ttc" id="a00152_html_a8778c346e27f42f0583c63909c2ea544"><div class="ttname"><a href="a00152.html#a8778c346e27f42f0583c63909c2ea544">PetscJacobianFunctionIMEX_Linear</a></div><div class="ttdeci">PetscErrorCode PetscJacobianFunctionIMEX_Linear(Mat, Vec, Vec)</div><div class="ttdef"><b>Definition:</b> <a href="a00324_source.html#l00292">PetscIJacobianIMEX.c:292</a></div></div>
<div class="ttc" id="a00152_html_aad212f0cfa337a32e39d307f8708eca7"><div class="ttname"><a href="a00152.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a></div><div class="ttdeci">#define _IMPLICIT_</div><div class="ttdef"><b>Definition:</b> <a href="a00152_source.html#l00022">petscinterface.h:22</a></div></div>
<div class="ttc" id="a00144_html_a711aad4cbe735871dd9e91ab575c878b"><div class="ttname"><a href="a00144.html#a711aad4cbe735871dd9e91ab575c878b">HyPar::x</a></div><div class="ttdeci">double * x</div><div class="ttdef"><b>Definition:</b> <a href="a00172_source.html#l00091">hypar.h:91</a></div></div>
<div class="ttc" id="a00173_html_aaf888c739c5200d9c58a7154347069b0"><div class="ttname"><a href="a00173.html#aaf888c739c5200d9c58a7154347069b0">WriteArray</a></div><div class="ttdeci">int WriteArray(int, int, int *, int *, int, double *, double *, void *, void *, char *)</div><div class="ttdef"><b>Definition:</b> <a href="a00283_source.html#l00027">WriteArray.c:27</a></div></div>
<div class="ttc" id="a00144_html_af0d8e0d5d3de3869b941b66b6caaf964"><div class="ttname"><a href="a00144.html#af0d8e0d5d3de3869b941b66b6caaf964">HyPar::n_iter</a></div><div class="ttdeci">int n_iter</div><div class="ttdef"><b>Definition:</b> <a href="a00172_source.html#l00047">hypar.h:47</a></div></div>
<div class="ttc" id="a00144_html_a25c87c7c874c7e08981688fe6c51167b"><div class="ttname"><a href="a00144.html#a25c87c7c874c7e08981688fe6c51167b">HyPar::JFunction</a></div><div class="ttdeci">int(* JFunction)(double *, double *, void *, int, int)</div><div class="ttdef"><b>Definition:</b> <a href="a00172_source.html#l00300">hypar.h:300</a></div></div>
<div class="ttc" id="a00152_html_a82aacb94c1481144ce3e43d40d1f04d4"><div class="ttname"><a href="a00152.html#a82aacb94c1481144ce3e43d40d1f04d4">PetscIJacobianIMEX</a></div><div class="ttdeci">PetscErrorCode PetscIJacobianIMEX(TS, PetscReal, Vec, Vec, PetscReal, Mat, Mat, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00324_source.html#l00061">PetscIJacobianIMEX.c:61</a></div></div>
<div class="ttc" id="a00152_html_a34cbd56d5136d5e8b5ea2cbb901c04cd"><div class="ttname"><a href="a00152.html#a34cbd56d5136d5e8b5ea2cbb901c04cd">PETScContext::tic</a></div><div class="ttdeci">int tic</div><div class="ttdef"><b>Definition:</b> <a href="a00152_source.html#l00046">petscinterface.h:46</a></div></div>
<div class="ttc" id="a00144_html_aa989ebb755986852177779cdf7bd8c85"><div class="ttname"><a href="a00144.html#aa989ebb755986852177779cdf7bd8c85">HyPar::dim_global</a></div><div class="ttdeci">int * dim_global</div><div class="ttdef"><b>Definition:</b> <a href="a00172_source.html#l00032">hypar.h:32</a></div></div>
<div class="ttc" id="a00166_html_add9cf96ae374934d245a1dc1ab697a42"><div class="ttname"><a href="a00166.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a></div><div class="ttdeci">#define CHECKERR(ierr)</div><div class="ttdef"><b>Definition:</b> <a href="a00166_source.html#l00014">basic.h:14</a></div></div>
<div class="ttc" id="a00144_html_a03e28be41881b703c836edbfe9b51b17"><div class="ttname"><a href="a00144.html#a03e28be41881b703c836edbfe9b51b17">HyPar::dt</a></div><div class="ttdeci">double dt</div><div class="ttdef"><b>Definition:</b> <a href="a00172_source.html#l00059">hypar.h:59</a></div></div>
<div class="ttc" id="a00152_html_ac48ad2561e5e125d2789133e848db1d9"><div class="ttname"><a href="a00152.html#ac48ad2561e5e125d2789133e848db1d9">PETScContext::flag_parabolic</a></div><div class="ttdeci">int flag_parabolic</div><div class="ttdef"><b>Definition:</b> <a href="a00152_source.html#l00066">petscinterface.h:66</a></div></div>
<div class="ttc" id="a00152_html_a68f5a93a79d56fcb964224f649af4ac9"><div class="ttname"><a href="a00152.html#a68f5a93a79d56fcb964224f649af4ac9">PetscJacobianFunction_JFNK</a></div><div class="ttdeci">PetscErrorCode PetscJacobianFunction_JFNK(Mat, Vec, Vec)</div><div class="ttdef"><b>Definition:</b> <a href="a00323_source.html#l00113">PetscIJacobian.c:113</a></div></div>
<div class="ttc" id="a00152_html_aba47a541676718cced51875b1c3a4ba6"><div class="ttname"><a href="a00152.html#aba47a541676718cced51875b1c3a4ba6">TransferVecFromPETSc</a></div><div class="ttdeci">int TransferVecFromPETSc(double *, Vec, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00333_source.html#l00022">TransferFromPETSc.c:22</a></div></div>
<div class="ttc" id="a00152_html_a3d6a695a879ec54937525109ac912355"><div class="ttname"><a href="a00152.html#a3d6a695a879ec54937525109ac912355">PetscIJacobian</a></div><div class="ttdeci">PetscErrorCode PetscIJacobian(TS, PetscReal, Vec, Vec, PetscReal, Mat, Mat, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00323_source.html#l00052">PetscIJacobian.c:52</a></div></div>
<div class="ttc" id="a00144_html_a5bed0cb9665daad89f4377c4f7609df4"><div class="ttname"><a href="a00144.html#a5bed0cb9665daad89f4377c4f7609df4">HyPar::SplitHyperbolicFlux</a></div><div class="ttdeci">char SplitHyperbolicFlux[_MAX_STRING_SIZE_]</div><div class="ttdef"><b>Definition:</b> <a href="a00172_source.html#l00076">hypar.h:76</a></div></div>
<div class="ttc" id="a00144_html_ae8f6d2fd6490d3153cb4133bf183a404"><div class="ttname"><a href="a00144.html#ae8f6d2fd6490d3153cb4133bf183a404">HyPar::nvars</a></div><div class="ttdeci">int nvars</div><div class="ttdef"><b>Definition:</b> <a href="a00172_source.html#l00029">hypar.h:29</a></div></div>
<div class="ttc" id="a00152_html_a271fbbfea71118710d4a2fb13eb4c1cc"><div class="ttname"><a href="a00152.html#a271fbbfea71118710d4a2fb13eb4c1cc">PETScContext::flag_use_precon</a></div><div class="ttdeci">int flag_use_precon</div><div class="ttdef"><b>Definition:</b> <a href="a00152_source.html#l00071">petscinterface.h:71</a></div></div>
<div class="ttc" id="a00152_html_a4edf057726501be3e8fe54e16fafe07b"><div class="ttname"><a href="a00152.html#a4edf057726501be3e8fe54e16fafe07b">PetscJacobianFunctionIMEX_JFNK</a></div><div class="ttdeci">PetscErrorCode PetscJacobianFunctionIMEX_JFNK(Mat, Vec, Vec)</div><div class="ttdef"><b>Definition:</b> <a href="a00324_source.html#l00130">PetscIJacobianIMEX.c:130</a></div></div>
<div class="ttc" id="a00502_html_a116876aaf447559b6cc9fff36a501843"><div class="ttname"><a href="a00502.html#a116876aaf447559b6cc9fff36a501843">CalculateError</a></div><div class="ttdeci">int CalculateError(void *, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00230_source.html#l00025">CalculateError.c:25</a></div></div>
<div class="ttc" id="a00152_html_a3f7397f8cd5e90306fb7f02edecb3782"><div class="ttname"><a href="a00152.html#a3f7397f8cd5e90306fb7f02edecb3782">PetscPostTimeStep</a></div><div class="ttdeci">PetscErrorCode PetscPostTimeStep(TS)</div><div class="ttdef"><b>Definition:</b> <a href="a00326_source.html#l00019">PetscPostTimeStep.c:19</a></div></div>
<div class="ttc" id="a00144_html_a484873c74138512e41bc50d17b7d955a"><div class="ttname"><a href="a00144.html#a484873c74138512e41bc50d17b7d955a">HyPar::ndims</a></div><div class="ttdeci">int ndims</div><div class="ttdef"><b>Definition:</b> <a href="a00172_source.html#l00026">hypar.h:26</a></div></div>
<div class="ttc" id="a00152_html_ae4a99505d5f322bfc1c590e3d31fcc0b"><div class="ttname"><a href="a00152.html#ae4a99505d5f322bfc1c590e3d31fcc0b">PetscCreatePointList</a></div><div class="ttdeci">int PetscCreatePointList(void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00319_source.html#l00023">PetscCreatePointList.c:23</a></div></div>
<div class="ttc" id="a00152_html_a200f63fcca813d56a5cf3209546cedb2"><div class="ttname"><a href="a00152.html#a200f63fcca813d56a5cf3209546cedb2">PETScContext::flag_is_linear</a></div><div class="ttdeci">int flag_is_linear</div><div class="ttdef"><b>Definition:</b> <a href="a00152_source.html#l00074">petscinterface.h:74</a></div></div>
<div class="ttc" id="a00156_html_a4afd2c7b3eb8fda452474ebdbe71c8c0"><div class="ttname"><a href="a00156.html#a4afd2c7b3eb8fda452474ebdbe71c8c0">SimulationObject::mpi</a></div><div class="ttdeci">MPIVariables mpi</div><div class="ttdef"><b>Definition:</b> <a href="a00156_source.html#l00025">simulation_object.h:25</a></div></div>
<div class="ttc" id="a00166_html_ad6ab74942c9de13cf0b4c12eb0d91780"><div class="ttname"><a href="a00166.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a></div><div class="ttdeci">#define IERR</div><div class="ttdef"><b>Definition:</b> <a href="a00166_source.html#l00012">basic.h:12</a></div></div>
<div class="ttc" id="a00152_html_a52781b615afd6404c69c93dd0aa82924"><div class="ttname"><a href="a00152.html#a52781b615afd6404c69c93dd0aa82924">PetscCleanup</a></div><div class="ttdeci">int PetscCleanup(void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00315_source.html#l00012">PetscCleanup.c:12</a></div></div>
<div class="ttc" id="a00152_html_a0c5f291f027b0928672b89121f44c0fc"><div class="ttname"><a href="a00152.html#a0c5f291f027b0928672b89121f44c0fc">PETScContext::globalDOF</a></div><div class="ttdeci">double * globalDOF</div><div class="ttdef"><b>Definition:</b> <a href="a00152_source.html#l00084">petscinterface.h:84</a></div></div>
<div class="ttc" id="a00152_html_a91eb21ee4374b79a74f413d926344d7e"><div class="ttname"><a href="a00152.html#a91eb21ee4374b79a74f413d926344d7e">PetscRHSFunctionImpl</a></div><div class="ttdeci">PetscErrorCode PetscRHSFunctionImpl(TS, PetscReal, Vec, Vec, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00332_source.html#l00037">PetscRHSFunctionImpl.c:37</a></div></div>
<div class="ttc" id="a00152_html_a00562"><div class="ttname"><a href="a00152.html#a00562">PETScContext</a></div><div class="ttdoc">Structure containing the variables for time-integration with PETSc. </div><div class="ttdef"><b>Definition:</b> <a href="a00152_source.html#l00035">petscinterface.h:35</a></div></div>
<div class="ttc" id="a00152_html_a6a0edd627a2b2cc687d1031e3884dd6a"><div class="ttname"><a href="a00152.html#a6a0edd627a2b2cc687d1031e3884dd6a">PETScContext::flag_hyperbolic_f</a></div><div class="ttdeci">int flag_hyperbolic_f</div><div class="ttdef"><b>Definition:</b> <a href="a00152_source.html#l00062">petscinterface.h:62</a></div></div>
<div class="ttc" id="a00144_html_a3b6b999a764f1e2ea94bb5f28c7a558c"><div class="ttname"><a href="a00144.html#a3b6b999a764f1e2ea94bb5f28c7a558c">HyPar::u</a></div><div class="ttdeci">double * u</div><div class="ttdef"><b>Definition:</b> <a href="a00172_source.html#l00100">hypar.h:100</a></div></div>
<div class="ttc" id="a00152_html_ae4815491f5992839fdb3949e5dedec8e"><div class="ttname"><a href="a00152.html#ae4815491f5992839fdb3949e5dedec8e">PetscGlobalDOF</a></div><div class="ttdeci">int PetscGlobalDOF(void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00321_source.html#l00070">PetscGlobalDOF.c:70</a></div></div>
<div class="ttc" id="a00152_html_a94499efe0f52b5174ce7105de5ab1a37"><div class="ttname"><a href="a00152.html#a94499efe0f52b5174ce7105de5ab1a37">TransferVecToPETSc</a></div><div class="ttdeci">int TransferVecToPETSc(double *, Vec, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00334_source.html#l00023">TransferToPETSc.c:23</a></div></div>
<div class="ttc" id="a00152_html_ab501847c597b0c20dff03d95a663b9b4"><div class="ttname"><a href="a00152.html#ab501847c597b0c20dff03d95a663b9b4">PetscTimeError</a></div><div class="ttdeci">PetscErrorCode PetscTimeError(TS)</div><div class="ttdef"><b>Definition:</b> <a href="a00320_source.html#l00021">PetscError.c:21</a></div></div>
<div class="ttc" id="a00152_html_ade1bc5cad8c6735a891a28f637cbfb06"><div class="ttname"><a href="a00152.html#ade1bc5cad8c6735a891a28f637cbfb06">PETScContext::solver</a></div><div class="ttdeci">void * solver</div><div class="ttdef"><b>Definition:</b> <a href="a00152_source.html#l00037">petscinterface.h:37</a></div></div>
<div class="ttc" id="a00152_html_a005fac516715e5fb65baa1540a79c82c"><div class="ttname"><a href="a00152.html#a005fac516715e5fb65baa1540a79c82c">PetscRegisterTIMethods</a></div><div class="ttdeci">int PetscRegisterTIMethods(int)</div><div class="ttdef"><b>Definition:</b> <a href="a00329_source.html#l00046">PetscRegisterTIMethods.c:46</a></div></div>
<div class="ttc" id="a00152_html_abaa15763a88d05dc68ff230ce570eee9"><div class="ttname"><a href="a00152.html#abaa15763a88d05dc68ff230ce570eee9">PETScContext::mpi</a></div><div class="ttdeci">void * mpi</div><div class="ttdef"><b>Definition:</b> <a href="a00152_source.html#l00039">petscinterface.h:39</a></div></div>
<div class="ttc" id="a00152_html_a377d0d14ec878aeb4deed4a0533e213d"><div class="ttname"><a href="a00152.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a></div><div class="ttdeci">#define _EXPLICIT_</div><div class="ttdef"><b>Definition:</b> <a href="a00152_source.html#l00020">petscinterface.h:20</a></div></div>
<div class="ttc" id="a00152_html_ab991f69858c9aada0736623db264237e"><div class="ttname"><a href="a00152.html#ab991f69858c9aada0736623db264237e">PETScContext::points</a></div><div class="ttdeci">int * points</div><div class="ttdef"><b>Definition:</b> <a href="a00152_source.html#l00056">petscinterface.h:56</a></div></div>
<div class="ttc" id="a00144_html_aafc992b5fa79d5a4036024615d03bce6"><div class="ttname"><a href="a00144.html#aafc992b5fa79d5a4036024615d03bce6">HyPar::ghosts</a></div><div class="ttdeci">int ghosts</div><div class="ttdef"><b>Definition:</b> <a href="a00172_source.html#l00044">hypar.h:44</a></div></div>
<div class="ttc" id="a00152_html_abed41de2efef801be98f8338aa2672f2"><div class="ttname"><a href="a00152.html#abed41de2efef801be98f8338aa2672f2">PetscJacobianFunction_Linear</a></div><div class="ttdeci">PetscErrorCode PetscJacobianFunction_Linear(Mat, Vec, Vec)</div><div class="ttdef"><b>Definition:</b> <a href="a00323_source.html#l00231">PetscIJacobian.c:231</a></div></div>
<div class="ttc" id="a00152_html_ad1f357f94c228ba9ff45275064ca162b"><div class="ttname"><a href="a00152.html#ad1f357f94c228ba9ff45275064ca162b">PetscPostStage</a></div><div class="ttdeci">PetscErrorCode PetscPostStage(TS, PetscReal, PetscInt, Vec *)</div><div class="ttdef"><b>Definition:</b> <a href="a00325_source.html#l00017">PetscPostStage.c:17</a></div></div>
<div class="ttc" id="a00156_html_a00563"><div class="ttname"><a href="a00156.html#a00563">SimulationObject</a></div><div class="ttdoc">Structure defining a simulation. </div><div class="ttdef"><b>Definition:</b> <a href="a00156_source.html#l00023">simulation_object.h:23</a></div></div>
<div class="ttc" id="a00146_html_a00559"><div class="ttname"><a href="a00146.html#a00559">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a00146_source.html#l00024">mpivars_struct.h:24</a></div></div>
<div class="ttc" id="a00152_html_a515ec0fe2abce5449e37ae520974cf5f"><div class="ttname"><a href="a00152.html#a515ec0fe2abce5449e37ae520974cf5f">PETScContext::npoints</a></div><div class="ttdeci">int npoints</div><div class="ttdef"><b>Definition:</b> <a href="a00152_source.html#l00051">petscinterface.h:51</a></div></div>
<div class="ttc" id="a00144_html_a1c247fc17b5919c384f8426052037f28"><div class="ttname"><a href="a00144.html#a1c247fc17b5919c384f8426052037f28">HyPar::PhysicsOutput</a></div><div class="ttdeci">int(* PhysicsOutput)(void *, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00172_source.html#l00315">hypar.h:315</a></div></div>
<div class="ttc" id="a00152_html_a21b4785029b7597816341479bc3260b4"><div class="ttname"><a href="a00152.html#a21b4785029b7597816341479bc3260b4">PETScContext::flag_hyperbolic_df</a></div><div class="ttdeci">int flag_hyperbolic_df</div><div class="ttdef"><b>Definition:</b> <a href="a00152_source.html#l00064">petscinterface.h:64</a></div></div>
<div class="ttc" id="a00152_html_ac67533553372ed2b44b32d095c775f5c"><div class="ttname"><a href="a00152.html#ac67533553372ed2b44b32d095c775f5c">PetscRHSFunctionExpl</a></div><div class="ttdeci">PetscErrorCode PetscRHSFunctionExpl(TS, PetscReal, Vec, Vec, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00330_source.html#l00036">PetscRHSFunctionExpl.c:36</a></div></div>
<div class="ttc" id="a00152_html_ad62e14c19e38497048380c4a7fe10e12"><div class="ttname"><a href="a00152.html#ad62e14c19e38497048380c4a7fe10e12">PETScContext::jfnk_eps</a></div><div class="ttdeci">double jfnk_eps</div><div class="ttdef"><b>Definition:</b> <a href="a00152_source.html#l00077">petscinterface.h:77</a></div></div>
<div class="ttc" id="a00152_html_ac7d9b0a219eb22bfd37482b741bd79c9"><div class="ttname"><a href="a00152.html#ac7d9b0a219eb22bfd37482b741bd79c9">PetscRHSFunctionIMEX</a></div><div class="ttdeci">PetscErrorCode PetscRHSFunctionIMEX(TS, PetscReal, Vec, Vec, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00331_source.html#l00049">PetscRHSFunctionIMEX.c:49</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">
var sc_project=10897352; 
var sc_invisible=1; 
var sc_security="83042f57"; 
var scJsHost = (("https:" == document.location.protocol) ?
"https://secure." : "http://www.");
document.write("<sc"+"ript type='text/javascript' src='" +
scJsHost+
"statcounter.com/counter/counter.js'></"+"script>");
</script>
<noscript><div class="statcounter"><a title="website
statistics" href="http://statcounter.com/"
target="_blank"><img class="statcounter"
src="//c.statcounter.com/10897352/0/83042f57/1/"
alt="website statistics"></a></div></noscript>
<!-- End of StatCounter Code for Default Guide -->
