<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>HyPar: include/hypar.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>include/hypar.h File Reference</h1>
<p>Contains structure definition for hypar.  
<a href="#_details">More...</a></p>
<code>#include &lt;<a class="el" href="a00036_source.html">basic.h</a>&gt;</code><br/>

<p><a href="a00039_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00015.html">HyPar</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Structure containing all solver-specific variables and functions.  <a href="a00015.html#_details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00039.html#a18ee8cd9b4297a259b08aa4cdfe30aa1">_NC_1STAGE_</a>&nbsp;&nbsp;&nbsp;&quot;nonconservative-1stage&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00039.html#a9f4de86b900c9aa5f097c2746e17612a">_NC_2STAGE_</a>&nbsp;&nbsp;&nbsp;&quot;nonconservative-2stage&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00039.html#a7bc6f9c42df5610bc5d844ad95c74fb8">_NC_1_5STAGE_</a>&nbsp;&nbsp;&nbsp;&quot;nonconservative-1.5stage&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00039.html#aabd653aa5d489ae2d0d8140290f6f026">_CONS_1STAGE_</a>&nbsp;&nbsp;&nbsp;&quot;conservative-1stage&quot;</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00039.html#a116876aaf447559b6cc9fff36a501843">CalculateError</a> (void *, void *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00039.html#a2afb53fd574f26094f46889c62b5e136">Cleanup</a> (void *, void *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00039.html#abea704146c0360a55dccc6674db8d5fb">Initialize</a> (void *, void *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00039.html#a8770e5634efc34bf45dea3596114c092">InitializeBoundaries</a> (void *, void *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00039.html#afdd596b7c9cc1d8376e602bd7fe54082">InitializeImmersedBoundaries</a> (void *, void *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00039.html#a95a1f3298244f6e0ec65e94fa9c124e2">InitializePhysics</a> (void *, void *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00039.html#a8166bb7cded409b3baa135d99fd6bc7c">InitializeSolvers</a> (void *, void *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00039.html#acaa477e12d5371876ebdb656626c68ee">InitialSolution</a> (void *, void *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00039.html#abff21fd701b932c05e9e0dac925bcf29">OutputSolution</a> (void *, void *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00039.html#a1eaea8a114ef1dad09df700d03e735e9">ReadInputs</a> (void *, void *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00039.html#a5242c7db89f8888de5d72251e5da91c2">Solve</a> (void *, void *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00039.html#a4dc9b9ce6ce776b7901fa2a6c9c9c1cf">SolvePETSc</a> (void *, void *)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Integrate in time with PETSc.  <a href="#a4dc9b9ce6ce776b7901fa2a6c9c9c1cf"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Contains structure definition for hypar. </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Debojyoti Ghosh </dd></dl>

<p>Definition in file <a class="el" href="a00039_source.html">hypar.h</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a18ee8cd9b4297a259b08aa4cdfe30aa1"></a><!-- doxytag: member="hypar.h::_NC_1STAGE_" ref="a18ee8cd9b4297a259b08aa4cdfe30aa1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define _NC_1STAGE_&nbsp;&nbsp;&nbsp;&quot;nonconservative-1stage&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Non-conservative, direct evaluation of the 2nd deriv </p>

<p>Definition at line <a class="el" href="a00039_source.html#l00411">411</a> of file <a class="el" href="a00039_source.html">hypar.h</a>.</p>

</div>
</div>
<a class="anchor" id="a9f4de86b900c9aa5f097c2746e17612a"></a><!-- doxytag: member="hypar.h::_NC_2STAGE_" ref="a9f4de86b900c9aa5f097c2746e17612a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define _NC_2STAGE_&nbsp;&nbsp;&nbsp;&quot;nonconservative-2stage&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Non-conservative, two-stage evaluation of the 2nd deriv </p>

<p>Definition at line <a class="el" href="a00039_source.html#l00413">413</a> of file <a class="el" href="a00039_source.html">hypar.h</a>.</p>

</div>
</div>
<a class="anchor" id="a7bc6f9c42df5610bc5d844ad95c74fb8"></a><!-- doxytag: member="hypar.h::_NC_1_5STAGE_" ref="a7bc6f9c42df5610bc5d844ad95c74fb8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define _NC_1_5STAGE_&nbsp;&nbsp;&nbsp;&quot;nonconservative-1.5stage&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Non-conservative, "1.5"-stage evaluation of the 2nd deriv - direct, 1-stage evaluation of the 2nd derivative in one variable 2-stage evaluation of cross-derivatives </p>

<p>Definition at line <a class="el" href="a00039_source.html#l00417">417</a> of file <a class="el" href="a00039_source.html">hypar.h</a>.</p>

</div>
</div>
<a class="anchor" id="aabd653aa5d489ae2d0d8140290f6f026"></a><!-- doxytag: member="hypar.h::_CONS_1STAGE_" ref="aabd653aa5d489ae2d0d8140290f6f026" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define _CONS_1STAGE_&nbsp;&nbsp;&nbsp;&quot;conservative-1stage&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Conservative, direct evaluation of the 2nd deriv </p>

<p>Definition at line <a class="el" href="a00039_source.html#l00419">419</a> of file <a class="el" href="a00039_source.html">hypar.h</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a116876aaf447559b6cc9fff36a501843"></a><!-- doxytag: member="hypar.h::CalculateError" ref="a116876aaf447559b6cc9fff36a501843" args="(void *, void *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int CalculateError </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>m</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Calculate the error in the final solution</p>
<p>Calculates the error in the solution if the exact solution is available. If the exact solution is not available, the errors are reported as zero. The exact solution should be provided in the file "exact.inp" in the same format as the initial solution. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>s</em>&nbsp;</td><td>Solver object of type <a class="el" href="a00015.html" title="Structure containing all solver-specific variables and functions.">HyPar</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>m</em>&nbsp;</td><td>MPI object of type <a class="el" href="a00019.html" title="Structure of MPI-related variables.">MPIVariables</a> </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00094_source.html#l00024">24</a> of file <a class="el" href="a00094_source.html">CalculateError.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00028"></a>00028 {
<a name="l00029"></a>00029   <a class="code" href="a00015.html" title="Structure containing all solver-specific variables and functions.">HyPar</a>         *solver     = (<a class="code" href="a00015.html" title="Structure containing all solver-specific variables and functions.">HyPar</a>*)        s;
<a name="l00030"></a>00030   <a class="code" href="a00019.html" title="Structure of MPI-related variables.">MPIVariables</a>  *mpi        = (<a class="code" href="a00019.html" title="Structure of MPI-related variables.">MPIVariables</a>*) m;
<a name="l00031"></a>00031   <span class="keywordtype">int</span>           exact_flag  = 0, i, size;
<a name="l00032"></a>00032   <span class="keywordtype">double</span>        sum         = 0, global_sum = 0;
<a name="l00033"></a>00033   <span class="keywordtype">double</span>        *uex        = NULL;
<a name="l00034"></a>00034   <a class="code" href="a00036.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a>;
<a name="l00035"></a>00035 
<a name="l00036"></a>00036   size = solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>;
<a name="l00037"></a>00037   <span class="keywordflow">for</span> (i = 0; i &lt; solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>; i++) 
<a name="l00038"></a>00038     size *= (solver-&gt;<a class="code" href="a00015.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>[i]+2*solver-&gt;<a class="code" href="a00015.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>);
<a name="l00039"></a>00039   uex = (<span class="keywordtype">double</span>*) calloc (size, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00040"></a>00040 
<a name="l00041"></a>00041   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> tolerance = 1<a class="code" href="a00032.html#a35b3e91c83139b35bbacfaa59a58afd1">e</a>-15;
<a name="l00042"></a>00042   <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00094.html#a9bb14d40dba84c49f607f1f00c1669d6">ExactSolution</a>(solver,mpi,uex,&amp;exact_flag); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00043"></a>00043 
<a name="l00044"></a>00044   <span class="keywordflow">if</span> (!exact_flag) {
<a name="l00045"></a>00045 
<a name="l00046"></a>00046     <span class="comment">/* No exact solution */</span>
<a name="l00047"></a>00047     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00061.html#aacd05babc2fa0650f3047f955c38319c">TimeError</a>(solver,mpi,NULL); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00048"></a>00048     solver-&gt;<a class="code" href="a00015.html#aa40f27cb2afa2db0f0468962be8b3679">error</a>[0] = solver-&gt;<a class="code" href="a00015.html#aa40f27cb2afa2db0f0468962be8b3679">error</a>[1] = solver-&gt;<a class="code" href="a00015.html#aa40f27cb2afa2db0f0468962be8b3679">error</a>[2] = 0.0;
<a name="l00049"></a>00049 
<a name="l00050"></a>00050   } <span class="keywordflow">else</span> {
<a name="l00051"></a>00051 
<a name="l00052"></a>00052     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00061.html#aacd05babc2fa0650f3047f955c38319c">TimeError</a>(solver,mpi,uex); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00053"></a>00053 
<a name="l00054"></a>00054     <span class="comment">/* calculate solution norms (for relative error) */</span>
<a name="l00055"></a>00055     <span class="keywordtype">double</span> solution_norm[3] = {0.0,0.0,0.0};
<a name="l00056"></a>00056     <span class="comment">/* L1 */</span>
<a name="l00057"></a>00057     sum = <a class="code" href="a00034.html#a60a3d838d95d860a21de20936f7bb910">ArraySumAbsnD</a>   (solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00015.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,
<a name="l00058"></a>00058                            solver-&gt;<a class="code" href="a00015.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,solver-&gt;<a class="code" href="a00015.html#a95e9e0f8a692321b83a2e0ce2789c485">index</a>,uex);
<a name="l00059"></a>00059     global_sum = 0; <a class="code" href="a00045.html#abd61f932b070ee84262d9d98b6dd854f">MPISum_double</a>(&amp;global_sum,&amp;sum,1,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);
<a name="l00060"></a>00060     solution_norm[0] = global_sum/((double)solver-&gt;<a class="code" href="a00015.html#a4e67f54563a3c4ff005dfaf0130f957c">npoints_global</a>);
<a name="l00061"></a>00061     <span class="comment">/* L2 */</span>
<a name="l00062"></a>00062     sum = <a class="code" href="a00034.html#a8c279db0af78d8ff386cf1a023a405dd">ArraySumSquarenD</a>(solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00015.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,
<a name="l00063"></a>00063                            solver-&gt;<a class="code" href="a00015.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,solver-&gt;<a class="code" href="a00015.html#a95e9e0f8a692321b83a2e0ce2789c485">index</a>,uex);
<a name="l00064"></a>00064     global_sum = 0; <a class="code" href="a00045.html#abd61f932b070ee84262d9d98b6dd854f">MPISum_double</a>(&amp;global_sum,&amp;sum,1,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);
<a name="l00065"></a>00065     solution_norm[1] = sqrt(global_sum/((<span class="keywordtype">double</span>)solver-&gt;<a class="code" href="a00015.html#a4e67f54563a3c4ff005dfaf0130f957c">npoints_global</a>));
<a name="l00066"></a>00066     <span class="comment">/* Linf */</span>
<a name="l00067"></a>00067     sum = <a class="code" href="a00034.html#ac20bd4916c6169956e5bf80777c6ab8f">ArrayMaxnD</a>      (solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00015.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,
<a name="l00068"></a>00068                            solver-&gt;<a class="code" href="a00015.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,solver-&gt;<a class="code" href="a00015.html#a95e9e0f8a692321b83a2e0ce2789c485">index</a>,uex);
<a name="l00069"></a>00069     global_sum = 0; <a class="code" href="a00045.html#a33aa37e0050ec72dadb8d63851df51ec">MPIMax_double</a>(&amp;global_sum,&amp;sum,1,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);
<a name="l00070"></a>00070     solution_norm[2] = global_sum;
<a name="l00071"></a>00071 
<a name="l00072"></a>00072     <span class="comment">/* compute error = difference between exact and numerical solution */</span>
<a name="l00073"></a>00073     <a class="code" href="a00034.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00015.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>,-1.0,uex,size);
<a name="l00074"></a>00074 
<a name="l00075"></a>00075     <span class="comment">/* calculate L1 norm of error */</span>
<a name="l00076"></a>00076     sum = <a class="code" href="a00034.html#a60a3d838d95d860a21de20936f7bb910">ArraySumAbsnD</a>   (solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00015.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,
<a name="l00077"></a>00077                            solver-&gt;<a class="code" href="a00015.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,solver-&gt;<a class="code" href="a00015.html#a95e9e0f8a692321b83a2e0ce2789c485">index</a>,uex);
<a name="l00078"></a>00078     global_sum = 0; <a class="code" href="a00045.html#abd61f932b070ee84262d9d98b6dd854f">MPISum_double</a>(&amp;global_sum,&amp;sum,1,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);
<a name="l00079"></a>00079     solver-&gt;<a class="code" href="a00015.html#aa40f27cb2afa2db0f0468962be8b3679">error</a>[0] = global_sum/((double)solver-&gt;<a class="code" href="a00015.html#a4e67f54563a3c4ff005dfaf0130f957c">npoints_global</a>);
<a name="l00080"></a>00080 
<a name="l00081"></a>00081     <span class="comment">/* calculate L2 norm of error */</span>
<a name="l00082"></a>00082     sum = <a class="code" href="a00034.html#a8c279db0af78d8ff386cf1a023a405dd">ArraySumSquarenD</a>(solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00015.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,
<a name="l00083"></a>00083                            solver-&gt;<a class="code" href="a00015.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,solver-&gt;<a class="code" href="a00015.html#a95e9e0f8a692321b83a2e0ce2789c485">index</a>,uex);
<a name="l00084"></a>00084     global_sum = 0; <a class="code" href="a00045.html#abd61f932b070ee84262d9d98b6dd854f">MPISum_double</a>(&amp;global_sum,&amp;sum,1,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);
<a name="l00085"></a>00085     solver-&gt;<a class="code" href="a00015.html#aa40f27cb2afa2db0f0468962be8b3679">error</a>[1] = sqrt(global_sum/((<span class="keywordtype">double</span>)solver-&gt;<a class="code" href="a00015.html#a4e67f54563a3c4ff005dfaf0130f957c">npoints_global</a>));
<a name="l00086"></a>00086 
<a name="l00087"></a>00087     <span class="comment">/* calculate Linf norm of error */</span>
<a name="l00088"></a>00088     sum = <a class="code" href="a00034.html#ac20bd4916c6169956e5bf80777c6ab8f">ArrayMaxnD</a>      (solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00015.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,
<a name="l00089"></a>00089                            solver-&gt;<a class="code" href="a00015.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,solver-&gt;<a class="code" href="a00015.html#a95e9e0f8a692321b83a2e0ce2789c485">index</a>,uex);
<a name="l00090"></a>00090     global_sum = 0; <a class="code" href="a00045.html#a33aa37e0050ec72dadb8d63851df51ec">MPIMax_double</a>(&amp;global_sum,&amp;sum,1,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);
<a name="l00091"></a>00091     solver-&gt;<a class="code" href="a00015.html#aa40f27cb2afa2db0f0468962be8b3679">error</a>[2] = global_sum;
<a name="l00092"></a>00092 
<a name="l00093"></a>00093     <span class="comment">/* </span>
<a name="l00094"></a>00094 <span class="comment">      decide whether to normalize and report relative errors, </span>
<a name="l00095"></a>00095 <span class="comment">      or report absolute errors.</span>
<a name="l00096"></a>00096 <span class="comment">    */</span>
<a name="l00097"></a>00097     <span class="keywordflow">if</span> (    (solution_norm[0] &gt; tolerance) 
<a name="l00098"></a>00098         &amp;&amp;  (solution_norm[1] &gt; tolerance) 
<a name="l00099"></a>00099         &amp;&amp;  (solution_norm[2] &gt; tolerance) ) {
<a name="l00100"></a>00100       solver-&gt;<a class="code" href="a00015.html#aa40f27cb2afa2db0f0468962be8b3679">error</a>[0] /= solution_norm[0];
<a name="l00101"></a>00101       solver-&gt;<a class="code" href="a00015.html#aa40f27cb2afa2db0f0468962be8b3679">error</a>[1] /= solution_norm[1];
<a name="l00102"></a>00102       solver-&gt;<a class="code" href="a00015.html#aa40f27cb2afa2db0f0468962be8b3679">error</a>[2] /= solution_norm[2];
<a name="l00103"></a>00103     }
<a name="l00104"></a>00104   }
<a name="l00105"></a>00105 
<a name="l00106"></a>00106   free(uex);
<a name="l00107"></a>00107   <span class="keywordflow">return</span>(0);
<a name="l00108"></a>00108 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2afb53fd574f26094f46889c62b5e136"></a><!-- doxytag: member="hypar.h::Cleanup" ref="a2afb53fd574f26094f46889c62b5e136" args="(void *, void *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int Cleanup </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>m</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Clean up: deallocate all arrays and objects</p>
<p>Cleans up and frees the memory after the completion of the simulation. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>s</em>&nbsp;</td><td>Solver object of type <a class="el" href="a00015.html" title="Structure containing all solver-specific variables and functions.">HyPar</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>m</em>&nbsp;</td><td>MPI object of type <a class="el" href="a00019.html" title="Structure of MPI-related variables.">MPIVariables</a> </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00095_source.html#l00034">34</a> of file <a class="el" href="a00095_source.html">Cleanup.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00038"></a>00038 {
<a name="l00039"></a>00039   <a class="code" href="a00015.html" title="Structure containing all solver-specific variables and functions.">HyPar</a>           *solver   = (<a class="code" href="a00015.html" title="Structure containing all solver-specific variables and functions.">HyPar</a>*)          s;
<a name="l00040"></a>00040   <a class="code" href="a00019.html" title="Structure of MPI-related variables.">MPIVariables</a>    *mpi      = (<a class="code" href="a00019.html" title="Structure of MPI-related variables.">MPIVariables</a>*)   m;
<a name="l00041"></a>00041   <a class="code" href="a00004.html" title="Structure containing the variables and function pointers defining a boundary.">DomainBoundary</a>  *boundary = (<a class="code" href="a00004.html" title="Structure containing the variables and function pointers defining a boundary.">DomainBoundary</a>*) solver-&gt;<a class="code" href="a00015.html#a6b5109ac1048aa203b8969b91e72c3af">boundary</a>;
<a name="l00042"></a>00042   <span class="keywordtype">int</span>             i;
<a name="l00043"></a>00043   <a class="code" href="a00036.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a>;
<a name="l00044"></a>00044 
<a name="l00045"></a>00045   if (!mpi-&gt;<a class="code" href="a00019.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) printf(<span class="stringliteral">&quot;Deallocating arrays.\n&quot;</span>);
<a name="l00046"></a>00046 
<a name="l00047"></a>00047   <span class="comment">/* Clean up boundary zones */</span>
<a name="l00048"></a>00048   <span class="keywordflow">for</span> (i = 0; i &lt; solver-&gt;<a class="code" href="a00015.html#a3f9a55664d1c8f058828ae9f4de11906">nBoundaryZones</a>; i++) {
<a name="l00049"></a>00049     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00037.html#af38bba62aa7b0f51ee9123ced0c46f24">BCCleanup</a>(&amp;boundary[i]); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00050"></a>00050   }
<a name="l00051"></a>00051   free(solver-&gt;<a class="code" href="a00015.html#a6b5109ac1048aa203b8969b91e72c3af">boundary</a>);
<a name="l00052"></a>00052 
<a name="l00053"></a>00053   <span class="comment">/* Clean up immersed boundaries */</span>
<a name="l00054"></a>00054   <span class="keywordflow">if</span> (solver-&gt;<a class="code" href="a00015.html#ae83b1b0117b6a805ead2e4728945814c">flag_ib</a>) {
<a name="l00055"></a>00055     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00040.html#a783bf18458c856297374e733c1d503ff">IBCleanup</a>(solver-&gt;<a class="code" href="a00015.html#a8419c1760256467c117ef5932b943259">ib</a>);
<a name="l00056"></a>00056     free(solver-&gt;<a class="code" href="a00015.html#a8419c1760256467c117ef5932b943259">ib</a>);
<a name="l00057"></a>00057   }
<a name="l00058"></a>00058 
<a name="l00059"></a>00059   <span class="comment">/* Clean up any allocations in physical model */</span>
<a name="l00060"></a>00060   <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#ad3fe4b266b398f3a7567ac1b241d99a2">model</a>,<a class="code" href="a00053.html#a44c745170d88218420752d150856b01c">_LINEAR_ADVECTION_DIFFUSION_REACTION_</a>)) {
<a name="l00061"></a>00061     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00053.html#a114e6f1e977ae4220d29e8097e017f19">LinearADRCleanup</a>(solver-&gt;<a class="code" href="a00015.html#a48e81a1806b5774943fd9a26e9a190f2">physics</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00062"></a>00062   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#ad3fe4b266b398f3a7567ac1b241d99a2">model</a>,<a class="code" href="a00049.html#a801cd9499779d35febbce73603aa70a6">_FP_DOUBLE_WELL_</a>)) {
<a name="l00063"></a>00063     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00049.html#ad512be0d21fc4b769fcc735ec3482203">FPDoubleWellCleanup</a>(solver-&gt;<a class="code" href="a00015.html#a48e81a1806b5774943fd9a26e9a190f2">physics</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00064"></a>00064   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#ad3fe4b266b398f3a7567ac1b241d99a2">model</a>,<a class="code" href="a00050.html#aaeb0de68ad20c63864e1a6cdf819e836">_FP_POWER_SYSTEM_</a>)) {
<a name="l00065"></a>00065     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00050.html#ac613cf54a15aaed79e93bd3b12d81f44">FPPowerSystemCleanup</a>(solver-&gt;<a class="code" href="a00015.html#a48e81a1806b5774943fd9a26e9a190f2">physics</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00066"></a>00066   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#ad3fe4b266b398f3a7567ac1b241d99a2">model</a>,<a class="code" href="a00051.html#a104fb063ee608b39fdab8d5e1e752ca3">_FP_POWER_SYSTEM_1BUS_</a>)) {
<a name="l00067"></a>00067     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00051.html#aa1df50611026cfcfb6c36f53a7620fef">FPPowerSystem1BusCleanup</a>(solver-&gt;<a class="code" href="a00015.html#a48e81a1806b5774943fd9a26e9a190f2">physics</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00068"></a>00068   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#ad3fe4b266b398f3a7567ac1b241d99a2">model</a>,<a class="code" href="a00052.html#a5c8fe736dacda1a087bf1fb514761d6e">_FP_POWER_SYSTEM_3BUS_</a>)) {
<a name="l00069"></a>00069     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00052.html#a4fc9b84262e14bb803d7469cee294b30">FPPowerSystem3BusCleanup</a>(solver-&gt;<a class="code" href="a00015.html#a48e81a1806b5774943fd9a26e9a190f2">physics</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00070"></a>00070   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#ad3fe4b266b398f3a7567ac1b241d99a2">model</a>,<a class="code" href="a00047.html#a076991b7fbc2b9c6330f792bbba182c2">_EULER_1D_</a>)) {
<a name="l00071"></a>00071     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00047.html#a8e310ddd9664225aef72a59b99baaaef">Euler1DCleanup</a>(solver-&gt;<a class="code" href="a00015.html#a48e81a1806b5774943fd9a26e9a190f2">physics</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00072"></a>00072   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#ad3fe4b266b398f3a7567ac1b241d99a2">model</a>,<a class="code" href="a00048.html#ae205e355df87a13c8b47c958828bce2f">_EULER_2D_</a>)) {
<a name="l00073"></a>00073     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00048.html#ae2bd18386ee9184c66bb7e7b78f1b73b">Euler2DCleanup</a>(solver-&gt;<a class="code" href="a00015.html#a48e81a1806b5774943fd9a26e9a190f2">physics</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00074"></a>00074   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#ad3fe4b266b398f3a7567ac1b241d99a2">model</a>,<a class="code" href="a00054.html#a04e16b3f2a882826e604b6353d9e5bcb">_NAVIER_STOKES_2D_</a>)) {
<a name="l00075"></a>00075     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00054.html#a6906f847d1d73981dfcfcebdb6cb70d4">NavierStokes2DCleanup</a>(solver-&gt;<a class="code" href="a00015.html#a48e81a1806b5774943fd9a26e9a190f2">physics</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00076"></a>00076   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#ad3fe4b266b398f3a7567ac1b241d99a2">model</a>,<a class="code" href="a00055.html#a34099431ed2606bd884d36cea1d0448e">_NAVIER_STOKES_3D_</a>)) {
<a name="l00077"></a>00077     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00055.html#a5467b4e62f223583e901763082eb0d57">NavierStokes3DCleanup</a>(solver-&gt;<a class="code" href="a00015.html#a48e81a1806b5774943fd9a26e9a190f2">physics</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00078"></a>00078   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#ad3fe4b266b398f3a7567ac1b241d99a2">model</a>,<a class="code" href="a00056.html#a82b3f90650895890211635171d649355">_NUMA2D_</a>)) {
<a name="l00079"></a>00079     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00056.html#a064e0d5fee20148d9337dadf871edda3">Numa2DCleanup</a>(solver-&gt;<a class="code" href="a00015.html#a48e81a1806b5774943fd9a26e9a190f2">physics</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00080"></a>00080   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#ad3fe4b266b398f3a7567ac1b241d99a2">model</a>,<a class="code" href="a00057.html#a8bccae14dde8eaba7663344939367e96">_NUMA3D_</a>)) {
<a name="l00081"></a>00081     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00057.html#a4f6671875e6da5b2480003e749cc35f0">Numa3DCleanup</a>(solver-&gt;<a class="code" href="a00015.html#a48e81a1806b5774943fd9a26e9a190f2">physics</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00082"></a>00082   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#ad3fe4b266b398f3a7567ac1b241d99a2">model</a>,<a class="code" href="a00058.html#ac280c6ead138670f1f518fad3ea94737">_SHALLOW_WATER_1D_</a>)) {
<a name="l00083"></a>00083     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00058.html#ab1bdb73df74d06f2e2aeb940b87fcdcf">ShallowWater1DCleanup</a>(solver-&gt;<a class="code" href="a00015.html#a48e81a1806b5774943fd9a26e9a190f2">physics</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00084"></a>00084   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#ad3fe4b266b398f3a7567ac1b241d99a2">model</a>,<a class="code" href="a00059.html#aebe5d4a29761b0784c3d3e67e325105b">_SHALLOW_WATER_2D_</a>)) {
<a name="l00085"></a>00085     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00059.html#a5cfeeae3a3729d15543d8954060a48d4">ShallowWater2DCleanup</a>(solver-&gt;<a class="code" href="a00015.html#a48e81a1806b5774943fd9a26e9a190f2">physics</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00086"></a>00086   }
<a name="l00087"></a>00087   free(solver-&gt;<a class="code" href="a00015.html#a48e81a1806b5774943fd9a26e9a190f2">physics</a>);
<a name="l00088"></a>00088 
<a name="l00089"></a>00089   <span class="comment">/* Clean up any allocations from time-integration */</span>
<a name="l00090"></a>00090 <span class="preprocessor">#ifdef with_petsc</span>
<a name="l00091"></a>00091 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (!solver-&gt;<a class="code" href="a00015.html#ad195de8c64c407718e42cda9246be0d2">use_petscTS</a>) {
<a name="l00092"></a>00092     <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#a138e751362d14724df8e6ab27c4a5e55">time_scheme</a>,<a class="code" href="a00061.html#a50d4bf1e7e4825cc062fca99a770e5ce">_RK_</a>)) {
<a name="l00093"></a>00093       <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00061.html#a9da14408e0e1ce563553ac6638c48456">TimeExplicitRKCleanup</a>(solver-&gt;<a class="code" href="a00015.html#adec095311615891040de11341c01a77f">msti</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00094"></a>00094       free(solver-&gt;<a class="code" href="a00015.html#adec095311615891040de11341c01a77f">msti</a>);
<a name="l00095"></a>00095     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#a138e751362d14724df8e6ab27c4a5e55">time_scheme</a>,<a class="code" href="a00061.html#aad9619c099daeb3e6b1b7ef9e03e38d8">_GLM_GEE_</a>)) {
<a name="l00096"></a>00096       <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00061.html#a600e683b5282f669c7128044f55b2ec4">TimeGLMGEECleanup</a>(solver-&gt;<a class="code" href="a00015.html#adec095311615891040de11341c01a77f">msti</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00097"></a>00097       free(solver-&gt;<a class="code" href="a00015.html#adec095311615891040de11341c01a77f">msti</a>);
<a name="l00098"></a>00098     }
<a name="l00099"></a>00099   }
<a name="l00100"></a>00100 <span class="preprocessor">#else</span>
<a name="l00101"></a>00101 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#a138e751362d14724df8e6ab27c4a5e55">time_scheme</a>,<a class="code" href="a00061.html#a50d4bf1e7e4825cc062fca99a770e5ce">_RK_</a>)) {
<a name="l00102"></a>00102     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00061.html#a9da14408e0e1ce563553ac6638c48456">TimeExplicitRKCleanup</a>(solver-&gt;<a class="code" href="a00015.html#adec095311615891040de11341c01a77f">msti</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00103"></a>00103     free(solver-&gt;<a class="code" href="a00015.html#adec095311615891040de11341c01a77f">msti</a>);
<a name="l00104"></a>00104   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#a138e751362d14724df8e6ab27c4a5e55">time_scheme</a>,<a class="code" href="a00061.html#aad9619c099daeb3e6b1b7ef9e03e38d8">_GLM_GEE_</a>)) {
<a name="l00105"></a>00105     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00061.html#a600e683b5282f669c7128044f55b2ec4">TimeGLMGEECleanup</a>(solver-&gt;<a class="code" href="a00015.html#adec095311615891040de11341c01a77f">msti</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00106"></a>00106     free(solver-&gt;<a class="code" href="a00015.html#adec095311615891040de11341c01a77f">msti</a>);
<a name="l00107"></a>00107   }
<a name="l00108"></a>00108 <span class="preprocessor">#endif</span>
<a name="l00109"></a>00109 <span class="preprocessor"></span>
<a name="l00110"></a>00110   <span class="comment">/* Clean up any spatial reconstruction related allocations */</span>
<a name="l00111"></a>00111   <span class="keywordflow">if</span> (   (!strcmp(solver-&gt;<a class="code" href="a00015.html#ad29846eeb9c83b329a8d7c1fe69d46b2">spatial_scheme_hyp</a>,<a class="code" href="a00041.html#acfeff1b158131390b7129f4a857b15ff">_FIFTH_ORDER_WENO_</a>  )) 
<a name="l00112"></a>00112       || (!strcmp(solver-&gt;<a class="code" href="a00015.html#ad29846eeb9c83b329a8d7c1fe69d46b2">spatial_scheme_hyp</a>,<a class="code" href="a00041.html#a175a82b8ae2b24c0ba51e1b1dd68c0e5">_FIFTH_ORDER_CRWENO_</a>))
<a name="l00113"></a>00113       || (!strcmp(solver-&gt;<a class="code" href="a00015.html#ad29846eeb9c83b329a8d7c1fe69d46b2">spatial_scheme_hyp</a>,<a class="code" href="a00041.html#a6d34f5e8aae80a0d2a27ea20368dfef1">_FIFTH_ORDER_HCWENO_</a>)) ) {
<a name="l00114"></a>00114     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00041.html#a37dd034f5e9eb221bd3fd51cc8d1b0f4">WENOCleanup</a>(solver-&gt;<a class="code" href="a00015.html#a29c46b81ad574e4dfbad5a7211487dcb">interp</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00115"></a>00115   }
<a name="l00116"></a>00116   <span class="keywordflow">if</span> (solver-&gt;<a class="code" href="a00015.html#a29c46b81ad574e4dfbad5a7211487dcb">interp</a>)   free(solver-&gt;<a class="code" href="a00015.html#a29c46b81ad574e4dfbad5a7211487dcb">interp</a>);
<a name="l00117"></a>00117   <span class="keywordflow">if</span> (   (!strcmp(solver-&gt;<a class="code" href="a00015.html#ad29846eeb9c83b329a8d7c1fe69d46b2">spatial_scheme_hyp</a>,<a class="code" href="a00041.html#ae832e2314ee85139cec9df4ea82aafa2">_FIFTH_ORDER_COMPACT_UPWIND_</a> )) 
<a name="l00118"></a>00118       || (!strcmp(solver-&gt;<a class="code" href="a00015.html#ad29846eeb9c83b329a8d7c1fe69d46b2">spatial_scheme_hyp</a>,<a class="code" href="a00041.html#a175a82b8ae2b24c0ba51e1b1dd68c0e5">_FIFTH_ORDER_CRWENO_</a>         ))
<a name="l00119"></a>00119       || (!strcmp(solver-&gt;<a class="code" href="a00015.html#ad29846eeb9c83b329a8d7c1fe69d46b2">spatial_scheme_hyp</a>,<a class="code" href="a00041.html#a6d34f5e8aae80a0d2a27ea20368dfef1">_FIFTH_ORDER_HCWENO_</a>         )) ) {
<a name="l00120"></a>00120     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00041.html#acfaa225472f09e2ade88945e909d5893">CompactSchemeCleanup</a>(solver-&gt;<a class="code" href="a00015.html#a56318721d534e74a96b440f8542a0232">compact</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00121"></a>00121   }
<a name="l00122"></a>00122   <span class="keywordflow">if</span> (solver-&gt;<a class="code" href="a00015.html#a56318721d534e74a96b440f8542a0232">compact</a>)  free(solver-&gt;<a class="code" href="a00015.html#a56318721d534e74a96b440f8542a0232">compact</a>);
<a name="l00123"></a>00123   <span class="keywordflow">if</span> (solver-&gt;<a class="code" href="a00015.html#a1dbfa1e479a373073b6ebf72401a7f0f">lusolver</a>) free(solver-&gt;<a class="code" href="a00015.html#a1dbfa1e479a373073b6ebf72401a7f0f">lusolver</a>);
<a name="l00124"></a>00124 
<a name="l00125"></a>00125   <span class="comment">/* Free the communicators created */</span>
<a name="l00126"></a>00126   <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#af59eb9eb78e6e99df5630429e5383617">MPIFreeCommunicators</a>(solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,mpi); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00127"></a>00127 
<a name="l00128"></a>00128   <span class="comment">/* These variables are allocated in Initialize.c */</span>
<a name="l00129"></a>00129   free(solver-&gt;<a class="code" href="a00015.html#aa989ebb755986852177779cdf7bd8c85">dim_global</a>);
<a name="l00130"></a>00130   free(solver-&gt;<a class="code" href="a00015.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>);
<a name="l00131"></a>00131   free(solver-&gt;<a class="code" href="a00015.html#a95e9e0f8a692321b83a2e0ce2789c485">index</a>);
<a name="l00132"></a>00132   free(solver-&gt;<a class="code" href="a00015.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>);
<a name="l00133"></a>00133 <span class="preprocessor">#ifdef with_petsc</span>
<a name="l00134"></a>00134 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (solver-&gt;<a class="code" href="a00015.html#acab4b9b417d6c3745ad789099d3731c6">u0</a>)     free(solver-&gt;<a class="code" href="a00015.html#acab4b9b417d6c3745ad789099d3731c6">u0</a>);
<a name="l00135"></a>00135   <span class="keywordflow">if</span> (solver-&gt;<a class="code" href="a00015.html#a3ccc9ddb96600c40dcc41bb1ded11160">uref</a>)   free(solver-&gt;<a class="code" href="a00015.html#a3ccc9ddb96600c40dcc41bb1ded11160">uref</a>);
<a name="l00136"></a>00136   <span class="keywordflow">if</span> (solver-&gt;<a class="code" href="a00015.html#ad587a58397d439c443ae325450a01a13">rhsref</a>) free(solver-&gt;<a class="code" href="a00015.html#ad587a58397d439c443ae325450a01a13">rhsref</a>);
<a name="l00137"></a>00137   <span class="keywordflow">if</span> (solver-&gt;<a class="code" href="a00015.html#ade4650485fe35fd3e12fea272fc80209">rhs</a>)    free(solver-&gt;<a class="code" href="a00015.html#ade4650485fe35fd3e12fea272fc80209">rhs</a>);   
<a name="l00138"></a>00138 <span class="preprocessor">#endif</span>
<a name="l00139"></a>00139 <span class="preprocessor"></span>  free(solver-&gt;<a class="code" href="a00015.html#a267ef7e03dbe9dd4440dee2fdf48619a">iblank</a>);
<a name="l00140"></a>00140   free(solver-&gt;<a class="code" href="a00015.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>);
<a name="l00141"></a>00141   free(solver-&gt;<a class="code" href="a00015.html#ae53517ad7a202762d7b79eaf681701f3">par</a>);
<a name="l00142"></a>00142   free(solver-&gt;<a class="code" href="a00015.html#a6b4951ffdbd82f3a3848b82352d389d6">source</a>);
<a name="l00143"></a>00143   free(solver-&gt;<a class="code" href="a00015.html#aee7ff3b51db01ee6ed4038ff5311ed24">fluxC</a>);
<a name="l00144"></a>00144   free(solver-&gt;<a class="code" href="a00015.html#a86221feda74097db9eb6c900ca1e6cbc">uC</a>);
<a name="l00145"></a>00145   free(solver-&gt;<a class="code" href="a00015.html#af163100a3e0533dbf1868decd5c8201c">Deriv1</a>);
<a name="l00146"></a>00146   free(solver-&gt;<a class="code" href="a00015.html#a31bc6f5b337e72aa281a1ea5ad5d6832">Deriv2</a>);
<a name="l00147"></a>00147   free(solver-&gt;<a class="code" href="a00015.html#a983929b7b1511ff3e7800597adef6a91">fluxI</a>);
<a name="l00148"></a>00148   free(solver-&gt;<a class="code" href="a00015.html#a8452297a324a34268a6565583901347d">uL</a>);
<a name="l00149"></a>00149   free(solver-&gt;<a class="code" href="a00015.html#a3c811b25c11d2c98bfff02ddeadeb3d9">uR</a>);
<a name="l00150"></a>00150   free(solver-&gt;<a class="code" href="a00015.html#a99f72a44e29089b75fd11155bfcc1ff8">fL</a>);
<a name="l00151"></a>00151   free(solver-&gt;<a class="code" href="a00015.html#abb50b7a404febaf647f7bd89f873b96e">fR</a>);
<a name="l00152"></a>00152   free(solver-&gt;<a class="code" href="a00015.html#a711aad4cbe735871dd9e91ab575c878b">x</a>);
<a name="l00153"></a>00153   free(solver-&gt;<a class="code" href="a00015.html#aa24a4f5e29bd70cbe5a2413be1ea9682">dxinv</a>);
<a name="l00154"></a>00154   free(solver-&gt;<a class="code" href="a00015.html#a40e3f67b1530d5ea4e913fc60b594802">isPeriodic</a>);
<a name="l00155"></a>00155   free(mpi-&gt;<a class="code" href="a00019.html#a0be0f30a83bc3f3d9f6ee3a36bbf2716">iproc</a>);
<a name="l00156"></a>00156   free(mpi-&gt;<a class="code" href="a00019.html#aa3c28612a64b8a97bde66b720e15c700">ip</a>);
<a name="l00157"></a>00157   free(mpi-&gt;<a class="code" href="a00019.html#a481013ba007a99a4237cde5eeb3c9a29">is</a>);
<a name="l00158"></a>00158   free(mpi-&gt;<a class="code" href="a00019.html#a7602de5ebb1b59ec35217e78a35a531e">ie</a>);
<a name="l00159"></a>00159   free(mpi-&gt;<a class="code" href="a00019.html#af40a5a3066fdb53a47e4627071abc2bc">bcperiodic</a>);
<a name="l00160"></a>00160   free(mpi-&gt;<a class="code" href="a00019.html#aba3b15034da676474db917f9f5533085">sendbuf</a>);
<a name="l00161"></a>00161   free(mpi-&gt;<a class="code" href="a00019.html#afc23e46e08649e112e8d64d780cea5cb">recvbuf</a>);
<a name="l00162"></a>00162   free(solver-&gt;<a class="code" href="a00015.html#a57f7bff1d8bf27f2ca5c00270da00d05">VolumeIntegral</a>);
<a name="l00163"></a>00163   free(solver-&gt;<a class="code" href="a00015.html#a3aec36aeb5caac1e87f5b4f5f75d5a23">VolumeIntegralInitial</a>);
<a name="l00164"></a>00164   free(solver-&gt;<a class="code" href="a00015.html#ac3326fc53477d445133072e3f1fe6b59">StageBoundaryIntegral</a>);
<a name="l00165"></a>00165   free(solver-&gt;<a class="code" href="a00015.html#a6dfeed442d18083b68fd0f28d5f63fa7">StepBoundaryIntegral</a>);
<a name="l00166"></a>00166   free(solver-&gt;<a class="code" href="a00015.html#a644ed0ed36ed4af1c396c0af6aca043d">TotalBoundaryIntegral</a>);
<a name="l00167"></a>00167   free(solver-&gt;<a class="code" href="a00015.html#a965363cd64ce50ae17705dfb285dd0ab">ConservationError</a>);
<a name="l00168"></a>00168   free(solver-&gt;<a class="code" href="a00015.html#a39dc7def53a36bdc722aa90f52e04561">stride_with_ghosts</a>);
<a name="l00169"></a>00169   free(solver-&gt;<a class="code" href="a00015.html#a98bbff775d127bdd2451b55ce3d06e06">stride_without_ghosts</a>);
<a name="l00170"></a>00170 
<a name="l00171"></a>00171   <span class="keywordflow">if</span> (solver-&gt;<a class="code" href="a00015.html#a0805db42e429173752189696c3c96909">filename_index</a>) free(solver-&gt;<a class="code" href="a00015.html#a0805db42e429173752189696c3c96909">filename_index</a>);
<a name="l00172"></a>00172 
<a name="l00173"></a>00173   <span class="keywordflow">return</span>(0);
<a name="l00174"></a>00174 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="abea704146c0360a55dccc6674db8d5fb"></a><!-- doxytag: member="hypar.h::Initialize" ref="abea704146c0360a55dccc6674db8d5fb" args="(void *, void *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int Initialize </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>m</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Initialize the solver</p>
<p>Initialization function called at the beginning of a simulation. This function does the following: + allocates memory for MPI related arrays + initializes the values for MPI variables + creates sub-communicators and communication groups + allocates memory for arrays to store solution, right-hand-side, flux, and other working vectors. + initializes function counters to zero </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>s</em>&nbsp;</td><td>Solver object of type <a class="el" href="a00015.html" title="Structure containing all solver-specific variables and functions.">HyPar</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>m</em>&nbsp;</td><td>MPI object of type <a class="el" href="a00019.html" title="Structure of MPI-related variables.">MPIVariables</a> </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00100_source.html#l00022">22</a> of file <a class="el" href="a00100_source.html">Initialize.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00026"></a>00026 {
<a name="l00027"></a>00027   <a class="code" href="a00015.html" title="Structure containing all solver-specific variables and functions.">HyPar</a>         *solver = (<a class="code" href="a00015.html" title="Structure containing all solver-specific variables and functions.">HyPar</a>*)        s;
<a name="l00028"></a>00028   <a class="code" href="a00019.html" title="Structure of MPI-related variables.">MPIVariables</a>  *mpi    = (<a class="code" href="a00019.html" title="Structure of MPI-related variables.">MPIVariables</a>*) m;
<a name="l00029"></a>00029   <span class="keywordtype">int</span>           i,d;
<a name="l00030"></a>00030 
<a name="l00031"></a>00031   <span class="comment">/* allocations */</span>
<a name="l00032"></a>00032   mpi-&gt;<a class="code" href="a00019.html#aa3c28612a64b8a97bde66b720e15c700">ip</a>           = (<span class="keywordtype">int</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00033"></a>00033   mpi-&gt;<a class="code" href="a00019.html#a481013ba007a99a4237cde5eeb3c9a29">is</a>           = (<span class="keywordtype">int</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00034"></a>00034   mpi-&gt;<a class="code" href="a00019.html#a7602de5ebb1b59ec35217e78a35a531e">ie</a>           = (<span class="keywordtype">int</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00035"></a>00035   mpi-&gt;<a class="code" href="a00019.html#af40a5a3066fdb53a47e4627071abc2bc">bcperiodic</a>   = (<span class="keywordtype">int</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00036"></a>00036   solver-&gt;<a class="code" href="a00015.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a> = (<span class="keywordtype">int</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00037"></a>00037   solver-&gt;<a class="code" href="a00015.html#a40e3f67b1530d5ea4e913fc60b594802">isPeriodic</a>= (<span class="keywordtype">int</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 <span class="preprocessor">#ifndef serial</span>
<a name="l00040"></a>00040 <span class="preprocessor"></span>  <a class="code" href="a00036.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a>;
<a name="l00041"></a>00041 
<a name="l00042"></a>00042   <span class="comment">/* Domain partitioning */</span>
<a name="l00043"></a>00043   <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a00019.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) printf(<span class="stringliteral">&quot;Partitioning domain.\n&quot;</span>);
<a name="l00044"></a>00044   <span class="keywordtype">int</span> total_proc = 1;
<a name="l00045"></a>00045   <span class="keywordflow">for</span> (i=0; i&lt;solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>; i++) total_proc *= mpi-&gt;<a class="code" href="a00019.html#a0be0f30a83bc3f3d9f6ee3a36bbf2716">iproc</a>[i];
<a name="l00046"></a>00046   if (mpi-&gt;<a class="code" href="a00019.html#ae68326adc3b3862f1162832f70727b06">nproc</a> != total_proc) {
<a name="l00047"></a>00047     fprintf(stderr,<span class="stringliteral">&quot;Error on rank %d: total number of processes is not consistent &quot;</span>, mpi-&gt;<a class="code" href="a00019.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>);
<a name="l00048"></a>00048     fprintf(stderr,<span class="stringliteral">&quot;with number of processes along each dimension.\n&quot;</span>);
<a name="l00049"></a>00049     fprintf(stderr,<span class="stringliteral">&quot;mpiexec was called with %d processes, &quot;</span>,mpi-&gt;<a class="code" href="a00019.html#ae68326adc3b3862f1162832f70727b06">nproc</a>);
<a name="l00050"></a>00050     fprintf(stderr,<span class="stringliteral">&quot;total number of processes from \&quot;solver.inp\&quot; is %d.\n&quot;</span>, total_proc);
<a name="l00051"></a>00051     <span class="keywordflow">return</span>(1);
<a name="l00052"></a>00052   }
<a name="l00053"></a>00053 
<a name="l00054"></a>00054   <span class="comment">/* calculate ndims-D rank of each process (ip[]) from rank in MPI_COMM_WORLD */</span>
<a name="l00055"></a>00055   <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#afe59a0480bb81cc0d7877ba547b3e28c">MPIRanknD</a>(solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,mpi-&gt;<a class="code" href="a00019.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>,mpi-&gt;<a class="code" href="a00019.html#a0be0f30a83bc3f3d9f6ee3a36bbf2716">iproc</a>,mpi-&gt;<a class="code" href="a00019.html#aa3c28612a64b8a97bde66b720e15c700">ip</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00056"></a>00056 
<a name="l00057"></a>00057   <span class="comment">/* calculate local domain sizes along each dimension */</span>
<a name="l00058"></a>00058   <span class="keywordflow">for</span> (i=0; i&lt;solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>; i++) 
<a name="l00059"></a>00059     solver-&gt;<a class="code" href="a00015.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>[i] = <a class="code" href="a00045.html#af8194ca5a460534fdbe391035a95c69d">MPIPartition1D</a>(solver-&gt;<a class="code" href="a00015.html#aa989ebb755986852177779cdf7bd8c85">dim_global</a>[i],mpi-&gt;<a class="code" href="a00019.html#a0be0f30a83bc3f3d9f6ee3a36bbf2716">iproc</a>[i],mpi-&gt;<a class="code" href="a00019.html#aa3c28612a64b8a97bde66b720e15c700">ip</a>[i]);
<a name="l00060"></a>00060 
<a name="l00061"></a>00061   <span class="comment">/* calculate local domain limits in terms of global domain */</span>
<a name="l00062"></a>00062   <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#a9a3fc32b7d4bea6a1dac44ab21c9202e">MPILocalDomainLimits</a>(solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,mpi-&gt;<a class="code" href="a00019.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>,mpi,solver-&gt;<a class="code" href="a00015.html#aa989ebb755986852177779cdf7bd8c85">dim_global</a>,mpi-&gt;<a class="code" href="a00019.html#a481013ba007a99a4237cde5eeb3c9a29">is</a>,mpi-&gt;<a class="code" href="a00019.html#a7602de5ebb1b59ec35217e78a35a531e">ie</a>);
<a name="l00063"></a>00063   <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00064"></a>00064 
<a name="l00065"></a>00065   <span class="comment">/* create sub-communicators for parallel computations along grid lines in each dimension */</span>
<a name="l00066"></a>00066   <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#ade449de8860c4b1060ca15bf7a80476f">MPICreateCommunicators</a>(solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,mpi); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00067"></a>00067 
<a name="l00068"></a>00068   <span class="comment">/* initialize periodic BC flags to zero */</span>
<a name="l00069"></a>00069   <span class="keywordflow">for</span> (i=0; i&lt;solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>; i++) mpi-&gt;<a class="code" href="a00019.html#af40a5a3066fdb53a47e4627071abc2bc">bcperiodic</a>[i] = 0;
<a name="l00070"></a>00070 
<a name="l00071"></a>00071   <span class="comment">/* create communication groups */</span>
<a name="l00072"></a>00072   <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#a87419c70e96bbafe1e63821ba1d2e975">MPICreateIOGroups</a>(mpi); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00073"></a>00073 
<a name="l00074"></a>00074 <span class="preprocessor">#else</span>
<a name="l00075"></a>00075 <span class="preprocessor"></span>
<a name="l00076"></a>00076   <span class="keywordflow">for</span> (i=0; i&lt;solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>; i++) {
<a name="l00077"></a>00077     mpi-&gt;<a class="code" href="a00019.html#aa3c28612a64b8a97bde66b720e15c700">ip</a>[i]            = 0;
<a name="l00078"></a>00078     solver-&gt;<a class="code" href="a00015.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>[i]  = solver-&gt;<a class="code" href="a00015.html#aa989ebb755986852177779cdf7bd8c85">dim_global</a>[i];
<a name="l00079"></a>00079     mpi-&gt;<a class="code" href="a00019.html#a0be0f30a83bc3f3d9f6ee3a36bbf2716">iproc</a>[i]         = 1;
<a name="l00080"></a>00080     mpi-&gt;<a class="code" href="a00019.html#a481013ba007a99a4237cde5eeb3c9a29">is</a>[i]            = 0;
<a name="l00081"></a>00081     mpi-&gt;<a class="code" href="a00019.html#a7602de5ebb1b59ec35217e78a35a531e">ie</a>[i]            = solver-&gt;<a class="code" href="a00015.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>[i];
<a name="l00082"></a>00082     mpi-&gt;<a class="code" href="a00019.html#af40a5a3066fdb53a47e4627071abc2bc">bcperiodic</a>[i]    = 0;
<a name="l00083"></a>00083   }
<a name="l00084"></a>00084 
<a name="l00085"></a>00085 <span class="preprocessor">#endif</span>
<a name="l00086"></a>00086 <span class="preprocessor"></span>
<a name="l00087"></a>00087   solver-&gt;<a class="code" href="a00015.html#a4e67f54563a3c4ff005dfaf0130f957c">npoints_global</a> = solver-&gt;<a class="code" href="a00015.html#afae6319baba315ac1f0c56505610ed85">npoints_local</a> = solver-&gt;<a class="code" href="a00015.html#a20ee1fd00a220b98513127884a5558cf">npoints_local_wghosts</a> = 1;
<a name="l00088"></a>00088   <span class="keywordflow">for</span> (i=0; i&lt;solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>; i++) solver-&gt;<a class="code" href="a00015.html#a4e67f54563a3c4ff005dfaf0130f957c">npoints_global</a> *= solver-&gt;<a class="code" href="a00015.html#aa989ebb755986852177779cdf7bd8c85">dim_global</a>[i];
<a name="l00089"></a>00089   for (i=0; i&lt;solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>; i++) solver-&gt;<a class="code" href="a00015.html#afae6319baba315ac1f0c56505610ed85">npoints_local</a>  *= solver-&gt;<a class="code" href="a00015.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a> [i];
<a name="l00090"></a>00090   for (i=0; i&lt;solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>; i++) 
<a name="l00091"></a>00091     solver-&gt;<a class="code" href="a00015.html#a20ee1fd00a220b98513127884a5558cf">npoints_local_wghosts</a> *= (solver-&gt;<a class="code" href="a00015.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>[i]+2*solver-&gt;<a class="code" href="a00015.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>);
<a name="l00092"></a>00092 
<a name="l00093"></a>00093   <span class="comment">/* Allocations */</span>
<a name="l00094"></a>00094   <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a00019.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) printf(<span class="stringliteral">&quot;Allocating data arrays.\n&quot;</span>);
<a name="l00095"></a>00095   solver-&gt;<a class="code" href="a00015.html#a95e9e0f8a692321b83a2e0ce2789c485">index</a> = (<span class="keywordtype">int</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00096"></a>00096   solver-&gt;<a class="code" href="a00015.html#a39dc7def53a36bdc722aa90f52e04561">stride_with_ghosts</a>    = (<span class="keywordtype">int</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00097"></a>00097   solver-&gt;<a class="code" href="a00015.html#a98bbff775d127bdd2451b55ce3d06e06">stride_without_ghosts</a> = (<span class="keywordtype">int</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00098"></a>00098   <span class="keywordtype">int</span> accu1 = 1, accu2 = 1;
<a name="l00099"></a>00099   <span class="keywordflow">for</span> (i=0; i&lt;solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>; i++) {
<a name="l00100"></a>00100     solver-&gt;<a class="code" href="a00015.html#a39dc7def53a36bdc722aa90f52e04561">stride_with_ghosts</a>[i]    = accu1;
<a name="l00101"></a>00101     solver-&gt;<a class="code" href="a00015.html#a98bbff775d127bdd2451b55ce3d06e06">stride_without_ghosts</a>[i] = accu2;
<a name="l00102"></a>00102     accu1 *= (solver-&gt;<a class="code" href="a00015.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>[i]+2*solver-&gt;<a class="code" href="a00015.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>);
<a name="l00103"></a>00103     accu2 *=  solver-&gt;<a class="code" href="a00015.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>[i];
<a name="l00104"></a>00104   }
<a name="l00105"></a>00105   <span class="keywordtype">int</span> size;
<a name="l00106"></a>00106   <span class="comment">/* state variable */</span>
<a name="l00107"></a>00107   size = 1;
<a name="l00108"></a>00108   <span class="keywordflow">for</span> (i=0; i&lt;solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>; i++) size *= (solver-&gt;<a class="code" href="a00015.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>[i]+2*solver-&gt;<a class="code" href="a00015.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>);
<a name="l00109"></a>00109   solver-&gt;<a class="code" href="a00015.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>       = (<span class="keywordtype">double</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>*size,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00110"></a>00110 <span class="preprocessor">#ifdef with_petsc</span>
<a name="l00111"></a>00111 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (solver-&gt;<a class="code" href="a00015.html#ad195de8c64c407718e42cda9246be0d2">use_petscTS</a>) {
<a name="l00112"></a>00112     solver-&gt;<a class="code" href="a00015.html#acab4b9b417d6c3745ad789099d3731c6">u0</a>      = (<span class="keywordtype">double</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>*size,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00113"></a>00113     solver-&gt;<a class="code" href="a00015.html#a3ccc9ddb96600c40dcc41bb1ded11160">uref</a>    = (<span class="keywordtype">double</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>*size,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00114"></a>00114     solver-&gt;<a class="code" href="a00015.html#ad587a58397d439c443ae325450a01a13">rhsref</a>  = (<span class="keywordtype">double</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>*size,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00115"></a>00115     solver-&gt;<a class="code" href="a00015.html#ade4650485fe35fd3e12fea272fc80209">rhs</a>     = (<span class="keywordtype">double</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>*size,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00116"></a>00116   } <span class="keywordflow">else</span> solver-&gt;<a class="code" href="a00015.html#acab4b9b417d6c3745ad789099d3731c6">u0</a> = solver-&gt;<a class="code" href="a00015.html#a3ccc9ddb96600c40dcc41bb1ded11160">uref</a> = solver-&gt;<a class="code" href="a00015.html#ad587a58397d439c443ae325450a01a13">rhsref</a> = solver-&gt;<a class="code" href="a00015.html#ade4650485fe35fd3e12fea272fc80209">rhs</a> = NULL;
<a name="l00117"></a>00117 <span class="preprocessor">#endif</span>
<a name="l00118"></a>00118 <span class="preprocessor"></span>  solver-&gt;<a class="code" href="a00015.html#aeadfdde0fbc3058bace813055212dcc3">hyp</a>     = (<span class="keywordtype">double</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>*size,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00119"></a>00119   solver-&gt;<a class="code" href="a00015.html#ae53517ad7a202762d7b79eaf681701f3">par</a>     = (<span class="keywordtype">double</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>*size,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00120"></a>00120   solver-&gt;<a class="code" href="a00015.html#a6b4951ffdbd82f3a3848b82352d389d6">source</a>  = (<span class="keywordtype">double</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>*size,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00121"></a>00121   solver-&gt;<a class="code" href="a00015.html#a267ef7e03dbe9dd4440dee2fdf48619a">iblank</a>  = (<span class="keywordtype">double</span>*) calloc (size              ,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00122"></a>00122   <span class="comment">/* grid */</span>
<a name="l00123"></a>00123   size = 0;
<a name="l00124"></a>00124   <span class="keywordflow">for</span> (i=0; i&lt;solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>; i++) size += (solver-&gt;<a class="code" href="a00015.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>[i]+2*solver-&gt;<a class="code" href="a00015.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>);
<a name="l00125"></a>00125   solver-&gt;<a class="code" href="a00015.html#a711aad4cbe735871dd9e91ab575c878b">x</a>     = (<span class="keywordtype">double</span>*) calloc (size,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00126"></a>00126   solver-&gt;<a class="code" href="a00015.html#aa24a4f5e29bd70cbe5a2413be1ea9682">dxinv</a> = (<span class="keywordtype">double</span>*) calloc (size,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00127"></a>00127   <span class="comment">/* arrays needed to compute fluxes */</span>
<a name="l00128"></a>00128   size = 1;  <span class="keywordflow">for</span> (i=0; i&lt;solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>; i++) size *= (solver-&gt;<a class="code" href="a00015.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>[i]+2*solver-&gt;<a class="code" href="a00015.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>);
<a name="l00129"></a>00129   solver-&gt;<a class="code" href="a00015.html#a86221feda74097db9eb6c900ca1e6cbc">uC</a>     = (<span class="keywordtype">double</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>*size,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00130"></a>00130   solver-&gt;<a class="code" href="a00015.html#aee7ff3b51db01ee6ed4038ff5311ed24">fluxC</a>  = (<span class="keywordtype">double</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>*size,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00131"></a>00131   solver-&gt;<a class="code" href="a00015.html#af163100a3e0533dbf1868decd5c8201c">Deriv1</a> = (<span class="keywordtype">double</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>*size,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00132"></a>00132   solver-&gt;<a class="code" href="a00015.html#a31bc6f5b337e72aa281a1ea5ad5d6832">Deriv2</a> = (<span class="keywordtype">double</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>*size,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00133"></a>00133   size = 1;  <span class="keywordflow">for</span> (i=0; i&lt;solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>; i++) size *= (solver-&gt;<a class="code" href="a00015.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>[i]+1);
<a name="l00134"></a>00134   solver-&gt;<a class="code" href="a00015.html#a983929b7b1511ff3e7800597adef6a91">fluxI</a> = (<span class="keywordtype">double</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>*size,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00135"></a>00135   solver-&gt;<a class="code" href="a00015.html#a8452297a324a34268a6565583901347d">uL</a>    = (<span class="keywordtype">double</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>*size,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00136"></a>00136   solver-&gt;<a class="code" href="a00015.html#a3c811b25c11d2c98bfff02ddeadeb3d9">uR</a>    = (<span class="keywordtype">double</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>*size,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00137"></a>00137   solver-&gt;<a class="code" href="a00015.html#a99f72a44e29089b75fd11155bfcc1ff8">fL</a>    = (<span class="keywordtype">double</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>*size,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00138"></a>00138   solver-&gt;<a class="code" href="a00015.html#abb50b7a404febaf647f7bd89f873b96e">fR</a>    = (<span class="keywordtype">double</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>*size,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00139"></a>00139   <span class="comment">/* allocate MPI send/receive buffer arrays */</span>
<a name="l00140"></a>00140   <span class="keywordtype">int</span> bufdim[solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>], maxbuf = 0;
<a name="l00141"></a>00141   <span class="keywordflow">for</span> (d = 0; d &lt; solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>; d++) {
<a name="l00142"></a>00142     bufdim[d] = 1;
<a name="l00143"></a>00143     <span class="keywordflow">for</span> (i = 0; i &lt; solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>; i++) {
<a name="l00144"></a>00144       <span class="keywordflow">if</span> (i == d) bufdim[d] *= solver-&gt;<a class="code" href="a00015.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>;
<a name="l00145"></a>00145       <span class="keywordflow">else</span>        bufdim[d] *= solver-&gt;<a class="code" href="a00015.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>[i];
<a name="l00146"></a>00146     }
<a name="l00147"></a>00147     <span class="keywordflow">if</span> (bufdim[d] &gt; maxbuf) maxbuf = bufdim[d];
<a name="l00148"></a>00148   }
<a name="l00149"></a>00149   maxbuf *= solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>;
<a name="l00150"></a>00150   mpi-&gt;<a class="code" href="a00019.html#a4c12bdea025b404c7dd79f368fc03efd">maxbuf</a>  = maxbuf;
<a name="l00151"></a>00151   mpi-&gt;<a class="code" href="a00019.html#aba3b15034da676474db917f9f5533085">sendbuf</a> = (<span class="keywordtype">double</span>*) calloc (2*solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>*maxbuf,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00152"></a>00152   mpi-&gt;<a class="code" href="a00019.html#afc23e46e08649e112e8d64d780cea5cb">recvbuf</a> = (<span class="keywordtype">double</span>*) calloc (2*solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>*maxbuf,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00153"></a>00153   <span class="comment">/* allocate the volume and boundary integral arrays */</span>
<a name="l00154"></a>00154   solver-&gt;<a class="code" href="a00015.html#a57f7bff1d8bf27f2ca5c00270da00d05">VolumeIntegral</a>        = (<span class="keywordtype">double</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>  ,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00155"></a>00155   solver-&gt;<a class="code" href="a00015.html#a3aec36aeb5caac1e87f5b4f5f75d5a23">VolumeIntegralInitial</a> = (<span class="keywordtype">double</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>  ,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00156"></a>00156   solver-&gt;<a class="code" href="a00015.html#ac3326fc53477d445133072e3f1fe6b59">StageBoundaryIntegral</a> = (<span class="keywordtype">double</span>*) calloc (2*solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>*solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00157"></a>00157   solver-&gt;<a class="code" href="a00015.html#a6dfeed442d18083b68fd0f28d5f63fa7">StepBoundaryIntegral</a>  = (<span class="keywordtype">double</span>*) calloc (2*solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>*solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00158"></a>00158   solver-&gt;<a class="code" href="a00015.html#a644ed0ed36ed4af1c396c0af6aca043d">TotalBoundaryIntegral</a> = (<span class="keywordtype">double</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00159"></a>00159   solver-&gt;<a class="code" href="a00015.html#a965363cd64ce50ae17705dfb285dd0ab">ConservationError</a>     = (<span class="keywordtype">double</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00160"></a>00160 
<a name="l00161"></a>00161   <span class="comment">/* initialize function call counts to zero */</span>
<a name="l00162"></a>00162   solver-&gt;<a class="code" href="a00015.html#ab6a7eec54a4d412178811cf50241fea0">count_hyp</a> = solver-&gt;<a class="code" href="a00015.html#a6e3288a129bfd334448fbf3089338b69">count_par</a> = solver-&gt;<a class="code" href="a00015.html#a0522fdf88d4668950f74422ec1e57a9b">count_sou</a> = 0;
<a name="l00163"></a>00163 <span class="preprocessor">#ifdef with_petsc</span>
<a name="l00164"></a>00164 <span class="preprocessor"></span>  solver-&gt;<a class="code" href="a00015.html#a037bb9eabb2ecdb3812c625db433cf6b">count_RHSFunction</a> = solver-&gt;<a class="code" href="a00015.html#a7d89659a19156a22ef22a361592ef5f7">count_IFunction</a>
<a name="l00165"></a>00165     = solver-&gt;<a class="code" href="a00015.html#a8086208a451520745e3fab0e3918db06">count_IJacobian</a> = solver-&gt;<a class="code" href="a00015.html#afc11cc081aa04d7b35ebcbcb735f7e22">count_IJacFunction</a> 
<a name="l00166"></a>00166     = 0;
<a name="l00167"></a>00167 <span class="preprocessor">#endif</span>
<a name="l00168"></a>00168 <span class="preprocessor"></span>
<a name="l00169"></a>00169   <span class="comment">/* Initialize iblank to 1*/</span>
<a name="l00170"></a>00170   <a class="code" href="a00034.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(solver-&gt;<a class="code" href="a00015.html#a267ef7e03dbe9dd4440dee2fdf48619a">iblank</a>,solver-&gt;<a class="code" href="a00015.html#a20ee1fd00a220b98513127884a5558cf">npoints_local_wghosts</a>,1);
<a name="l00171"></a>00171 
<a name="l00172"></a>00172   <span class="keywordflow">return</span>(0);
<a name="l00173"></a>00173 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8770e5634efc34bf45dea3596114c092"></a><!-- doxytag: member="hypar.h::InitializeBoundaries" ref="a8770e5634efc34bf45dea3596114c092" args="(void *, void *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int InitializeBoundaries </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>m</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Initialize the boundary conditions</p>
<p>This function initializes the variables and functions related to implementing the boundary conditions. + Rank 0 reads in the boundary conditions file and broadcasts the information to all processors. + Depending on the type of boundary, additional information is read in. For example, for Dirichlet boundary, the Dirichlet value is read in. + Allocate and initialize arrays and variables related to implementing the boundary conditions. + Each rank finds out if the subdomain it owns abuts any of the boundaries specified.</p>
<p>Note that boundary conditions are implemented as boundary objects of the type <a class="el" href="a00004.html" title="Structure containing the variables and function pointers defining a boundary.">DomainBoundary</a>. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>s</em>&nbsp;</td><td>Solver object of type <a class="el" href="a00015.html" title="Structure containing all solver-specific variables and functions.">HyPar</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>m</em>&nbsp;</td><td>MPI object of type <a class="el" href="a00019.html" title="Structure of MPI-related variables.">MPIVariables</a> </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00101_source.html#l00031">31</a> of file <a class="el" href="a00101_source.html">InitializeBoundaries.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00035"></a>00035 {
<a name="l00036"></a>00036   <a class="code" href="a00015.html" title="Structure containing all solver-specific variables and functions.">HyPar</a>           *solver   = (<a class="code" href="a00015.html" title="Structure containing all solver-specific variables and functions.">HyPar</a>*)        s;
<a name="l00037"></a>00037   <a class="code" href="a00019.html" title="Structure of MPI-related variables.">MPIVariables</a>    *mpi      = (<a class="code" href="a00019.html" title="Structure of MPI-related variables.">MPIVariables</a>*) m;
<a name="l00038"></a>00038   <a class="code" href="a00004.html" title="Structure containing the variables and function pointers defining a boundary.">DomainBoundary</a>  *boundary = NULL;
<a name="l00039"></a>00039   <span class="keywordtype">int</span>             n, ferr;
<a name="l00040"></a>00040   <a class="code" href="a00036.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a>;
<a name="l00041"></a>00041 
<a name="l00042"></a>00042   <span class="comment">/* root process reads boundary condition file */</span>
<a name="l00043"></a>00043   <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a00019.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) {
<a name="l00044"></a>00044     printf(<span class="stringliteral">&quot;Reading boundary conditions from \&quot;boundary.inp\&quot;.\n&quot;</span>);
<a name="l00045"></a>00045     FILE *in;
<a name="l00046"></a>00046     in = fopen(<span class="stringliteral">&quot;boundary.inp&quot;</span>,<span class="stringliteral">&quot;r&quot;</span>);
<a name="l00047"></a>00047     <span class="keywordflow">if</span> (!in) {
<a name="l00048"></a>00048       fprintf(stderr,<span class="stringliteral">&quot;Error: boundary condition file \&quot;boundary.inp\&quot; not found.\n&quot;</span>);
<a name="l00049"></a>00049       <span class="keywordflow">return</span>(1);
<a name="l00050"></a>00050     }
<a name="l00051"></a>00051 
<a name="l00052"></a>00052     <span class="comment">/* read number of boundary conditions and allocate */</span>
<a name="l00053"></a>00053     ferr = fscanf(in,<span class="stringliteral">&quot;%d&quot;</span>,&amp;solver-&gt;<a class="code" href="a00015.html#a3f9a55664d1c8f058828ae9f4de11906">nBoundaryZones</a>); <span class="keywordflow">if</span> (ferr != 1) <span class="keywordflow">return</span>(1);
<a name="l00054"></a>00054     boundary = (<a class="code" href="a00004.html" title="Structure containing the variables and function pointers defining a boundary.">DomainBoundary</a>*) calloc (solver-&gt;<a class="code" href="a00015.html#a3f9a55664d1c8f058828ae9f4de11906">nBoundaryZones</a>,<span class="keyword">sizeof</span>(<a class="code" href="a00004.html" title="Structure containing the variables and function pointers defining a boundary.">DomainBoundary</a>));
<a name="l00055"></a>00055     <span class="keywordflow">for</span> (n = 0; n &lt; solver-&gt;<a class="code" href="a00015.html#a3f9a55664d1c8f058828ae9f4de11906">nBoundaryZones</a>; n++) {
<a name="l00056"></a>00056       boundary[n].<a class="code" href="a00004.html#a6aa65431c39a8d8177f35c338ddb7a0e">DirichletValue</a> = boundary[n].<a class="code" href="a00004.html#af7eeb4ff3f7c8bc22e0786ddbe62f16d">SpongeValue</a> 
<a name="l00057"></a>00057                                  = boundary[n].<a class="code" href="a00004.html#a0d0d92fab642e1d02a9de254e73a3f21">FlowVelocity</a> 
<a name="l00058"></a>00058                                  = boundary[n].<a class="code" href="a00004.html#a48f59fc59e6a86d0b4aad842daea9106">UnsteadyDirichletData</a>
<a name="l00059"></a>00059                                  = NULL;
<a name="l00060"></a>00060       boundary[n].<a class="code" href="a00004.html#ac3b478217419275ad063182f69cb543d">UnsteadyDirichletSize</a> = NULL;
<a name="l00061"></a>00061     }
<a name="l00062"></a>00062 
<a name="l00063"></a>00063     <span class="comment">/* read each boundary condition */</span>
<a name="l00064"></a>00064     <span class="keywordflow">for</span> (n = 0; n &lt; solver-&gt;<a class="code" href="a00015.html#a3f9a55664d1c8f058828ae9f4de11906">nBoundaryZones</a>; n++) {
<a name="l00065"></a>00065       <span class="keywordtype">int</span> d, v;
<a name="l00066"></a>00066       boundary[n].<a class="code" href="a00004.html#a1e51e79041d5a3dddffb503277703568">xmin</a> = (<span class="keywordtype">double</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)); <span class="comment">/* deallocated in BCCleanup.c */</span>
<a name="l00067"></a>00067       boundary[n].<a class="code" href="a00004.html#a7ea24a733beddff902459a07bf91ca67">xmax</a> = (<span class="keywordtype">double</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)); <span class="comment">/* deallocated in BCCleanup.c */</span>
<a name="l00068"></a>00068 
<a name="l00069"></a>00069       ferr = fscanf(in,<span class="stringliteral">&quot;%s&quot;</span>,boundary[n].bctype); <span class="keywordflow">if</span> (ferr != 1) <span class="keywordflow">return</span>(1);
<a name="l00070"></a>00070       ferr = fscanf(in,<span class="stringliteral">&quot;%d&quot;</span>,&amp;boundary[n].dim  ); <span class="keywordflow">if</span> (ferr != 1) <span class="keywordflow">return</span>(1);
<a name="l00071"></a>00071       ferr = fscanf(in,<span class="stringliteral">&quot;%d&quot;</span>,&amp;boundary[n].face ); <span class="keywordflow">if</span> (ferr != 1) <span class="keywordflow">return</span>(1);
<a name="l00072"></a>00072       <span class="keywordflow">for</span> (d=0; d &lt; solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>; d++) {
<a name="l00073"></a>00073         ferr = fscanf(in,<span class="stringliteral">&quot;%lf %lf&quot;</span>, &amp;boundary[n].xmin[d], &amp;boundary[n].xmax[d]);
<a name="l00074"></a>00074         <span class="keywordflow">if</span> (ferr != 2) <span class="keywordflow">return</span>(1);
<a name="l00075"></a>00075       }
<a name="l00076"></a>00076 
<a name="l00077"></a>00077       <span class="comment">/* read in boundary type-specific additional data if required */</span>
<a name="l00078"></a>00078 
<a name="l00079"></a>00079       <span class="keywordflow">if</span> (!strcmp(boundary[n].bctype,<a class="code" href="a00037.html#a7b8553c8fd765568f7355cf32b93b20d">_DIRICHLET_</a>)) {
<a name="l00080"></a>00080         boundary[n].<a class="code" href="a00004.html#a6aa65431c39a8d8177f35c338ddb7a0e">DirichletValue</a> = (<span class="keywordtype">double</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)); 
<a name="l00081"></a>00081                                      <span class="comment">/* deallocated in BCCleanup.c */</span>
<a name="l00082"></a>00082         <span class="comment">/* read the Dirichlet value for each variable on this boundary */</span>
<a name="l00083"></a>00083         <span class="keywordflow">for</span> (v = 0; v &lt; solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>; v++) ferr = fscanf(in,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;boundary[n].DirichletValue[v]);
<a name="l00084"></a>00084       }
<a name="l00085"></a>00085 
<a name="l00086"></a>00086       <span class="keywordflow">if</span> (!strcmp(boundary[n].bctype,<a class="code" href="a00037.html#ab02c004c9707df0589311375014dc666">_SPONGE_</a>)) {
<a name="l00087"></a>00087         boundary[n].<a class="code" href="a00004.html#af7eeb4ff3f7c8bc22e0786ddbe62f16d">SpongeValue</a> = (<span class="keywordtype">double</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)); 
<a name="l00088"></a>00088                                      <span class="comment">/* deallocated in BCCleanup.c */</span>
<a name="l00089"></a>00089         <span class="comment">/* read the sponge value for each variable on this boundary */</span>
<a name="l00090"></a>00090         <span class="keywordflow">for</span> (v = 0; v &lt; solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>; v++) ferr = fscanf(in,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;boundary[n].SpongeValue[v]);
<a name="l00091"></a>00091       }
<a name="l00092"></a>00092 
<a name="l00093"></a>00093       <span class="keywordflow">if</span> (    (!strcmp(boundary[n].bctype,<a class="code" href="a00037.html#af3a9f3ba15bc914ed0a88295aee147e8">_SLIP_WALL_</a>)) 
<a name="l00094"></a>00094           ||  (!strcmp(boundary[n].bctype,<a class="code" href="a00037.html#affb6a9c452f92435e738bd59b9c98935">_NOSLIP_WALL_</a>)) ) {
<a name="l00095"></a>00095         boundary[n].<a class="code" href="a00004.html#a0d0d92fab642e1d02a9de254e73a3f21">FlowVelocity</a> = (<span class="keywordtype">double</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00096"></a>00096                                      <span class="comment">/* deallocated in BCCleanup.c */</span>
<a name="l00097"></a>00097         <span class="comment">/* read the wall velocity */</span>
<a name="l00098"></a>00098         <span class="keywordflow">for</span> (v = 0; v &lt; solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>; v++) ferr = fscanf(in,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;boundary[n].FlowVelocity[v]);
<a name="l00099"></a>00099       }
<a name="l00100"></a>00100 
<a name="l00101"></a>00101       <span class="keywordflow">if</span> (    (!strcmp(boundary[n].bctype,<a class="code" href="a00037.html#a6cd5a586de4ae1a3b73884d62f76bdee">_SW_SLIP_WALL_</a>)) 
<a name="l00102"></a>00102           ||  (!strcmp(boundary[n].bctype,<a class="code" href="a00037.html#ab8248be9e215df26dfce851b1acc54ec">_SW_NOSLIP_WALL_</a>)) ) {
<a name="l00103"></a>00103         boundary[n].<a class="code" href="a00004.html#a0d0d92fab642e1d02a9de254e73a3f21">FlowVelocity</a> = (<span class="keywordtype">double</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00104"></a>00104                                      <span class="comment">/* deallocated in BCCleanup.c */</span>
<a name="l00105"></a>00105         <span class="comment">/* read the wall velocity */</span>
<a name="l00106"></a>00106         <span class="keywordflow">for</span> (v = 0; v &lt; solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>; v++) ferr = fscanf(in,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;boundary[n].FlowVelocity[v]);
<a name="l00107"></a>00107       }
<a name="l00108"></a>00108 
<a name="l00109"></a>00109       <span class="keywordflow">if</span> (!strcmp(boundary[n].bctype,<a class="code" href="a00037.html#adba2024137894c96339af50efabe3771">_SUBSONIC_INFLOW_</a>)) {
<a name="l00110"></a>00110         boundary[n].<a class="code" href="a00004.html#a0d0d92fab642e1d02a9de254e73a3f21">FlowVelocity</a> = (<span class="keywordtype">double</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00111"></a>00111                                      <span class="comment">/* deallocated in BCCleanup.c */</span>
<a name="l00112"></a>00112         <span class="comment">/* read in the inflow density and velocity */</span>
<a name="l00113"></a>00113         ferr = fscanf(in,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;boundary[n].FlowDensity);
<a name="l00114"></a>00114         <span class="keywordflow">for</span> (v = 0; v &lt; solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>; v++) ferr = fscanf(in,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;boundary[n].FlowVelocity[v]);
<a name="l00115"></a>00115       }
<a name="l00116"></a>00116 
<a name="l00117"></a>00117       <span class="keywordflow">if</span> (!strcmp(boundary[n].bctype,<a class="code" href="a00037.html#adeb38801d1b832ce3eee3ebc1eed6263">_SUBSONIC_OUTFLOW_</a>)) {
<a name="l00118"></a>00118         <span class="comment">/* read in the outflow pressure */</span>
<a name="l00119"></a>00119         ferr = fscanf(in,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;boundary[n].FlowPressure);
<a name="l00120"></a>00120       }
<a name="l00121"></a>00121 
<a name="l00122"></a>00122       <span class="keywordflow">if</span> (!strcmp(boundary[n].bctype,<a class="code" href="a00037.html#aac7250bf34e60e7df688d3cf7355855c">_SUBSONIC_AMBIVALENT_</a>)) {
<a name="l00123"></a>00123         boundary[n].<a class="code" href="a00004.html#a0d0d92fab642e1d02a9de254e73a3f21">FlowVelocity</a> = (<span class="keywordtype">double</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00124"></a>00124                                      <span class="comment">/* deallocated in BCCleanup.c */</span>
<a name="l00125"></a>00125         <span class="comment">/* read in the inflow density, velocity, and pressure */</span>
<a name="l00126"></a>00126         ferr = fscanf(in,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;boundary[n].FlowDensity);
<a name="l00127"></a>00127         <span class="keywordflow">for</span> (v = 0; v &lt; solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>; v++) ferr = fscanf(in,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;boundary[n].FlowVelocity[v]);
<a name="l00128"></a>00128         ferr = fscanf(in,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;boundary[n].FlowPressure);
<a name="l00129"></a>00129       }
<a name="l00130"></a>00130 
<a name="l00131"></a>00131       <span class="keywordflow">if</span> (!strcmp(boundary[n].bctype,<a class="code" href="a00037.html#a5c9f9f3c97682664b0fe253e10863b57">_SUPERSONIC_INFLOW_</a>)) {
<a name="l00132"></a>00132         boundary[n].<a class="code" href="a00004.html#a0d0d92fab642e1d02a9de254e73a3f21">FlowVelocity</a> = (<span class="keywordtype">double</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00133"></a>00133                                      <span class="comment">/* deallocated in BCCleanup.c */</span>
<a name="l00134"></a>00134         <span class="comment">/* read in the inflow density, velocity and pressure */</span>
<a name="l00135"></a>00135         ferr = fscanf(in,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;boundary[n].FlowDensity);
<a name="l00136"></a>00136         <span class="keywordflow">for</span> (v = 0; v &lt; solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>; v++) ferr = fscanf(in,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;boundary[n].FlowVelocity[v]);
<a name="l00137"></a>00137         ferr = fscanf(in,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;boundary[n].FlowPressure);
<a name="l00138"></a>00138       }
<a name="l00139"></a>00139 
<a name="l00140"></a>00140       <span class="keywordflow">if</span> (!strcmp(boundary[n].bctype,<a class="code" href="a00037.html#a9b20b4f17d0f550f5da42946cc8a5b4a">_TURBULENT_SUPERSONIC_INFLOW_</a>)) {
<a name="l00141"></a>00141         boundary[n].<a class="code" href="a00004.html#a0d0d92fab642e1d02a9de254e73a3f21">FlowVelocity</a> = (<span class="keywordtype">double</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00142"></a>00142                                      <span class="comment">/* deallocated in BCCleanup.c */</span>
<a name="l00143"></a>00143         <span class="comment">/* read in the inflow density, velocity and pressure */</span>
<a name="l00144"></a>00144         ferr = fscanf(in,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;boundary[n].FlowDensity);
<a name="l00145"></a>00145         <span class="keywordflow">for</span> (v = 0; v &lt; solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>; v++) ferr = fscanf(in,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;boundary[n].FlowVelocity[v]);
<a name="l00146"></a>00146         ferr = fscanf(in,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;boundary[n].FlowPressure);
<a name="l00147"></a>00147         ferr = fscanf(in,<span class="stringliteral">&quot;%s&quot;</span> , boundary[n].UnsteadyDirichletFilename);
<a name="l00148"></a>00148       }
<a name="l00149"></a>00149 
<a name="l00150"></a>00150       <span class="keywordflow">if</span> (!strcmp(boundary[n].bctype,<a class="code" href="a00037.html#a1fb5767ea5e8c4f48969ff25eae1ddaf">_THERMAL_SLIP_WALL_</a>)) {
<a name="l00151"></a>00151         boundary[n].<a class="code" href="a00004.html#a0d0d92fab642e1d02a9de254e73a3f21">FlowVelocity</a> = (<span class="keywordtype">double</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00152"></a>00152                                      <span class="comment">/* deallocated in BCCleanup.c */</span>
<a name="l00153"></a>00153         <span class="comment">/* read the wall velocity */</span>
<a name="l00154"></a>00154         <span class="keywordflow">for</span> (v = 0; v &lt; solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>; v++) ferr = fscanf(in,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;boundary[n].FlowVelocity[v]);
<a name="l00155"></a>00155         <span class="comment">/* read in the filename where temperature data is available */</span>
<a name="l00156"></a>00156         ferr = fscanf(in,<span class="stringliteral">&quot;%s&quot;</span> , boundary[n].UnsteadyTemperatureFilename);
<a name="l00157"></a>00157       }
<a name="l00158"></a>00158 
<a name="l00159"></a>00159       <span class="comment">/* if boundary is periodic, let the MPI and HyPar know */</span>
<a name="l00160"></a>00160       <span class="keywordflow">if</span> (!strcmp(boundary[n].bctype,<a class="code" href="a00037.html#a65ffa4253dee762c65092abcf04ecdee">_PERIODIC_</a>)) {
<a name="l00161"></a>00161         solver-&gt;<a class="code" href="a00015.html#a40e3f67b1530d5ea4e913fc60b594802">isPeriodic</a>[boundary[n].<a class="code" href="a00004.html#a70b5e28b5bc3d1b63a7435c5fe50b837">dim</a>] = 1;
<a name="l00162"></a>00162       }
<a name="l00163"></a>00163       <span class="comment">/* </span>
<a name="l00164"></a>00164 <span class="comment">        The MPI function to exchange internal (MPI) boundary information will handle</span>
<a name="l00165"></a>00165 <span class="comment">        periodic boundaries ONLY IF number of process along that dimension is more </span>
<a name="l00166"></a>00166 <span class="comment">        than 1.</span>
<a name="l00167"></a>00167 <span class="comment">      */</span>
<a name="l00168"></a>00168       <span class="keywordflow">if</span> ((!strcmp(boundary[n].bctype,<a class="code" href="a00037.html#a65ffa4253dee762c65092abcf04ecdee">_PERIODIC_</a>)) &amp;&amp; (mpi-&gt;<a class="code" href="a00019.html#a0be0f30a83bc3f3d9f6ee3a36bbf2716">iproc</a>[boundary[n].<a class="code" href="a00004.html#a70b5e28b5bc3d1b63a7435c5fe50b837">dim</a>] &gt; 1)) {
<a name="l00169"></a>00169         mpi-&gt;<a class="code" href="a00019.html#af40a5a3066fdb53a47e4627071abc2bc">bcperiodic</a>[boundary[n].<a class="code" href="a00004.html#a70b5e28b5bc3d1b63a7435c5fe50b837">dim</a>] = 1;
<a name="l00170"></a>00170       }
<a name="l00171"></a>00171 
<a name="l00172"></a>00172       <span class="comment">/* some checks */</span>
<a name="l00173"></a>00173       <span class="keywordflow">if</span> (boundary[n].dim &gt;= solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>) {
<a name="l00174"></a>00174         fprintf(stderr,<span class="stringliteral">&quot;Error in reading boundary condition %d: dim %d is invalid (ndims = %d).\n&quot;</span>,
<a name="l00175"></a>00175                 n,boundary[n].dim,solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>);
<a name="l00176"></a>00176         <span class="keywordflow">return</span>(1);
<a name="l00177"></a>00177       }
<a name="l00178"></a>00178       printf(<span class="stringliteral">&quot;  Boundary %30s:  Along dimension %2d and face %+1d\n&quot;</span>,
<a name="l00179"></a>00179                 boundary[n].bctype,boundary[n].dim,boundary[n].face);
<a name="l00180"></a>00180     }
<a name="l00181"></a>00181 
<a name="l00182"></a>00182     fclose(in);
<a name="l00183"></a>00183     printf(<span class="stringliteral">&quot;%d boundary condition(s) read.\n&quot;</span>,solver-&gt;<a class="code" href="a00015.html#a3f9a55664d1c8f058828ae9f4de11906">nBoundaryZones</a>);
<a name="l00184"></a>00184   }
<a name="l00185"></a>00185 
<a name="l00186"></a>00186   <span class="comment">/* tell other processes how many BCs are there and let them allocate */</span>
<a name="l00187"></a>00187   <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#acd7957559b9206224c7da3cab4f22b27">MPIBroadcast_integer</a>(&amp;solver-&gt;<a class="code" href="a00015.html#a3f9a55664d1c8f058828ae9f4de11906">nBoundaryZones</a>,1,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00188"></a>00188   <span class="keywordflow">if</span> (mpi-&gt;<a class="code" href="a00019.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) {
<a name="l00189"></a>00189     boundary = (<a class="code" href="a00004.html" title="Structure containing the variables and function pointers defining a boundary.">DomainBoundary</a>*) calloc (solver-&gt;<a class="code" href="a00015.html#a3f9a55664d1c8f058828ae9f4de11906">nBoundaryZones</a>,<span class="keyword">sizeof</span>(<a class="code" href="a00004.html" title="Structure containing the variables and function pointers defining a boundary.">DomainBoundary</a>));
<a name="l00190"></a>00190     <span class="keywordflow">for</span> (n = 0; n &lt; solver-&gt;<a class="code" href="a00015.html#a3f9a55664d1c8f058828ae9f4de11906">nBoundaryZones</a>; n++) {
<a name="l00191"></a>00191       boundary[n].<a class="code" href="a00004.html#a1e51e79041d5a3dddffb503277703568">xmin</a> = (<span class="keywordtype">double</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)); <span class="comment">/* deallocated in BCCleanup.c */</span>
<a name="l00192"></a>00192       boundary[n].<a class="code" href="a00004.html#a7ea24a733beddff902459a07bf91ca67">xmax</a> = (<span class="keywordtype">double</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)); <span class="comment">/* deallocated in BCCleanup.c */</span>
<a name="l00193"></a>00193       boundary[n].<a class="code" href="a00004.html#a6aa65431c39a8d8177f35c338ddb7a0e">DirichletValue</a> = boundary[n].<a class="code" href="a00004.html#af7eeb4ff3f7c8bc22e0786ddbe62f16d">SpongeValue</a> 
<a name="l00194"></a>00194                                  = boundary[n].<a class="code" href="a00004.html#a0d0d92fab642e1d02a9de254e73a3f21">FlowVelocity</a> 
<a name="l00195"></a>00195                                  = boundary[n].<a class="code" href="a00004.html#a48f59fc59e6a86d0b4aad842daea9106">UnsteadyDirichletData</a>
<a name="l00196"></a>00196                                  = NULL;
<a name="l00197"></a>00197       boundary[n].<a class="code" href="a00004.html#ac3b478217419275ad063182f69cb543d">UnsteadyDirichletSize</a> = NULL;
<a name="l00198"></a>00198     }
<a name="l00199"></a>00199   }
<a name="l00200"></a>00200 
<a name="l00201"></a>00201   <span class="comment">/* communicate BC data to other processes */</span>
<a name="l00202"></a>00202   <span class="keywordflow">for</span> (n = 0; n &lt; solver-&gt;<a class="code" href="a00015.html#a3f9a55664d1c8f058828ae9f4de11906">nBoundaryZones</a>; n++) {
<a name="l00203"></a>00203     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#ad408e5a44e863cca50112d1e2f728597">MPIBroadcast_character</a>(boundary[n].bctype,<a class="code" href="a00036.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00204"></a>00204     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#acd7957559b9206224c7da3cab4f22b27">MPIBroadcast_integer</a>  (&amp;boundary[n].dim  ,1                ,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00205"></a>00205     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#acd7957559b9206224c7da3cab4f22b27">MPIBroadcast_integer</a>  (&amp;boundary[n].face ,1                ,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00206"></a>00206     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#a45dcb265863a65d862bb16222e7e623c">MPIBroadcast_double</a>   (boundary[n].xmin  ,solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>    ,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00207"></a>00207     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#a45dcb265863a65d862bb16222e7e623c">MPIBroadcast_double</a>   (boundary[n].xmax  ,solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>    ,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00208"></a>00208   }
<a name="l00209"></a>00209   <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#acd7957559b9206224c7da3cab4f22b27">MPIBroadcast_integer</a>(solver-&gt;<a class="code" href="a00015.html#a40e3f67b1530d5ea4e913fc60b594802">isPeriodic</a>,solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);<a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00210"></a>00210 
<a name="l00211"></a>00211   <span class="comment">/* broadcast periodic boundary info for MPI to all processes */</span>
<a name="l00212"></a>00212   <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#acd7957559b9206224c7da3cab4f22b27">MPIBroadcast_integer</a>(mpi-&gt;<a class="code" href="a00019.html#af40a5a3066fdb53a47e4627071abc2bc">bcperiodic</a>,solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);<a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00213"></a>00213 
<a name="l00214"></a>00214   <span class="comment">/* On other processes, if necessary, allocate and receive boundary-type-specific data */</span>
<a name="l00215"></a>00215   <span class="keywordflow">for</span> (n = 0; n &lt; solver-&gt;<a class="code" href="a00015.html#a3f9a55664d1c8f058828ae9f4de11906">nBoundaryZones</a>; n++) {
<a name="l00216"></a>00216     <span class="keywordflow">if</span> (!strcmp(boundary[n].bctype,<a class="code" href="a00037.html#a7b8553c8fd765568f7355cf32b93b20d">_DIRICHLET_</a>)) {
<a name="l00217"></a>00217       <span class="keywordflow">if</span> (mpi-&gt;<a class="code" href="a00019.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>)  boundary[n].<a class="code" href="a00004.html#a6aa65431c39a8d8177f35c338ddb7a0e">DirichletValue</a> = (<span class="keywordtype">double</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00218"></a>00218       <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#a45dcb265863a65d862bb16222e7e623c">MPIBroadcast_double</a>(boundary[n].DirichletValue,solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00219"></a>00219     }
<a name="l00220"></a>00220 
<a name="l00221"></a>00221     <span class="keywordflow">if</span> (!strcmp(boundary[n].bctype,<a class="code" href="a00037.html#ab02c004c9707df0589311375014dc666">_SPONGE_</a>)) {
<a name="l00222"></a>00222       <span class="keywordflow">if</span> (mpi-&gt;<a class="code" href="a00019.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>)  boundary[n].<a class="code" href="a00004.html#af7eeb4ff3f7c8bc22e0786ddbe62f16d">SpongeValue</a> = (<span class="keywordtype">double</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00223"></a>00223       <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#a45dcb265863a65d862bb16222e7e623c">MPIBroadcast_double</a>(boundary[n].SpongeValue,solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00224"></a>00224     }
<a name="l00225"></a>00225 
<a name="l00226"></a>00226     <span class="keywordflow">if</span> (    (!strcmp(boundary[n].bctype,<a class="code" href="a00037.html#af3a9f3ba15bc914ed0a88295aee147e8">_SLIP_WALL_</a>)) 
<a name="l00227"></a>00227         ||  (!strcmp(boundary[n].bctype,<a class="code" href="a00037.html#affb6a9c452f92435e738bd59b9c98935">_NOSLIP_WALL_</a>)) ) {
<a name="l00228"></a>00228       <span class="keywordflow">if</span> (mpi-&gt;<a class="code" href="a00019.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) boundary[n].<a class="code" href="a00004.html#a0d0d92fab642e1d02a9de254e73a3f21">FlowVelocity</a> = (<span class="keywordtype">double</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00229"></a>00229       <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#a45dcb265863a65d862bb16222e7e623c">MPIBroadcast_double</a>(boundary[n].FlowVelocity,solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00230"></a>00230     }
<a name="l00231"></a>00231 
<a name="l00232"></a>00232     <span class="keywordflow">if</span> (    (!strcmp(boundary[n].bctype,<a class="code" href="a00037.html#a6cd5a586de4ae1a3b73884d62f76bdee">_SW_SLIP_WALL_</a>)) 
<a name="l00233"></a>00233         ||  (!strcmp(boundary[n].bctype,<a class="code" href="a00037.html#ab8248be9e215df26dfce851b1acc54ec">_SW_NOSLIP_WALL_</a>)) ) {
<a name="l00234"></a>00234       <span class="keywordflow">if</span> (mpi-&gt;<a class="code" href="a00019.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) boundary[n].<a class="code" href="a00004.html#a0d0d92fab642e1d02a9de254e73a3f21">FlowVelocity</a> = (<span class="keywordtype">double</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00235"></a>00235       <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#a45dcb265863a65d862bb16222e7e623c">MPIBroadcast_double</a>(boundary[n].FlowVelocity,solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00236"></a>00236     }
<a name="l00237"></a>00237 
<a name="l00238"></a>00238     <span class="keywordflow">if</span> (!strcmp(boundary[n].bctype,<a class="code" href="a00037.html#adba2024137894c96339af50efabe3771">_SUBSONIC_INFLOW_</a>)) {
<a name="l00239"></a>00239       <span class="keywordflow">if</span> (mpi-&gt;<a class="code" href="a00019.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) boundary[n].<a class="code" href="a00004.html#a0d0d92fab642e1d02a9de254e73a3f21">FlowVelocity</a> = (<span class="keywordtype">double</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00240"></a>00240       <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#a45dcb265863a65d862bb16222e7e623c">MPIBroadcast_double</a>(&amp;boundary[n].FlowDensity,1            ,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00241"></a>00241       <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#a45dcb265863a65d862bb16222e7e623c">MPIBroadcast_double</a>(boundary[n].FlowVelocity,solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00242"></a>00242     }
<a name="l00243"></a>00243 
<a name="l00244"></a>00244     <span class="keywordflow">if</span> (!strcmp(boundary[n].bctype,<a class="code" href="a00037.html#adeb38801d1b832ce3eee3ebc1eed6263">_SUBSONIC_OUTFLOW_</a>)) {
<a name="l00245"></a>00245       <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#a45dcb265863a65d862bb16222e7e623c">MPIBroadcast_double</a>(&amp;boundary[n].FlowPressure,1,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00246"></a>00246     }
<a name="l00247"></a>00247 
<a name="l00248"></a>00248     <span class="keywordflow">if</span> (!strcmp(boundary[n].bctype,<a class="code" href="a00037.html#aac7250bf34e60e7df688d3cf7355855c">_SUBSONIC_AMBIVALENT_</a>)) {
<a name="l00249"></a>00249       <span class="keywordflow">if</span> (mpi-&gt;<a class="code" href="a00019.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) boundary[n].<a class="code" href="a00004.html#a0d0d92fab642e1d02a9de254e73a3f21">FlowVelocity</a> = (<span class="keywordtype">double</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00250"></a>00250       <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#a45dcb265863a65d862bb16222e7e623c">MPIBroadcast_double</a>(&amp;boundary[n].FlowDensity,1            ,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00251"></a>00251       <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#a45dcb265863a65d862bb16222e7e623c">MPIBroadcast_double</a>(boundary[n].FlowVelocity,solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00252"></a>00252       <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#a45dcb265863a65d862bb16222e7e623c">MPIBroadcast_double</a>(&amp;boundary[n].FlowPressure,1,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00253"></a>00253     }
<a name="l00254"></a>00254 
<a name="l00255"></a>00255     <span class="keywordflow">if</span> (!strcmp(boundary[n].bctype,<a class="code" href="a00037.html#a5c9f9f3c97682664b0fe253e10863b57">_SUPERSONIC_INFLOW_</a>)) {
<a name="l00256"></a>00256       <span class="keywordflow">if</span> (mpi-&gt;<a class="code" href="a00019.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) boundary[n].<a class="code" href="a00004.html#a0d0d92fab642e1d02a9de254e73a3f21">FlowVelocity</a> = (<span class="keywordtype">double</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00257"></a>00257       <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#a45dcb265863a65d862bb16222e7e623c">MPIBroadcast_double</a>(&amp;boundary[n].FlowDensity ,1            ,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00258"></a>00258       <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#a45dcb265863a65d862bb16222e7e623c">MPIBroadcast_double</a>(boundary[n].FlowVelocity ,solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00259"></a>00259       <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#a45dcb265863a65d862bb16222e7e623c">MPIBroadcast_double</a>(&amp;boundary[n].FlowPressure,1            ,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00260"></a>00260     }
<a name="l00261"></a>00261 
<a name="l00262"></a>00262     <span class="keywordflow">if</span> (!strcmp(boundary[n].bctype,<a class="code" href="a00037.html#a9b20b4f17d0f550f5da42946cc8a5b4a">_TURBULENT_SUPERSONIC_INFLOW_</a>)) {
<a name="l00263"></a>00263       <span class="keywordflow">if</span> (mpi-&gt;<a class="code" href="a00019.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) boundary[n].<a class="code" href="a00004.html#a0d0d92fab642e1d02a9de254e73a3f21">FlowVelocity</a> = (<span class="keywordtype">double</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00264"></a>00264       <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#a45dcb265863a65d862bb16222e7e623c">MPIBroadcast_double</a>(&amp;boundary[n].FlowDensity ,1            ,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00265"></a>00265       <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#a45dcb265863a65d862bb16222e7e623c">MPIBroadcast_double</a>(boundary[n].FlowVelocity ,solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00266"></a>00266       <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#a45dcb265863a65d862bb16222e7e623c">MPIBroadcast_double</a>(&amp;boundary[n].FlowPressure,1            ,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00267"></a>00267       <span class="comment">/* allocate arrays and read in unsteady boundary data */</span>
<a name="l00268"></a>00268       <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00037.html#a6cc369236fbfe94bff52c55175cfaba7">BCReadTurbulentInflowData</a>(&amp;boundary[n],mpi,solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00015.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00269"></a>00269     }
<a name="l00270"></a>00270 
<a name="l00271"></a>00271     <span class="keywordflow">if</span> (!strcmp(boundary[n].bctype,<a class="code" href="a00037.html#a1fb5767ea5e8c4f48969ff25eae1ddaf">_THERMAL_SLIP_WALL_</a>)) {
<a name="l00272"></a>00272       <span class="keywordflow">if</span> (mpi-&gt;<a class="code" href="a00019.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) boundary[n].<a class="code" href="a00004.html#a0d0d92fab642e1d02a9de254e73a3f21">FlowVelocity</a> = (<span class="keywordtype">double</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00273"></a>00273       <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#a45dcb265863a65d862bb16222e7e623c">MPIBroadcast_double</a>(boundary[n].FlowVelocity,solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00274"></a>00274       <span class="comment">/* allocate arrays and read in boundary temperature data */</span>
<a name="l00275"></a>00275       <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00085.html#a482110904d4b11dd863786c9d425bc7e">BCReadTemperatureData</a>(&amp;boundary[n],mpi,solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00015.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00276"></a>00276     }
<a name="l00277"></a>00277 
<a name="l00278"></a>00278   }
<a name="l00279"></a>00279 
<a name="l00280"></a>00280   solver-&gt;<a class="code" href="a00015.html#a6b5109ac1048aa203b8969b91e72c3af">boundary</a> = boundary;
<a name="l00281"></a>00281 
<a name="l00282"></a>00282   <span class="comment">/* each process calculates its own part of these boundaries */</span>
<a name="l00283"></a>00283   <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00101.html#a33293e35159e6411e3574409bf7d90db">CalculateLocalExtent</a>(solver,mpi); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00284"></a>00284 
<a name="l00285"></a>00285   <span class="comment">/* initialize function pointers for each boundary condition */</span>
<a name="l00286"></a>00286   <span class="keywordflow">for</span> (n = 0; n &lt; solver-&gt;<a class="code" href="a00015.html#a3f9a55664d1c8f058828ae9f4de11906">nBoundaryZones</a>; n++) {
<a name="l00287"></a>00287     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00037.html#ac12085fd970427feca33543fd1257b15">BCInitialize</a>(&amp;boundary[n]); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00288"></a>00288   }
<a name="l00289"></a>00289 
<a name="l00290"></a>00290   <span class="keywordflow">return</span>(0);
<a name="l00291"></a>00291 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="afdd596b7c9cc1d8376e602bd7fe54082"></a><!-- doxytag: member="hypar.h::InitializeImmersedBoundaries" ref="afdd596b7c9cc1d8376e602bd7fe54082" args="(void *, void *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int InitializeImmersedBoundaries </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>m</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Initialize the immersed boundary conditions</p>
<p>Initialize the immersed boundaries, if present. + Read in immersed body from STL file. + Allocate and set up <a class="el" href="a00017.html" title="Structure containing variables for immersed boundary implementation.">ImmersedBoundary</a> object. + Identify blanked-out grid points based on immersed body geometry. + Identify and make a list of immersed boundary points on each rank. + For each immersed boundary point, find the "nearest" facet. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>s</em>&nbsp;</td><td>Solver object of type <a class="el" href="a00015.html" title="Structure containing all solver-specific variables and functions.">HyPar</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>m</em>&nbsp;</td><td>MPI object of type <a class="el" href="a00019.html" title="Structure of MPI-related variables.">MPIVariables</a> </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00102_source.html#l00022">22</a> of file <a class="el" href="a00102_source.html">InitializeImmersedBoundaries.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00026"></a>00026 {
<a name="l00027"></a>00027   <a class="code" href="a00015.html" title="Structure containing all solver-specific variables and functions.">HyPar</a>             *solver   = (<a class="code" href="a00015.html" title="Structure containing all solver-specific variables and functions.">HyPar</a>*)        s;
<a name="l00028"></a>00028   <a class="code" href="a00019.html" title="Structure of MPI-related variables.">MPIVariables</a>      *mpi      = (<a class="code" href="a00019.html" title="Structure of MPI-related variables.">MPIVariables</a>*) m;
<a name="l00029"></a>00029   <a class="code" href="a00017.html" title="Structure containing variables for immersed boundary implementation.">ImmersedBoundary</a>  *ib       = NULL;
<a name="l00030"></a>00030   <a class="code" href="a00002.html" title="Structure defining a body.">Body3D</a>            *body     = NULL;
<a name="l00031"></a>00031   <span class="keywordtype">int</span>               stat, d, ndims = solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>;
<a name="l00032"></a>00032 
<a name="l00033"></a>00033   <span class="keywordflow">if</span> ((!solver-&gt;<a class="code" href="a00015.html#ae83b1b0117b6a805ead2e4728945814c">flag_ib</a>) || (ndims != <a class="code" href="a00040.html#a0f59ba2c552bae2f35a03ce3964a2b4a">_IB_NDIMS_</a>)) {
<a name="l00034"></a>00034     solver-&gt;<a class="code" href="a00015.html#a8419c1760256467c117ef5932b943259">ib</a> = NULL;
<a name="l00035"></a>00035     <span class="keywordflow">return</span>(0);
<a name="l00036"></a>00036   }
<a name="l00037"></a>00037 
<a name="l00038"></a>00038   <span class="comment">/* Read in immersed body from file */</span>
<a name="l00039"></a>00039   <a class="code" href="a00040.html#a4246de81fa9366c4e377b927c9cfd2ed">IBReadBodySTL</a>(&amp;body,solver-&gt;<a class="code" href="a00015.html#a43ee3672350b4fd385871b6512e5d47b">ib_filename</a>,mpi,&amp;stat);
<a name="l00040"></a>00040   <span class="keywordflow">if</span> (stat) {
<a name="l00041"></a>00041     <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a00019.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) {
<a name="l00042"></a>00042       fprintf(stderr,<span class="stringliteral">&quot;Error in InitializeImmersedBoundaries(): Unable to &quot;</span>);
<a name="l00043"></a>00043       fprintf(stderr,<span class="stringliteral">&quot;read immersed body from file %s.\n&quot;</span>,solver-&gt;<a class="code" href="a00015.html#a43ee3672350b4fd385871b6512e5d47b">ib_filename</a>);
<a name="l00044"></a>00044     }
<a name="l00045"></a>00045     solver-&gt;<a class="code" href="a00015.html#ae83b1b0117b6a805ead2e4728945814c">flag_ib</a> = 0;
<a name="l00046"></a>00046     solver-&gt;<a class="code" href="a00015.html#a8419c1760256467c117ef5932b943259">ib</a> = NULL;
<a name="l00047"></a>00047     <span class="keywordflow">return</span>(1);
<a name="l00048"></a>00048   }
<a name="l00049"></a>00049   <a class="code" href="a00040.html#a59296c4f43deabbc6a9b511ba559a4b4">IBComputeBoundingBox</a>(body);
<a name="l00050"></a>00050 
<a name="l00051"></a>00051   <span class="comment">/* allocate immersed boundary object and set it up */</span>
<a name="l00052"></a>00052   ib = (<a class="code" href="a00017.html" title="Structure containing variables for immersed boundary implementation.">ImmersedBoundary</a>*) calloc (1, <span class="keyword">sizeof</span>(<a class="code" href="a00017.html" title="Structure containing variables for immersed boundary implementation.">ImmersedBoundary</a>));
<a name="l00053"></a>00053   ib-&gt;<a class="code" href="a00017.html#a97eab6d709b80585fe9e8a54b1e3da27">tolerance</a> = 1<a class="code" href="a00032.html#a35b3e91c83139b35bbacfaa59a58afd1">e</a>-12;
<a name="l00054"></a>00054   ib-&gt;<a class="code" href="a00017.html#a9ea1a8f5ef3e6d20b362385e1288c72c">delta</a>     = 1<a class="code" href="a00032.html#a35b3e91c83139b35bbacfaa59a58afd1">e</a>-6;
<a name="l00055"></a>00055   ib-&gt;<a class="code" href="a00017.html#a5a34c6ed89d3769fb1200fdfbdc8ae33">itr_max</a>   = 500;
<a name="l00056"></a>00056   ib-&gt;<a class="code" href="a00017.html#af858f0e9bc4a6cb1c16ad2931cf4b43d">body</a>      = body;
<a name="l00057"></a>00057   solver-&gt;<a class="code" href="a00015.html#a8419c1760256467c117ef5932b943259">ib</a>    = ib;
<a name="l00058"></a>00058 
<a name="l00059"></a>00059   <span class="keywordtype">int</span>     offset_global, offset_local,
<a name="l00060"></a>00060           *dim_local  = solver-&gt;<a class="code" href="a00015.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,
<a name="l00061"></a>00061           *dim_global = solver-&gt;<a class="code" href="a00015.html#aa989ebb755986852177779cdf7bd8c85">dim_global</a>,
<a name="l00062"></a>00062           ghosts      = solver-&gt;<a class="code" href="a00015.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,
<a name="l00063"></a>00063           size        = dim_global[0] + dim_global[1] + dim_global[2],
<a name="l00064"></a>00064           count       = 0;
<a name="l00065"></a>00065   <span class="keywordtype">double</span>  *Xg         = (<span class="keywordtype">double</span>*) calloc(size,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
<a name="l00066"></a>00066 
<a name="l00067"></a>00067   <span class="comment">/* assemble the global grid on rank 0 */</span>
<a name="l00068"></a>00068   offset_global = offset_local = 0;
<a name="l00069"></a>00069   <span class="keywordflow">for</span> (d=0; d&lt;ndims; d++) {
<a name="l00070"></a>00070     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#ac4c9e0736d7419f96307c6e6298d3f45">MPIGatherArray1D</a>(mpi,(mpi-&gt;<a class="code" href="a00019.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>?NULL:&amp;Xg[offset_global]),
<a name="l00071"></a>00071                           &amp;solver-&gt;<a class="code" href="a00015.html#a711aad4cbe735871dd9e91ab575c878b">x</a>[offset_local+ghosts],
<a name="l00072"></a>00072                           mpi-&gt;<a class="code" href="a00019.html#a481013ba007a99a4237cde5eeb3c9a29">is</a>[d],mpi-&gt;<a class="code" href="a00019.html#a7602de5ebb1b59ec35217e78a35a531e">ie</a>[d],dim_local[d],0); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00073"></a>00073     offset_global += dim_global[d];
<a name="l00074"></a>00074     offset_local  += dim_local [d] + 2*ghosts;
<a name="l00075"></a>00075   }
<a name="l00076"></a>00076   <span class="comment">/* send the global grid to other ranks */</span>
<a name="l00077"></a>00077   <a class="code" href="a00045.html#a45dcb265863a65d862bb16222e7e623c">MPIBroadcast_double</a>(Xg,size,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);
<a name="l00078"></a>00078 
<a name="l00079"></a>00079   <span class="comment">/* identify whether this is a 3D or &quot;pseudo-2D&quot; simulation */</span>
<a name="l00080"></a>00080   <a class="code" href="a00040.html#aafa48e01069cbd264052995cffeb6ea0">IBIdentifyMode</a>(Xg,dim_global,solver-&gt;<a class="code" href="a00015.html#a8419c1760256467c117ef5932b943259">ib</a>);
<a name="l00081"></a>00081 
<a name="l00082"></a>00082   <span class="comment">/* identify grid points inside the immersed body */</span>
<a name="l00083"></a>00083   <span class="keywordtype">int</span> count_inside_body = 0;
<a name="l00084"></a>00084   count = <a class="code" href="a00040.html#a9b7a52f65913c3f33f902400fa18239d">IBIdentifyBody</a>(solver-&gt;<a class="code" href="a00015.html#a8419c1760256467c117ef5932b943259">ib</a>,dim_global,dim_local,ghosts,mpi,Xg,solver-&gt;<a class="code" href="a00015.html#a267ef7e03dbe9dd4440dee2fdf48619a">iblank</a>);
<a name="l00085"></a>00085   <a class="code" href="a00045.html#a25c7df0ff2e4f81a64368ea72894a4f8">MPISum_integer</a>(&amp;count_inside_body,&amp;count,1,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);
<a name="l00086"></a>00086   free(Xg);
<a name="l00087"></a>00087 
<a name="l00088"></a>00088   <span class="comment">/* At ghost points corresponding to the physical boundary, extrapolate from the interior </span>
<a name="l00089"></a>00089 <span class="comment">     (this should also work for bodies that are adjacent to physical boundaries). At interior</span>
<a name="l00090"></a>00090 <span class="comment">     (MPI) boundaries, exchange iblank across MPI ranks.</span>
<a name="l00091"></a>00091 <span class="comment">  */</span>
<a name="l00092"></a>00092   <span class="keywordtype">int</span> indexb[ndims], indexi[ndims], bounds[ndims], offset[ndims];
<a name="l00093"></a>00093   <span class="keywordflow">for</span> (d = 0; d &lt; ndims; d++) {
<a name="l00094"></a>00094     <span class="comment">/* left boundary */</span>
<a name="l00095"></a>00095     <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a00019.html#aa3c28612a64b8a97bde66b720e15c700">ip</a>[d]) {
<a name="l00096"></a>00096       <a class="code" href="a00034.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>(dim_local,bounds,ndims); bounds[d] = ghosts;
<a name="l00097"></a>00097       <a class="code" href="a00034.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(offset,ndims,0); offset[d] = -ghosts;
<a name="l00098"></a>00098       <span class="keywordtype">int</span> done = 0; <a class="code" href="a00034.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(indexb,ndims,0);
<a name="l00099"></a>00099       <span class="keywordflow">while</span> (!done) {
<a name="l00100"></a>00100         <a class="code" href="a00034.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>(indexb,indexi,ndims); indexi[d] = ghosts-1-indexb[d];
<a name="l00101"></a>00101         <span class="keywordtype">int</span> p1; <a class="code" href="a00034.html#a0739cb538f4d301fad3b45059ddd0738">_ArrayIndex1DWO_</a>(ndims,dim_local,indexb,offset,ghosts,p1);
<a name="l00102"></a>00102         <span class="keywordtype">int</span> p2; <a class="code" href="a00034.html#afbb862a2fdf5b72b1f9ace42f64b556f">_ArrayIndex1D_</a>  (ndims,dim_local,indexi,ghosts,p2);
<a name="l00103"></a>00103         solver-&gt;<a class="code" href="a00015.html#a267ef7e03dbe9dd4440dee2fdf48619a">iblank</a>[p1] = solver-&gt;<a class="code" href="a00015.html#a267ef7e03dbe9dd4440dee2fdf48619a">iblank</a>[p2];
<a name="l00104"></a>00104         <a class="code" href="a00034.html#ac5ec1371623f11d03b0f42adaa24acbc">_ArrayIncrementIndex_</a>(ndims,bounds,indexb,done);
<a name="l00105"></a>00105       }
<a name="l00106"></a>00106     }
<a name="l00107"></a>00107     <span class="comment">/* right boundary */</span>
<a name="l00108"></a>00108     <span class="keywordflow">if</span> (mpi-&gt;<a class="code" href="a00019.html#aa3c28612a64b8a97bde66b720e15c700">ip</a>[d] == mpi-&gt;<a class="code" href="a00019.html#a0be0f30a83bc3f3d9f6ee3a36bbf2716">iproc</a>[d]-1) {
<a name="l00109"></a>00109       <a class="code" href="a00034.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>(dim_local,bounds,ndims); bounds[d] = ghosts;
<a name="l00110"></a>00110       <a class="code" href="a00034.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(offset,ndims,0); offset[d] = dim_local[d];
<a name="l00111"></a>00111       <span class="keywordtype">int</span> done = 0; <a class="code" href="a00034.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(indexb,ndims,0);
<a name="l00112"></a>00112       <span class="keywordflow">while</span> (!done) {
<a name="l00113"></a>00113         <a class="code" href="a00034.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>(indexb,indexi,ndims); indexi[d] = dim_local[d]-1-indexb[d];
<a name="l00114"></a>00114         <span class="keywordtype">int</span> p1; <a class="code" href="a00034.html#a0739cb538f4d301fad3b45059ddd0738">_ArrayIndex1DWO_</a>(ndims,dim_local,indexb,offset,ghosts,p1);
<a name="l00115"></a>00115         <span class="keywordtype">int</span> p2; <a class="code" href="a00034.html#afbb862a2fdf5b72b1f9ace42f64b556f">_ArrayIndex1D_</a>  (ndims,dim_local,indexi,ghosts,p2);
<a name="l00116"></a>00116         solver-&gt;<a class="code" href="a00015.html#a267ef7e03dbe9dd4440dee2fdf48619a">iblank</a>[p1] = solver-&gt;<a class="code" href="a00015.html#a267ef7e03dbe9dd4440dee2fdf48619a">iblank</a>[p2];
<a name="l00117"></a>00117         <a class="code" href="a00034.html#ac5ec1371623f11d03b0f42adaa24acbc">_ArrayIncrementIndex_</a>(ndims,bounds,indexb,done);
<a name="l00118"></a>00118       }
<a name="l00119"></a>00119     }
<a name="l00120"></a>00120   }
<a name="l00121"></a>00121   <a class="code" href="a00045.html#a60ace5964c051fa481e6a1e6f1ef75d7">MPIExchangeBoundariesnD</a>(ndims,1,dim_local,ghosts,mpi,solver-&gt;<a class="code" href="a00015.html#a267ef7e03dbe9dd4440dee2fdf48619a">iblank</a>);
<a name="l00122"></a>00122 
<a name="l00123"></a>00123   <span class="comment">/* identify and create a list of immersed boundary points on each rank */</span>
<a name="l00124"></a>00124   <span class="keywordtype">int</span> count_boundary_points = 0;
<a name="l00125"></a>00125   count = <a class="code" href="a00040.html#af70e331f0896000fe1b0edf69676296c">IBIdentifyBoundary</a>(solver-&gt;<a class="code" href="a00015.html#a8419c1760256467c117ef5932b943259">ib</a>,mpi,dim_local,ghosts,solver-&gt;<a class="code" href="a00015.html#a267ef7e03dbe9dd4440dee2fdf48619a">iblank</a>);
<a name="l00126"></a>00126   <a class="code" href="a00045.html#a25c7df0ff2e4f81a64368ea72894a4f8">MPISum_integer</a>(&amp;count_boundary_points,&amp;count,1,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);
<a name="l00127"></a>00127 
<a name="l00128"></a>00128   <span class="comment">/* find the nearest facet for each immersed boundary point */</span>
<a name="l00129"></a>00129   <span class="keywordtype">double</span> ld = 0, xmin, xmax, ymin, ymax, zmin, zmax;
<a name="l00130"></a>00130   <a class="code" href="a00036.html#a9aa9bad8531d6733731a850ccc471a42">_GetCoordinate_</a>(0,0             ,dim_local,ghosts,solver-&gt;<a class="code" href="a00015.html#a711aad4cbe735871dd9e91ab575c878b">x</a>,xmin);
<a name="l00131"></a>00131   <a class="code" href="a00036.html#a9aa9bad8531d6733731a850ccc471a42">_GetCoordinate_</a>(0,dim_local[0]-1,dim_local,ghosts,solver-&gt;<a class="code" href="a00015.html#a711aad4cbe735871dd9e91ab575c878b">x</a>,xmax);
<a name="l00132"></a>00132   <a class="code" href="a00036.html#a9aa9bad8531d6733731a850ccc471a42">_GetCoordinate_</a>(1,0             ,dim_local,ghosts,solver-&gt;<a class="code" href="a00015.html#a711aad4cbe735871dd9e91ab575c878b">x</a>,ymin);
<a name="l00133"></a>00133   <a class="code" href="a00036.html#a9aa9bad8531d6733731a850ccc471a42">_GetCoordinate_</a>(1,dim_local[1]-1,dim_local,ghosts,solver-&gt;<a class="code" href="a00015.html#a711aad4cbe735871dd9e91ab575c878b">x</a>,ymax);
<a name="l00134"></a>00134   <a class="code" href="a00036.html#a9aa9bad8531d6733731a850ccc471a42">_GetCoordinate_</a>(2,0             ,dim_local,ghosts,solver-&gt;<a class="code" href="a00015.html#a711aad4cbe735871dd9e91ab575c878b">x</a>,zmin);
<a name="l00135"></a>00135   <a class="code" href="a00036.html#a9aa9bad8531d6733731a850ccc471a42">_GetCoordinate_</a>(2,dim_local[2]-1,dim_local,ghosts,solver-&gt;<a class="code" href="a00015.html#a711aad4cbe735871dd9e91ab575c878b">x</a>,zmax);
<a name="l00136"></a>00136   <span class="keywordtype">double</span> xlen = xmax - xmin;
<a name="l00137"></a>00137   <span class="keywordtype">double</span> ylen = ymax - ymin;
<a name="l00138"></a>00138   <span class="keywordtype">double</span> zlen = zmax - zmin;
<a name="l00139"></a>00139   ld = <a class="code" href="a00043.html#aa0d45e1e67c5cacf5c9251fcd90a971b">max3</a>(xlen,ylen,zlen);
<a name="l00140"></a>00140   count = <a class="code" href="a00040.html#ac877ecf361b72916a491e4759f8af040">IBNearestFacetNormal</a>(solver-&gt;<a class="code" href="a00015.html#a8419c1760256467c117ef5932b943259">ib</a>,mpi,solver-&gt;<a class="code" href="a00015.html#a711aad4cbe735871dd9e91ab575c878b">x</a>,ld,dim_local,ghosts);
<a name="l00141"></a>00141   <span class="keywordflow">if</span> (count) <span class="keywordflow">return</span>(count);
<a name="l00142"></a>00142 
<a name="l00143"></a>00143   <span class="comment">/* For the immersed boundary points, find the interior points for extrapolation,</span>
<a name="l00144"></a>00144 <span class="comment">     and compute their interpolation coefficients */</span>
<a name="l00145"></a>00145   count = <a class="code" href="a00040.html#a0175a349146a94c667dc90f2bffdb7ef">IBInterpCoeffs</a>(solver-&gt;<a class="code" href="a00015.html#a8419c1760256467c117ef5932b943259">ib</a>,mpi,solver-&gt;<a class="code" href="a00015.html#a711aad4cbe735871dd9e91ab575c878b">x</a>,dim_local,ghosts,solver-&gt;<a class="code" href="a00015.html#a267ef7e03dbe9dd4440dee2fdf48619a">iblank</a>);
<a name="l00146"></a>00146   <span class="keywordflow">if</span> (count) <span class="keywordflow">return</span>(count);
<a name="l00147"></a>00147 
<a name="l00148"></a>00148   <span class="comment">/* Create facet mapping */</span>;
<a name="l00149"></a>00149   count = <a class="code" href="a00040.html#a0575b5233bc22af6797e2c7b0d95f469">IBCreateFacetMapping</a>(ib,mpi,solver-&gt;<a class="code" href="a00015.html#a711aad4cbe735871dd9e91ab575c878b">x</a>,dim_local,ghosts);
<a name="l00150"></a>00150   <span class="keywordflow">if</span> (count) <span class="keywordflow">return</span>(count);
<a name="l00151"></a>00151   
<a name="l00152"></a>00152   <span class="comment">/* Done */</span>
<a name="l00153"></a>00153   <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a00019.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) {
<a name="l00154"></a>00154     <span class="keywordtype">double</span> percentage;
<a name="l00155"></a>00155     printf(<span class="stringliteral">&quot;Immersed body read from %s:\n&quot;</span>,solver-&gt;<a class="code" href="a00015.html#a43ee3672350b4fd385871b6512e5d47b">ib_filename</a>);
<a name="l00156"></a>00156     printf(<span class="stringliteral">&quot;    Number of facets: %d\n    Bounding box: [%3.1f,%3.1lf] X [%3.1f,%3.1lf] X [%3.1f,%3.1lf]\n&quot;</span>,
<a name="l00157"></a>00157            body-&gt;<a class="code" href="a00002.html#afd755b081f4d9ca3558ef9ca9f3c35d0">nfacets</a>,body-&gt;<a class="code" href="a00002.html#ab5bbe897a0c25c58341c216a1b31fbbf">xmin</a>,body-&gt;<a class="code" href="a00002.html#a30554afc6599846bcd01cbf986d0998a">xmax</a>,body-&gt;<a class="code" href="a00002.html#a8c17b15efd6e0337c596d98616e9b9da">ymin</a>,body-&gt;<a class="code" href="a00002.html#afc6ae6b11b9521d908c52e4fb3ea09ce">ymax</a>,body-&gt;<a class="code" href="a00002.html#aaea53ab3c236de8e4f167c3807d35b47">zmin</a>,body-&gt;<a class="code" href="a00002.html#ade09ae0d27b0b7a2d1e886efc6d1a500">zmax</a>);
<a name="l00158"></a>00158     percentage = ((double)count_inside_body)/((double)solver-&gt;<a class="code" href="a00015.html#a4e67f54563a3c4ff005dfaf0130f957c">npoints_global</a>)*100.0;
<a name="l00159"></a>00159     printf(<span class="stringliteral">&quot;    Number of grid points inside immersed body: %d (%4.1f%%).\n&quot;</span>,count_inside_body,percentage);
<a name="l00160"></a>00160     percentage = ((double)count_boundary_points)/((double)solver-&gt;<a class="code" href="a00015.html#a4e67f54563a3c4ff005dfaf0130f957c">npoints_global</a>)*100.0;
<a name="l00161"></a>00161     printf(<span class="stringliteral">&quot;    Number of immersed boundary points        : %d (%4.1f%%).\n&quot;</span>,count_boundary_points,percentage);
<a name="l00162"></a>00162     printf(<span class="stringliteral">&quot;    Immersed body simulation mode             : %s.\n&quot;</span>, ib-&gt;<a class="code" href="a00017.html#a935394e510d17282c5697cd76a6e2667">mode</a>);
<a name="l00163"></a>00163   }
<a name="l00164"></a>00164 
<a name="l00165"></a>00165   <span class="keywordflow">return</span>(0);
<a name="l00166"></a>00166 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a95a1f3298244f6e0ec65e94fa9c124e2"></a><!-- doxytag: member="hypar.h::InitializePhysics" ref="a95a1f3298244f6e0ec65e94fa9c124e2" args="(void *, void *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int InitializePhysics </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>m</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Initialize the physics</p>
<p>Initialize the physical model for a simulation: Depending on the physical model specified, this function calls the initialization function for that physical model. The latter is responsible for setting all the physics-specific functions that are required by the model. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>s</em>&nbsp;</td><td>Solver object of type <a class="el" href="a00015.html" title="Structure containing all solver-specific variables and functions.">HyPar</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>m</em>&nbsp;</td><td>MPI object of type <a class="el" href="a00019.html" title="Structure of MPI-related variables.">MPIVariables</a> </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00103_source.html#l00036">36</a> of file <a class="el" href="a00103_source.html">InitializePhysics.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00040"></a>00040 {
<a name="l00041"></a>00041   <a class="code" href="a00015.html" title="Structure containing all solver-specific variables and functions.">HyPar</a>         *solver = (<a class="code" href="a00015.html" title="Structure containing all solver-specific variables and functions.">HyPar</a>*)        s;
<a name="l00042"></a>00042   <a class="code" href="a00019.html" title="Structure of MPI-related variables.">MPIVariables</a>  *mpi    = (<a class="code" href="a00019.html" title="Structure of MPI-related variables.">MPIVariables</a>*) m;
<a name="l00043"></a>00043   <a class="code" href="a00036.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a>;
<a name="l00044"></a>00044 
<a name="l00045"></a>00045   <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a00019.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) printf(<span class="stringliteral">&quot;Initializing physics. Model = \&quot;%s\&quot;\n&quot;</span>,solver-&gt;<a class="code" href="a00015.html#ad3fe4b266b398f3a7567ac1b241d99a2">model</a>);
<a name="l00046"></a>00046 
<a name="l00047"></a>00047   <span class="comment">/* Initialize physics-specific functions to NULL */</span>
<a name="l00048"></a>00048   solver-&gt;<a class="code" href="a00015.html#a73ad2e9dae43bf438ab8bfc4cd2e1bdd">ComputeCFL</a>            = NULL;
<a name="l00049"></a>00049   solver-&gt;<a class="code" href="a00015.html#a49e17e5889baddd411c028afc3b91335">ComputeDiffNumber</a>     = NULL;
<a name="l00050"></a>00050   solver-&gt;<a class="code" href="a00015.html#a0d895f9bb0c8a3e79a64dd2379e1f2dd">FFunction</a>             = NULL;
<a name="l00051"></a>00051   solver-&gt;<a class="code" href="a00015.html#aa1dd38befc4bb4adda9d456146436b14">dFFunction</a>            = NULL;
<a name="l00052"></a>00052   solver-&gt;<a class="code" href="a00015.html#adcc5e677515d0952ce3ff702c9d85b86">FdFFunction</a>           = NULL;
<a name="l00053"></a>00053   solver-&gt;<a class="code" href="a00015.html#ad8f03ca8c9fd6e1e235203495e8f2173">GFunction</a>             = NULL;
<a name="l00054"></a>00054   solver-&gt;<a class="code" href="a00015.html#a122bcc1ec2e20b3bc69d169580529021">HFunction</a>             = NULL;
<a name="l00055"></a>00055   solver-&gt;<a class="code" href="a00015.html#a1685cd0c6b8c413bdbbe86d8f4475c58">SFunction</a>             = NULL;
<a name="l00056"></a>00056   solver-&gt;<a class="code" href="a00015.html#af1dc5a4ba2bdc46dfd226e35772b4130">UFunction</a>             = NULL;
<a name="l00057"></a>00057   solver-&gt;<a class="code" href="a00015.html#a15eea1647344c503deb1d9f89cead631">JFunction</a>             = NULL;
<a name="l00058"></a>00058   solver-&gt;<a class="code" href="a00015.html#a7eb68b9643feb74bd49f3a171b66eef1">Upwind</a>                = NULL;
<a name="l00059"></a>00059   solver-&gt;<a class="code" href="a00015.html#a73a85f83072e02bf979234486265b6d3">UpwinddF</a>              = NULL;
<a name="l00060"></a>00060   solver-&gt;<a class="code" href="a00015.html#ab06746933e859e829d694505c18258b3">UpwindFdF</a>             = NULL;
<a name="l00061"></a>00061   solver-&gt;<a class="code" href="a00015.html#ad00c58573b5bcfe8c8bb72eed3dc7ad8">PreStage</a>              = NULL;
<a name="l00062"></a>00062   solver-&gt;<a class="code" href="a00015.html#a356e3534ee0048e05c5ea3ca091c33d8">PostStage</a>             = NULL;
<a name="l00063"></a>00063   solver-&gt;<a class="code" href="a00015.html#a6a34ae8a3044f521e57180a7260f3b42">PreStep</a>               = NULL;
<a name="l00064"></a>00064   solver-&gt;<a class="code" href="a00015.html#a85a6422b0b08263704165a2a14719033">PostStep</a>              = NULL;
<a name="l00065"></a>00065   solver-&gt;<a class="code" href="a00015.html#aa4ef2f3e9fcc13ef7b8885b8a7145967">PrintStep</a>             = NULL;
<a name="l00066"></a>00066   solver-&gt;<a class="code" href="a00015.html#ab4c55736e92f7d72f04b8a957d82b054">PhysicsOutput</a>         = NULL;
<a name="l00067"></a>00067   solver-&gt;<a class="code" href="a00015.html#a7331366d789b2995436accbc35e1cc80">AveragingFunction</a>     = NULL;
<a name="l00068"></a>00068   solver-&gt;<a class="code" href="a00015.html#a8c603c73be1f08e408a1de94a088da7b">GetLeftEigenvectors</a>   = NULL;
<a name="l00069"></a>00069   solver-&gt;<a class="code" href="a00015.html#a22eef349f191a1aa267e14b08140c823">GetRightEigenvectors</a>  = NULL;
<a name="l00070"></a>00070   solver-&gt;<a class="code" href="a00015.html#a0d9d4a968c52356bd63f45ad76112245">IBFunction</a>            = NULL;
<a name="l00071"></a>00071 
<a name="l00072"></a>00072   <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#ad3fe4b266b398f3a7567ac1b241d99a2">model</a>,<a class="code" href="a00053.html#a44c745170d88218420752d150856b01c">_LINEAR_ADVECTION_DIFFUSION_REACTION_</a>)) {
<a name="l00073"></a>00073 
<a name="l00074"></a>00074     solver-&gt;<a class="code" href="a00015.html#a48e81a1806b5774943fd9a26e9a190f2">physics</a> = (<a class="code" href="a00018.html">LinearADR</a>*) calloc (1,<span class="keyword">sizeof</span>(<a class="code" href="a00018.html">LinearADR</a>));
<a name="l00075"></a>00075     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00053.html#a78c1fbb2ddae048ddb9d2863ad4f65b3">LinearADRInitialize</a>(solver,mpi); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00076"></a>00076 
<a name="l00077"></a>00077   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#ad3fe4b266b398f3a7567ac1b241d99a2">model</a>,<a class="code" href="a00049.html#a801cd9499779d35febbce73603aa70a6">_FP_DOUBLE_WELL_</a>)) {
<a name="l00078"></a>00078 
<a name="l00079"></a>00079     solver-&gt;<a class="code" href="a00015.html#a48e81a1806b5774943fd9a26e9a190f2">physics</a> = (<a class="code" href="a00010.html">FPDoubleWell</a>*) calloc (1,<span class="keyword">sizeof</span>(<a class="code" href="a00010.html">FPDoubleWell</a>));
<a name="l00080"></a>00080     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00049.html#af48e8eb8a81020a97b3b7b039bb94626">FPDoubleWellInitialize</a>(solver,mpi); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00081"></a>00081 
<a name="l00082"></a>00082   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#ad3fe4b266b398f3a7567ac1b241d99a2">model</a>,<a class="code" href="a00050.html#aaeb0de68ad20c63864e1a6cdf819e836">_FP_POWER_SYSTEM_</a>)) {
<a name="l00083"></a>00083 
<a name="l00084"></a>00084     solver-&gt;<a class="code" href="a00015.html#a48e81a1806b5774943fd9a26e9a190f2">physics</a> = (<a class="code" href="a00011.html">FPPowerSystem</a>*) calloc (1,<span class="keyword">sizeof</span>(<a class="code" href="a00011.html">FPPowerSystem</a>));
<a name="l00085"></a>00085     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00050.html#abe8191ce0b15220b854bbcda4446b170">FPPowerSystemInitialize</a>(solver,mpi); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00086"></a>00086 
<a name="l00087"></a>00087   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#ad3fe4b266b398f3a7567ac1b241d99a2">model</a>,<a class="code" href="a00051.html#a104fb063ee608b39fdab8d5e1e752ca3">_FP_POWER_SYSTEM_1BUS_</a>)) {
<a name="l00088"></a>00088 
<a name="l00089"></a>00089     solver-&gt;<a class="code" href="a00015.html#a48e81a1806b5774943fd9a26e9a190f2">physics</a> = (<a class="code" href="a00012.html">FPPowerSystem1Bus</a>*) calloc (1,<span class="keyword">sizeof</span>(<a class="code" href="a00012.html">FPPowerSystem1Bus</a>));
<a name="l00090"></a>00090     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00051.html#aa498ad8f4fd87b8a18d2d81e327d7013">FPPowerSystem1BusInitialize</a>(solver,mpi); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00091"></a>00091 
<a name="l00092"></a>00092   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#ad3fe4b266b398f3a7567ac1b241d99a2">model</a>,<a class="code" href="a00052.html#a5c8fe736dacda1a087bf1fb514761d6e">_FP_POWER_SYSTEM_3BUS_</a>)) {
<a name="l00093"></a>00093 
<a name="l00094"></a>00094     solver-&gt;<a class="code" href="a00015.html#a48e81a1806b5774943fd9a26e9a190f2">physics</a> = (<a class="code" href="a00013.html" title="Structure containing variable and parameters specific to the 3-bus power system model...">FPPowerSystem3Bus</a>*) calloc (1,<span class="keyword">sizeof</span>(<a class="code" href="a00013.html" title="Structure containing variable and parameters specific to the 3-bus power system model...">FPPowerSystem3Bus</a>));
<a name="l00095"></a>00095     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00052.html#ac493c18d35f80f5207a03d0be4778617">FPPowerSystem3BusInitialize</a>(solver,mpi); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00096"></a>00096 
<a name="l00097"></a>00097   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#ad3fe4b266b398f3a7567ac1b241d99a2">model</a>,<a class="code" href="a00047.html#a076991b7fbc2b9c6330f792bbba182c2">_EULER_1D_</a>)) {
<a name="l00098"></a>00098 
<a name="l00099"></a>00099     solver-&gt;<a class="code" href="a00015.html#a48e81a1806b5774943fd9a26e9a190f2">physics</a> = (<a class="code" href="a00005.html" title="Structure containing variables and parameters specific to the 1D Euler equations...">Euler1D</a>*) calloc (1,<span class="keyword">sizeof</span>(<a class="code" href="a00005.html" title="Structure containing variables and parameters specific to the 1D Euler equations...">Euler1D</a>));
<a name="l00100"></a>00100     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00032.html#a96d0f06dcec440c0f9d1b9d1d74127d5">Euler1DInitialize</a>(solver,mpi); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00101"></a>00101 
<a name="l00102"></a>00102   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#ad3fe4b266b398f3a7567ac1b241d99a2">model</a>,<a class="code" href="a00048.html#ae205e355df87a13c8b47c958828bce2f">_EULER_2D_</a>)) {
<a name="l00103"></a>00103 
<a name="l00104"></a>00104     solver-&gt;<a class="code" href="a00015.html#a48e81a1806b5774943fd9a26e9a190f2">physics</a> = (<a class="code" href="a00006.html">Euler2D</a>*) calloc (1,<span class="keyword">sizeof</span>(<a class="code" href="a00006.html">Euler2D</a>));
<a name="l00105"></a>00105     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00048.html#a7c85bdac3c8b5f3bb3bd83fdae2e52e8">Euler2DInitialize</a>(solver,mpi); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00106"></a>00106 
<a name="l00107"></a>00107   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#ad3fe4b266b398f3a7567ac1b241d99a2">model</a>,<a class="code" href="a00054.html#a04e16b3f2a882826e604b6353d9e5bcb">_NAVIER_STOKES_2D_</a>)) {
<a name="l00108"></a>00108 
<a name="l00109"></a>00109     solver-&gt;<a class="code" href="a00015.html#a48e81a1806b5774943fd9a26e9a190f2">physics</a> = (<a class="code" href="a00021.html" title="Structure containing variables and parameters specific to the 2D Navier Stokes equations...">NavierStokes2D</a>*) calloc (1,<span class="keyword">sizeof</span>(<a class="code" href="a00021.html" title="Structure containing variables and parameters specific to the 2D Navier Stokes equations...">NavierStokes2D</a>));
<a name="l00110"></a>00110     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00032.html#a01be02c8f7e2f34d7de86706693ea1be">NavierStokes2DInitialize</a>(solver,mpi); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00111"></a>00111 
<a name="l00112"></a>00112   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#ad3fe4b266b398f3a7567ac1b241d99a2">model</a>,<a class="code" href="a00055.html#a34099431ed2606bd884d36cea1d0448e">_NAVIER_STOKES_3D_</a>)) {
<a name="l00113"></a>00113 
<a name="l00114"></a>00114     solver-&gt;<a class="code" href="a00015.html#a48e81a1806b5774943fd9a26e9a190f2">physics</a> = (<a class="code" href="a00022.html" title="Structure containing variables and parameters specific to the 3D Navier Stokes equations...">NavierStokes3D</a>*) calloc (1,<span class="keyword">sizeof</span>(<a class="code" href="a00022.html" title="Structure containing variables and parameters specific to the 3D Navier Stokes equations...">NavierStokes3D</a>));
<a name="l00115"></a>00115     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00055.html#a0385acf3caf014aa7491ad2fc6a9572a">NavierStokes3DInitialize</a>(solver,mpi); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00116"></a>00116 
<a name="l00117"></a>00117   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#ad3fe4b266b398f3a7567ac1b241d99a2">model</a>,<a class="code" href="a00056.html#a82b3f90650895890211635171d649355">_NUMA2D_</a>)) {
<a name="l00118"></a>00118 
<a name="l00119"></a>00119     solver-&gt;<a class="code" href="a00015.html#a48e81a1806b5774943fd9a26e9a190f2">physics</a> = (<a class="code" href="a00023.html">Numa2D</a>*) calloc (1,<span class="keyword">sizeof</span>(<a class="code" href="a00023.html">Numa2D</a>));
<a name="l00120"></a>00120     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00056.html#afe3cd0a9dcef80c2cdb1e8928cef9887">Numa2DInitialize</a>(solver,mpi); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00121"></a>00121 
<a name="l00122"></a>00122   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#ad3fe4b266b398f3a7567ac1b241d99a2">model</a>,<a class="code" href="a00057.html#a8bccae14dde8eaba7663344939367e96">_NUMA3D_</a>)) {
<a name="l00123"></a>00123 
<a name="l00124"></a>00124     solver-&gt;<a class="code" href="a00015.html#a48e81a1806b5774943fd9a26e9a190f2">physics</a> = (<a class="code" href="a00024.html">Numa3D</a>*) calloc (1,<span class="keyword">sizeof</span>(<a class="code" href="a00024.html">Numa3D</a>));
<a name="l00125"></a>00125     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00057.html#aad8263a96673a7500502bc9d88c9fd41">Numa3DInitialize</a>(solver,mpi); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00126"></a>00126 
<a name="l00127"></a>00127   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#ad3fe4b266b398f3a7567ac1b241d99a2">model</a>,<a class="code" href="a00058.html#ac280c6ead138670f1f518fad3ea94737">_SHALLOW_WATER_1D_</a>)) {
<a name="l00128"></a>00128 
<a name="l00129"></a>00129     solver-&gt;<a class="code" href="a00015.html#a48e81a1806b5774943fd9a26e9a190f2">physics</a> = (<a class="code" href="a00026.html" title="Structure containing variables and parameters specific to the 1D Shallow Water equations...">ShallowWater1D</a>*) calloc (1,<span class="keyword">sizeof</span>(<a class="code" href="a00026.html" title="Structure containing variables and parameters specific to the 1D Shallow Water equations...">ShallowWater1D</a>));
<a name="l00130"></a>00130     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00058.html#a66b9f9e2ed58d68a910cbd5522381fa2">ShallowWater1DInitialize</a>(solver,mpi); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00131"></a>00131 
<a name="l00132"></a>00132   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#ad3fe4b266b398f3a7567ac1b241d99a2">model</a>,<a class="code" href="a00059.html#aebe5d4a29761b0784c3d3e67e325105b">_SHALLOW_WATER_2D_</a>)) {
<a name="l00133"></a>00133 
<a name="l00134"></a>00134     solver-&gt;<a class="code" href="a00015.html#a48e81a1806b5774943fd9a26e9a190f2">physics</a> = (<a class="code" href="a00027.html" title="Structure containing variables and parameters specific to the 2D Shallow Water equations...">ShallowWater2D</a>*) calloc (1,<span class="keyword">sizeof</span>(<a class="code" href="a00027.html" title="Structure containing variables and parameters specific to the 2D Shallow Water equations...">ShallowWater2D</a>));
<a name="l00135"></a>00135     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00059.html#a9182e40f0c923b05a4280c768bb5a1f6">ShallowWater2DInitialize</a>(solver,mpi); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00136"></a>00136 
<a name="l00137"></a>00137   } <span class="keywordflow">else</span> {
<a name="l00138"></a>00138 
<a name="l00139"></a>00139     fprintf(stderr,<span class="stringliteral">&quot;Error: %s is not a supported physical model.\n&quot;</span>,solver-&gt;<a class="code" href="a00015.html#ad3fe4b266b398f3a7567ac1b241d99a2">model</a>);
<a name="l00140"></a>00140     <span class="keywordflow">return</span>(1);
<a name="l00141"></a>00141 
<a name="l00142"></a>00142   }
<a name="l00143"></a>00143 
<a name="l00144"></a>00144   <span class="comment">/* some checks */</span>
<a name="l00145"></a>00145   <span class="keywordflow">if</span> ( ( (solver-&gt;<a class="code" href="a00015.html#a8c603c73be1f08e408a1de94a088da7b">GetLeftEigenvectors</a> == NULL) || (solver-&gt;<a class="code" href="a00015.html#a22eef349f191a1aa267e14b08140c823">GetRightEigenvectors</a> == NULL) )
<a name="l00146"></a>00146       &amp;&amp; (!strcmp(solver-&gt;<a class="code" href="a00015.html#a9591ba0fadb863561474e2ba251d2594">interp_type</a>,<a class="code" href="a00041.html#aa7752b40155314f9f2c063d4d9d8339d">_CHARACTERISTIC_</a>)) &amp;&amp; (solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a> &gt; 1) ) {
<a name="l00147"></a>00147     <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a00019.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) {
<a name="l00148"></a>00148       fprintf(stderr,<span class="stringliteral">&quot;Error: Interpolation type is defined as characteristic &quot;</span>);
<a name="l00149"></a>00149       fprintf(stderr,<span class="stringliteral">&quot;but physics initializations returned NULL pointers for &quot;</span>);
<a name="l00150"></a>00150       fprintf(stderr,<span class="stringliteral">&quot;Get(Left,Right)Eigenvectors needed for characteristic-based &quot;</span>);
<a name="l00151"></a>00151       fprintf(stderr,<span class="stringliteral">&quot;reconstruction.\n&quot;</span>);
<a name="l00152"></a>00152     }
<a name="l00153"></a>00153     <span class="keywordflow">return</span>(1);
<a name="l00154"></a>00154   }
<a name="l00155"></a>00155 
<a name="l00156"></a>00156   <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#a5bed0cb9665daad89f4377c4f7609df4">SplitHyperbolicFlux</a>,<span class="stringliteral">&quot;yes&quot;</span>)) {
<a name="l00157"></a>00157     <span class="keywordflow">if</span> ((!solver-&gt;<a class="code" href="a00015.html#aa1dd38befc4bb4adda9d456146436b14">dFFunction</a>) || (!solver-&gt;<a class="code" href="a00015.html#a73a85f83072e02bf979234486265b6d3">UpwinddF</a>)) {
<a name="l00158"></a>00158       <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a00019.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) {
<a name="l00159"></a>00159         fprintf(stderr,<span class="stringliteral">&quot;Error: Splitting of hyperbolic flux requires a dFFunction &quot;</span>);
<a name="l00160"></a>00160         fprintf(stderr,<span class="stringliteral">&quot;and its upwinding function UpwinddF.\n&quot;</span>);
<a name="l00161"></a>00161         fprintf(stderr,<span class="stringliteral">&quot;Error: f(u) = [f(u) - df(u)] + df(u).\n&quot;</span>);
<a name="l00162"></a>00162         fprintf(stderr,<span class="stringliteral">&quot;Error: dFFunction or UpwinddF (or both) is (are) NULL.\n&quot;</span>);
<a name="l00163"></a>00163       }
<a name="l00164"></a>00164       <span class="keywordflow">return</span>(1);
<a name="l00165"></a>00165     }
<a name="l00166"></a>00166     <span class="keywordflow">if</span> (solver-&gt;<a class="code" href="a00015.html#adcc5e677515d0952ce3ff702c9d85b86">FdFFunction</a> &amp;&amp; solver-&gt;<a class="code" href="a00015.html#ab06746933e859e829d694505c18258b3">UpwindFdF</a>) solver-&gt;<a class="code" href="a00015.html#ad607f82c4bfde055613e05272f9afd81">flag_fdf_specified</a> = 1;
<a name="l00167"></a>00167     <span class="keywordflow">else</span>                                          solver-&gt;<a class="code" href="a00015.html#ad607f82c4bfde055613e05272f9afd81">flag_fdf_specified</a> = 0;
<a name="l00168"></a>00168   }
<a name="l00169"></a>00169 
<a name="l00170"></a>00170   <span class="keywordflow">if</span> ((solver-&gt;<a class="code" href="a00015.html#a0d9d4a968c52356bd63f45ad76112245">IBFunction</a> == NULL) &amp;&amp; (solver-&gt;<a class="code" href="a00015.html#ae83b1b0117b6a805ead2e4728945814c">flag_ib</a>)) {
<a name="l00171"></a>00171     <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a00019.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) {
<a name="l00172"></a>00172       fprintf(stderr,<span class="stringliteral">&quot;Error in InitializePhysics(): Physical model %s does not yet have an immersed boundary treatment.\n&quot;</span>,
<a name="l00173"></a>00173               solver-&gt;<a class="code" href="a00015.html#ad3fe4b266b398f3a7567ac1b241d99a2">model</a>);
<a name="l00174"></a>00174     }
<a name="l00175"></a>00175     <span class="keywordflow">return</span>(1);
<a name="l00176"></a>00176   }
<a name="l00177"></a>00177 
<a name="l00178"></a>00178   <span class="keywordflow">return</span>(0);
<a name="l00179"></a>00179 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8166bb7cded409b3baa135d99fd6bc7c"></a><!-- doxytag: member="hypar.h::InitializeSolvers" ref="a8166bb7cded409b3baa135d99fd6bc7c" args="(void *, void *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int InitializeSolvers </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>m</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Initialize the solvers</p>
<p>This function initializes all solvers-specific function pointers depending on user input. The specific functions used for spatial discretization, time integration, and solution output are set here. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>s</em>&nbsp;</td><td>Solver object of type <a class="el" href="a00015.html" title="Structure containing all solver-specific variables and functions.">HyPar</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>m</em>&nbsp;</td><td>MPI object of type <a class="el" href="a00019.html" title="Structure of MPI-related variables.">MPIVariables</a> </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00104_source.html#l00041">41</a> of file <a class="el" href="a00104_source.html">InitializeSolvers.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00045"></a>00045 {
<a name="l00046"></a>00046   <a class="code" href="a00015.html" title="Structure containing all solver-specific variables and functions.">HyPar</a>         *solver = (<a class="code" href="a00015.html" title="Structure containing all solver-specific variables and functions.">HyPar</a>*)        s;
<a name="l00047"></a>00047   <a class="code" href="a00019.html" title="Structure of MPI-related variables.">MPIVariables</a>  *mpi    = (<a class="code" href="a00019.html" title="Structure of MPI-related variables.">MPIVariables</a>*) m;
<a name="l00048"></a>00048   <a class="code" href="a00036.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a>;
<a name="l00049"></a>00049 
<a name="l00050"></a>00050   <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a00019.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) printf(<span class="stringliteral">&quot;Initializing solvers.\n&quot;</span>);
<a name="l00051"></a>00051 
<a name="l00052"></a>00052   solver-&gt;<a class="code" href="a00015.html#a6266f3bf86254aae74920f03d2257390">ApplyBoundaryConditions</a>     = <a class="code" href="a00090.html#a652bd59d2ccc7c0061a9ff9d6aea044a" title="Applies the boundary conditions specified for each boundary zone.">ApplyBoundaryConditions</a>;
<a name="l00053"></a>00053   solver-&gt;<a class="code" href="a00015.html#a83d97dfc50e6bfefd0db6503d365d5bd">ApplyIBConditions</a>           = <a class="code" href="a00091.html#a63bad563b5163bdada0672cec6d535c0">ApplyIBConditions</a>;
<a name="l00054"></a>00054   solver-&gt;<a class="code" href="a00015.html#aa245f8c9e6af37e47c5867dccbbc208b">HyperbolicFunction</a>          = <a class="code" href="a00033.html#a93e7db794730c0755fe02ab1ffe7715c">HyperbolicFunction</a>;
<a name="l00055"></a>00055   solver-&gt;<a class="code" href="a00015.html#a662e256e081a2b74f971d02c747892b8">SourceFunction</a>              = <a class="code" href="a00104.html#a6f2b6bacb5d50cb9fce6e3e00d55cc6d">SourceFunction</a>;
<a name="l00056"></a>00056   solver-&gt;<a class="code" href="a00015.html#a0fda913c8c0424880302e9296cc0e813">VolumeIntegralFunction</a>      = <a class="code" href="a00104.html#a1f30168f72fce94d12bd0cc8d9322494">VolumeIntegral</a>;
<a name="l00057"></a>00057   solver-&gt;<a class="code" href="a00015.html#a479abc98a0ca73359a33089ba5d37863">BoundaryIntegralFunction</a>    = <a class="code" href="a00092.html#abf698222199fe88976002228400c428d">BoundaryIntegral</a>;
<a name="l00058"></a>00058   solver-&gt;<a class="code" href="a00015.html#a2108550c80e1666f11c684fcb4f1ca89">CalculateConservationError</a>  = <a class="code" href="a00093.html#aef9a903e2e2870dbadbae56ab1b62eb7">CalculateConservationError</a>;
<a name="l00059"></a>00059   solver-&gt;<a class="code" href="a00015.html#a228697ae6a0f0fe7a928a9ddad45da54">NonlinearInterp</a>             = <a class="code" href="a00104.html#a72a765174f8397b09ea5632b33c2563e">NonLinearInterpolation</a>;
<a name="l00060"></a>00060 
<a name="l00061"></a>00061   <span class="comment">/* choose the type of parabolic discretization */</span>
<a name="l00062"></a>00062   solver-&gt;<a class="code" href="a00015.html#a75e8be4ea8c1ae2e99fc1e802e69a573">ParabolicFunction</a>         = NULL;
<a name="l00063"></a>00063   solver-&gt;<a class="code" href="a00015.html#a4b350316573a1d93caf01c5f1d43a45f">SecondDerivativePar</a>       = NULL;
<a name="l00064"></a>00064   solver-&gt;<a class="code" href="a00015.html#add4554e1a8a541607b867db7ec38d7a9">FirstDerivativePar</a>        = NULL;
<a name="l00065"></a>00065   solver-&gt;<a class="code" href="a00015.html#a13a0f9420009a55a3689f407a2c8efea">InterpolateInterfacesPar</a>  = NULL;
<a name="l00066"></a>00066   <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#ad45d57b33d578bf602574a221bf53d93">spatial_type_par</a>,<a class="code" href="a00039.html#a18ee8cd9b4297a259b08aa4cdfe30aa1">_NC_1STAGE_</a>)) {
<a name="l00067"></a>00067     solver-&gt;<a class="code" href="a00015.html#a75e8be4ea8c1ae2e99fc1e802e69a573">ParabolicFunction</a> = <a class="code" href="a00033.html#ac018abe1663638bf7fb3c955728fb9d1">ParabolicFunctionNC1Stage</a>;
<a name="l00068"></a>00068     <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#a170f2f6cc8ac86b78fcb376c2392e290">spatial_scheme_par</a>,<a class="code" href="a00038.html#a89694dcc7c48314c98b9636759bb8bee">_SECOND_ORDER_CENTRAL_</a>)) {
<a name="l00069"></a>00069       solver-&gt;<a class="code" href="a00015.html#a4b350316573a1d93caf01c5f1d43a45f">SecondDerivativePar</a>      = <a class="code" href="a00060.html#a36b168a9f6846e2b4bc027989c8f3e65">SecondDerivativeSecondOrderCentral</a>; 
<a name="l00070"></a>00070     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#a170f2f6cc8ac86b78fcb376c2392e290">spatial_scheme_par</a>,<a class="code" href="a00038.html#aac4d00dd8bef7592948a7e563021c02a">_FOURTH_ORDER_CENTRAL_</a>)) {
<a name="l00071"></a>00071       solver-&gt;<a class="code" href="a00015.html#a4b350316573a1d93caf01c5f1d43a45f">SecondDerivativePar</a>      = <a class="code" href="a00060.html#a7fa2be45147cb91831760e66b631e15c">SecondDerivativeFourthOrderCentral</a>; 
<a name="l00072"></a>00072     } <span class="keywordflow">else</span> {
<a name="l00073"></a>00073       fprintf(stderr,<span class="stringliteral">&quot;Error: %s is not a supported &quot;</span>,solver-&gt;<a class="code" href="a00015.html#a170f2f6cc8ac86b78fcb376c2392e290">spatial_scheme_par</a>);
<a name="l00074"></a>00074       fprintf(stderr,<span class="stringliteral">&quot;spatial scheme of type %s for the parabolic terms.\n&quot;</span>,
<a name="l00075"></a>00075             solver-&gt;<a class="code" href="a00015.html#ad45d57b33d578bf602574a221bf53d93">spatial_type_par</a>);
<a name="l00076"></a>00076     }
<a name="l00077"></a>00077   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#ad45d57b33d578bf602574a221bf53d93">spatial_type_par</a>,<a class="code" href="a00039.html#a9f4de86b900c9aa5f097c2746e17612a">_NC_2STAGE_</a>)) {
<a name="l00078"></a>00078     solver-&gt;<a class="code" href="a00015.html#a75e8be4ea8c1ae2e99fc1e802e69a573">ParabolicFunction</a> = <a class="code" href="a00104.html#a9f5c8ed9c587aa71c9f75209222ad67c">ParabolicFunctionNC2Stage</a>;
<a name="l00079"></a>00079     <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#a170f2f6cc8ac86b78fcb376c2392e290">spatial_scheme_par</a>,<a class="code" href="a00038.html#a89694dcc7c48314c98b9636759bb8bee">_SECOND_ORDER_CENTRAL_</a>)) {
<a name="l00080"></a>00080       solver-&gt;<a class="code" href="a00015.html#add4554e1a8a541607b867db7ec38d7a9">FirstDerivativePar</a>       = <a class="code" href="a00038.html#ad06a8db0245d2502016fb6c7b77ef37f">FirstDerivativeFirstOrder</a>; 
<a name="l00081"></a>00081       <span class="comment">/* why first order? see ParabolicFunctionNC2Stage.c. 2nd order central</span>
<a name="l00082"></a>00082 <span class="comment">         approximation to the 2nd derivative can be expressed as a conjugation</span>
<a name="l00083"></a>00083 <span class="comment">         of 1st order approximations to the 1st derivative (one forward and </span>
<a name="l00084"></a>00084 <span class="comment">         one backward) -- this prevents odd-even decoupling */</span> 
<a name="l00085"></a>00085     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#a170f2f6cc8ac86b78fcb376c2392e290">spatial_scheme_par</a>,<a class="code" href="a00038.html#aac4d00dd8bef7592948a7e563021c02a">_FOURTH_ORDER_CENTRAL_</a>)) {
<a name="l00086"></a>00086       solver-&gt;<a class="code" href="a00015.html#add4554e1a8a541607b867db7ec38d7a9">FirstDerivativePar</a>       = <a class="code" href="a00038.html#a08c28e6bc4493172df7b7867e1f3d815">FirstDerivativeFourthOrderCentral</a>; 
<a name="l00087"></a>00087       <span class="comment">/* why 4th order? I could not derive the decomposition of the </span>
<a name="l00088"></a>00088 <span class="comment">         4th order central approximation to the 2nd derivative! Some problems</span>
<a name="l00089"></a>00089 <span class="comment">         may show odd-even decoupling */</span> 
<a name="l00090"></a>00090     } <span class="keywordflow">else</span> {
<a name="l00091"></a>00091       fprintf(stderr,<span class="stringliteral">&quot;Error: %s is not a supported &quot;</span>,solver-&gt;<a class="code" href="a00015.html#a170f2f6cc8ac86b78fcb376c2392e290">spatial_scheme_par</a>);
<a name="l00092"></a>00092       fprintf(stderr,<span class="stringliteral">&quot;spatial scheme of type %s for the parabolic terms.\n&quot;</span>,
<a name="l00093"></a>00093             solver-&gt;<a class="code" href="a00015.html#ad45d57b33d578bf602574a221bf53d93">spatial_type_par</a>);
<a name="l00094"></a>00094     }
<a name="l00095"></a>00095   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#ad45d57b33d578bf602574a221bf53d93">spatial_type_par</a>,<a class="code" href="a00039.html#a7bc6f9c42df5610bc5d844ad95c74fb8">_NC_1_5STAGE_</a>)) {
<a name="l00096"></a>00096     solver-&gt;<a class="code" href="a00015.html#a75e8be4ea8c1ae2e99fc1e802e69a573">ParabolicFunction</a> = <a class="code" href="a00104.html#aedd832fdf4002f675da44a840e132456">ParabolicFunctionNC1_5Stage</a>;
<a name="l00097"></a>00097     <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#a170f2f6cc8ac86b78fcb376c2392e290">spatial_scheme_par</a>,<a class="code" href="a00038.html#a89694dcc7c48314c98b9636759bb8bee">_SECOND_ORDER_CENTRAL_</a>)) {
<a name="l00098"></a>00098       solver-&gt;<a class="code" href="a00015.html#add4554e1a8a541607b867db7ec38d7a9">FirstDerivativePar</a>       = <a class="code" href="a00038.html#a27d213967bae3d2b969d07a967525541">FirstDerivativeSecondOrderCentral</a>; 
<a name="l00099"></a>00099       solver-&gt;<a class="code" href="a00015.html#a4b350316573a1d93caf01c5f1d43a45f">SecondDerivativePar</a>      = <a class="code" href="a00060.html#a36b168a9f6846e2b4bc027989c8f3e65">SecondDerivativeSecondOrderCentral</a>; 
<a name="l00100"></a>00100     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#a170f2f6cc8ac86b78fcb376c2392e290">spatial_scheme_par</a>,<a class="code" href="a00038.html#aac4d00dd8bef7592948a7e563021c02a">_FOURTH_ORDER_CENTRAL_</a>)) {
<a name="l00101"></a>00101       solver-&gt;<a class="code" href="a00015.html#add4554e1a8a541607b867db7ec38d7a9">FirstDerivativePar</a>       = <a class="code" href="a00038.html#a08c28e6bc4493172df7b7867e1f3d815">FirstDerivativeFourthOrderCentral</a>; 
<a name="l00102"></a>00102       solver-&gt;<a class="code" href="a00015.html#a4b350316573a1d93caf01c5f1d43a45f">SecondDerivativePar</a>      = <a class="code" href="a00060.html#a7fa2be45147cb91831760e66b631e15c">SecondDerivativeFourthOrderCentral</a>; 
<a name="l00103"></a>00103     } <span class="keywordflow">else</span> {
<a name="l00104"></a>00104       fprintf(stderr,<span class="stringliteral">&quot;Error: %s is not a supported &quot;</span>,solver-&gt;<a class="code" href="a00015.html#a170f2f6cc8ac86b78fcb376c2392e290">spatial_scheme_par</a>);
<a name="l00105"></a>00105       fprintf(stderr,<span class="stringliteral">&quot;spatial scheme of type %s for the parabolic terms.\n&quot;</span>,
<a name="l00106"></a>00106             solver-&gt;<a class="code" href="a00015.html#ad45d57b33d578bf602574a221bf53d93">spatial_type_par</a>);
<a name="l00107"></a>00107     }
<a name="l00108"></a>00108   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#ad45d57b33d578bf602574a221bf53d93">spatial_type_par</a>,<a class="code" href="a00039.html#aabd653aa5d489ae2d0d8140290f6f026">_CONS_1STAGE_</a>)) {
<a name="l00109"></a>00109     solver-&gt;<a class="code" href="a00015.html#a75e8be4ea8c1ae2e99fc1e802e69a573">ParabolicFunction</a> = <a class="code" href="a00033.html#a62d59663e168051efcb7306776473ecb">ParabolicFunctionCons1Stage</a>;
<a name="l00110"></a>00110     <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#a170f2f6cc8ac86b78fcb376c2392e290">spatial_scheme_par</a>,<a class="code" href="a00038.html#a89694dcc7c48314c98b9636759bb8bee">_SECOND_ORDER_CENTRAL_</a>)) {
<a name="l00111"></a>00111       solver-&gt;<a class="code" href="a00015.html#a13a0f9420009a55a3689f407a2c8efea">InterpolateInterfacesPar</a> = <a class="code" href="a00041.html#ae8bfe856abd743f5af925dc03e708ee3" title="2nd order component-wise interpolation of the 2nd primitive on a uniform grid">Interp2PrimSecondOrder</a>; 
<a name="l00112"></a>00112     } <span class="keywordflow">else</span> {
<a name="l00113"></a>00113       fprintf(stderr,<span class="stringliteral">&quot;Error: %s is not a supported &quot;</span>,solver-&gt;<a class="code" href="a00015.html#a170f2f6cc8ac86b78fcb376c2392e290">spatial_scheme_par</a>);
<a name="l00114"></a>00114       fprintf(stderr,<span class="stringliteral">&quot;spatial scheme of type %s for the parabolic terms.\n&quot;</span>,
<a name="l00115"></a>00115             solver-&gt;<a class="code" href="a00015.html#ad45d57b33d578bf602574a221bf53d93">spatial_type_par</a>);
<a name="l00116"></a>00116     }
<a name="l00117"></a>00117   } <span class="keywordflow">else</span> {
<a name="l00118"></a>00118     fprintf(stderr,<span class="stringliteral">&quot;Error: %s is not a supported &quot;</span>,solver-&gt;<a class="code" href="a00015.html#ad45d57b33d578bf602574a221bf53d93">spatial_type_par</a>);
<a name="l00119"></a>00119     fprintf(stderr,<span class="stringliteral">&quot;spatial discretization type for the parabolic terms.\n&quot;</span>);
<a name="l00120"></a>00120     <span class="keywordflow">return</span>(1);
<a name="l00121"></a>00121   }
<a name="l00122"></a>00122 
<a name="l00123"></a>00123   <span class="comment">/* Spatial interpolation for hyperbolic term */</span>
<a name="l00124"></a>00124   solver-&gt;<a class="code" href="a00015.html#a29c46b81ad574e4dfbad5a7211487dcb">interp</a>                = NULL;
<a name="l00125"></a>00125   solver-&gt;<a class="code" href="a00015.html#a56318721d534e74a96b440f8542a0232">compact</a>               = NULL;
<a name="l00126"></a>00126   solver-&gt;<a class="code" href="a00015.html#a1dbfa1e479a373073b6ebf72401a7f0f">lusolver</a>              = NULL;
<a name="l00127"></a>00127   solver-&gt;<a class="code" href="a00015.html#afeeb150a9699ade5eccc7589fcae3fe0">SetInterpLimiterVar</a>   = NULL;
<a name="l00128"></a>00128   solver-&gt;<a class="code" href="a00015.html#a9a61d44b50cc9043a19bdc3c0f591d99">flag_nonlinearinterp</a>  = 1;
<a name="l00129"></a>00129   <span class="keywordflow">if</span> (strcmp(solver-&gt;<a class="code" href="a00015.html#a9591ba0fadb863561474e2ba251d2594">interp_type</a>,<a class="code" href="a00041.html#aa7752b40155314f9f2c063d4d9d8339d">_CHARACTERISTIC_</a>) &amp;&amp; strcmp(solver-&gt;<a class="code" href="a00015.html#a9591ba0fadb863561474e2ba251d2594">interp_type</a>,<a class="code" href="a00041.html#ac1f614645aa891fde12c0ce4354de45d">_COMPONENTS_</a>)) {
<a name="l00130"></a>00130     fprintf(stderr,<span class="stringliteral">&quot;Error in InitializeSolvers(): %s is not a &quot;</span>,solver-&gt;<a class="code" href="a00015.html#a9591ba0fadb863561474e2ba251d2594">interp_type</a>);
<a name="l00131"></a>00131     fprintf(stderr,<span class="stringliteral">&quot;supported interpolation type.\n&quot;</span>);
<a name="l00132"></a>00132     <span class="keywordflow">return</span>(1);
<a name="l00133"></a>00133   }
<a name="l00134"></a>00134   <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#ad29846eeb9c83b329a8d7c1fe69d46b2">spatial_scheme_hyp</a>,<a class="code" href="a00041.html#a19cc54d502757bfed14b373b443f144c">_FIRST_ORDER_UPWIND_</a>)) {
<a name="l00135"></a>00135 
<a name="l00136"></a>00136     <span class="comment">/* First order upwind scheme */</span>
<a name="l00137"></a>00137     <span class="keywordflow">if</span> ((solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a> &gt; 1) &amp;&amp; (!strcmp(solver-&gt;<a class="code" href="a00015.html#a9591ba0fadb863561474e2ba251d2594">interp_type</a>,<a class="code" href="a00041.html#aa7752b40155314f9f2c063d4d9d8339d">_CHARACTERISTIC_</a>))) {
<a name="l00138"></a>00138       solver-&gt;<a class="code" href="a00015.html#a17e1cfc7de4fe33c6ee88f2cc42883e7">InterpolateInterfacesHyp</a> = <a class="code" href="a00041.html#a759e07ba8a484c2c6971fc7c6a81a95a" title="1st order upwind reconstruction (characteristic-based) on a uniform grid">Interp1PrimFirstOrderUpwindChar</a>;
<a name="l00139"></a>00139     } <span class="keywordflow">else</span> {
<a name="l00140"></a>00140       solver-&gt;<a class="code" href="a00015.html#a17e1cfc7de4fe33c6ee88f2cc42883e7">InterpolateInterfacesHyp</a> = <a class="code" href="a00041.html#a0a067c9c4745556845b9bcb7f049b59b" title="1st order upwind reconstruction (component-wise) on a uniform grid">Interp1PrimFirstOrderUpwind</a>;
<a name="l00141"></a>00141     }
<a name="l00142"></a>00142 
<a name="l00143"></a>00143   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#ad29846eeb9c83b329a8d7c1fe69d46b2">spatial_scheme_hyp</a>,<a class="code" href="a00038.html#a89694dcc7c48314c98b9636759bb8bee">_SECOND_ORDER_CENTRAL_</a>)) {
<a name="l00144"></a>00144 
<a name="l00145"></a>00145     <span class="comment">/* Second order central scheme */</span>
<a name="l00146"></a>00146     <span class="keywordflow">if</span> ((solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a> &gt; 1) &amp;&amp; (!strcmp(solver-&gt;<a class="code" href="a00015.html#a9591ba0fadb863561474e2ba251d2594">interp_type</a>,<a class="code" href="a00041.html#aa7752b40155314f9f2c063d4d9d8339d">_CHARACTERISTIC_</a>))) {
<a name="l00147"></a>00147       solver-&gt;<a class="code" href="a00015.html#a17e1cfc7de4fe33c6ee88f2cc42883e7">InterpolateInterfacesHyp</a> = <a class="code" href="a00041.html#a963c82116a2a1d6084af3d519b61b896" title="2nd order central reconstruction (characteristic-based) on a uniform grid">Interp1PrimSecondOrderCentralChar</a>;
<a name="l00148"></a>00148     } <span class="keywordflow">else</span> {
<a name="l00149"></a>00149       solver-&gt;<a class="code" href="a00015.html#a17e1cfc7de4fe33c6ee88f2cc42883e7">InterpolateInterfacesHyp</a> = <a class="code" href="a00041.html#a697d5c94aa331054c5286492e7fa39c7" title="2nd order central reconstruction (component-wise) on a uniform grid">Interp1PrimSecondOrderCentral</a>;
<a name="l00150"></a>00150     }
<a name="l00151"></a>00151 
<a name="l00152"></a>00152   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#ad29846eeb9c83b329a8d7c1fe69d46b2">spatial_scheme_hyp</a>,<a class="code" href="a00041.html#a21f7f383e497570fcb71c43f243539d3">_THIRD_ORDER_MUSCL_</a>)) {
<a name="l00153"></a>00153 
<a name="l00154"></a>00154     <span class="comment">/* Third order MUSCL scheme */</span>
<a name="l00155"></a>00155     <span class="keywordflow">if</span> ((solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a> &gt; 1) &amp;&amp; (!strcmp(solver-&gt;<a class="code" href="a00015.html#a9591ba0fadb863561474e2ba251d2594">interp_type</a>,<a class="code" href="a00041.html#aa7752b40155314f9f2c063d4d9d8339d">_CHARACTERISTIC_</a>))) {
<a name="l00156"></a>00156       solver-&gt;<a class="code" href="a00015.html#a17e1cfc7de4fe33c6ee88f2cc42883e7">InterpolateInterfacesHyp</a> = <a class="code" href="a00041.html#a985d08c4fb9bcb71875c697f9e00d6eb" title="3rd order MUSCL scheme with Koren&amp;#39;s limiter (characteristic-based) on a uniform...">Interp1PrimThirdOrderMUSCLChar</a>;
<a name="l00157"></a>00157     } <span class="keywordflow">else</span> {
<a name="l00158"></a>00158       solver-&gt;<a class="code" href="a00015.html#a17e1cfc7de4fe33c6ee88f2cc42883e7">InterpolateInterfacesHyp</a> = <a class="code" href="a00041.html#ae7eb6a81a164ca0fa2ace3cab2697847" title="3rd order MUSCL scheme with Koren&amp;#39;s limiter (component-wise) on a uniform grid...">Interp1PrimThirdOrderMUSCL</a>;
<a name="l00159"></a>00159     }
<a name="l00160"></a>00160     solver-&gt;<a class="code" href="a00015.html#a29c46b81ad574e4dfbad5a7211487dcb">interp</a> = (<a class="code" href="a00020.html" title="Structure of variables/parameters needed by the MUSCL scheme.">MUSCLParameters</a>*) calloc(1,<span class="keyword">sizeof</span>(<a class="code" href="a00020.html" title="Structure of variables/parameters needed by the MUSCL scheme.">MUSCLParameters</a>));
<a name="l00161"></a>00161     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00041.html#a22e0ae19117192cae9978a7a741d15a5">MUSCLInitialize</a>(solver-&gt;<a class="code" href="a00015.html#a29c46b81ad574e4dfbad5a7211487dcb">interp</a>,mpi); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00162"></a>00162 
<a name="l00163"></a>00163   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#ad29846eeb9c83b329a8d7c1fe69d46b2">spatial_scheme_hyp</a>,<a class="code" href="a00041.html#a7bc4a755992e5f68efe365591b7a2c02">_FIFTH_ORDER_UPWIND_</a>)) {
<a name="l00164"></a>00164 
<a name="l00165"></a>00165     <span class="comment">/* Fifth order upwind scheme */</span>
<a name="l00166"></a>00166     <span class="keywordflow">if</span> ((solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a> &gt; 1) &amp;&amp; (!strcmp(solver-&gt;<a class="code" href="a00015.html#a9591ba0fadb863561474e2ba251d2594">interp_type</a>,<a class="code" href="a00041.html#aa7752b40155314f9f2c063d4d9d8339d">_CHARACTERISTIC_</a>))) {
<a name="l00167"></a>00167       solver-&gt;<a class="code" href="a00015.html#a17e1cfc7de4fe33c6ee88f2cc42883e7">InterpolateInterfacesHyp</a> = <a class="code" href="a00041.html#ade9ece6e934d70cdf29090494440f505" title="5th order upwind reconstruction (characteristic-based) on a uniform grid">Interp1PrimFifthOrderUpwindChar</a>;
<a name="l00168"></a>00168     } <span class="keywordflow">else</span> {
<a name="l00169"></a>00169       solver-&gt;<a class="code" href="a00015.html#a17e1cfc7de4fe33c6ee88f2cc42883e7">InterpolateInterfacesHyp</a> = <a class="code" href="a00041.html#aea7c973ffe0c37bca0703c1bf6175aaa" title="5th order upwind reconstruction (component-wise) on a uniform grid">Interp1PrimFifthOrderUpwind</a>;
<a name="l00170"></a>00170     }
<a name="l00171"></a>00171 
<a name="l00172"></a>00172   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#ad29846eeb9c83b329a8d7c1fe69d46b2">spatial_scheme_hyp</a>,<a class="code" href="a00041.html#ae832e2314ee85139cec9df4ea82aafa2">_FIFTH_ORDER_COMPACT_UPWIND_</a>)) {
<a name="l00173"></a>00173 
<a name="l00174"></a>00174     <span class="comment">/* Fifth order compact upwind scheme */</span>
<a name="l00175"></a>00175     <span class="keywordflow">if</span> ((solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a> &gt; 1) &amp;&amp; (!strcmp(solver-&gt;<a class="code" href="a00015.html#a9591ba0fadb863561474e2ba251d2594">interp_type</a>,<a class="code" href="a00041.html#aa7752b40155314f9f2c063d4d9d8339d">_CHARACTERISTIC_</a>))) {
<a name="l00176"></a>00176       solver-&gt;<a class="code" href="a00015.html#a17e1cfc7de4fe33c6ee88f2cc42883e7">InterpolateInterfacesHyp</a> = <a class="code" href="a00041.html#a28b8d3ce17676cec19de4f91f989042d" title="5th order compact upwind reconstruction (characteristic-based) on a uniform grid">Interp1PrimFifthOrderCompactUpwindChar</a>;
<a name="l00177"></a>00177     } <span class="keywordflow">else</span> {
<a name="l00178"></a>00178       solver-&gt;<a class="code" href="a00015.html#a17e1cfc7de4fe33c6ee88f2cc42883e7">InterpolateInterfacesHyp</a> = <a class="code" href="a00041.html#a3ac2a77b9fa5a50499c285e49cf91344" title="5th order compact upwind reconstruction (component-wise) on a uniform grid">Interp1PrimFifthOrderCompactUpwind</a>;
<a name="l00179"></a>00179     }
<a name="l00180"></a>00180     solver-&gt;<a class="code" href="a00015.html#a56318721d534e74a96b440f8542a0232">compact</a> = (<a class="code" href="a00003.html" title="Structure of variables/parameters needed by the compact schemes.">CompactScheme</a>*) calloc(1,<span class="keyword">sizeof</span>(<a class="code" href="a00003.html" title="Structure of variables/parameters needed by the compact schemes.">CompactScheme</a>));
<a name="l00181"></a>00181     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00041.html#af255a582e14c5820cf12f9f95b4e28fd">CompactSchemeInitialize</a>(solver,mpi,solver-&gt;<a class="code" href="a00015.html#a9591ba0fadb863561474e2ba251d2594">interp_type</a>);
<a name="l00182"></a>00182     solver-&gt;<a class="code" href="a00015.html#a1dbfa1e479a373073b6ebf72401a7f0f">lusolver</a> = (<a class="code" href="a00029.html">TridiagLU</a>*) calloc (1,<span class="keyword">sizeof</span>(<a class="code" href="a00029.html">TridiagLU</a>));
<a name="l00183"></a>00183     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00062.html#a52d21dfe1d76916811879bf0d7a29d72">tridiagLUInit</a>(solver-&gt;<a class="code" href="a00015.html#a1dbfa1e479a373073b6ebf72401a7f0f">lusolver</a>,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);<a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00184"></a>00184 
<a name="l00185"></a>00185   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#ad29846eeb9c83b329a8d7c1fe69d46b2">spatial_scheme_hyp</a>,<a class="code" href="a00041.html#acfeff1b158131390b7129f4a857b15ff">_FIFTH_ORDER_WENO_</a>)) {
<a name="l00186"></a>00186 
<a name="l00187"></a>00187     <span class="comment">/* Fifth order WENO scheme */</span>
<a name="l00188"></a>00188     <span class="keywordflow">if</span> ((solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a> &gt; 1) &amp;&amp; (!strcmp(solver-&gt;<a class="code" href="a00015.html#a9591ba0fadb863561474e2ba251d2594">interp_type</a>,<a class="code" href="a00041.html#aa7752b40155314f9f2c063d4d9d8339d">_CHARACTERISTIC_</a>))) {
<a name="l00189"></a>00189       solver-&gt;<a class="code" href="a00015.html#a17e1cfc7de4fe33c6ee88f2cc42883e7">InterpolateInterfacesHyp</a> = <a class="code" href="a00041.html#abf3b032fdc8c0e84b86909db9e0b93c3" title="5th order WENO reconstruction (characteristic-based) on a uniform grid">Interp1PrimFifthOrderWENOChar</a>;
<a name="l00190"></a>00190     } <span class="keywordflow">else</span> {
<a name="l00191"></a>00191       solver-&gt;<a class="code" href="a00015.html#a17e1cfc7de4fe33c6ee88f2cc42883e7">InterpolateInterfacesHyp</a> = <a class="code" href="a00041.html#af2195885ad055989a1b2b11655843343" title="5th order WENO reconstruction (component-wise) on a uniform grid">Interp1PrimFifthOrderWENO</a>;
<a name="l00192"></a>00192     }
<a name="l00193"></a>00193     solver-&gt;<a class="code" href="a00015.html#a29c46b81ad574e4dfbad5a7211487dcb">interp</a> = (<a class="code" href="a00030.html" title="Structure of variables/parameters needed by the WENO-type scheme.">WENOParameters</a>*) calloc(1,<span class="keyword">sizeof</span>(<a class="code" href="a00030.html" title="Structure of variables/parameters needed by the WENO-type scheme.">WENOParameters</a>));
<a name="l00194"></a>00194     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00041.html#aecbe557b2ccc254cdbbd312fc91717be">WENOInitialize</a>(solver,mpi,solver-&gt;<a class="code" href="a00015.html#ad29846eeb9c83b329a8d7c1fe69d46b2">spatial_scheme_hyp</a>,solver-&gt;<a class="code" href="a00015.html#a9591ba0fadb863561474e2ba251d2594">interp_type</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00195"></a>00195     solver-&gt;<a class="code" href="a00015.html#a9a61d44b50cc9043a19bdc3c0f591d99">flag_nonlinearinterp</a> = !(((<a class="code" href="a00030.html" title="Structure of variables/parameters needed by the WENO-type scheme.">WENOParameters</a>*)solver-&gt;<a class="code" href="a00015.html#a29c46b81ad574e4dfbad5a7211487dcb">interp</a>)-&gt;no_limiting);
<a name="l00196"></a>00196 
<a name="l00197"></a>00197   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#ad29846eeb9c83b329a8d7c1fe69d46b2">spatial_scheme_hyp</a>,<a class="code" href="a00041.html#a175a82b8ae2b24c0ba51e1b1dd68c0e5">_FIFTH_ORDER_CRWENO_</a>)) {
<a name="l00198"></a>00198 
<a name="l00199"></a>00199     <span class="comment">/* Fifth order CRWENO scheme */</span>
<a name="l00200"></a>00200     <span class="keywordflow">if</span> ((solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a> &gt; 1) &amp;&amp; (!strcmp(solver-&gt;<a class="code" href="a00015.html#a9591ba0fadb863561474e2ba251d2594">interp_type</a>,<a class="code" href="a00041.html#aa7752b40155314f9f2c063d4d9d8339d">_CHARACTERISTIC_</a>))) {
<a name="l00201"></a>00201       solver-&gt;<a class="code" href="a00015.html#a17e1cfc7de4fe33c6ee88f2cc42883e7">InterpolateInterfacesHyp</a> = <a class="code" href="a00041.html#ae2b27971cc952cf3b4959128bef6174b" title="5th order CRWENO reconstruction (characteristic-based) on a uniform grid">Interp1PrimFifthOrderCRWENOChar</a>;
<a name="l00202"></a>00202     } <span class="keywordflow">else</span> {
<a name="l00203"></a>00203       solver-&gt;<a class="code" href="a00015.html#a17e1cfc7de4fe33c6ee88f2cc42883e7">InterpolateInterfacesHyp</a> = <a class="code" href="a00041.html#a33b1e24c12129941b0027a83c543a654" title="5th order CRWENO reconstruction (component-wise) on a uniform grid">Interp1PrimFifthOrderCRWENO</a>;
<a name="l00204"></a>00204     }
<a name="l00205"></a>00205     solver-&gt;<a class="code" href="a00015.html#a29c46b81ad574e4dfbad5a7211487dcb">interp</a> = (<a class="code" href="a00030.html" title="Structure of variables/parameters needed by the WENO-type scheme.">WENOParameters</a>*) calloc(1,<span class="keyword">sizeof</span>(<a class="code" href="a00030.html" title="Structure of variables/parameters needed by the WENO-type scheme.">WENOParameters</a>));
<a name="l00206"></a>00206     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00041.html#aecbe557b2ccc254cdbbd312fc91717be">WENOInitialize</a>(solver,mpi,solver-&gt;<a class="code" href="a00015.html#ad29846eeb9c83b329a8d7c1fe69d46b2">spatial_scheme_hyp</a>,solver-&gt;<a class="code" href="a00015.html#a9591ba0fadb863561474e2ba251d2594">interp_type</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00207"></a>00207     solver-&gt;<a class="code" href="a00015.html#a9a61d44b50cc9043a19bdc3c0f591d99">flag_nonlinearinterp</a> = !(((<a class="code" href="a00030.html" title="Structure of variables/parameters needed by the WENO-type scheme.">WENOParameters</a>*)solver-&gt;<a class="code" href="a00015.html#a29c46b81ad574e4dfbad5a7211487dcb">interp</a>)-&gt;no_limiting);
<a name="l00208"></a>00208     solver-&gt;<a class="code" href="a00015.html#a56318721d534e74a96b440f8542a0232">compact</a> = (<a class="code" href="a00003.html" title="Structure of variables/parameters needed by the compact schemes.">CompactScheme</a>*) calloc(1,<span class="keyword">sizeof</span>(<a class="code" href="a00003.html" title="Structure of variables/parameters needed by the compact schemes.">CompactScheme</a>));
<a name="l00209"></a>00209     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00041.html#af255a582e14c5820cf12f9f95b4e28fd">CompactSchemeInitialize</a>(solver,mpi,solver-&gt;<a class="code" href="a00015.html#a9591ba0fadb863561474e2ba251d2594">interp_type</a>);
<a name="l00210"></a>00210     solver-&gt;<a class="code" href="a00015.html#a1dbfa1e479a373073b6ebf72401a7f0f">lusolver</a> = (<a class="code" href="a00029.html">TridiagLU</a>*) calloc (1,<span class="keyword">sizeof</span>(<a class="code" href="a00029.html">TridiagLU</a>));
<a name="l00211"></a>00211     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00062.html#a52d21dfe1d76916811879bf0d7a29d72">tridiagLUInit</a>(solver-&gt;<a class="code" href="a00015.html#a1dbfa1e479a373073b6ebf72401a7f0f">lusolver</a>,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);<a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00212"></a>00212 
<a name="l00213"></a>00213   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#ad29846eeb9c83b329a8d7c1fe69d46b2">spatial_scheme_hyp</a>,<a class="code" href="a00041.html#a6d34f5e8aae80a0d2a27ea20368dfef1">_FIFTH_ORDER_HCWENO_</a>)) {
<a name="l00214"></a>00214 
<a name="l00215"></a>00215     <span class="comment">/* Fifth order HCWENO scheme */</span>
<a name="l00216"></a>00216     <span class="keywordflow">if</span> ((solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a> &gt; 1) &amp;&amp; (!strcmp(solver-&gt;<a class="code" href="a00015.html#a9591ba0fadb863561474e2ba251d2594">interp_type</a>,<a class="code" href="a00041.html#aa7752b40155314f9f2c063d4d9d8339d">_CHARACTERISTIC_</a>))) {
<a name="l00217"></a>00217       solver-&gt;<a class="code" href="a00015.html#a17e1cfc7de4fe33c6ee88f2cc42883e7">InterpolateInterfacesHyp</a> = <a class="code" href="a00041.html#a91fbe118c8c01fe1d5efa3cea4930589" title="5th order hybrid compact-WENO reconstruction (characteristic-based) on a uniform...">Interp1PrimFifthOrderHCWENOChar</a>;
<a name="l00218"></a>00218     } <span class="keywordflow">else</span> {
<a name="l00219"></a>00219       solver-&gt;<a class="code" href="a00015.html#a17e1cfc7de4fe33c6ee88f2cc42883e7">InterpolateInterfacesHyp</a> = <a class="code" href="a00041.html#ad9c611137cfce1c622c2e9838fb523c8" title="5th order hybrid compact-WENO reconstruction (component-wise) on a uniform grid">Interp1PrimFifthOrderHCWENO</a>;
<a name="l00220"></a>00220     }
<a name="l00221"></a>00221     solver-&gt;<a class="code" href="a00015.html#a29c46b81ad574e4dfbad5a7211487dcb">interp</a> = (<a class="code" href="a00030.html" title="Structure of variables/parameters needed by the WENO-type scheme.">WENOParameters</a>*) calloc(1,<span class="keyword">sizeof</span>(<a class="code" href="a00030.html" title="Structure of variables/parameters needed by the WENO-type scheme.">WENOParameters</a>));
<a name="l00222"></a>00222     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00041.html#aecbe557b2ccc254cdbbd312fc91717be">WENOInitialize</a>(solver,mpi,solver-&gt;<a class="code" href="a00015.html#ad29846eeb9c83b329a8d7c1fe69d46b2">spatial_scheme_hyp</a>,solver-&gt;<a class="code" href="a00015.html#a9591ba0fadb863561474e2ba251d2594">interp_type</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00223"></a>00223     solver-&gt;<a class="code" href="a00015.html#a9a61d44b50cc9043a19bdc3c0f591d99">flag_nonlinearinterp</a> = !(((<a class="code" href="a00030.html" title="Structure of variables/parameters needed by the WENO-type scheme.">WENOParameters</a>*)solver-&gt;<a class="code" href="a00015.html#a29c46b81ad574e4dfbad5a7211487dcb">interp</a>)-&gt;no_limiting);
<a name="l00224"></a>00224     solver-&gt;<a class="code" href="a00015.html#a56318721d534e74a96b440f8542a0232">compact</a> = (<a class="code" href="a00003.html" title="Structure of variables/parameters needed by the compact schemes.">CompactScheme</a>*) calloc(1,<span class="keyword">sizeof</span>(<a class="code" href="a00003.html" title="Structure of variables/parameters needed by the compact schemes.">CompactScheme</a>));
<a name="l00225"></a>00225     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00041.html#af255a582e14c5820cf12f9f95b4e28fd">CompactSchemeInitialize</a>(solver,mpi,solver-&gt;<a class="code" href="a00015.html#a9591ba0fadb863561474e2ba251d2594">interp_type</a>);
<a name="l00226"></a>00226     solver-&gt;<a class="code" href="a00015.html#a1dbfa1e479a373073b6ebf72401a7f0f">lusolver</a> = (<a class="code" href="a00029.html">TridiagLU</a>*) calloc (1,<span class="keyword">sizeof</span>(<a class="code" href="a00029.html">TridiagLU</a>));
<a name="l00227"></a>00227     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00062.html#a52d21dfe1d76916811879bf0d7a29d72">tridiagLUInit</a>(solver-&gt;<a class="code" href="a00015.html#a1dbfa1e479a373073b6ebf72401a7f0f">lusolver</a>,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);<a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00228"></a>00228 
<a name="l00229"></a>00229   } <span class="keywordflow">else</span> {
<a name="l00230"></a>00230     fprintf(stderr,<span class="stringliteral">&quot;Error: %s is a not a supported spatial interpolation scheme.\n&quot;</span>,
<a name="l00231"></a>00231             solver-&gt;<a class="code" href="a00015.html#ad29846eeb9c83b329a8d7c1fe69d46b2">spatial_scheme_hyp</a>);
<a name="l00232"></a>00232     <span class="keywordflow">return</span>(1);
<a name="l00233"></a>00233   }
<a name="l00234"></a>00234 
<a name="l00235"></a>00235   <span class="comment">/* Time integration */</span>
<a name="l00236"></a>00236   solver-&gt;<a class="code" href="a00015.html#a1d36fea92472416e32e039b86dea0b18">time_integrator</a> = NULL;
<a name="l00237"></a>00237 <span class="preprocessor">#ifdef with_petsc</span>
<a name="l00238"></a>00238 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (solver-&gt;<a class="code" href="a00015.html#ad195de8c64c407718e42cda9246be0d2">use_petscTS</a>) {
<a name="l00239"></a>00239     <span class="comment">/* dummy -- not used */</span>
<a name="l00240"></a>00240     solver-&gt;<a class="code" href="a00015.html#a7de550a63022232e0039dc46a08114b0">TimeIntegrate</a> = <a class="code" href="a00061.html#a5fe3d9828c6afcbc00cf6fdd940ebe4b">TimeForwardEuler</a>;
<a name="l00241"></a>00241     solver-&gt;<a class="code" href="a00015.html#adec095311615891040de11341c01a77f">msti</a> = NULL;
<a name="l00242"></a>00242   } <span class="keywordflow">else</span> {
<a name="l00243"></a>00243     <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#a138e751362d14724df8e6ab27c4a5e55">time_scheme</a>,<a class="code" href="a00061.html#af9b1e641532cff8859c5c5a8377f5feb">_FORWARD_EULER_</a>)) { 
<a name="l00244"></a>00244       solver-&gt;<a class="code" href="a00015.html#a7de550a63022232e0039dc46a08114b0">TimeIntegrate</a> = <a class="code" href="a00061.html#a5fe3d9828c6afcbc00cf6fdd940ebe4b">TimeForwardEuler</a>;
<a name="l00245"></a>00245       solver-&gt;<a class="code" href="a00015.html#adec095311615891040de11341c01a77f">msti</a> = NULL;
<a name="l00246"></a>00246     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#a138e751362d14724df8e6ab27c4a5e55">time_scheme</a>,<a class="code" href="a00061.html#a50d4bf1e7e4825cc062fca99a770e5ce">_RK_</a>)) {
<a name="l00247"></a>00247       solver-&gt;<a class="code" href="a00015.html#a7de550a63022232e0039dc46a08114b0">TimeIntegrate</a> = <a class="code" href="a00061.html#aca6ebec6e6998f0c509bb38fa91f3321">TimeRK</a>;
<a name="l00248"></a>00248       solver-&gt;<a class="code" href="a00015.html#adec095311615891040de11341c01a77f">msti</a> = (<a class="code" href="a00007.html" title="Structure containing the parameters for an explicit Runge-Kutta method.">ExplicitRKParameters</a>*) calloc (1,<span class="keyword">sizeof</span>(<a class="code" href="a00007.html" title="Structure containing the parameters for an explicit Runge-Kutta method.">ExplicitRKParameters</a>));
<a name="l00249"></a>00249       <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00061.html#a966855c31cad0395c350b9a77add7ab8">TimeExplicitRKInitialize</a>(solver-&gt;<a class="code" href="a00015.html#a138e751362d14724df8e6ab27c4a5e55">time_scheme</a>,solver-&gt;<a class="code" href="a00015.html#a61750696383420ba8bcc7d9e44a538e2">time_scheme_type</a>,
<a name="l00250"></a>00250                                     solver-&gt;<a class="code" href="a00015.html#adec095311615891040de11341c01a77f">msti</a>,mpi); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00251"></a>00251     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#a138e751362d14724df8e6ab27c4a5e55">time_scheme</a>,<a class="code" href="a00061.html#aad9619c099daeb3e6b1b7ef9e03e38d8">_GLM_GEE_</a>)) {
<a name="l00252"></a>00252       solver-&gt;<a class="code" href="a00015.html#a7de550a63022232e0039dc46a08114b0">TimeIntegrate</a> = <a class="code" href="a00061.html#a7b76988ab950d39d505042dc1f09b875">TimeGLMGEE</a>;
<a name="l00253"></a>00253       solver-&gt;<a class="code" href="a00015.html#adec095311615891040de11341c01a77f">msti</a> = (<a class="code" href="a00014.html" title="Structure containing the parameters for the General Linear Methods with Global Error...">GLMGEEParameters</a>*) calloc (1,<span class="keyword">sizeof</span>(<a class="code" href="a00014.html" title="Structure containing the parameters for the General Linear Methods with Global Error...">GLMGEEParameters</a>));
<a name="l00254"></a>00254       <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00061.html#ad7d778f0d388a120492e4901c3319d51">TimeGLMGEEInitialize</a>(solver-&gt;<a class="code" href="a00015.html#a138e751362d14724df8e6ab27c4a5e55">time_scheme</a>,solver-&gt;<a class="code" href="a00015.html#a61750696383420ba8bcc7d9e44a538e2">time_scheme_type</a>,
<a name="l00255"></a>00255                                 solver-&gt;<a class="code" href="a00015.html#adec095311615891040de11341c01a77f">msti</a>,mpi); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00256"></a>00256     } <span class="keywordflow">else</span> {
<a name="l00257"></a>00257       fprintf(stderr,<span class="stringliteral">&quot;Error: %s is a not a supported time-integration scheme.\n&quot;</span>,
<a name="l00258"></a>00258               solver-&gt;<a class="code" href="a00015.html#a138e751362d14724df8e6ab27c4a5e55">time_scheme</a>);
<a name="l00259"></a>00259       <span class="keywordflow">return</span>(1);
<a name="l00260"></a>00260     }
<a name="l00261"></a>00261   }
<a name="l00262"></a>00262 <span class="preprocessor">#else</span>
<a name="l00263"></a>00263 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#a138e751362d14724df8e6ab27c4a5e55">time_scheme</a>,<a class="code" href="a00061.html#af9b1e641532cff8859c5c5a8377f5feb">_FORWARD_EULER_</a>)) { 
<a name="l00264"></a>00264     solver-&gt;<a class="code" href="a00015.html#a7de550a63022232e0039dc46a08114b0">TimeIntegrate</a> = <a class="code" href="a00061.html#a5fe3d9828c6afcbc00cf6fdd940ebe4b">TimeForwardEuler</a>;
<a name="l00265"></a>00265     solver-&gt;<a class="code" href="a00015.html#adec095311615891040de11341c01a77f">msti</a> = NULL;
<a name="l00266"></a>00266   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#a138e751362d14724df8e6ab27c4a5e55">time_scheme</a>,<a class="code" href="a00061.html#a50d4bf1e7e4825cc062fca99a770e5ce">_RK_</a>)) {
<a name="l00267"></a>00267     solver-&gt;<a class="code" href="a00015.html#a7de550a63022232e0039dc46a08114b0">TimeIntegrate</a> = <a class="code" href="a00061.html#aca6ebec6e6998f0c509bb38fa91f3321">TimeRK</a>;
<a name="l00268"></a>00268     solver-&gt;<a class="code" href="a00015.html#adec095311615891040de11341c01a77f">msti</a> = (<a class="code" href="a00007.html" title="Structure containing the parameters for an explicit Runge-Kutta method.">ExplicitRKParameters</a>*) calloc (1,<span class="keyword">sizeof</span>(<a class="code" href="a00007.html" title="Structure containing the parameters for an explicit Runge-Kutta method.">ExplicitRKParameters</a>));
<a name="l00269"></a>00269     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00061.html#a966855c31cad0395c350b9a77add7ab8">TimeExplicitRKInitialize</a>(solver-&gt;<a class="code" href="a00015.html#a138e751362d14724df8e6ab27c4a5e55">time_scheme</a>,solver-&gt;<a class="code" href="a00015.html#a61750696383420ba8bcc7d9e44a538e2">time_scheme_type</a>,
<a name="l00270"></a>00270                                   solver-&gt;<a class="code" href="a00015.html#adec095311615891040de11341c01a77f">msti</a>,mpi); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00271"></a>00271   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#a138e751362d14724df8e6ab27c4a5e55">time_scheme</a>,<a class="code" href="a00061.html#aad9619c099daeb3e6b1b7ef9e03e38d8">_GLM_GEE_</a>)) {
<a name="l00272"></a>00272     solver-&gt;<a class="code" href="a00015.html#a7de550a63022232e0039dc46a08114b0">TimeIntegrate</a> = <a class="code" href="a00061.html#a7b76988ab950d39d505042dc1f09b875">TimeGLMGEE</a>;
<a name="l00273"></a>00273     solver-&gt;<a class="code" href="a00015.html#adec095311615891040de11341c01a77f">msti</a> = (<a class="code" href="a00014.html" title="Structure containing the parameters for the General Linear Methods with Global Error...">GLMGEEParameters</a>*) calloc (1,<span class="keyword">sizeof</span>(<a class="code" href="a00014.html" title="Structure containing the parameters for the General Linear Methods with Global Error...">GLMGEEParameters</a>));
<a name="l00274"></a>00274     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00061.html#ad7d778f0d388a120492e4901c3319d51">TimeGLMGEEInitialize</a>(solver-&gt;<a class="code" href="a00015.html#a138e751362d14724df8e6ab27c4a5e55">time_scheme</a>,solver-&gt;<a class="code" href="a00015.html#a61750696383420ba8bcc7d9e44a538e2">time_scheme_type</a>,
<a name="l00275"></a>00275                               solver-&gt;<a class="code" href="a00015.html#adec095311615891040de11341c01a77f">msti</a>,mpi); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00276"></a>00276   } <span class="keywordflow">else</span> {
<a name="l00277"></a>00277     fprintf(stderr,<span class="stringliteral">&quot;Error: %s is a not a supported time-integration scheme.\n&quot;</span>,
<a name="l00278"></a>00278             solver-&gt;<a class="code" href="a00015.html#a138e751362d14724df8e6ab27c4a5e55">time_scheme</a>);
<a name="l00279"></a>00279     <span class="keywordflow">return</span>(1);
<a name="l00280"></a>00280   }
<a name="l00281"></a>00281 <span class="preprocessor">#endif</span>
<a name="l00282"></a>00282 <span class="preprocessor"></span>
<a name="l00283"></a>00283   <span class="comment">/* Solution output function */</span>
<a name="l00284"></a>00284   solver-&gt;<a class="code" href="a00015.html#a9018a1befab4079332620f40375a9661">WriteOutput</a>    = NULL; <span class="comment">/* default - no output */</span>
<a name="l00285"></a>00285   solver-&gt;<a class="code" href="a00015.html#a0805db42e429173752189696c3c96909">filename_index</a> = NULL;
<a name="l00286"></a>00286   <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#a5f89e286a9eaffdb66d966fa6a290d3f">output_mode</a>,<span class="stringliteral">&quot;serial&quot;</span>)) {
<a name="l00287"></a>00287     solver-&gt;<a class="code" href="a00015.html#af474ca4577de91b658e4399ad0a6d7b3">index_length</a> = 5;
<a name="l00288"></a>00288     solver-&gt;<a class="code" href="a00015.html#a0805db42e429173752189696c3c96909">filename_index</a> = (<span class="keywordtype">char</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#af474ca4577de91b658e4399ad0a6d7b3">index_length</a>+1,<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
<a name="l00289"></a>00289     <span class="keywordtype">int</span> i; <span class="keywordflow">for</span> (i=0; i&lt;solver-&gt;<a class="code" href="a00015.html#af474ca4577de91b658e4399ad0a6d7b3">index_length</a>; i++) solver-&gt;<a class="code" href="a00015.html#a0805db42e429173752189696c3c96909">filename_index</a>[i] = <span class="charliteral">&apos;0&apos;</span>;
<a name="l00290"></a>00290     solver-&gt;<a class="code" href="a00015.html#a0805db42e429173752189696c3c96909">filename_index</a>[solver-&gt;<a class="code" href="a00015.html#af474ca4577de91b658e4399ad0a6d7b3">index_length</a>] = (<span class="keywordtype">char</span>) 0;
<a name="l00291"></a>00291     <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#a51a3b8c19b86e9e1df5be02b05a6613c">op_file_format</a>,<span class="stringliteral">&quot;text&quot;</span>)) {
<a name="l00292"></a>00292       solver-&gt;<a class="code" href="a00015.html#a9018a1befab4079332620f40375a9661">WriteOutput</a> = <a class="code" href="a00042.html#a3355a71faf3d87f6715ad627db08ac9e">WriteText</a>;
<a name="l00293"></a>00293       strcpy(solver-&gt;<a class="code" href="a00015.html#a25f6a0c8fded2ee6bd9593c737bc3a51">solnfilename_extn</a>,<span class="stringliteral">&quot;.dat&quot;</span>);
<a name="l00294"></a>00294     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#a51a3b8c19b86e9e1df5be02b05a6613c">op_file_format</a>,<span class="stringliteral">&quot;tecplot2d&quot;</span>)) {
<a name="l00295"></a>00295       solver-&gt;<a class="code" href="a00015.html#a9018a1befab4079332620f40375a9661">WriteOutput</a> = <a class="code" href="a00042.html#a265b0583afb79edd2f2f5d5087e5c3bf">WriteTecplot2D</a>;
<a name="l00296"></a>00296       strcpy(solver-&gt;<a class="code" href="a00015.html#a25f6a0c8fded2ee6bd9593c737bc3a51">solnfilename_extn</a>,<span class="stringliteral">&quot;.dat&quot;</span>);
<a name="l00297"></a>00297     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#a51a3b8c19b86e9e1df5be02b05a6613c">op_file_format</a>,<span class="stringliteral">&quot;tecplot3d&quot;</span>)) {
<a name="l00298"></a>00298       solver-&gt;<a class="code" href="a00015.html#a9018a1befab4079332620f40375a9661">WriteOutput</a> = <a class="code" href="a00042.html#a5bdb048ecc5ae7ab61622e4764f3133e">WriteTecplot3D</a>;
<a name="l00299"></a>00299       strcpy(solver-&gt;<a class="code" href="a00015.html#a25f6a0c8fded2ee6bd9593c737bc3a51">solnfilename_extn</a>,<span class="stringliteral">&quot;.dat&quot;</span>);
<a name="l00300"></a>00300     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((!strcmp(solver-&gt;<a class="code" href="a00015.html#a51a3b8c19b86e9e1df5be02b05a6613c">op_file_format</a>,<span class="stringliteral">&quot;binary&quot;</span>)) || (!strcmp(solver-&gt;<a class="code" href="a00015.html#a51a3b8c19b86e9e1df5be02b05a6613c">op_file_format</a>,<span class="stringliteral">&quot;bin&quot;</span>))) {
<a name="l00301"></a>00301       solver-&gt;<a class="code" href="a00015.html#a9018a1befab4079332620f40375a9661">WriteOutput</a> = <a class="code" href="a00042.html#a067f454c26d85d6cfb4d7d878b3783c9">WriteBinary</a>;
<a name="l00302"></a>00302       strcpy(solver-&gt;<a class="code" href="a00015.html#a25f6a0c8fded2ee6bd9593c737bc3a51">solnfilename_extn</a>,<span class="stringliteral">&quot;.bin&quot;</span>);
<a name="l00303"></a>00303     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#a51a3b8c19b86e9e1df5be02b05a6613c">op_file_format</a>,<span class="stringliteral">&quot;none&quot;</span>)) {
<a name="l00304"></a>00304       solver-&gt;<a class="code" href="a00015.html#a9018a1befab4079332620f40375a9661">WriteOutput</a> = NULL;
<a name="l00305"></a>00305     } <span class="keywordflow">else</span> {
<a name="l00306"></a>00306       fprintf(stderr,<span class="stringliteral">&quot;Error: %s is not a supported file format.\n&quot;</span>,solver-&gt;<a class="code" href="a00015.html#a51a3b8c19b86e9e1df5be02b05a6613c">op_file_format</a>);
<a name="l00307"></a>00307       <span class="keywordflow">return</span>(1);
<a name="l00308"></a>00308     }
<a name="l00309"></a>00309     <span class="keywordflow">if</span> ((!strcmp(solver-&gt;<a class="code" href="a00015.html#a4e93cb107e180ef982b74cef7726b70f">op_overwrite</a>,<span class="stringliteral">&quot;no&quot;</span>)) &amp;&amp; solver-&gt;<a class="code" href="a00015.html#aafb41b96563d9966e8e9f458751f2960">restart_iter</a>) {
<a name="l00310"></a>00310       <span class="comment">/* if it&apos;s a restart run, fast-forward the filename */</span>
<a name="l00311"></a>00311       <span class="keywordtype">int</span> <a class="code" href="a00031.html#ac71d8a4e2847ef13524ec70ed9f5d7d4">t</a>;
<a name="l00312"></a>00312       <span class="keywordflow">for</span> (t=0; t&lt;solver-&gt;<a class="code" href="a00015.html#aafb41b96563d9966e8e9f458751f2960">restart_iter</a>; t++) 
<a name="l00313"></a>00313         <span class="keywordflow">if</span> ((t+1)%solver-&gt;<a class="code" href="a00015.html#a6ff746b30ee55a3bbb9f3306c145f27a">file_op_iter</a> == 0) <a class="code" href="a00099.html#a9fda82ed752188f3af821e2c30f63c21">IncrementFilenameIndex</a>(solver-&gt;<a class="code" href="a00015.html#a0805db42e429173752189696c3c96909">filename_index</a>,solver-&gt;<a class="code" href="a00015.html#af474ca4577de91b658e4399ad0a6d7b3">index_length</a>);
<a name="l00314"></a>00314     }
<a name="l00315"></a>00315   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#a5f89e286a9eaffdb66d966fa6a290d3f">output_mode</a>,<span class="stringliteral">&quot;parallel&quot;</span>)) {
<a name="l00316"></a>00316     <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#a51a3b8c19b86e9e1df5be02b05a6613c">op_file_format</a>,<span class="stringliteral">&quot;none&quot;</span>)) solver-&gt;<a class="code" href="a00015.html#a9018a1befab4079332620f40375a9661">WriteOutput</a> = NULL;
<a name="l00317"></a>00317     <span class="keywordflow">else</span> {
<a name="l00318"></a>00318       <span class="comment">/* only binary file writing supported in parallel mode */</span>
<a name="l00319"></a>00319       <span class="comment">/* use post-processing scripts to convert              */</span>
<a name="l00320"></a>00320       solver-&gt;<a class="code" href="a00015.html#a9018a1befab4079332620f40375a9661">WriteOutput</a> = <a class="code" href="a00042.html#a067f454c26d85d6cfb4d7d878b3783c9">WriteBinary</a>;
<a name="l00321"></a>00321       strcpy(solver-&gt;<a class="code" href="a00015.html#a25f6a0c8fded2ee6bd9593c737bc3a51">solnfilename_extn</a>,<span class="stringliteral">&quot;.bin&quot;</span>);
<a name="l00322"></a>00322     }
<a name="l00323"></a>00323   } <span class="keywordflow">else</span> {
<a name="l00324"></a>00324     fprintf(stderr,<span class="stringliteral">&quot;Error: %s is not a supported output mode.\n&quot;</span>,solver-&gt;<a class="code" href="a00015.html#a5f89e286a9eaffdb66d966fa6a290d3f">output_mode</a>);
<a name="l00325"></a>00325     fprintf(stderr,<span class="stringliteral">&quot;Should be \&quot;serial\&quot; or \&quot;parallel\&quot;.    \n&quot;</span>);
<a name="l00326"></a>00326     <span class="keywordflow">return</span>(1);
<a name="l00327"></a>00327   }
<a name="l00328"></a>00328 
<a name="l00329"></a>00329   <span class="keywordflow">return</span>(0);
<a name="l00330"></a>00330 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="acaa477e12d5371876ebdb656626c68ee"></a><!-- doxytag: member="hypar.h::InitialSolution" ref="acaa477e12d5371876ebdb656626c68ee" args="(void *, void *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int InitialSolution </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>m</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Read the initial solution</p>
<p>Read in initial solution from file, and compute grid spacing and volume integral of the initial solution </p>

<p>Definition at line <a class="el" href="a00105_source.html#l00019">19</a> of file <a class="el" href="a00105_source.html">InitialSolution.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00020"></a>00020 {
<a name="l00021"></a>00021   <a class="code" href="a00015.html" title="Structure containing all solver-specific variables and functions.">HyPar</a>         *solver = (<a class="code" href="a00015.html" title="Structure containing all solver-specific variables and functions.">HyPar</a>*) s;
<a name="l00022"></a>00022   <a class="code" href="a00019.html" title="Structure of MPI-related variables.">MPIVariables</a>  *mpi    = (<a class="code" href="a00019.html" title="Structure of MPI-related variables.">MPIVariables</a>*) m;
<a name="l00023"></a>00023   <span class="keywordtype">int</span>           flag, d, i, offset, ghosts = solver-&gt;<a class="code" href="a00015.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>;
<a name="l00024"></a>00024   <a class="code" href="a00036.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a>;
<a name="l00025"></a>00025 
<a name="l00026"></a>00026   <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00042.html#afaf5b0d6e79b1e8674b397aebcb219dc">ReadArray</a>(solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00015.html#aa989ebb755986852177779cdf7bd8c85">dim_global</a>,solver-&gt;<a class="code" href="a00015.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,
<a name="l00027"></a>00027                  solver-&gt;<a class="code" href="a00015.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,solver,mpi,solver-&gt;<a class="code" href="a00015.html#a711aad4cbe735871dd9e91ab575c878b">x</a>,solver-&gt;<a class="code" href="a00015.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>,<span class="stringliteral">&quot;initial&quot;</span>,&amp;flag);
<a name="l00028"></a>00028   <span class="keywordflow">if</span> (!flag) {
<a name="l00029"></a>00029     fprintf(stderr,<span class="stringliteral">&quot;Error: initial solution file not found.\n&quot;</span>);
<a name="l00030"></a>00030     <span class="keywordflow">return</span>(1);
<a name="l00031"></a>00031   }
<a name="l00032"></a>00032   <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00033"></a>00033 
<a name="l00034"></a>00034   <span class="comment">/* exchange MPI-boundary values of u between processors */</span>
<a name="l00035"></a>00035   <a class="code" href="a00045.html#a60ace5964c051fa481e6a1e6f1ef75d7">MPIExchangeBoundariesnD</a>(solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00015.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,solver-&gt;<a class="code" href="a00015.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,mpi,solver-&gt;<a class="code" href="a00015.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>);
<a name="l00036"></a>00036 
<a name="l00037"></a>00037   <span class="comment">/* calculate dxinv */</span>
<a name="l00038"></a>00038   offset = 0;
<a name="l00039"></a>00039   <span class="keywordflow">for</span> (d = 0; d &lt; solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>; d++) {
<a name="l00040"></a>00040     <span class="keywordflow">for</span> (i = 0; i &lt; solver-&gt;<a class="code" href="a00015.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>[d]; i++) 
<a name="l00041"></a>00041       solver-&gt;<a class="code" href="a00015.html#aa24a4f5e29bd70cbe5a2413be1ea9682">dxinv</a>[i+offset+ghosts] = 2.0/(solver-&gt;<a class="code" href="a00015.html#a711aad4cbe735871dd9e91ab575c878b">x</a>[i+1+offset+ghosts]-solver-&gt;<a class="code" href="a00015.html#a711aad4cbe735871dd9e91ab575c878b">x</a>[i-1+offset+ghosts]);
<a name="l00042"></a>00042     offset += (solver-&gt;<a class="code" href="a00015.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>[d] + 2*ghosts);
<a name="l00043"></a>00043   }
<a name="l00044"></a>00044 
<a name="l00045"></a>00045   <span class="comment">/* exchange MPI-boundary values of dxinv between processors */</span>
<a name="l00046"></a>00046   offset = 0;
<a name="l00047"></a>00047   <span class="keywordflow">for</span> (d = 0; d &lt; solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>; d++) {
<a name="l00048"></a>00048     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#ac2f0cce702a9ce439753286ce227c7a2">MPIExchangeBoundaries1D</a>(mpi,&amp;solver-&gt;<a class="code" href="a00015.html#aa24a4f5e29bd70cbe5a2413be1ea9682">dxinv</a>[offset],solver-&gt;<a class="code" href="a00015.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>[d],
<a name="l00049"></a>00049                                    ghosts,d,solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00050"></a>00050     offset  += (solver-&gt;<a class="code" href="a00015.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>[d] + 2*ghosts);
<a name="l00051"></a>00051   }
<a name="l00052"></a>00052 
<a name="l00053"></a>00053   <span class="comment">/* fill in ghost values of dxinv at physical boundaries by extrapolation */</span>
<a name="l00054"></a>00054   offset = 0;
<a name="l00055"></a>00055   <span class="keywordflow">for</span> (d = 0; d &lt; solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>; d++) {
<a name="l00056"></a>00056     <span class="keywordtype">double</span> *dxinv = &amp;solver-&gt;<a class="code" href="a00015.html#aa24a4f5e29bd70cbe5a2413be1ea9682">dxinv</a>[offset];
<a name="l00057"></a>00057     <span class="keywordtype">int</span>    *dim   = solver-&gt;<a class="code" href="a00015.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>;
<a name="l00058"></a>00058     <span class="keywordflow">if</span> (mpi-&gt;<a class="code" href="a00019.html#aa3c28612a64b8a97bde66b720e15c700">ip</a>[d] == 0) {
<a name="l00059"></a>00059       <span class="comment">/* fill left boundary along this dimension */</span>
<a name="l00060"></a>00060       <span class="keywordflow">for</span> (i = 0; i &lt; ghosts; i++) dxinv[i] = dxinv[ghosts];
<a name="l00061"></a>00061     }
<a name="l00062"></a>00062     <span class="keywordflow">if</span> (mpi-&gt;<a class="code" href="a00019.html#aa3c28612a64b8a97bde66b720e15c700">ip</a>[d] == mpi-&gt;<a class="code" href="a00019.html#a0be0f30a83bc3f3d9f6ee3a36bbf2716">iproc</a>[d]-1) {
<a name="l00063"></a>00063       <span class="comment">/* fill right boundary along this dimension */</span>
<a name="l00064"></a>00064       <span class="keywordflow">for</span> (i = dim[d]+ghosts; i &lt; dim[d]+2*ghosts; i++) dxinv[i] = dxinv[dim[d]+ghosts-1];
<a name="l00065"></a>00065     }
<a name="l00066"></a>00066     offset  += (dim[d] + 2*ghosts);
<a name="l00067"></a>00067   }
<a name="l00068"></a>00068 
<a name="l00069"></a>00069   <span class="comment">/* calculate volume integral of the initial solution */</span>
<a name="l00070"></a>00070   <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00104.html#a1f30168f72fce94d12bd0cc8d9322494">VolumeIntegral</a>(solver-&gt;<a class="code" href="a00015.html#a3aec36aeb5caac1e87f5b4f5f75d5a23">VolumeIntegralInitial</a>,solver-&gt;<a class="code" href="a00015.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>,solver,mpi); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00071"></a>00071   <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a00019.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) {
<a name="l00072"></a>00072     printf(<span class="stringliteral">&quot;Volume integral of the initial solution:\n&quot;</span>);
<a name="l00073"></a>00073     <span class="keywordflow">for</span> (d=0; d&lt;solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>; d++) printf(<span class="stringliteral">&quot;%2d:  %1.16E\n&quot;</span>,d,solver-&gt;<a class="code" href="a00015.html#a3aec36aeb5caac1e87f5b4f5f75d5a23">VolumeIntegralInitial</a>[d]);
<a name="l00074"></a>00074   }
<a name="l00075"></a>00075   <span class="comment">/* Set initial total boundary flux integral to zero */</span>
<a name="l00076"></a>00076   <a class="code" href="a00034.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(solver-&gt;<a class="code" href="a00015.html#a644ed0ed36ed4af1c396c0af6aca043d">TotalBoundaryIntegral</a>,solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,0);
<a name="l00077"></a>00077 
<a name="l00078"></a>00078   <span class="keywordflow">return</span>(0); 
<a name="l00079"></a>00079 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="abff21fd701b932c05e9e0dac925bcf29"></a><!-- doxytag: member="hypar.h::OutputSolution" ref="abff21fd701b932c05e9e0dac925bcf29" args="(void *, void *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int OutputSolution </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>m</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Write solution to file</p>
<p>Write out the solution to file </p>

<p>Definition at line <a class="el" href="a00107_source.html#l00020">20</a> of file <a class="el" href="a00107_source.html">OutputSolution.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00021"></a>00021 {
<a name="l00022"></a>00022   <a class="code" href="a00015.html" title="Structure containing all solver-specific variables and functions.">HyPar</a>         *solver = (<a class="code" href="a00015.html" title="Structure containing all solver-specific variables and functions.">HyPar</a>*)       s;
<a name="l00023"></a>00023   <a class="code" href="a00019.html" title="Structure of MPI-related variables.">MPIVariables</a>  *mpi    = (<a class="code" href="a00019.html" title="Structure of MPI-related variables.">MPIVariables</a>*)m;
<a name="l00024"></a>00024   <a class="code" href="a00036.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a>;
<a name="l00025"></a>00025   
<a name="l00026"></a>00026   <span class="comment">/* if WriteOutput() is NULL, then return */</span>
<a name="l00027"></a>00027   <span class="keywordflow">if</span> (!solver-&gt;<a class="code" href="a00015.html#a9018a1befab4079332620f40375a9661">WriteOutput</a>) <span class="keywordflow">return</span>(0);
<a name="l00028"></a>00028 
<a name="l00029"></a>00029   <span class="comment">/* time integration module may have auxiliary arrays to write out, so get them */</span>
<a name="l00030"></a>00030   <span class="keywordtype">int</span>     NSolutions = 0;
<a name="l00031"></a>00031   <span class="keywordtype">double</span>  *uaux = NULL;
<a name="l00032"></a>00032   <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00061.html#a0a0363dd75de215624b351561d335e83">TimeGetAuxSolutions</a>(&amp;NSolutions,NULL,solver,-1); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00033"></a>00033   <span class="keywordflow">if</span> (NSolutions &gt; 10) NSolutions = 10;
<a name="l00034"></a>00034 
<a name="l00035"></a>00035   <span class="keywordtype">int</span>  n;
<a name="l00036"></a>00036   <span class="keywordtype">char</span> fname_root[3]     = <span class="stringliteral">&quot;op&quot;</span>;
<a name="l00037"></a>00037   <span class="keywordtype">char</span> aux_fname_root[4] = <span class="stringliteral">&quot;ts0&quot;</span>;
<a name="l00038"></a>00038 
<a name="l00039"></a>00039   <span class="keywordflow">for</span> (n=0; n&lt;NSolutions; n++) {
<a name="l00040"></a>00040     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00061.html#a0a0363dd75de215624b351561d335e83">TimeGetAuxSolutions</a>(&amp;NSolutions,&amp;uaux,solver,n); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00041"></a>00041     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00042.html#aaf888c739c5200d9c58a7154347069b0">WriteArray</a>(solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00015.html#aa989ebb755986852177779cdf7bd8c85">dim_global</a>,solver-&gt;<a class="code" href="a00015.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,
<a name="l00042"></a>00042                     solver-&gt;<a class="code" href="a00015.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,solver-&gt;<a class="code" href="a00015.html#a711aad4cbe735871dd9e91ab575c878b">x</a>,uaux,solver,mpi,aux_fname_root); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00043"></a>00043     aux_fname_root[2]++;
<a name="l00044"></a>00044   }
<a name="l00045"></a>00045   <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00042.html#aaf888c739c5200d9c58a7154347069b0">WriteArray</a>(solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00015.html#aa989ebb755986852177779cdf7bd8c85">dim_global</a>,solver-&gt;<a class="code" href="a00015.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,
<a name="l00046"></a>00046                   solver-&gt;<a class="code" href="a00015.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,solver-&gt;<a class="code" href="a00015.html#a711aad4cbe735871dd9e91ab575c878b">x</a>,solver-&gt;<a class="code" href="a00015.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>,solver,mpi,fname_root); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00047"></a>00047 
<a name="l00048"></a>00048   <span class="comment">/* increment the index string, if required */</span>
<a name="l00049"></a>00049   <span class="keywordflow">if</span> ((!strcmp(solver-&gt;<a class="code" href="a00015.html#a5f89e286a9eaffdb66d966fa6a290d3f">output_mode</a>,<span class="stringliteral">&quot;serial&quot;</span>)) &amp;&amp; (!strcmp(solver-&gt;<a class="code" href="a00015.html#a4e93cb107e180ef982b74cef7726b70f">op_overwrite</a>,<span class="stringliteral">&quot;no&quot;</span>)))
<a name="l00050"></a>00050       <a class="code" href="a00099.html#a9fda82ed752188f3af821e2c30f63c21">IncrementFilenameIndex</a>(solver-&gt;<a class="code" href="a00015.html#a0805db42e429173752189696c3c96909">filename_index</a>,solver-&gt;<a class="code" href="a00015.html#af474ca4577de91b658e4399ad0a6d7b3">index_length</a>);
<a name="l00051"></a>00051   
<a name="l00052"></a>00052   <span class="keywordflow">return</span>(0);
<a name="l00053"></a>00053 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1eaea8a114ef1dad09df700d03e735e9"></a><!-- doxytag: member="hypar.h::ReadInputs" ref="a1eaea8a114ef1dad09df700d03e735e9" args="(void *, void *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ReadInputs </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>m</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Read the input parameters</p>
<p>Read the simulation inputs from the file <b>solver.inp</b>. Rank 0 reads in the inputs and broadcasts them to all the processors.<br/>
<br/>
 The format of <b>solver.inp</b> is as follows:<br/>
</p>
<p>begin &lt;keyword&gt; </p>
<p>&lt;keyword&gt; </p>
<p>&lt;keyword&gt; </p>
<p>... &lt;keyword&gt; </p>
<p>end</p>
<p>where the list of keywords and their type are:<br/>
 Keyword name | Type | Variable | Default value ------------------ | ------------ | ----------------------------- | ------------------------------------------ ndims | int | <a class="el" href="a00015.html#a484873c74138512e41bc50d17b7d955a">HyPar::ndims</a> | 1 nvars | int | <a class="el" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">HyPar::nvars</a> | 1 size | int[ndims] | <a class="el" href="a00015.html#aa989ebb755986852177779cdf7bd8c85">HyPar::dim_global</a> | must be specified iproc | int[ndims] | <a class="el" href="a00019.html#a0be0f30a83bc3f3d9f6ee3a36bbf2716">MPIVariables::iproc</a> | must be specified ghost | int | <a class="el" href="a00015.html#aafc992b5fa79d5a4036024615d03bce6">HyPar::ghosts</a> | 1 n_iter | int | <a class="el" href="a00015.html#af0d8e0d5d3de3869b941b66b6caaf964">HyPar::n_iter</a> | 0 restart_iter | int | <a class="el" href="a00015.html#aafb41b96563d9966e8e9f458751f2960">HyPar::restart_iter</a> | 0 time_scheme | char[] | <a class="el" href="a00015.html#a138e751362d14724df8e6ab27c4a5e55">HyPar::time_scheme</a> | euler time_scheme_type | char[] | <a class="el" href="a00015.html#a61750696383420ba8bcc7d9e44a538e2">HyPar::time_scheme_type</a> | none hyp_space_scheme | char[] | <a class="el" href="a00015.html#ad29846eeb9c83b329a8d7c1fe69d46b2">HyPar::spatial_scheme_hyp</a> | 1 hyp_flux_split | char[] | <a class="el" href="a00015.html#a5bed0cb9665daad89f4377c4f7609df4">HyPar::SplitHyperbolicFlux</a> | no hyp_interp_type | char[] | <a class="el" href="a00015.html#a9591ba0fadb863561474e2ba251d2594">HyPar::interp_type</a> | characteristic par_space_type | char[] | <a class="el" href="a00015.html#ad45d57b33d578bf602574a221bf53d93">HyPar::spatial_type_par</a> | nonconservative-1stage par_space_scheme | char[] | <a class="el" href="a00015.html#a170f2f6cc8ac86b78fcb376c2392e290">HyPar::spatial_scheme_par</a> | 2 dt | double | <a class="el" href="a00015.html#a03e28be41881b703c836edbfe9b51b17">HyPar::dt</a> | 0.0 conservation_check | char[] | <a class="el" href="a00015.html#ac92c34fe456d92c694eacd2231f5a7b1">HyPar::ConservationCheck</a> | no screen_op_iter | int | <a class="el" href="a00015.html#a74ff7fa96cbfc4ee87f508f964e94409">HyPar::screen_op_iter</a> | 1 file_op_iter | int | <a class="el" href="a00015.html#a6ff746b30ee55a3bbb9f3306c145f27a">HyPar::file_op_iter</a> | 1000 op_file_format | char[] | <a class="el" href="a00015.html#a51a3b8c19b86e9e1df5be02b05a6613c">HyPar::op_file_format</a> | text ip_file_type | char[] | <a class="el" href="a00015.html#a83f3dcd022f744511a44f2a31a824ac8">HyPar::ip_file_type</a> | ascii input_mode | char[] | <a class="el" href="a00015.html#a0a0b9dc97c7c278a019939d301db9399">HyPar::input_mode</a> | serial output_mode | char[] | <a class="el" href="a00015.html#a5f89e286a9eaffdb66d966fa6a290d3f">HyPar::output_mode</a> | serial op_overwrite | char[] | <a class="el" href="a00015.html#a4e93cb107e180ef982b74cef7726b70f">HyPar::op_overwrite</a> | no model | char[] | <a class="el" href="a00015.html#ad3fe4b266b398f3a7567ac1b241d99a2">HyPar::model</a> | must be specified immersed_body | char[] | <a class="el" href="a00015.html#a43ee3672350b4fd385871b6512e5d47b">HyPar::ib_filename</a> | "none"</p>
<p><b>Notes:</b> + "ndims" <b>must</b> be specified <b>before</b> "size" and "iproc". + if "input_mode" or "output_mode" are set to "parallel" or "mpi-io", the number of I/O ranks must be specified right after as an integer. For example:</p>
<p>begin ... input_mode parallel 4 ... end</p>
<p>This means that 4 MPI ranks will participate in file I/O (assuming total MPI ranks is more than 4) (see <a class="el" href="a00151.html#adaa1bd7f962777f3b7ce886a94a8338e">ReadArrayParallel()</a>, <a class="el" href="a00032.html#a8f55f8295fddffc51426862c150c11c1">WriteArrayParallel()</a>, <a class="el" href="a00032.html#aeccbf8d2c2a7e417eb0d06bea0f3c5b5">ReadArrayMPI_IO()</a> ).</p>
<ul>
<li>The number of I/O ranks specified for "input_mode" and "output_mode" <b>must</b> <b>be</b> <b>same</b>. Otherwise, the value for the one specified last will be used.</li>
<li>The number of I/O ranks must be such that the total number of MPI ranks is an integer multiple. Otherwise, the code will use only 1 I/O rank. + If any of the keywords are not present, the default value is used, except the ones whose default values say "must be specified". Thus, keywords that are not required for a particular simulation may be left out of the solver.inp input file. For example,</li>
<li>a <a class="el" href="a00005.html" title="Structure containing variables and parameters specific to the 1D Euler equations...">Euler1D</a> simulation does not need "par_space_type" or "par_space_scheme" because it does not have a parabolic term.</li>
<li>unless a conservation check is required, "conservation_check" can be left out and the code will not check for conservation.</li>
<li>"immersed_body" need not be specified if there are no immersed bodies present. <b>NOTE:</b> However, if it is specified, and a file of that filename does not exist, it will result in an error. </li>
</ul>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>s</em>&nbsp;</td><td>Solver object of type <a class="el" href="a00015.html" title="Structure containing all solver-specific variables and functions.">HyPar</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>m</em>&nbsp;</td><td>MPI object of type <a class="el" href="a00019.html" title="Structure of MPI-related variables.">MPIVariables</a> </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00112_source.html#l00088">88</a> of file <a class="el" href="a00112_source.html">ReadInputs.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00092"></a>00092 {
<a name="l00093"></a>00093   <a class="code" href="a00015.html" title="Structure containing all solver-specific variables and functions.">HyPar</a>         *solver = (<a class="code" href="a00015.html" title="Structure containing all solver-specific variables and functions.">HyPar</a>*) s;
<a name="l00094"></a>00094   <a class="code" href="a00019.html" title="Structure of MPI-related variables.">MPIVariables</a>  *mpi    = (<a class="code" href="a00019.html" title="Structure of MPI-related variables.">MPIVariables</a>*) m;
<a name="l00095"></a>00095   <span class="keywordtype">int</span>           ferr    = 0;
<a name="l00096"></a>00096 
<a name="l00097"></a>00097   <span class="comment">/* set some default values for optional inputs */</span>
<a name="l00098"></a>00098   solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>           = 1;
<a name="l00099"></a>00099   solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>           = 1;
<a name="l00100"></a>00100   solver-&gt;<a class="code" href="a00015.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>          = 1;
<a name="l00101"></a>00101   solver-&gt;<a class="code" href="a00015.html#aa989ebb755986852177779cdf7bd8c85">dim_global</a>      = NULL;
<a name="l00102"></a>00102   solver-&gt;<a class="code" href="a00015.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>       = NULL;
<a name="l00103"></a>00103   mpi-&gt;<a class="code" href="a00019.html#a0be0f30a83bc3f3d9f6ee3a36bbf2716">iproc</a>              = NULL;
<a name="l00104"></a>00104   mpi-&gt;<a class="code" href="a00019.html#a297fca986fa3aa27de07a0c746ffaaa8">N_IORanks</a>          = 1;
<a name="l00105"></a>00105   solver-&gt;<a class="code" href="a00015.html#a03e28be41881b703c836edbfe9b51b17">dt</a>              = 0.0;
<a name="l00106"></a>00106   solver-&gt;<a class="code" href="a00015.html#af0d8e0d5d3de3869b941b66b6caaf964">n_iter</a>          = 0;
<a name="l00107"></a>00107   solver-&gt;<a class="code" href="a00015.html#aafb41b96563d9966e8e9f458751f2960">restart_iter</a>    = 0;
<a name="l00108"></a>00108   solver-&gt;<a class="code" href="a00015.html#a74ff7fa96cbfc4ee87f508f964e94409">screen_op_iter</a>  = 1;
<a name="l00109"></a>00109   solver-&gt;<a class="code" href="a00015.html#a6ff746b30ee55a3bbb9f3306c145f27a">file_op_iter</a>    = 1000;
<a name="l00110"></a>00110   solver-&gt;<a class="code" href="a00015.html#aa6022244a5ae02a5f457172dbf69f3e5">write_residual</a>  = 0;
<a name="l00111"></a>00111   solver-&gt;<a class="code" href="a00015.html#ae83b1b0117b6a805ead2e4728945814c">flag_ib</a>         = 0;
<a name="l00112"></a>00112   strcpy(solver-&gt;<a class="code" href="a00015.html#a138e751362d14724df8e6ab27c4a5e55">time_scheme</a>        ,<span class="stringliteral">&quot;euler&quot;</span>         );
<a name="l00113"></a>00113   strcpy(solver-&gt;<a class="code" href="a00015.html#a61750696383420ba8bcc7d9e44a538e2">time_scheme_type</a>   ,<span class="stringliteral">&quot; &quot;</span>             );
<a name="l00114"></a>00114   strcpy(solver-&gt;<a class="code" href="a00015.html#ad29846eeb9c83b329a8d7c1fe69d46b2">spatial_scheme_hyp</a> ,<span class="stringliteral">&quot;1&quot;</span>             );
<a name="l00115"></a>00115   strcpy(solver-&gt;<a class="code" href="a00015.html#ad45d57b33d578bf602574a221bf53d93">spatial_type_par</a>   ,<a class="code" href="a00039.html#a18ee8cd9b4297a259b08aa4cdfe30aa1">_NC_1STAGE_</a>     );
<a name="l00116"></a>00116   strcpy(solver-&gt;<a class="code" href="a00015.html#a170f2f6cc8ac86b78fcb376c2392e290">spatial_scheme_par</a> ,<span class="stringliteral">&quot;2&quot;</span>             );
<a name="l00117"></a>00117   strcpy(solver-&gt;<a class="code" href="a00015.html#a9591ba0fadb863561474e2ba251d2594">interp_type</a>        ,<span class="stringliteral">&quot;characteristic&quot;</span>);
<a name="l00118"></a>00118   strcpy(solver-&gt;<a class="code" href="a00015.html#a83f3dcd022f744511a44f2a31a824ac8">ip_file_type</a>       ,<span class="stringliteral">&quot;ascii&quot;</span>         );
<a name="l00119"></a>00119   strcpy(solver-&gt;<a class="code" href="a00015.html#a0a0b9dc97c7c278a019939d301db9399">input_mode</a>         ,<span class="stringliteral">&quot;serial&quot;</span>        );
<a name="l00120"></a>00120   strcpy(solver-&gt;<a class="code" href="a00015.html#a5f89e286a9eaffdb66d966fa6a290d3f">output_mode</a>        ,<span class="stringliteral">&quot;serial&quot;</span>        );
<a name="l00121"></a>00121   strcpy(solver-&gt;<a class="code" href="a00015.html#a51a3b8c19b86e9e1df5be02b05a6613c">op_file_format</a>     ,<span class="stringliteral">&quot;text&quot;</span>          );
<a name="l00122"></a>00122   strcpy(solver-&gt;<a class="code" href="a00015.html#a4e93cb107e180ef982b74cef7726b70f">op_overwrite</a>       ,<span class="stringliteral">&quot;no&quot;</span>            );
<a name="l00123"></a>00123   strcpy(solver-&gt;<a class="code" href="a00015.html#ad3fe4b266b398f3a7567ac1b241d99a2">model</a>              ,<span class="stringliteral">&quot;none&quot;</span>          );
<a name="l00124"></a>00124   strcpy(solver-&gt;<a class="code" href="a00015.html#ac92c34fe456d92c694eacd2231f5a7b1">ConservationCheck</a>  ,<span class="stringliteral">&quot;no&quot;</span>            );
<a name="l00125"></a>00125   strcpy(solver-&gt;<a class="code" href="a00015.html#a5bed0cb9665daad89f4377c4f7609df4">SplitHyperbolicFlux</a>,<span class="stringliteral">&quot;no&quot;</span>            );
<a name="l00126"></a>00126   strcpy(solver-&gt;<a class="code" href="a00015.html#a43ee3672350b4fd385871b6512e5d47b">ib_filename</a>        ,<span class="stringliteral">&quot;none&quot;</span>          );
<a name="l00127"></a>00127 
<a name="l00128"></a>00128   <span class="comment">/* reading solver inputs */</span>
<a name="l00129"></a>00129   <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a00019.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) {
<a name="l00130"></a>00130     FILE *in;
<a name="l00131"></a>00131     printf(<span class="stringliteral">&quot;Reading solver inputs from file \&quot;solver.inp\&quot;.\n&quot;</span>);
<a name="l00132"></a>00132     in = fopen(<span class="stringliteral">&quot;solver.inp&quot;</span>,<span class="stringliteral">&quot;r&quot;</span>);
<a name="l00133"></a>00133     <span class="keywordflow">if</span> (!in) {
<a name="l00134"></a>00134       fprintf(stderr,<span class="stringliteral">&quot;Error: File \&quot;solver.inp\&quot; not found.\n&quot;</span>);
<a name="l00135"></a>00135       <span class="keywordflow">return</span>(1);
<a name="l00136"></a>00136     } <span class="keywordflow">else</span> {
<a name="l00137"></a>00137         <span class="keywordtype">char</span> word[<a class="code" href="a00036.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>];
<a name="l00138"></a>00138       ferr = fscanf(in,<span class="stringliteral">&quot;%s&quot;</span>,word); <span class="keywordflow">if</span> (ferr != 1) <span class="keywordflow">return</span>(1);
<a name="l00139"></a>00139       <span class="keywordflow">if</span> (!strcmp(word, <span class="stringliteral">&quot;begin&quot;</span>)){
<a name="l00140"></a>00140           <span class="keywordflow">while</span> (strcmp(word, <span class="stringliteral">&quot;end&quot;</span>)){
<a name="l00141"></a>00141               ferr = fscanf(in,<span class="stringliteral">&quot;%s&quot;</span>,word); <span class="keywordflow">if</span> (ferr != 1) <span class="keywordflow">return</span>(1);
<a name="l00142"></a>00142           <span class="keywordflow">if</span> (!strcmp(word, <span class="stringliteral">&quot;ndims&quot;</span>)) {
<a name="l00143"></a>00143             ferr = fscanf(in,<span class="stringliteral">&quot;%d&quot;</span>,&amp;solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>); <span class="keywordflow">if</span> (ferr != 1) <span class="keywordflow">return</span>(1);
<a name="l00144"></a>00144             solver-&gt;<a class="code" href="a00015.html#aa989ebb755986852177779cdf7bd8c85">dim_global</a> = (<span class="keywordtype">int</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00145"></a>00145             mpi-&gt;<a class="code" href="a00019.html#a0be0f30a83bc3f3d9f6ee3a36bbf2716">iproc</a>         = (<span class="keywordtype">int</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00146"></a>00146           } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(word, <span class="stringliteral">&quot;nvars&quot;</span>)) ferr = fscanf(in,<span class="stringliteral">&quot;%d&quot;</span>,&amp;solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);
<a name="l00147"></a>00147               <span class="keywordflow">else</span> <span class="keywordflow">if</span>   (!strcmp(word, <span class="stringliteral">&quot;size&quot;</span>)) {
<a name="l00148"></a>00148             <span class="keywordtype">int</span> i;
<a name="l00149"></a>00149             <span class="keywordflow">if</span> (!solver-&gt;<a class="code" href="a00015.html#aa989ebb755986852177779cdf7bd8c85">dim_global</a>) {
<a name="l00150"></a>00150               fprintf(stderr,<span class="stringliteral">&quot;Error in ReadInputs(): dim_global not allocated.\n&quot;</span>);
<a name="l00151"></a>00151               fprintf(stderr,<span class="stringliteral">&quot;Please specify ndims before dimensions.\n&quot;</span>         );
<a name="l00152"></a>00152               <span class="keywordflow">return</span>(1);
<a name="l00153"></a>00153             } <span class="keywordflow">else</span> {
<a name="l00154"></a>00154               <span class="keywordflow">for</span> (i=0; i&lt;solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>; i++) ferr = fscanf(in,<span class="stringliteral">&quot;%d&quot;</span>,&amp;solver-&gt;<a class="code" href="a00015.html#aa989ebb755986852177779cdf7bd8c85">dim_global</a>[i]);
<a name="l00155"></a>00155               <span class="keywordflow">if</span> (ferr != 1) <span class="keywordflow">return</span>(1);
<a name="l00156"></a>00156             }
<a name="l00157"></a>00157           } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(word, <span class="stringliteral">&quot;iproc&quot;</span>)) {
<a name="l00158"></a>00158             <span class="keywordtype">int</span> i;
<a name="l00159"></a>00159             <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a00019.html#a0be0f30a83bc3f3d9f6ee3a36bbf2716">iproc</a>) {
<a name="l00160"></a>00160               fprintf(stderr,<span class="stringliteral">&quot;Error in ReadInputs(): iproc not allocated.\n&quot;</span>);
<a name="l00161"></a>00161               fprintf(stderr,<span class="stringliteral">&quot;Please specify ndims before iproc.\n&quot;</span>         );
<a name="l00162"></a>00162               <span class="keywordflow">return</span>(1);
<a name="l00163"></a>00163             } <span class="keywordflow">else</span> {
<a name="l00164"></a>00164               <span class="keywordflow">for</span> (i=0; i&lt;solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>; i++) ferr = fscanf(in,<span class="stringliteral">&quot;%d&quot;</span>,&amp;mpi-&gt;<a class="code" href="a00019.html#a0be0f30a83bc3f3d9f6ee3a36bbf2716">iproc</a>[i]);
<a name="l00165"></a>00165               <span class="keywordflow">if</span> (ferr != 1) <span class="keywordflow">return</span>(1);
<a name="l00166"></a>00166             }
<a name="l00167"></a>00167               } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(word, <span class="stringliteral">&quot;ghost&quot;</span>              ))  ferr = fscanf(in,<span class="stringliteral">&quot;%d&quot;</span>,&amp;solver-&gt;<a class="code" href="a00015.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>             );
<a name="l00168"></a>00168               <span class="keywordflow">else</span> <span class="keywordflow">if</span>   (!strcmp(word, <span class="stringliteral">&quot;n_iter&quot;</span>             ))  ferr = fscanf(in,<span class="stringliteral">&quot;%d&quot;</span>,&amp;solver-&gt;<a class="code" href="a00015.html#af0d8e0d5d3de3869b941b66b6caaf964">n_iter</a>             );
<a name="l00169"></a>00169               <span class="keywordflow">else</span> <span class="keywordflow">if</span>   (!strcmp(word, <span class="stringliteral">&quot;restart_iter&quot;</span>       ))  ferr = fscanf(in,<span class="stringliteral">&quot;%d&quot;</span>,&amp;solver-&gt;<a class="code" href="a00015.html#aafb41b96563d9966e8e9f458751f2960">restart_iter</a>       );
<a name="l00170"></a>00170               <span class="keywordflow">else</span> <span class="keywordflow">if</span>   (!strcmp(word, <span class="stringliteral">&quot;time_scheme&quot;</span>        ))  ferr = fscanf(in,<span class="stringliteral">&quot;%s&quot;</span>,solver-&gt;<a class="code" href="a00015.html#a138e751362d14724df8e6ab27c4a5e55">time_scheme</a>         );
<a name="l00171"></a>00171             <span class="keywordflow">else</span> <span class="keywordflow">if</span>   (!strcmp(word, <span class="stringliteral">&quot;time_scheme_type&quot;</span>   ))  ferr = fscanf(in,<span class="stringliteral">&quot;%s&quot;</span>,solver-&gt;<a class="code" href="a00015.html#a61750696383420ba8bcc7d9e44a538e2">time_scheme_type</a>    );
<a name="l00172"></a>00172             <span class="keywordflow">else</span> <span class="keywordflow">if</span>   (!strcmp(word, <span class="stringliteral">&quot;hyp_space_scheme&quot;</span>   ))  ferr = fscanf(in,<span class="stringliteral">&quot;%s&quot;</span>,solver-&gt;<a class="code" href="a00015.html#ad29846eeb9c83b329a8d7c1fe69d46b2">spatial_scheme_hyp</a>  );
<a name="l00173"></a>00173             <span class="keywordflow">else</span> <span class="keywordflow">if</span>   (!strcmp(word, <span class="stringliteral">&quot;hyp_flux_split&quot;</span>     ))  ferr = fscanf(in,<span class="stringliteral">&quot;%s&quot;</span>,solver-&gt;<a class="code" href="a00015.html#a5bed0cb9665daad89f4377c4f7609df4">SplitHyperbolicFlux</a> );
<a name="l00174"></a>00174             <span class="keywordflow">else</span> <span class="keywordflow">if</span>   (!strcmp(word, <span class="stringliteral">&quot;hyp_interp_type&quot;</span>    ))  ferr = fscanf(in,<span class="stringliteral">&quot;%s&quot;</span>,solver-&gt;<a class="code" href="a00015.html#a9591ba0fadb863561474e2ba251d2594">interp_type</a>         );
<a name="l00175"></a>00175             <span class="keywordflow">else</span> <span class="keywordflow">if</span>   (!strcmp(word, <span class="stringliteral">&quot;par_space_type&quot;</span>     ))  ferr = fscanf(in,<span class="stringliteral">&quot;%s&quot;</span>,solver-&gt;<a class="code" href="a00015.html#ad45d57b33d578bf602574a221bf53d93">spatial_type_par</a>    );
<a name="l00176"></a>00176             <span class="keywordflow">else</span> <span class="keywordflow">if</span>   (!strcmp(word, <span class="stringliteral">&quot;par_space_scheme&quot;</span>   ))  ferr = fscanf(in,<span class="stringliteral">&quot;%s&quot;</span>,solver-&gt;<a class="code" href="a00015.html#a170f2f6cc8ac86b78fcb376c2392e290">spatial_scheme_par</a>  );
<a name="l00177"></a>00177             <span class="keywordflow">else</span> <span class="keywordflow">if</span>   (!strcmp(word, <span class="stringliteral">&quot;dt&quot;</span>                 ))  ferr = fscanf(in,<span class="stringliteral">&quot;%lf&quot;</span>,&amp;solver-&gt;<a class="code" href="a00015.html#a03e28be41881b703c836edbfe9b51b17">dt</a>                );
<a name="l00178"></a>00178             <span class="keywordflow">else</span> <span class="keywordflow">if</span>   (!strcmp(word, <span class="stringliteral">&quot;conservation_check&quot;</span> ))  ferr = fscanf(in,<span class="stringliteral">&quot;%s&quot;</span>,solver-&gt;<a class="code" href="a00015.html#ac92c34fe456d92c694eacd2231f5a7b1">ConservationCheck</a>   );
<a name="l00179"></a>00179             <span class="keywordflow">else</span> <span class="keywordflow">if</span>   (!strcmp(word, <span class="stringliteral">&quot;screen_op_iter&quot;</span>     ))  ferr = fscanf(in,<span class="stringliteral">&quot;%d&quot;</span>,&amp;solver-&gt;<a class="code" href="a00015.html#a74ff7fa96cbfc4ee87f508f964e94409">screen_op_iter</a>     );
<a name="l00180"></a>00180             <span class="keywordflow">else</span> <span class="keywordflow">if</span>   (!strcmp(word, <span class="stringliteral">&quot;file_op_iter&quot;</span>       ))  ferr = fscanf(in,<span class="stringliteral">&quot;%d&quot;</span>,&amp;solver-&gt;<a class="code" href="a00015.html#a6ff746b30ee55a3bbb9f3306c145f27a">file_op_iter</a>       );
<a name="l00181"></a>00181             <span class="keywordflow">else</span> <span class="keywordflow">if</span>   (!strcmp(word, <span class="stringliteral">&quot;op_file_format&quot;</span>     ))  ferr = fscanf(in,<span class="stringliteral">&quot;%s&quot;</span>,solver-&gt;<a class="code" href="a00015.html#a51a3b8c19b86e9e1df5be02b05a6613c">op_file_format</a>      );
<a name="l00182"></a>00182             <span class="keywordflow">else</span> <span class="keywordflow">if</span>   (!strcmp(word, <span class="stringliteral">&quot;ip_file_type&quot;</span>       ))  ferr = fscanf(in,<span class="stringliteral">&quot;%s&quot;</span>,solver-&gt;<a class="code" href="a00015.html#a83f3dcd022f744511a44f2a31a824ac8">ip_file_type</a>        );
<a name="l00183"></a>00183             <span class="keywordflow">else</span> <span class="keywordflow">if</span>   (!strcmp(word, <span class="stringliteral">&quot;input_mode&quot;</span>         ))  {
<a name="l00184"></a>00184             ferr = fscanf(in,<span class="stringliteral">&quot;%s&quot;</span>,solver-&gt;<a class="code" href="a00015.html#a0a0b9dc97c7c278a019939d301db9399">input_mode</a>);
<a name="l00185"></a>00185             <span class="keywordflow">if</span> (strcmp(solver-&gt;<a class="code" href="a00015.html#a0a0b9dc97c7c278a019939d301db9399">input_mode</a>,<span class="stringliteral">&quot;serial&quot;</span>))        ferr = fscanf(in,<span class="stringliteral">&quot;%d&quot;</span>,&amp;mpi-&gt;<a class="code" href="a00019.html#a297fca986fa3aa27de07a0c746ffaaa8">N_IORanks</a>);
<a name="l00186"></a>00186             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(word, <span class="stringliteral">&quot;output_mode&quot;</span>        ))  {
<a name="l00187"></a>00187             ferr = fscanf(in,<span class="stringliteral">&quot;%s&quot;</span>,solver-&gt;<a class="code" href="a00015.html#a5f89e286a9eaffdb66d966fa6a290d3f">output_mode</a>);
<a name="l00188"></a>00188             <span class="keywordflow">if</span> (strcmp(solver-&gt;<a class="code" href="a00015.html#a5f89e286a9eaffdb66d966fa6a290d3f">output_mode</a>,<span class="stringliteral">&quot;serial&quot;</span>))       ferr = fscanf(in,<span class="stringliteral">&quot;%d&quot;</span>,&amp;mpi-&gt;<a class="code" href="a00019.html#a297fca986fa3aa27de07a0c746ffaaa8">N_IORanks</a>);
<a name="l00189"></a>00189           } <span class="keywordflow">else</span> <span class="keywordflow">if</span>   (!strcmp(word, <span class="stringliteral">&quot;op_overwrite&quot;</span>     ))  ferr = fscanf(in,<span class="stringliteral">&quot;%s&quot;</span>,solver-&gt;<a class="code" href="a00015.html#a4e93cb107e180ef982b74cef7726b70f">op_overwrite</a>      );
<a name="l00190"></a>00190             <span class="keywordflow">else</span> <span class="keywordflow">if</span>   (!strcmp(word, <span class="stringliteral">&quot;model&quot;</span>              ))  ferr = fscanf(in,<span class="stringliteral">&quot;%s&quot;</span>,solver-&gt;<a class="code" href="a00015.html#ad3fe4b266b398f3a7567ac1b241d99a2">model</a>             );
<a name="l00191"></a>00191             <span class="keywordflow">else</span> <span class="keywordflow">if</span>   (!strcmp(word, <span class="stringliteral">&quot;immersed_body&quot;</span>      ))  ferr = fscanf(in,<span class="stringliteral">&quot;%s&quot;</span>,solver-&gt;<a class="code" href="a00015.html#a43ee3672350b4fd385871b6512e5d47b">ib_filename</a>       );
<a name="l00192"></a>00192           <span class="keywordflow">else</span> <span class="keywordflow">if</span>   ( strcmp(word, <span class="stringliteral">&quot;end&quot;</span>                )) {
<a name="l00193"></a>00193             <span class="keywordtype">char</span> useless[<a class="code" href="a00036.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>];
<a name="l00194"></a>00194             ferr = fscanf(in,<span class="stringliteral">&quot;%s&quot;</span>,useless);
<a name="l00195"></a>00195             printf(<span class="stringliteral">&quot;Warning: keyword %s in file \&quot;solver.inp\&quot; with value %s not recognized or extraneous. Ignoring.\n&quot;</span>,
<a name="l00196"></a>00196                     word,useless);
<a name="l00197"></a>00197           }
<a name="l00198"></a>00198           <span class="keywordflow">if</span> (ferr != 1) <span class="keywordflow">return</span>(1);
<a name="l00199"></a>00199         }
<a name="l00200"></a>00200       } <span class="keywordflow">else</span> {
<a name="l00201"></a>00201           fprintf(stderr,<span class="stringliteral">&quot;Error: Illegal format in file \&quot;solver.inp\&quot;.\n&quot;</span>);
<a name="l00202"></a>00202         <span class="keywordflow">return</span>(1);
<a name="l00203"></a>00203       }
<a name="l00204"></a>00204       fclose(in);
<a name="l00205"></a>00205 
<a name="l00206"></a>00206       <span class="keywordflow">if</span> (solver-&gt;<a class="code" href="a00015.html#a74ff7fa96cbfc4ee87f508f964e94409">screen_op_iter</a> &lt;= 0)  solver-&gt;<a class="code" href="a00015.html#a74ff7fa96cbfc4ee87f508f964e94409">screen_op_iter</a> = 1;
<a name="l00207"></a>00207       <span class="keywordflow">if</span> (solver-&gt;<a class="code" href="a00015.html#a6ff746b30ee55a3bbb9f3306c145f27a">file_op_iter</a> &lt;= 0)    solver-&gt;<a class="code" href="a00015.html#a6ff746b30ee55a3bbb9f3306c145f27a">file_op_iter</a>   = solver-&gt;<a class="code" href="a00015.html#af0d8e0d5d3de3869b941b66b6caaf964">n_iter</a>;
<a name="l00208"></a>00208 
<a name="l00209"></a>00209       <span class="keywordflow">if</span> ((solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a> != 3) &amp;&amp; (strcmp(solver-&gt;<a class="code" href="a00015.html#a43ee3672350b4fd385871b6512e5d47b">ib_filename</a>,<span class="stringliteral">&quot;none&quot;</span>))) {
<a name="l00210"></a>00210         printf(<span class="stringliteral">&quot;Warning: immersed boundaries not implemented for ndims = %d. &quot;</span>,solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>);
<a name="l00211"></a>00211         printf(<span class="stringliteral">&quot;Ignoring input for \&quot;immersed_body\&quot; (%s).\n&quot;</span>,solver-&gt;<a class="code" href="a00015.html#a43ee3672350b4fd385871b6512e5d47b">ib_filename</a>);
<a name="l00212"></a>00212         strcpy(solver-&gt;<a class="code" href="a00015.html#a43ee3672350b4fd385871b6512e5d47b">ib_filename</a>,<span class="stringliteral">&quot;none&quot;</span>);
<a name="l00213"></a>00213       }
<a name="l00214"></a>00214       solver-&gt;<a class="code" href="a00015.html#ae83b1b0117b6a805ead2e4728945814c">flag_ib</a> = strcmp(solver-&gt;<a class="code" href="a00015.html#a43ee3672350b4fd385871b6512e5d47b">ib_filename</a>,<span class="stringliteral">&quot;none&quot;</span>);
<a name="l00215"></a>00215 
<a name="l00216"></a>00216       <span class="comment">/* Print to screen the inputs read */</span>
<a name="l00217"></a>00217       <span class="keywordtype">int</span> i;
<a name="l00218"></a>00218         printf(<span class="stringliteral">&quot;\tNo. of dimensions                          : %d\n&quot;</span>,solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>);
<a name="l00219"></a>00219         printf(<span class="stringliteral">&quot;\tNo. of variables                           : %d\n&quot;</span>,solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);
<a name="l00220"></a>00220         printf(<span class="stringliteral">&quot;\tDomain size                                : &quot;</span>);
<a name="l00221"></a>00221       <span class="keywordflow">for</span> (i=0; i&lt;solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>; i++) printf (<span class="stringliteral">&quot;%d &quot;</span>,solver-&gt;<a class="code" href="a00015.html#aa989ebb755986852177779cdf7bd8c85">dim_global</a>[i]);
<a name="l00222"></a>00222       printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00223"></a>00223 <span class="preprocessor">#ifndef serial</span>
<a name="l00224"></a>00224 <span class="preprocessor"></span>        printf(<span class="stringliteral">&quot;\tProcesses along each dimension             : &quot;</span>);
<a name="l00225"></a>00225       <span class="keywordflow">for</span> (i=0; i&lt;solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>; i++) printf (<span class="stringliteral">&quot;%d &quot;</span>,mpi-&gt;<a class="code" href="a00019.html#a0be0f30a83bc3f3d9f6ee3a36bbf2716">iproc</a>[i]);
<a name="l00226"></a>00226       printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00227"></a>00227 <span class="preprocessor">#endif</span>
<a name="l00228"></a>00228 <span class="preprocessor"></span>        printf(<span class="stringliteral">&quot;\tNo. of ghosts pts                          : %d\n&quot;</span>     ,solver-&gt;<a class="code" href="a00015.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>              );
<a name="l00229"></a>00229         printf(<span class="stringliteral">&quot;\tNo. of iter.                               : %d\n&quot;</span>     ,solver-&gt;<a class="code" href="a00015.html#af0d8e0d5d3de3869b941b66b6caaf964">n_iter</a>              );
<a name="l00230"></a>00230         printf(<span class="stringliteral">&quot;\tRestart iteration                          : %d\n&quot;</span>     ,solver-&gt;<a class="code" href="a00015.html#aafb41b96563d9966e8e9f458751f2960">restart_iter</a>        );
<a name="l00231"></a>00231 <span class="preprocessor">#ifdef with_petsc</span>
<a name="l00232"></a>00232 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (solver-&gt;<a class="code" href="a00015.html#ad195de8c64c407718e42cda9246be0d2">use_petscTS</a>)
<a name="l00233"></a>00233         printf(<span class="stringliteral">&quot;\tTime integration scheme                    : PETSc \n&quot;</span>                            );
<a name="l00234"></a>00234       <span class="keywordflow">else</span> {
<a name="l00235"></a>00235         printf(<span class="stringliteral">&quot;\tTime integration scheme                    : %s &quot;</span>,solver-&gt;<a class="code" href="a00015.html#a138e751362d14724df8e6ab27c4a5e55">time_scheme</a>             );
<a name="l00236"></a>00236         <span class="keywordflow">if</span> (strcmp(solver-&gt;<a class="code" href="a00015.html#a138e751362d14724df8e6ab27c4a5e55">time_scheme</a>,<a class="code" href="a00061.html#af9b1e641532cff8859c5c5a8377f5feb">_FORWARD_EULER_</a>)) {
<a name="l00237"></a>00237           printf(<span class="stringliteral">&quot;(%s)&quot;</span>,solver-&gt;<a class="code" href="a00015.html#a61750696383420ba8bcc7d9e44a538e2">time_scheme_type</a>                                                    );
<a name="l00238"></a>00238         }
<a name="l00239"></a>00239         printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00240"></a>00240       }
<a name="l00241"></a>00241 <span class="preprocessor">#else</span>
<a name="l00242"></a>00242 <span class="preprocessor"></span>      printf(<span class="stringliteral">&quot;\tTime integration scheme                    : %s &quot;</span>,solver-&gt;<a class="code" href="a00015.html#a138e751362d14724df8e6ab27c4a5e55">time_scheme</a>               );
<a name="l00243"></a>00243       <span class="keywordflow">if</span> (strcmp(solver-&gt;<a class="code" href="a00015.html#a138e751362d14724df8e6ab27c4a5e55">time_scheme</a>,<a class="code" href="a00061.html#af9b1e641532cff8859c5c5a8377f5feb">_FORWARD_EULER_</a>)) {
<a name="l00244"></a>00244         printf(<span class="stringliteral">&quot;(%s)&quot;</span>,solver-&gt;<a class="code" href="a00015.html#a61750696383420ba8bcc7d9e44a538e2">time_scheme_type</a>                                                      );
<a name="l00245"></a>00245       }
<a name="l00246"></a>00246       printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00247"></a>00247 <span class="preprocessor">#endif</span>
<a name="l00248"></a>00248 <span class="preprocessor"></span>      printf(<span class="stringliteral">&quot;\tSpatial discretization scheme (hyperbolic) : %s\n&quot;</span>     ,solver-&gt;<a class="code" href="a00015.html#ad29846eeb9c83b329a8d7c1fe69d46b2">spatial_scheme_hyp</a>  );
<a name="l00249"></a>00249       printf(<span class="stringliteral">&quot;\tSplit hyperbolic flux term?                : %s\n&quot;</span>     ,solver-&gt;<a class="code" href="a00015.html#a5bed0cb9665daad89f4377c4f7609df4">SplitHyperbolicFlux</a> );
<a name="l00250"></a>00250       printf(<span class="stringliteral">&quot;\tInterpolation type for hyperbolic term     : %s\n&quot;</span>     ,solver-&gt;<a class="code" href="a00015.html#a9591ba0fadb863561474e2ba251d2594">interp_type</a>         );
<a name="l00251"></a>00251       printf(<span class="stringliteral">&quot;\tSpatial discretization type   (parabolic ) : %s\n&quot;</span>     ,solver-&gt;<a class="code" href="a00015.html#ad45d57b33d578bf602574a221bf53d93">spatial_type_par</a>    );
<a name="l00252"></a>00252       printf(<span class="stringliteral">&quot;\tSpatial discretization scheme (parabolic ) : %s\n&quot;</span>     ,solver-&gt;<a class="code" href="a00015.html#a170f2f6cc8ac86b78fcb376c2392e290">spatial_scheme_par</a>  );
<a name="l00253"></a>00253         printf(<span class="stringliteral">&quot;\tTime Step                                  : %E\n&quot;</span>     ,solver-&gt;<a class="code" href="a00015.html#a03e28be41881b703c836edbfe9b51b17">dt</a>                  );
<a name="l00254"></a>00254         printf(<span class="stringliteral">&quot;\tCheck for conservation                     : %s\n&quot;</span>     ,solver-&gt;<a class="code" href="a00015.html#ac92c34fe456d92c694eacd2231f5a7b1">ConservationCheck</a>   );
<a name="l00255"></a>00255       printf(<span class="stringliteral">&quot;\tScreen output iterations                   : %d\n&quot;</span>     ,solver-&gt;<a class="code" href="a00015.html#a74ff7fa96cbfc4ee87f508f964e94409">screen_op_iter</a>      );
<a name="l00256"></a>00256       printf(<span class="stringliteral">&quot;\tFile output iterations                     : %d\n&quot;</span>     ,solver-&gt;<a class="code" href="a00015.html#a6ff746b30ee55a3bbb9f3306c145f27a">file_op_iter</a>        );
<a name="l00257"></a>00257       printf(<span class="stringliteral">&quot;\tInitial solution file type                 : %s\n&quot;</span>     ,solver-&gt;<a class="code" href="a00015.html#a83f3dcd022f744511a44f2a31a824ac8">ip_file_type</a>        );
<a name="l00258"></a>00258       printf(<span class="stringliteral">&quot;\tInitial solution read mode                 : %s&quot;</span>       ,solver-&gt;<a class="code" href="a00015.html#a0a0b9dc97c7c278a019939d301db9399">input_mode</a>          );
<a name="l00259"></a>00259       <span class="keywordflow">if</span> (strcmp(solver-&gt;<a class="code" href="a00015.html#a0a0b9dc97c7c278a019939d301db9399">input_mode</a>,<span class="stringliteral">&quot;serial&quot;</span>))    printf(<span class="stringliteral">&quot;\t[%d file IO rank(s)]\n&quot;</span>,mpi-&gt;<a class="code" href="a00019.html#a297fca986fa3aa27de07a0c746ffaaa8">N_IORanks</a>  );
<a name="l00260"></a>00260       <span class="keywordflow">else</span>                                        printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00261"></a>00261       printf(<span class="stringliteral">&quot;\tSolution file write mode                   : %s&quot;</span>       ,solver-&gt;<a class="code" href="a00015.html#a5f89e286a9eaffdb66d966fa6a290d3f">output_mode</a>         );
<a name="l00262"></a>00262       <span class="keywordflow">if</span> (strcmp(solver-&gt;<a class="code" href="a00015.html#a5f89e286a9eaffdb66d966fa6a290d3f">output_mode</a>,<span class="stringliteral">&quot;serial&quot;</span>))   printf(<span class="stringliteral">&quot;\t[%d file IO rank(s)]\n&quot;</span>,mpi-&gt;<a class="code" href="a00019.html#a297fca986fa3aa27de07a0c746ffaaa8">N_IORanks</a>  );
<a name="l00263"></a>00263       <span class="keywordflow">else</span>                                        printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00264"></a>00264       printf(<span class="stringliteral">&quot;\tSolution file format                       : %s\n&quot;</span>     ,solver-&gt;<a class="code" href="a00015.html#a51a3b8c19b86e9e1df5be02b05a6613c">op_file_format</a>      );
<a name="l00265"></a>00265       printf(<span class="stringliteral">&quot;\tOverwrite solution file                    : %s\n&quot;</span>     ,solver-&gt;<a class="code" href="a00015.html#a4e93cb107e180ef982b74cef7726b70f">op_overwrite</a>        );
<a name="l00266"></a>00266       printf(<span class="stringliteral">&quot;\tPhysical model                             : %s\n&quot;</span>     ,solver-&gt;<a class="code" href="a00015.html#ad3fe4b266b398f3a7567ac1b241d99a2">model</a>               );
<a name="l00267"></a>00267       <span class="keywordflow">if</span> (solver-&gt;<a class="code" href="a00015.html#ae83b1b0117b6a805ead2e4728945814c">flag_ib</a>) {
<a name="l00268"></a>00268         printf(<span class="stringliteral">&quot;\tImmersed Body                              : %s\n&quot;</span>     ,solver-&gt;<a class="code" href="a00015.html#a43ee3672350b4fd385871b6512e5d47b">ib_filename</a>         );
<a name="l00269"></a>00269       }
<a name="l00270"></a>00270     }
<a name="l00271"></a>00271     <span class="comment">/* checks - restart only supported for binary output files */</span>
<a name="l00272"></a>00272     <span class="keywordflow">if</span> ((solver-&gt;<a class="code" href="a00015.html#aafb41b96563d9966e8e9f458751f2960">restart_iter</a> != 0) &amp;&amp; strcmp(solver-&gt;<a class="code" href="a00015.html#a51a3b8c19b86e9e1df5be02b05a6613c">op_file_format</a>,<span class="stringliteral">&quot;binary&quot;</span>)) {
<a name="l00273"></a>00273       <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a00019.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) fprintf(stderr,<span class="stringliteral">&quot;Error in ReadInputs(): Restart is supported only for binary output files.\n&quot;</span>);
<a name="l00274"></a>00274       <span class="keywordflow">return</span>(1);
<a name="l00275"></a>00275     }
<a name="l00276"></a>00276   }
<a name="l00277"></a>00277 
<a name="l00278"></a>00278 <span class="preprocessor">#ifndef serial</span>
<a name="l00279"></a>00279 <span class="preprocessor"></span>  <span class="comment">/* Broadcast the input parameters */</span>
<a name="l00280"></a>00280   <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#acd7957559b9206224c7da3cab4f22b27">MPIBroadcast_integer</a>(&amp;solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,1,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00281"></a>00281   <span class="keywordflow">if</span> (mpi-&gt;<a class="code" href="a00019.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) {
<a name="l00282"></a>00282     solver-&gt;<a class="code" href="a00015.html#aa989ebb755986852177779cdf7bd8c85">dim_global</a> = (<span class="keywordtype">int</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00283"></a>00283     mpi-&gt;<a class="code" href="a00019.html#a0be0f30a83bc3f3d9f6ee3a36bbf2716">iproc</a>         = (<span class="keywordtype">int</span>*) calloc (solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00284"></a>00284   }
<a name="l00285"></a>00285   <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#acd7957559b9206224c7da3cab4f22b27">MPIBroadcast_integer</a>(&amp;solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>              ,1            ,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00286"></a>00286   <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#acd7957559b9206224c7da3cab4f22b27">MPIBroadcast_integer</a>( solver-&gt;<a class="code" href="a00015.html#aa989ebb755986852177779cdf7bd8c85">dim_global</a>         ,solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00287"></a>00287   <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#acd7957559b9206224c7da3cab4f22b27">MPIBroadcast_integer</a>( mpi-&gt;<a class="code" href="a00019.html#a0be0f30a83bc3f3d9f6ee3a36bbf2716">iproc</a>                 ,solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00288"></a>00288   <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#acd7957559b9206224c7da3cab4f22b27">MPIBroadcast_integer</a>(&amp;mpi-&gt;<a class="code" href="a00019.html#a297fca986fa3aa27de07a0c746ffaaa8">N_IORanks</a>             ,1            ,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00289"></a>00289   <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#acd7957559b9206224c7da3cab4f22b27">MPIBroadcast_integer</a>(&amp;solver-&gt;<a class="code" href="a00015.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>             ,1            ,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00290"></a>00290   <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#acd7957559b9206224c7da3cab4f22b27">MPIBroadcast_integer</a>(&amp;solver-&gt;<a class="code" href="a00015.html#af0d8e0d5d3de3869b941b66b6caaf964">n_iter</a>             ,1            ,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00291"></a>00291   <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#acd7957559b9206224c7da3cab4f22b27">MPIBroadcast_integer</a>(&amp;solver-&gt;<a class="code" href="a00015.html#aafb41b96563d9966e8e9f458751f2960">restart_iter</a>       ,1            ,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00292"></a>00292   <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#acd7957559b9206224c7da3cab4f22b27">MPIBroadcast_integer</a>(&amp;solver-&gt;<a class="code" href="a00015.html#a74ff7fa96cbfc4ee87f508f964e94409">screen_op_iter</a>     ,1            ,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00293"></a>00293   <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#acd7957559b9206224c7da3cab4f22b27">MPIBroadcast_integer</a>(&amp;solver-&gt;<a class="code" href="a00015.html#a6ff746b30ee55a3bbb9f3306c145f27a">file_op_iter</a>       ,1            ,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00294"></a>00294   <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#acd7957559b9206224c7da3cab4f22b27">MPIBroadcast_integer</a>(&amp;solver-&gt;<a class="code" href="a00015.html#ae83b1b0117b6a805ead2e4728945814c">flag_ib</a>            ,1            ,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00295"></a>00295 
<a name="l00296"></a>00296   <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#ad408e5a44e863cca50112d1e2f728597">MPIBroadcast_character</a>(solver-&gt;<a class="code" href="a00015.html#a138e751362d14724df8e6ab27c4a5e55">time_scheme</a>         ,<a class="code" href="a00036.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00297"></a>00297   <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#ad408e5a44e863cca50112d1e2f728597">MPIBroadcast_character</a>(solver-&gt;<a class="code" href="a00015.html#a61750696383420ba8bcc7d9e44a538e2">time_scheme_type</a>    ,<a class="code" href="a00036.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00298"></a>00298   <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#ad408e5a44e863cca50112d1e2f728597">MPIBroadcast_character</a>(solver-&gt;<a class="code" href="a00015.html#ad29846eeb9c83b329a8d7c1fe69d46b2">spatial_scheme_hyp</a>  ,<a class="code" href="a00036.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00299"></a>00299   <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#ad408e5a44e863cca50112d1e2f728597">MPIBroadcast_character</a>(solver-&gt;<a class="code" href="a00015.html#a9591ba0fadb863561474e2ba251d2594">interp_type</a>         ,<a class="code" href="a00036.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00300"></a>00300   <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#ad408e5a44e863cca50112d1e2f728597">MPIBroadcast_character</a>(solver-&gt;<a class="code" href="a00015.html#ad45d57b33d578bf602574a221bf53d93">spatial_type_par</a>    ,<a class="code" href="a00036.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00301"></a>00301   <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#ad408e5a44e863cca50112d1e2f728597">MPIBroadcast_character</a>(solver-&gt;<a class="code" href="a00015.html#a170f2f6cc8ac86b78fcb376c2392e290">spatial_scheme_par</a>  ,<a class="code" href="a00036.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00302"></a>00302   <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#ad408e5a44e863cca50112d1e2f728597">MPIBroadcast_character</a>(solver-&gt;<a class="code" href="a00015.html#ac92c34fe456d92c694eacd2231f5a7b1">ConservationCheck</a>   ,<a class="code" href="a00036.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00303"></a>00303   <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#ad408e5a44e863cca50112d1e2f728597">MPIBroadcast_character</a>(solver-&gt;<a class="code" href="a00015.html#a5bed0cb9665daad89f4377c4f7609df4">SplitHyperbolicFlux</a> ,<a class="code" href="a00036.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00304"></a>00304   <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#ad408e5a44e863cca50112d1e2f728597">MPIBroadcast_character</a>(solver-&gt;<a class="code" href="a00015.html#a51a3b8c19b86e9e1df5be02b05a6613c">op_file_format</a>      ,<a class="code" href="a00036.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00305"></a>00305   <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#ad408e5a44e863cca50112d1e2f728597">MPIBroadcast_character</a>(solver-&gt;<a class="code" href="a00015.html#a83f3dcd022f744511a44f2a31a824ac8">ip_file_type</a>        ,<a class="code" href="a00036.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00306"></a>00306   <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#ad408e5a44e863cca50112d1e2f728597">MPIBroadcast_character</a>(solver-&gt;<a class="code" href="a00015.html#a0a0b9dc97c7c278a019939d301db9399">input_mode</a>          ,<a class="code" href="a00036.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00307"></a>00307   <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#ad408e5a44e863cca50112d1e2f728597">MPIBroadcast_character</a>(solver-&gt;<a class="code" href="a00015.html#a5f89e286a9eaffdb66d966fa6a290d3f">output_mode</a>         ,<a class="code" href="a00036.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00308"></a>00308   <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#ad408e5a44e863cca50112d1e2f728597">MPIBroadcast_character</a>(solver-&gt;<a class="code" href="a00015.html#a4e93cb107e180ef982b74cef7726b70f">op_overwrite</a>        ,<a class="code" href="a00036.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00309"></a>00309   <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#ad408e5a44e863cca50112d1e2f728597">MPIBroadcast_character</a>(solver-&gt;<a class="code" href="a00015.html#ad3fe4b266b398f3a7567ac1b241d99a2">model</a>               ,<a class="code" href="a00036.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00310"></a>00310   <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#ad408e5a44e863cca50112d1e2f728597">MPIBroadcast_character</a>(solver-&gt;<a class="code" href="a00015.html#a43ee3672350b4fd385871b6512e5d47b">ib_filename</a>         ,<a class="code" href="a00036.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00311"></a>00311 
<a name="l00312"></a>00312   <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00045.html#a45dcb265863a65d862bb16222e7e623c">MPIBroadcast_double</a>(&amp;solver-&gt;<a class="code" href="a00015.html#a03e28be41881b703c836edbfe9b51b17">dt</a>,1,0,&amp;mpi-&gt;<a class="code" href="a00019.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00313"></a>00313 <span class="preprocessor">#endif</span>
<a name="l00314"></a>00314 <span class="preprocessor"></span>
<a name="l00315"></a>00315   <span class="keywordflow">return</span>(0);
<a name="l00316"></a>00316 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5242c7db89f8888de5d72251e5da91c2"></a><!-- doxytag: member="hypar.h::Solve" ref="a5242c7db89f8888de5d72251e5da91c2" args="(void *, void *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int Solve </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>m</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Solve the PDE - time-integration</p>
<p>This function integrates the semi-discrete ODE (obtained from discretizing the PDE in space) using natively implemented time integration methods. It initializes the time integration object, iterates the simulation for the required number of time steps, and calculates the errors. After the specified number of iterations, it writes out some information to the screen and the solution to a file. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>s</em>&nbsp;</td><td>Solver object of type <a class="el" href="a00015.html" title="Structure containing all solver-specific variables and functions.">HyPar</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>m</em>&nbsp;</td><td>MPI object of type <a class="el" href="a00019.html" title="Structure of MPI-related variables.">MPIVariables</a> </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00113_source.html#l00022">22</a> of file <a class="el" href="a00113_source.html">Solve.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00026"></a>00026 {
<a name="l00027"></a>00027   <a class="code" href="a00015.html" title="Structure containing all solver-specific variables and functions.">HyPar</a>         *solver = (<a class="code" href="a00015.html" title="Structure containing all solver-specific variables and functions.">HyPar</a>*)        s;
<a name="l00028"></a>00028   <a class="code" href="a00019.html" title="Structure of MPI-related variables.">MPIVariables</a>  *mpi    = (<a class="code" href="a00019.html" title="Structure of MPI-related variables.">MPIVariables</a>*) m;
<a name="l00029"></a>00029   <span class="keywordtype">int</span>           tic     = 0;
<a name="l00030"></a>00030   <a class="code" href="a00036.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a>;
<a name="l00031"></a>00031 
<a name="l00032"></a>00032   <span class="comment">/* write out iblank to file for visualization */</span>
<a name="l00033"></a>00033   <span class="keywordflow">if</span> (solver-&gt;<a class="code" href="a00015.html#ae83b1b0117b6a805ead2e4728945814c">flag_ib</a>) {
<a name="l00034"></a>00034     <a class="code" href="a00042.html#aaf888c739c5200d9c58a7154347069b0">WriteArray</a>(solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,1,solver-&gt;<a class="code" href="a00015.html#aa989ebb755986852177779cdf7bd8c85">dim_global</a>,solver-&gt;<a class="code" href="a00015.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,
<a name="l00035"></a>00035                solver-&gt;<a class="code" href="a00015.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,solver-&gt;<a class="code" href="a00015.html#a711aad4cbe735871dd9e91ab575c878b">x</a>,solver-&gt;<a class="code" href="a00015.html#a267ef7e03dbe9dd4440dee2fdf48619a">iblank</a>,solver,mpi,<span class="stringliteral">&quot;iblank&quot;</span>);
<a name="l00036"></a>00036   }
<a name="l00037"></a>00037 
<a name="l00038"></a>00038   <span class="comment">/* Define and initialize the time-integration object */</span>
<a name="l00039"></a>00039   <a class="code" href="a00028.html" title="Structure of variables/parameters and function pointers for time integration.">TimeIntegration</a> TS;
<a name="l00040"></a>00040   <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a00019.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) printf(<span class="stringliteral">&quot;Setting up time integration.\n&quot;</span>);
<a name="l00041"></a>00041   <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00061.html#adc5448ce618349cfcb304addd7bf23b9">TimeInitialize</a>(solver,mpi,&amp;TS); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00042"></a>00042 
<a name="l00043"></a>00043   <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a00019.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) printf(<span class="stringliteral">&quot;Solving in time (from %d to %d iterations)\n&quot;</span>,TS.<a class="code" href="a00028.html#aafb41b96563d9966e8e9f458751f2960">restart_iter</a>,TS.<a class="code" href="a00028.html#af0d8e0d5d3de3869b941b66b6caaf964">n_iter</a>);
<a name="l00044"></a>00044   <span class="keywordflow">for</span> (TS.<a class="code" href="a00028.html#aab6f168571c2073e01e240524b8a3da0">iter</a> = TS.<a class="code" href="a00028.html#aafb41b96563d9966e8e9f458751f2960">restart_iter</a>; TS.<a class="code" href="a00028.html#aab6f168571c2073e01e240524b8a3da0">iter</a> &lt; TS.<a class="code" href="a00028.html#af0d8e0d5d3de3869b941b66b6caaf964">n_iter</a>; TS.<a class="code" href="a00028.html#aab6f168571c2073e01e240524b8a3da0">iter</a>++) {
<a name="l00045"></a>00045 
<a name="l00046"></a>00046     <span class="comment">/* Write initial solution to file if this is the first iteration */</span>
<a name="l00047"></a>00047     <span class="keywordflow">if</span> (!TS.<a class="code" href="a00028.html#aab6f168571c2073e01e240524b8a3da0">iter</a>) { 
<a name="l00048"></a>00048       <span class="keywordflow">if</span> (solver-&gt;<a class="code" href="a00015.html#ab4c55736e92f7d72f04b8a957d82b054">PhysicsOutput</a>) {
<a name="l00049"></a>00049         <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00015.html#ab4c55736e92f7d72f04b8a957d82b054">PhysicsOutput</a>(solver,mpi); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00050"></a>00050       }
<a name="l00051"></a>00051       <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00039.html#abff21fd701b932c05e9e0dac925bcf29">OutputSolution</a>(solver,mpi); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr); 
<a name="l00052"></a>00052     }
<a name="l00053"></a>00053 
<a name="l00054"></a>00054     <span class="comment">/* Call pre-step function */</span>
<a name="l00055"></a>00055     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00061.html#a2afba6dcdd13eb929ad4cb54a71eb470">TimePreStep</a>  (&amp;TS); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00056"></a>00056 <span class="preprocessor">#ifdef compute_rhs_operators</span>
<a name="l00057"></a>00057 <span class="preprocessor"></span>    <span class="comment">/* compute and write (to file) matrix operators representing the right-hand side */</span>
<a name="l00058"></a>00058     <span class="keywordflow">if</span> (((TS.<a class="code" href="a00028.html#aab6f168571c2073e01e240524b8a3da0">iter</a>+1)%solver-&gt;<a class="code" href="a00015.html#a6ff746b30ee55a3bbb9f3306c145f27a">file_op_iter</a> == 0) || (!TS.<a class="code" href="a00028.html#aab6f168571c2073e01e240524b8a3da0">iter</a>)) 
<a name="l00059"></a>00059       { <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00096.html#ad14888d0f63cc4137735c200b0687c59">ComputeRHSOperators</a>(solver,mpi,TS.<a class="code" href="a00028.html#a28e4e78c0bf258662bef21d26c51fc0b">waqt</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr); }
<a name="l00060"></a>00060 <span class="preprocessor">#endif</span>
<a name="l00061"></a>00061 <span class="preprocessor"></span>
<a name="l00062"></a>00062     <span class="comment">/* Step in time */</span>
<a name="l00063"></a>00063     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00061.html#acb00956b2e195653e3f8107b1ab1dc4d">TimeStep</a>     (&amp;TS); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00064"></a>00064 
<a name="l00065"></a>00065     <span class="comment">/* Call post-step function */</span>
<a name="l00066"></a>00066     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00061.html#a25f8d76bc92804608cd299e63e23291c">TimePostStep</a> (&amp;TS); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00067"></a>00067 
<a name="l00068"></a>00068     <span class="comment">/* Print information to screen */</span>
<a name="l00069"></a>00069     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00061.html#aa1ffb2050f4788b7c49b4576a9fe52ca">TimePrintStep</a>(&amp;TS); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00070"></a>00070     tic++;
<a name="l00071"></a>00071 
<a name="l00072"></a>00072     <span class="comment">/* Write intermediate solution to file */</span>
<a name="l00073"></a>00073     <span class="keywordflow">if</span> ((TS.<a class="code" href="a00028.html#aab6f168571c2073e01e240524b8a3da0">iter</a>+1)%solver-&gt;<a class="code" href="a00015.html#a6ff746b30ee55a3bbb9f3306c145f27a">file_op_iter</a> == 0) { 
<a name="l00074"></a>00074       <span class="keywordflow">if</span> (solver-&gt;<a class="code" href="a00015.html#ab4c55736e92f7d72f04b8a957d82b054">PhysicsOutput</a>) {
<a name="l00075"></a>00075         <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00015.html#ab4c55736e92f7d72f04b8a957d82b054">PhysicsOutput</a>(solver,mpi); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00076"></a>00076       }
<a name="l00077"></a>00077       <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00039.html#abff21fd701b932c05e9e0dac925bcf29">OutputSolution</a>(solver,mpi); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr); 
<a name="l00078"></a>00078       tic = 0; 
<a name="l00079"></a>00079     }
<a name="l00080"></a>00080 
<a name="l00081"></a>00081   }
<a name="l00082"></a>00082 
<a name="l00083"></a>00083   <span class="comment">/* write a final solution file, if last iteration did not write one */</span>
<a name="l00084"></a>00084   <span class="keywordflow">if</span> (tic || (!TS.<a class="code" href="a00028.html#af0d8e0d5d3de3869b941b66b6caaf964">n_iter</a>)) { 
<a name="l00085"></a>00085     <span class="keywordflow">if</span> (solver-&gt;<a class="code" href="a00015.html#ab4c55736e92f7d72f04b8a957d82b054">PhysicsOutput</a>) {
<a name="l00086"></a>00086       <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00015.html#ab4c55736e92f7d72f04b8a957d82b054">PhysicsOutput</a>(solver,mpi); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00087"></a>00087     }
<a name="l00088"></a>00088     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00039.html#abff21fd701b932c05e9e0dac925bcf29">OutputSolution</a>(solver,mpi); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr); 
<a name="l00089"></a>00089   }
<a name="l00090"></a>00090 
<a name="l00091"></a>00091   <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a00019.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) printf(<span class="stringliteral">&quot;Completed time integration (Final time: %f).\n&quot;</span>,TS.<a class="code" href="a00028.html#a28e4e78c0bf258662bef21d26c51fc0b">waqt</a>);
<a name="l00092"></a>00092 
<a name="l00093"></a>00093   <span class="comment">/* calculate error if exact solution has been provided */</span>
<a name="l00094"></a>00094   <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00039.html#a116876aaf447559b6cc9fff36a501843">CalculateError</a>(solver,mpi); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00095"></a>00095   <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00061.html#a85984dec08cd43570151a625ab62f8d9">TimeCleanup</a>(&amp;TS); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00096"></a>00096   <span class="keywordflow">return</span>(0);
<a name="l00097"></a>00097 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4dc9b9ce6ce776b7901fa2a6c9c9c1cf"></a><!-- doxytag: member="hypar.h::SolvePETSc" ref="a4dc9b9ce6ce776b7901fa2a6c9c9c1cf" args="(void *, void *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int SolvePETSc </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>m</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Integrate in time with PETSc. </p>
<p>Solve the PDE using PETSc TS</p>
<p>This function integrates the semi-discrete ODE (obtained from discretizing the PDE in space) using the time-integration module of PETSc (<a href="http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/index.html">http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/TS/index.html</a>). The time-integration context is set up using the parameters specified in the input file. However, they can also be specified using PETSc's command line inputs.<br/>
 <br/>
 See PETSc's documentation and examples for more details on how to use its TS module. All functions and data types whose names start with Vec, Mat, PC, KSP, SNES, and TS are PETSc functions - refer to the PETSc documentation (usually googling with the function name shows the man page for that function on PETSc's website). </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>s</em>&nbsp;</td><td>Solver object of type <a class="el" href="a00015.html" title="Structure containing all solver-specific variables and functions.">HyPar</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>m</em>&nbsp;</td><td>MPI object of type <a class="el" href="a00019.html" title="Structure of MPI-related variables.">MPIVariables</a> </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00114_source.html#l00042">42</a> of file <a class="el" href="a00114_source.html">SolvePETSc.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00044"></a>00044 {
<a name="l00045"></a>00045   <a class="code" href="a00015.html" title="Structure containing all solver-specific variables and functions.">HyPar</a>           *solver = (<a class="code" href="a00015.html" title="Structure containing all solver-specific variables and functions.">HyPar</a>*)        s;
<a name="l00046"></a>00046   <a class="code" href="a00019.html" title="Structure of MPI-related variables.">MPIVariables</a>    *mpi    = (<a class="code" href="a00019.html" title="Structure of MPI-related variables.">MPIVariables</a>*) m;
<a name="l00047"></a>00047   PetscErrorCode  ierr    = 0, d;
<a name="l00048"></a>00048   TS              ts;     <span class="comment">/* time integration object               */</span>
<a name="l00049"></a>00049   Vec             Y,Z;    <span class="comment">/* PETSc solution vectors                */</span>
<a name="l00050"></a>00050   Mat             A, B;   <span class="comment">/* Jacobian and preconditioning matrices */</span>
<a name="l00051"></a>00051   TSType          time_scheme;  <span class="comment">/* time integration method         */</span>
<a name="l00052"></a>00052   TSProblemType   ptype;  <span class="comment">/* problem type - nonlinear or linear    */</span>
<a name="l00053"></a>00053   <span class="keywordtype">int</span>             flag_mat_a = 0, flag_mat_b = 0, iAuxSize = 0, i;
<a name="l00054"></a>00054 
<a name="l00055"></a>00055   PetscFunctionBegin;
<a name="l00056"></a>00056 
<a name="l00057"></a>00057   <span class="comment">/* Register custom time-integration methods, if specified */</span>
<a name="l00058"></a>00058   ierr = <a class="code" href="a00046.html#a005fac516715e5fb65baa1540a79c82c">PetscRegisterTIMethods</a>(mpi-&gt;<a class="code" href="a00019.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00059"></a>00059   <span class="keywordflow">if</span>(!mpi-&gt;<a class="code" href="a00019.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) printf(<span class="stringliteral">&quot;Setting up PETSc time integration... \n&quot;</span>);
<a name="l00060"></a>00060 
<a name="l00061"></a>00061   <span class="comment">/* create and set a PETSc context */</span>
<a name="l00062"></a>00062   <a class="code" href="a00025.html" title="Structure containing the variables for time-integration with PETSc.">PETScContext</a> context;
<a name="l00063"></a>00063   context.<a class="code" href="a00025.html#ade1bc5cad8c6735a891a28f637cbfb06">solver</a> = solver;
<a name="l00064"></a>00064   context.<a class="code" href="a00025.html#abaa15763a88d05dc68ff230ce570eee9">mpi</a>    = mpi;
<a name="l00065"></a>00065   context.<a class="code" href="a00025.html#a34cbd56d5136d5e8b5ea2cbb901c04cd">tic</a>    = 0;
<a name="l00066"></a>00066   context.<a class="code" href="a00025.html#a376b6b34e162357d201827d01a5aa2a4">flag_hyperbolic</a>     = <a class="code" href="a00046.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>; 
<a name="l00067"></a>00067   context.<a class="code" href="a00025.html#a6a0edd627a2b2cc687d1031e3884dd6a">flag_hyperbolic_f</a>   = <a class="code" href="a00046.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>; 
<a name="l00068"></a>00068   context.<a class="code" href="a00025.html#a21b4785029b7597816341479bc3260b4">flag_hyperbolic_df</a>  = <a class="code" href="a00046.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>; 
<a name="l00069"></a>00069   context.<a class="code" href="a00025.html#ac48ad2561e5e125d2789133e848db1d9">flag_parabolic</a>      = <a class="code" href="a00046.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>; 
<a name="l00070"></a>00070   context.<a class="code" href="a00025.html#a54c0451c4ae9650a54f54246f1f8823b">flag_source</a>         = <a class="code" href="a00046.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>; 
<a name="l00071"></a>00071   context.<a class="code" href="a00025.html#a200f63fcca813d56a5cf3209546cedb2">flag_is_linear</a>      = 0;
<a name="l00072"></a>00072   context.<a class="code" href="a00025.html#a0c5f291f027b0928672b89121f44c0fc">globalDOF</a>           = NULL;
<a name="l00073"></a>00073   context.<a class="code" href="a00025.html#ab991f69858c9aada0736623db264237e">points</a>              = NULL;
<a name="l00074"></a>00074 
<a name="l00075"></a>00075   ierr = <a class="code" href="a00046.html#ae4a99505d5f322bfc1c590e3d31fcc0b">PetscCreatePointList</a>(&amp;context);
<a name="l00076"></a>00076 
<a name="l00077"></a>00077   <span class="comment">/* create and initialize PETSc solution vector and other parameters */</span>
<a name="l00078"></a>00078   <span class="comment">/* PETSc solution vector does not have ghost points */</span>
<a name="l00079"></a>00079   <span class="keywordtype">int</span> total_size = context.<a class="code" href="a00025.html#a515ec0fe2abce5449e37ae520974cf5f">npoints</a> * solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>;
<a name="l00080"></a>00080   ierr = VecCreate(MPI_COMM_WORLD,&amp;Y); CHKERRQ(ierr);
<a name="l00081"></a>00081   ierr = VecSetSizes(Y,total_size,PETSC_DECIDE); CHKERRQ(ierr);
<a name="l00082"></a>00082   ierr = VecSetUp(Y); CHKERRQ(ierr);
<a name="l00083"></a>00083 
<a name="l00084"></a>00084   <span class="comment">/* copy initial solution to PETSc&apos;s vector */</span>
<a name="l00085"></a>00085   ierr = <a class="code" href="a00046.html#a94499efe0f52b5174ce7105de5ab1a37">TransferVecToPETSc</a>(solver-&gt;<a class="code" href="a00015.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>,Y,&amp;context); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00086"></a>00086 
<a name="l00087"></a>00087   <span class="comment">/* Create the global DOF mapping for all the grid points */</span>
<a name="l00088"></a>00088   ierr = <a class="code" href="a00046.html#ae4815491f5992839fdb3949e5dedec8e">PetscGlobalDOF</a>(&amp;context);
<a name="l00089"></a>00089 
<a name="l00090"></a>00090   <span class="comment">/* Define and initialize the time-integration object */</span>
<a name="l00091"></a>00091   ierr = TSCreate(MPI_COMM_WORLD,&amp;ts); CHKERRQ(ierr);
<a name="l00092"></a>00092   ierr = TSSetMaxSteps(ts,solver-&gt;<a class="code" href="a00015.html#af0d8e0d5d3de3869b941b66b6caaf964">n_iter</a>); CHKERRQ(ierr);
<a name="l00093"></a>00093   ierr = TSSetMaxTime(ts,solver-&gt;<a class="code" href="a00015.html#a03e28be41881b703c836edbfe9b51b17">dt</a>*solver-&gt;<a class="code" href="a00015.html#af0d8e0d5d3de3869b941b66b6caaf964">n_iter</a>); CHKERRQ(ierr);
<a name="l00094"></a>00094   ierr = TSSetTimeStep(ts,solver-&gt;<a class="code" href="a00015.html#a03e28be41881b703c836edbfe9b51b17">dt</a>); CHKERRQ(ierr);
<a name="l00095"></a>00095   ierr = TSSetTime(ts,0.0); CHKERRQ(ierr);
<a name="l00096"></a>00096   ierr = TSSetExactFinalTime(ts,TS_EXACTFINALTIME_MATCHSTEP); CHKERRQ(ierr);
<a name="l00097"></a>00097   ierr = TSSetType(ts,TSBEULER); CHKERRQ(ierr);
<a name="l00098"></a>00098 
<a name="l00099"></a>00099   <span class="comment">/* set default time step adaptivity to none */</span>
<a name="l00100"></a>00100   TSAdapt adapt;
<a name="l00101"></a>00101   ierr = TSGetAdapt(ts,&amp;adapt);
<a name="l00102"></a>00102   TSAdaptSetType(adapt,TSADAPTNONE);
<a name="l00103"></a>00103 
<a name="l00104"></a>00104   <span class="comment">/* set options from input */</span>
<a name="l00105"></a>00105   ierr = TSSetFromOptions(ts); CHKERRQ(ierr);
<a name="l00106"></a>00106 
<a name="l00107"></a>00107   <span class="comment">/* Define the right and left -hand side functions for each time-integration scheme */</span>
<a name="l00108"></a>00108   ierr = TSGetType(ts,&amp;time_scheme); CHKERRQ(ierr);
<a name="l00109"></a>00109   ierr = TSGetProblemType(ts,&amp;ptype); CHKERRQ(ierr);
<a name="l00110"></a>00110   <span class="keywordflow">if</span> (!strcmp(time_scheme,TSARKIMEX)) {
<a name="l00111"></a>00111 
<a name="l00112"></a>00112     <span class="comment">/* implicit - explicit time integration */</span>
<a name="l00113"></a>00113 
<a name="l00114"></a>00114     ierr = TSSetRHSFunction(ts,PETSC_NULL,<a class="code" href="a00046.html#ac7d9b0a219eb22bfd37482b741bd79c9">PetscRHSFunctionIMEX</a>,&amp;context); CHKERRQ(ierr);
<a name="l00115"></a>00115     ierr = TSSetIFunction  (ts,PETSC_NULL,<a class="code" href="a00046.html#a9d093c3140369a1178dd5b9589a926b1">PetscIFunctionIMEX</a>,  &amp;context); CHKERRQ(ierr);
<a name="l00116"></a>00116 
<a name="l00117"></a>00117     SNES     snes;
<a name="l00118"></a>00118     KSP      ksp;
<a name="l00119"></a>00119     PC       pc;
<a name="l00120"></a>00120     SNESType snestype;
<a name="l00121"></a>00121     ierr = TSGetSNES(ts,&amp;snes); CHKERRQ(ierr);
<a name="l00122"></a>00122     ierr = SNESGetType(snes,&amp;snestype); CHKERRQ(ierr);
<a name="l00123"></a>00123 
<a name="l00124"></a>00124     <span class="comment">/* Matrix-free representation of the Jacobian */</span>
<a name="l00125"></a>00125     flag_mat_a = 1;
<a name="l00126"></a>00126     ierr = MatCreateShell(MPI_COMM_WORLD,total_size,total_size,PETSC_DETERMINE,
<a name="l00127"></a>00127                           PETSC_DETERMINE,&amp;context,&amp;A); CHKERRQ(ierr);
<a name="l00128"></a>00128     <span class="keywordflow">if</span> ((!strcmp(snestype,SNESKSPONLY)) || (ptype == TS_LINEAR)) {
<a name="l00129"></a>00129       <span class="comment">/* linear problem */</span>
<a name="l00130"></a>00130       context.<a class="code" href="a00025.html#a200f63fcca813d56a5cf3209546cedb2">flag_is_linear</a> = 1;
<a name="l00131"></a>00131       ierr = MatShellSetOperation(A,MATOP_MULT,(<span class="keywordtype">void</span> (*)(<span class="keywordtype">void</span>))<a class="code" href="a00046.html#a8778c346e27f42f0583c63909c2ea544">PetscJacobianFunctionIMEX_Linear</a>); CHKERRQ(ierr);
<a name="l00132"></a>00132       ierr = SNESSetType(snes,SNESKSPONLY); CHKERRQ(ierr);
<a name="l00133"></a>00133     } <span class="keywordflow">else</span> {
<a name="l00134"></a>00134       <span class="comment">/* nonlinear problem */</span>
<a name="l00135"></a>00135       context.<a class="code" href="a00025.html#a200f63fcca813d56a5cf3209546cedb2">flag_is_linear</a> = 0;
<a name="l00136"></a>00136       context.<a class="code" href="a00025.html#ad62e14c19e38497048380c4a7fe10e12">jfnk_eps</a> = 1<a class="code" href="a00032.html#a35b3e91c83139b35bbacfaa59a58afd1">e</a>-7;
<a name="l00137"></a>00137       ierr = PetscOptionsGetReal(NULL,NULL,<span class="stringliteral">&quot;-jfnk_epsilon&quot;</span>,&amp;context.<a class="code" href="a00025.html#ad62e14c19e38497048380c4a7fe10e12">jfnk_eps</a>,NULL); CHKERRQ(ierr);
<a name="l00138"></a>00138       ierr = MatShellSetOperation(A,MATOP_MULT,(<span class="keywordtype">void</span> (*)(<span class="keywordtype">void</span>))<a class="code" href="a00046.html#a4edf057726501be3e8fe54e16fafe07b">PetscJacobianFunctionIMEX_JFNK</a>); CHKERRQ(ierr);
<a name="l00139"></a>00139     }
<a name="l00140"></a>00140     ierr = MatSetUp(A); CHKERRQ(ierr);
<a name="l00141"></a>00141 
<a name="l00142"></a>00142     context.<a class="code" href="a00025.html#a271fbbfea71118710d4a2fb13eb4c1cc">flag_use_precon</a> = 0;
<a name="l00143"></a>00143     ierr = PetscOptionsGetBool(PETSC_NULL,PETSC_NULL,<span class="stringliteral">&quot;-with_pc&quot;</span>,(PetscBool*)(&amp;context.<a class="code" href="a00025.html#a271fbbfea71118710d4a2fb13eb4c1cc">flag_use_precon</a>),PETSC_NULL); CHKERRQ(ierr);
<a name="l00144"></a>00144 
<a name="l00145"></a>00145     <span class="keywordflow">if</span> (context.<a class="code" href="a00025.html#a271fbbfea71118710d4a2fb13eb4c1cc">flag_use_precon</a>) {
<a name="l00146"></a>00146       <span class="comment">/* check if flux Jacobian of the physical model is defined */</span>
<a name="l00147"></a>00147       <span class="keywordflow">if</span> (!solver-&gt;<a class="code" href="a00015.html#a15eea1647344c503deb1d9f89cead631">JFunction</a>) {
<a name="l00148"></a>00148         <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a00019.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) {
<a name="l00149"></a>00149           fprintf(stderr,<span class="stringliteral">&quot;Error in SolvePETSc(): solver-&gt;JFunction (point-wise flux Jacobian) must &quot;</span>);
<a name="l00150"></a>00150           fprintf(stderr,<span class="stringliteral">&quot;be defined for preconditioning.\n&quot;</span>);
<a name="l00151"></a>00151         }
<a name="l00152"></a>00152         PetscFunctionReturn(1);
<a name="l00153"></a>00153       }
<a name="l00154"></a>00154       <span class="comment">/* Set up preconditioner matrix */</span>
<a name="l00155"></a>00155       flag_mat_b = 1;
<a name="l00156"></a>00156       ierr = MatCreateAIJ(MPI_COMM_WORLD,total_size,total_size,PETSC_DETERMINE,PETSC_DETERMINE,
<a name="l00157"></a>00157                           (solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>*2+1)*solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,NULL,
<a name="l00158"></a>00158                           2*solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>*solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,NULL,&amp;B); CHKERRQ(ierr);
<a name="l00159"></a>00159       ierr = MatSetBlockSize(B,solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);
<a name="l00160"></a>00160       <span class="comment">/* Set the IJacobian function for TS */</span>
<a name="l00161"></a>00161       ierr = TSSetIJacobian(ts,A,B,<a class="code" href="a00046.html#a82aacb94c1481144ce3e43d40d1f04d4">PetscIJacobianIMEX</a>,&amp;context); CHKERRQ(ierr);
<a name="l00162"></a>00162     } <span class="keywordflow">else</span> {
<a name="l00163"></a>00163       <span class="comment">/* Set the IJacobian function for TS */</span>
<a name="l00164"></a>00164       ierr = TSSetIJacobian(ts,A,A,<a class="code" href="a00046.html#a82aacb94c1481144ce3e43d40d1f04d4">PetscIJacobianIMEX</a>,&amp;context); CHKERRQ(ierr);
<a name="l00165"></a>00165       <span class="comment">/* Set PC (preconditioner) to none */</span>
<a name="l00166"></a>00166       ierr = SNESGetKSP(snes,&amp;ksp); CHKERRQ(ierr);
<a name="l00167"></a>00167       ierr = KSPGetPC(ksp,&amp;pc); CHKERRQ(ierr);
<a name="l00168"></a>00168       ierr = PCSetType(pc,PCNONE); CHKERRQ(ierr);
<a name="l00169"></a>00169     }
<a name="l00170"></a>00170 
<a name="l00171"></a>00171     <span class="comment">/* read the implicit/explicit flags for each of the terms for IMEX schemes */</span>
<a name="l00172"></a>00172     <span class="comment">/* default -&gt; hyperbolic - explicit, parabolic and source - implicit       */</span>
<a name="l00173"></a>00173     PetscBool flag = PETSC_FALSE;
<a name="l00174"></a>00174 
<a name="l00175"></a>00175     context.<a class="code" href="a00025.html#a376b6b34e162357d201827d01a5aa2a4">flag_hyperbolic</a>     = <a class="code" href="a00046.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>; 
<a name="l00176"></a>00176     context.<a class="code" href="a00025.html#a6a0edd627a2b2cc687d1031e3884dd6a">flag_hyperbolic_f</a>   = <a class="code" href="a00046.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>; 
<a name="l00177"></a>00177     context.<a class="code" href="a00025.html#a21b4785029b7597816341479bc3260b4">flag_hyperbolic_df</a>  = <a class="code" href="a00046.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>; 
<a name="l00178"></a>00178     context.<a class="code" href="a00025.html#ac48ad2561e5e125d2789133e848db1d9">flag_parabolic</a>      = <a class="code" href="a00046.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>; 
<a name="l00179"></a>00179     context.<a class="code" href="a00025.html#a54c0451c4ae9650a54f54246f1f8823b">flag_source</a>         = <a class="code" href="a00046.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>; 
<a name="l00180"></a>00180 
<a name="l00181"></a>00181     <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#a5bed0cb9665daad89f4377c4f7609df4">SplitHyperbolicFlux</a>,<span class="stringliteral">&quot;yes&quot;</span>)) {
<a name="l00182"></a>00182 
<a name="l00183"></a>00183       flag = PETSC_FALSE; 
<a name="l00184"></a>00184       ierr = PetscOptionsGetBool(PETSC_NULL,PETSC_NULL,<span class="stringliteral">&quot;-hyperbolic_f_explicit&quot;</span>,&amp;flag,PETSC_NULL); CHKERRQ(ierr);
<a name="l00185"></a>00185       <span class="keywordflow">if</span> (flag == PETSC_TRUE) context.<a class="code" href="a00025.html#a6a0edd627a2b2cc687d1031e3884dd6a">flag_hyperbolic_f</a> = <a class="code" href="a00046.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>; 
<a name="l00186"></a>00186       flag = PETSC_FALSE; 
<a name="l00187"></a>00187       ierr = PetscOptionsGetBool(PETSC_NULL,PETSC_NULL,<span class="stringliteral">&quot;-hyperbolic_f_implicit&quot;</span>,&amp;flag,PETSC_NULL); CHKERRQ(ierr);
<a name="l00188"></a>00188       <span class="keywordflow">if</span> (flag == PETSC_TRUE) context.<a class="code" href="a00025.html#a6a0edd627a2b2cc687d1031e3884dd6a">flag_hyperbolic_f</a> = <a class="code" href="a00046.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>; 
<a name="l00189"></a>00189 
<a name="l00190"></a>00190       flag = PETSC_FALSE; 
<a name="l00191"></a>00191       ierr = PetscOptionsGetBool(PETSC_NULL,PETSC_NULL,<span class="stringliteral">&quot;-hyperbolic_df_explicit&quot;</span>,&amp;flag,PETSC_NULL); CHKERRQ(ierr);
<a name="l00192"></a>00192       <span class="keywordflow">if</span> (flag == PETSC_TRUE) context.<a class="code" href="a00025.html#a21b4785029b7597816341479bc3260b4">flag_hyperbolic_df</a> = <a class="code" href="a00046.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>; 
<a name="l00193"></a>00193       flag = PETSC_FALSE; 
<a name="l00194"></a>00194       ierr = PetscOptionsGetBool(PETSC_NULL,PETSC_NULL,<span class="stringliteral">&quot;-hyperbolic_df_implicit&quot;</span>,&amp;flag,PETSC_NULL); CHKERRQ(ierr);
<a name="l00195"></a>00195       <span class="keywordflow">if</span> (flag == PETSC_TRUE) context.<a class="code" href="a00025.html#a21b4785029b7597816341479bc3260b4">flag_hyperbolic_df</a> = <a class="code" href="a00046.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>; 
<a name="l00196"></a>00196 
<a name="l00197"></a>00197     } <span class="keywordflow">else</span> {
<a name="l00198"></a>00198 
<a name="l00199"></a>00199       flag = PETSC_FALSE; 
<a name="l00200"></a>00200       ierr = PetscOptionsGetBool(PETSC_NULL,PETSC_NULL,<span class="stringliteral">&quot;-hyperbolic_explicit&quot;</span>,&amp;flag,PETSC_NULL); CHKERRQ(ierr);
<a name="l00201"></a>00201       <span class="keywordflow">if</span> (flag == PETSC_TRUE) context.<a class="code" href="a00025.html#a376b6b34e162357d201827d01a5aa2a4">flag_hyperbolic</a> = <a class="code" href="a00046.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>; 
<a name="l00202"></a>00202       flag = PETSC_FALSE; 
<a name="l00203"></a>00203       ierr = PetscOptionsGetBool(PETSC_NULL,PETSC_NULL,<span class="stringliteral">&quot;-hyperbolic_implicit&quot;</span>,&amp;flag,PETSC_NULL); CHKERRQ(ierr);
<a name="l00204"></a>00204       <span class="keywordflow">if</span> (flag == PETSC_TRUE) context.<a class="code" href="a00025.html#a376b6b34e162357d201827d01a5aa2a4">flag_hyperbolic</a> = <a class="code" href="a00046.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>; 
<a name="l00205"></a>00205 
<a name="l00206"></a>00206     }
<a name="l00207"></a>00207 
<a name="l00208"></a>00208     flag = PETSC_FALSE; 
<a name="l00209"></a>00209     ierr = PetscOptionsGetBool(PETSC_NULL,PETSC_NULL,<span class="stringliteral">&quot;-parabolic_explicit&quot;</span>,&amp;flag,PETSC_NULL); CHKERRQ(ierr);
<a name="l00210"></a>00210     <span class="keywordflow">if</span> (flag == PETSC_TRUE) context.<a class="code" href="a00025.html#ac48ad2561e5e125d2789133e848db1d9">flag_parabolic</a> = <a class="code" href="a00046.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>; 
<a name="l00211"></a>00211     flag = PETSC_FALSE; 
<a name="l00212"></a>00212     ierr = PetscOptionsGetBool(PETSC_NULL,PETSC_NULL,<span class="stringliteral">&quot;-parabolic_implicit&quot;</span>,&amp;flag,PETSC_NULL); CHKERRQ(ierr);
<a name="l00213"></a>00213     <span class="keywordflow">if</span> (flag == PETSC_TRUE) context.<a class="code" href="a00025.html#ac48ad2561e5e125d2789133e848db1d9">flag_parabolic</a> = <a class="code" href="a00046.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>; 
<a name="l00214"></a>00214 
<a name="l00215"></a>00215     flag = PETSC_FALSE; 
<a name="l00216"></a>00216     ierr = PetscOptionsGetBool(PETSC_NULL,PETSC_NULL,<span class="stringliteral">&quot;-source_explicit&quot;</span>,&amp;flag,PETSC_NULL); CHKERRQ(ierr);
<a name="l00217"></a>00217     <span class="keywordflow">if</span> (flag == PETSC_TRUE) context.<a class="code" href="a00025.html#a54c0451c4ae9650a54f54246f1f8823b">flag_source</a> = <a class="code" href="a00046.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>; 
<a name="l00218"></a>00218     flag = PETSC_FALSE; 
<a name="l00219"></a>00219     ierr = PetscOptionsGetBool(PETSC_NULL,PETSC_NULL,<span class="stringliteral">&quot;-source_implicit&quot;</span>,&amp;flag,PETSC_NULL); CHKERRQ(ierr);
<a name="l00220"></a>00220     <span class="keywordflow">if</span> (flag == PETSC_TRUE) context.<a class="code" href="a00025.html#a54c0451c4ae9650a54f54246f1f8823b">flag_source</a> = <a class="code" href="a00046.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>; 
<a name="l00221"></a>00221 
<a name="l00222"></a>00222     flag = PETSC_FALSE;
<a name="l00223"></a>00223     ierr = PetscOptionsGetBool(PETSC_NULL,PETSC_NULL,<span class="stringliteral">&quot;-ts_arkimex_fully_implicit&quot;</span>,&amp;flag,PETSC_NULL); CHKERRQ(ierr);
<a name="l00224"></a>00224     <span class="keywordflow">if</span> (flag == PETSC_TRUE) {
<a name="l00225"></a>00225       context.<a class="code" href="a00025.html#a6a0edd627a2b2cc687d1031e3884dd6a">flag_hyperbolic_f</a>   = <a class="code" href="a00046.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>;
<a name="l00226"></a>00226       context.<a class="code" href="a00025.html#a21b4785029b7597816341479bc3260b4">flag_hyperbolic_df</a>  = <a class="code" href="a00046.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>;
<a name="l00227"></a>00227       context.<a class="code" href="a00025.html#a376b6b34e162357d201827d01a5aa2a4">flag_hyperbolic</a>     = <a class="code" href="a00046.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>;
<a name="l00228"></a>00228       context.<a class="code" href="a00025.html#ac48ad2561e5e125d2789133e848db1d9">flag_parabolic</a>      = <a class="code" href="a00046.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>;
<a name="l00229"></a>00229       context.<a class="code" href="a00025.html#a54c0451c4ae9650a54f54246f1f8823b">flag_source</a>         = <a class="code" href="a00046.html#aad212f0cfa337a32e39d307f8708eca7">_IMPLICIT_</a>;
<a name="l00230"></a>00230     }
<a name="l00231"></a>00231 
<a name="l00232"></a>00232     <span class="comment">/* print out a summary of the treatment of each term */</span>
<a name="l00233"></a>00233     <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a00019.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) {
<a name="l00234"></a>00234       printf(<span class="stringliteral">&quot;Implicit-Explicit time-integration:-\n&quot;</span>);
<a name="l00235"></a>00235       <span class="keywordflow">if</span> (!strcmp(solver-&gt;<a class="code" href="a00015.html#a5bed0cb9665daad89f4377c4f7609df4">SplitHyperbolicFlux</a>,<span class="stringliteral">&quot;yes&quot;</span>)) {
<a name="l00236"></a>00236         <span class="keywordflow">if</span> (context.<a class="code" href="a00025.html#a6a0edd627a2b2cc687d1031e3884dd6a">flag_hyperbolic_f</a> == <a class="code" href="a00046.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>)  printf(<span class="stringliteral">&quot;Hyperbolic (f-df) term: Explicit\n&quot;</span>);
<a name="l00237"></a>00237         <span class="keywordflow">else</span>                                          printf(<span class="stringliteral">&quot;Hyperbolic (f-df) term: Implicit\n&quot;</span>);
<a name="l00238"></a>00238         <span class="keywordflow">if</span> (context.<a class="code" href="a00025.html#a21b4785029b7597816341479bc3260b4">flag_hyperbolic_df</a> == <a class="code" href="a00046.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>) printf(<span class="stringliteral">&quot;Hyperbolic (df)   term: Explicit\n&quot;</span>);
<a name="l00239"></a>00239         <span class="keywordflow">else</span>                                          printf(<span class="stringliteral">&quot;Hyperbolic (df)   term: Implicit\n&quot;</span>);
<a name="l00240"></a>00240       } <span class="keywordflow">else</span> {
<a name="l00241"></a>00241         <span class="keywordflow">if</span> (context.<a class="code" href="a00025.html#a376b6b34e162357d201827d01a5aa2a4">flag_hyperbolic</a> == <a class="code" href="a00046.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>)    printf(<span class="stringliteral">&quot;Hyperbolic        term: Explicit\n&quot;</span>);
<a name="l00242"></a>00242         <span class="keywordflow">else</span>                                          printf(<span class="stringliteral">&quot;Hyperbolic        term: Implicit\n&quot;</span>);
<a name="l00243"></a>00243       }
<a name="l00244"></a>00244       <span class="keywordflow">if</span> (context.<a class="code" href="a00025.html#ac48ad2561e5e125d2789133e848db1d9">flag_parabolic</a> == <a class="code" href="a00046.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>)       printf(<span class="stringliteral">&quot;Parabolic         term: Explicit\n&quot;</span>);
<a name="l00245"></a>00245       <span class="keywordflow">else</span>                                            printf(<span class="stringliteral">&quot;Parabolic         term: Implicit\n&quot;</span>);
<a name="l00246"></a>00246       <span class="keywordflow">if</span> (context.<a class="code" href="a00025.html#a54c0451c4ae9650a54f54246f1f8823b">flag_source</a>    == <a class="code" href="a00046.html#a377d0d14ec878aeb4deed4a0533e213d">_EXPLICIT_</a>)       printf(<span class="stringliteral">&quot;Source            term: Explicit\n&quot;</span>);
<a name="l00247"></a>00247       <span class="keywordflow">else</span>                                            printf(<span class="stringliteral">&quot;Source            term: Implicit\n&quot;</span>);
<a name="l00248"></a>00248     }
<a name="l00249"></a>00249 
<a name="l00250"></a>00250   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((!strcmp(time_scheme,TSEULER)) || (!strcmp(time_scheme,TSRK)) || (!strcmp(time_scheme,TSSSP))) {
<a name="l00251"></a>00251 
<a name="l00252"></a>00252     <span class="comment">/* Explicit time integration */</span>    
<a name="l00253"></a>00253     ierr = TSSetRHSFunction(ts,PETSC_NULL,<a class="code" href="a00046.html#ac67533553372ed2b44b32d095c775f5c">PetscRHSFunctionExpl</a>,&amp;context); CHKERRQ(ierr);
<a name="l00254"></a>00254 
<a name="l00255"></a>00255   } <span class="keywordflow">else</span> {
<a name="l00256"></a>00256 
<a name="l00257"></a>00257     <span class="comment">/* Implicit or explicit time integration */</span>
<a name="l00258"></a>00258 
<a name="l00259"></a>00259     ierr = TSSetRHSFunction(ts,PETSC_NULL,<a class="code" href="a00046.html#a91eb21ee4374b79a74f413d926344d7e">PetscRHSFunctionImpl</a>,&amp;context); CHKERRQ(ierr);
<a name="l00260"></a>00260 
<a name="l00261"></a>00261     SNES     snes;
<a name="l00262"></a>00262     KSP      ksp;
<a name="l00263"></a>00263     PC       pc;
<a name="l00264"></a>00264     SNESType snestype;
<a name="l00265"></a>00265     ierr = TSGetSNES(ts,&amp;snes); CHKERRQ(ierr);
<a name="l00266"></a>00266     ierr = SNESGetType(snes,&amp;snestype); CHKERRQ(ierr);
<a name="l00267"></a>00267 
<a name="l00268"></a>00268     <span class="comment">/* Matrix-free representation of the Jacobian */</span>
<a name="l00269"></a>00269     flag_mat_a = 1;
<a name="l00270"></a>00270     ierr = MatCreateShell(MPI_COMM_WORLD,total_size,total_size,PETSC_DETERMINE,
<a name="l00271"></a>00271                           PETSC_DETERMINE,&amp;context,&amp;A); CHKERRQ(ierr);
<a name="l00272"></a>00272     <span class="keywordflow">if</span> ((!strcmp(snestype,SNESKSPONLY)) || (ptype == TS_LINEAR)) {
<a name="l00273"></a>00273       <span class="comment">/* linear problem */</span>
<a name="l00274"></a>00274       context.<a class="code" href="a00025.html#a200f63fcca813d56a5cf3209546cedb2">flag_is_linear</a> = 1;
<a name="l00275"></a>00275       ierr = MatShellSetOperation(A,MATOP_MULT,(<span class="keywordtype">void</span> (*)(<span class="keywordtype">void</span>))<a class="code" href="a00046.html#abed41de2efef801be98f8338aa2672f2">PetscJacobianFunction_Linear</a>); CHKERRQ(ierr);
<a name="l00276"></a>00276       ierr = SNESSetType(snes,SNESKSPONLY); CHKERRQ(ierr);
<a name="l00277"></a>00277     } <span class="keywordflow">else</span> {
<a name="l00278"></a>00278       <span class="comment">/* nonlinear problem */</span>
<a name="l00279"></a>00279       context.<a class="code" href="a00025.html#a200f63fcca813d56a5cf3209546cedb2">flag_is_linear</a> = 0;
<a name="l00280"></a>00280       context.<a class="code" href="a00025.html#ad62e14c19e38497048380c4a7fe10e12">jfnk_eps</a> = 1<a class="code" href="a00032.html#a35b3e91c83139b35bbacfaa59a58afd1">e</a>-7;
<a name="l00281"></a>00281       ierr = PetscOptionsGetReal(NULL,NULL,<span class="stringliteral">&quot;-jfnk_epsilon&quot;</span>,&amp;context.<a class="code" href="a00025.html#ad62e14c19e38497048380c4a7fe10e12">jfnk_eps</a>,NULL); CHKERRQ(ierr);
<a name="l00282"></a>00282       ierr = MatShellSetOperation(A,MATOP_MULT,(<span class="keywordtype">void</span> (*)(<span class="keywordtype">void</span>))<a class="code" href="a00046.html#a68f5a93a79d56fcb964224f649af4ac9">PetscJacobianFunction_JFNK</a>); CHKERRQ(ierr);
<a name="l00283"></a>00283     }
<a name="l00284"></a>00284     ierr = MatSetUp(A); CHKERRQ(ierr);
<a name="l00285"></a>00285 
<a name="l00286"></a>00286     context.<a class="code" href="a00025.html#a271fbbfea71118710d4a2fb13eb4c1cc">flag_use_precon</a> = 0;
<a name="l00287"></a>00287     ierr = PetscOptionsGetBool(PETSC_NULL,PETSC_NULL,<span class="stringliteral">&quot;-with_pc&quot;</span>,(PetscBool*)(&amp;context.<a class="code" href="a00025.html#a271fbbfea71118710d4a2fb13eb4c1cc">flag_use_precon</a>),PETSC_NULL); CHKERRQ(ierr);
<a name="l00288"></a>00288 
<a name="l00289"></a>00289     <span class="comment">/* </span>
<a name="l00290"></a>00290 <span class="comment">       Since we are using a MatShell to represent the action of the Jacobian on a vector (Jacobian-free approach),</span>
<a name="l00291"></a>00291 <span class="comment">       we need to define the Jacobian through TSSetIJacobian, and not TSSetRHSJacobian, so that we can define the </span>
<a name="l00292"></a>00292 <span class="comment">       complete operator (the shifted Jacobian aI - J )</span>
<a name="l00293"></a>00293 <span class="comment">    */</span>
<a name="l00294"></a>00294 
<a name="l00295"></a>00295     <span class="keywordflow">if</span> (context.<a class="code" href="a00025.html#a271fbbfea71118710d4a2fb13eb4c1cc">flag_use_precon</a>) {
<a name="l00296"></a>00296       <span class="comment">/* check if flux Jacobian of the physical model is defined */</span>
<a name="l00297"></a>00297       <span class="keywordflow">if</span> (!solver-&gt;<a class="code" href="a00015.html#a15eea1647344c503deb1d9f89cead631">JFunction</a>) {
<a name="l00298"></a>00298         <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a00019.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) {
<a name="l00299"></a>00299           fprintf(stderr,<span class="stringliteral">&quot;Error in SolvePETSc(): solver-&gt;JFunction (point-wise flux Jacobian) must &quot;</span>);
<a name="l00300"></a>00300           fprintf(stderr,<span class="stringliteral">&quot;be defined for preconditioning.\n&quot;</span>);
<a name="l00301"></a>00301         }
<a name="l00302"></a>00302         PetscFunctionReturn(1);
<a name="l00303"></a>00303       }
<a name="l00304"></a>00304       <span class="comment">/* Set up preconditioner matrix */</span>
<a name="l00305"></a>00305       flag_mat_b = 1;
<a name="l00306"></a>00306       ierr = MatCreateAIJ(MPI_COMM_WORLD,total_size,total_size,PETSC_DETERMINE,PETSC_DETERMINE,
<a name="l00307"></a>00307                           (solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>*2+1)*solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,NULL,
<a name="l00308"></a>00308                           2*solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>*solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,NULL,&amp;B); CHKERRQ(ierr);
<a name="l00309"></a>00309       ierr = MatSetBlockSize(B,solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>);
<a name="l00310"></a>00310       <span class="comment">/* Set the RHSJacobian function for TS */</span>
<a name="l00311"></a>00311       ierr = TSSetIJacobian(ts,A,B,<a class="code" href="a00046.html#a3d6a695a879ec54937525109ac912355">PetscIJacobian</a>,&amp;context); CHKERRQ(ierr);
<a name="l00312"></a>00312     } <span class="keywordflow">else</span> {
<a name="l00313"></a>00313       <span class="comment">/* Set the RHSJacobian function for TS */</span>
<a name="l00314"></a>00314       ierr = TSSetIJacobian(ts,A,A,<a class="code" href="a00046.html#a3d6a695a879ec54937525109ac912355">PetscIJacobian</a>,&amp;context); CHKERRQ(ierr);
<a name="l00315"></a>00315       <span class="comment">/* Set PC (preconditioner) to none */</span>
<a name="l00316"></a>00316       ierr = SNESGetKSP(snes,&amp;ksp); CHKERRQ(ierr);
<a name="l00317"></a>00317       ierr = KSPGetPC(ksp,&amp;pc); CHKERRQ(ierr);
<a name="l00318"></a>00318       ierr = PCSetType(pc,PCNONE); CHKERRQ(ierr);
<a name="l00319"></a>00319     }
<a name="l00320"></a>00320 
<a name="l00321"></a>00321   }
<a name="l00322"></a>00322 
<a name="l00323"></a>00323   <span class="comment">/* Set pre/post-stage and post-timestep function */</span>
<a name="l00324"></a>00324   ierr = TSSetPreStep (ts,<a class="code" href="a00046.html#ace222db5eadd0e0bd27229641e43fa9b">PetscPreTimeStep</a> ); CHKERRQ(ierr);
<a name="l00325"></a>00325   ierr = TSSetPreStage(ts,<a class="code" href="a00046.html#aa52bad03c15488a2119b794d0e70deed">PetscPreStage</a>    ); CHKERRQ(ierr);
<a name="l00326"></a>00326   ierr = TSSetPostStage(ts,<a class="code" href="a00046.html#ad1f357f94c228ba9ff45275064ca162b">PetscPostStage</a>  ); CHKERRQ(ierr);
<a name="l00327"></a>00327   ierr = TSSetPostStep(ts,<a class="code" href="a00046.html#a3f7397f8cd5e90306fb7f02edecb3782">PetscPostTimeStep</a>); CHKERRQ(ierr);
<a name="l00328"></a>00328   <span class="comment">/* Set solution vector for TS */</span>
<a name="l00329"></a>00329   ierr = TSSetSolution(ts,Y); CHKERRQ(ierr);
<a name="l00330"></a>00330   <span class="comment">/* Set it all up */</span>
<a name="l00331"></a>00331   ierr = TSSetUp(ts); CHKERRQ(ierr);
<a name="l00332"></a>00332   <span class="comment">/* Set application context */</span>
<a name="l00333"></a>00333   ierr = TSSetApplicationContext(ts,&amp;context); CHKERRQ(ierr);
<a name="l00334"></a>00334 
<a name="l00335"></a>00335   <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a00019.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) {
<a name="l00336"></a>00336     <span class="keywordflow">if</span> (context.<a class="code" href="a00025.html#a200f63fcca813d56a5cf3209546cedb2">flag_is_linear</a>) printf(<span class="stringliteral">&quot;SolvePETSc(): Problem type is linear.\n&quot;</span>);
<a name="l00337"></a>00337     <span class="keywordflow">else</span>                        printf(<span class="stringliteral">&quot;SolvePETSc(): Problem type is nonlinear.\n&quot;</span>);
<a name="l00338"></a>00338   }
<a name="l00339"></a>00339 
<a name="l00340"></a>00340   <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a00019.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) printf(<span class="stringliteral">&quot;** Starting PETSc time integration **\n&quot;</span>);
<a name="l00341"></a>00341   ierr = TSSolve(ts,Y); CHKERRQ(ierr);
<a name="l00342"></a>00342   <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a00019.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) printf(<span class="stringliteral">&quot;** Completed PETSc time integration **\n&quot;</span>);
<a name="l00343"></a>00343 
<a name="l00344"></a>00344   <span class="comment">/* Get the number of time steps */</span>
<a name="l00345"></a>00345   ierr = TSGetStepNumber(ts,&amp;solver-&gt;<a class="code" href="a00015.html#af0d8e0d5d3de3869b941b66b6caaf964">n_iter</a>); CHKERRQ(ierr);
<a name="l00346"></a>00346 
<a name="l00347"></a>00347   <span class="comment">/* get and write to file any auxiliary solutions */</span>
<a name="l00348"></a>00348   <span class="keywordtype">char</span> aux_fname_root[4] = <span class="stringliteral">&quot;ts0&quot;</span>;
<a name="l00349"></a>00349   ierr = TSGetSolutionComponents(ts,&amp;iAuxSize,NULL);CHKERRQ(ierr);
<a name="l00350"></a>00350   <span class="keywordflow">if</span> (iAuxSize) {
<a name="l00351"></a>00351     <span class="keywordflow">if</span> (iAuxSize &gt; 10) iAuxSize = 10;
<a name="l00352"></a>00352     <span class="keywordflow">if</span> (!mpi-&gt;<a class="code" href="a00019.html#a6cfd95afd0afebd625b889fb6e58371c">rank</a>) printf(<span class="stringliteral">&quot;Number of auxiliary solutions from time integration: %d\n&quot;</span>,iAuxSize);
<a name="l00353"></a>00353     ierr = VecDuplicate(Y,&amp;Z);
<a name="l00354"></a>00354     <span class="keywordflow">for</span> (i=0; i&lt;iAuxSize; i++) {
<a name="l00355"></a>00355       ierr = TSGetSolutionComponents(ts,&amp;i,&amp;Z);CHKERRQ(ierr);
<a name="l00356"></a>00356       ierr = <a class="code" href="a00046.html#aba47a541676718cced51875b1c3a4ba6">TransferVecFromPETSc</a>(solver-&gt;<a class="code" href="a00015.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>,Z,&amp;context); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00357"></a>00357       <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00042.html#aaf888c739c5200d9c58a7154347069b0">WriteArray</a>(solver-&gt;<a class="code" href="a00015.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00015.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00015.html#aa989ebb755986852177779cdf7bd8c85">dim_global</a>,solver-&gt;<a class="code" href="a00015.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,
<a name="l00358"></a>00358                       solver-&gt;<a class="code" href="a00015.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,solver-&gt;<a class="code" href="a00015.html#a711aad4cbe735871dd9e91ab575c878b">x</a>,solver-&gt;<a class="code" href="a00015.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>,solver,mpi,aux_fname_root); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00359"></a>00359       aux_fname_root[2]++;
<a name="l00360"></a>00360     }
<a name="l00361"></a>00361     ierr = VecDestroy(&amp;Z); CHKERRQ(ierr);
<a name="l00362"></a>00362   }
<a name="l00363"></a>00363 
<a name="l00364"></a>00364   <span class="comment">/* if available, get error estimates */</span>
<a name="l00365"></a>00365   ierr = <a class="code" href="a00046.html#ab501847c597b0c20dff03d95a663b9b4">PetscTimeError</a>(ts); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00366"></a>00366 
<a name="l00367"></a>00367   <span class="comment">/* copy final solution from PETSc&apos;s vector */</span>
<a name="l00368"></a>00368   ierr = <a class="code" href="a00046.html#aba47a541676718cced51875b1c3a4ba6">TransferVecFromPETSc</a>(solver-&gt;<a class="code" href="a00015.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>,Y,&amp;context); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00369"></a>00369 
<a name="l00370"></a>00370   <span class="comment">/* clean up */</span>
<a name="l00371"></a>00371   <span class="keywordflow">if</span> (flag_mat_a) { ierr = MatDestroy(&amp;A); CHKERRQ(ierr); }
<a name="l00372"></a>00372   <span class="keywordflow">if</span> (flag_mat_b) { ierr = MatDestroy(&amp;B); CHKERRQ(ierr); }
<a name="l00373"></a>00373   ierr = TSDestroy(&amp;ts); CHKERRQ(ierr);
<a name="l00374"></a>00374   ierr = VecDestroy(&amp;Y); CHKERRQ(ierr);
<a name="l00375"></a>00375 
<a name="l00376"></a>00376   <span class="comment">/* write a final solution file, if last iteration did not write one */</span>
<a name="l00377"></a>00377   <span class="keywordflow">if</span> (context.<a class="code" href="a00025.html#a34cbd56d5136d5e8b5ea2cbb901c04cd">tic</a>) { 
<a name="l00378"></a>00378     <span class="keywordflow">if</span> (solver-&gt;<a class="code" href="a00015.html#ab4c55736e92f7d72f04b8a957d82b054">PhysicsOutput</a>) {
<a name="l00379"></a>00379       <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00015.html#ab4c55736e92f7d72f04b8a957d82b054">PhysicsOutput</a>(solver,mpi); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00380"></a>00380     }
<a name="l00381"></a>00381     <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00039.html#abff21fd701b932c05e9e0dac925bcf29">OutputSolution</a>(solver,mpi); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr); 
<a name="l00382"></a>00382   }
<a name="l00383"></a>00383   <span class="comment">/* calculate error if exact solution has been provided */</span>
<a name="l00384"></a>00384   <a class="code" href="a00036.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00039.html#a116876aaf447559b6cc9fff36a501843">CalculateError</a>(solver,mpi); <a class="code" href="a00036.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);
<a name="l00385"></a>00385 
<a name="l00386"></a>00386   ierr = <a class="code" href="a00046.html#a52781b615afd6404c69c93dd0aa82924">PetscCleanup</a>(&amp;context);
<a name="l00387"></a>00387   PetscFunctionReturn(0);
<a name="l00388"></a>00388 }
</pre></div></p>

</div>
</div>
</div>
<!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">
var sc_project=10897352; 
var sc_invisible=1; 
var sc_security="83042f57"; 
var scJsHost = (("https:" == document.location.protocol) ?
"https://secure." : "http://www.");
document.write("<sc"+"ript type='text/javascript' src='" +
scJsHost+
"statcounter.com/counter/counter.js'></"+"script>");
</script>
<noscript><div class="statcounter"><a title="website
statistics" href="http://statcounter.com/"
target="_blank"><img class="statcounter"
src="//c.statcounter.com/10897352/0/83042f57/1/"
alt="website statistics"></a></div></noscript>
<!-- End of StatCounter Code for Default Guide -->
