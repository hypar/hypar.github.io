<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>HyPar: src/Simulation/Solve.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_html_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">HyPar
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">Finite-Difference Hyperbolic-Parabolic PDE Solver on Cartesian Grids</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('a00605.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Solve.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;math.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;vector&gt;</code><br/>
<code>#include &lt;<a class="el" href="a00235_source.html">common_cpp.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="a00240_source.html">io_cpp.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="a00266_source.html">timeintegration_cpp.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="a00249_source.html">mpivars_cpp.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="a00218_source.html">simulation_object.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="a00241_source.html">librom_interface.h</a>&gt;</code><br/>
</div>
<p><a href="a00605_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ac36e92835a7778335d6855faae25a575"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00605.html#ac36e92835a7778335d6855faae25a575">ComputeRHSOperators</a> (void *, void *, double)</td></tr>
<tr class="separator:ac36e92835a7778335d6855faae25a575"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a116876aaf447559b6cc9fff36a501843"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00605.html#a116876aaf447559b6cc9fff36a501843">CalculateError</a> (void *, void *)</td></tr>
<tr class="separator:a116876aaf447559b6cc9fff36a501843"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5981de613724cb667e98aa872157534e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00605.html#a5981de613724cb667e98aa872157534e">OutputSolution</a> (void *, int)</td></tr>
<tr class="separator:a5981de613724cb667e98aa872157534e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abf45c2d1c16e7b6f6f48ffd421c68c7c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00605.html#abf45c2d1c16e7b6f6f48ffd421c68c7c">ResetFilenameIndex</a> (char *, int)</td></tr>
<tr class="separator:abf45c2d1c16e7b6f6f48ffd421c68c7c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa0fa2c66e04e9f6d84039bedc6400765"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00605.html#aa0fa2c66e04e9f6d84039bedc6400765">CalculateROMDiff</a> (void *, void *)</td></tr>
<tr class="separator:aa0fa2c66e04e9f6d84039bedc6400765"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0f058c8fed21156da5f1f64c828b5b39"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00605.html#a0f058c8fed21156da5f1f64c828b5b39">OutputROMSolution</a> (void *, int)</td></tr>
<tr class="separator:a0f058c8fed21156da5f1f64c828b5b39"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7252344719299385bb387a001b2a3a38"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00605.html#a7252344719299385bb387a001b2a3a38">Solve</a> (void *s, int nsims, int rank, int nproc)</td></tr>
<tr class="separator:a7252344719299385bb387a001b2a3a38"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ac36e92835a7778335d6855faae25a575"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ComputeRHSOperators </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>t</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Computes the matrices representing the Jacobians of the hyperbolic (<a class="el" href="a00202.html#aa245f8c9e6af37e47c5867dccbbc208b">HyPar::HyperbolicFunction</a>), parabolic (<a class="el" href="a00202.html#a75e8be4ea8c1ae2e99fc1e802e69a573">HyPar::ParabolicFunction</a>), and the source (<a class="el" href="a00202.html#a662e256e081a2b74f971d02c747892b8">HyPar::SourceFunction</a>) terms. <br/>
<br/>
 Each element is compute through finite-differences, by perturbing one DOF of the solution at a time. The matrices are not stored in the memory, instead the non-zero are written to file as soon as they are computed. The filenames for the matrices are "Mat_*Function_nnnnn.dat", where "nnnnn" is a time-dependent index.</p>
<ul>
<li>The format (ASCII text) of the file is as follows:<br/>
 <em>n</em> <br/>
 <em>i</em> <em>j</em> <em>val</em> <br/>
 <em>i</em> <em>j</em> <em>val</em> <br/>
 ...<br/>
 <em>i</em> <em>j</em> <em>val</em> <br/>
 where <em>n</em> is the size of the matrix, followed by all the non-zero elements (each line contains the indices <em>i</em>,<em>j</em> and the value <em>val</em> of one non-zero element).</li>
<li>This function is called after <a class="el" href="a00202.html#a6ff746b30ee55a3bbb9f3306c145f27a">HyPar::file_op_iter</a> iterations (i.e. the same frequency at which solution files are written).</li>
<li>If a splitting for the hyperbolic flux is defined, then the Jacobians of the complete hyperbolic term, as well as the split terms are computed.</li>
<li>The eigenvalues of these matrices can be computed and plotted in MATLAB using the scripts Examples/Matlab/ComputeEvals.m and Examples/Matlab/PlotEvals.m respectively.</li>
<li>To use this function, the code must be compiled with the flag <b>-Dcompute_rhs_operators</b>, and run on a single processor. This is very slow for larger domains, and should be used only for the numerical analysis of test cases.</li>
<li>The current solution stored in <a class="el" href="a00202.html#a3b6b999a764f1e2ea94bb5f28c7a558c">HyPar::u</a> is used as the reference state at which the Jacobians are computed (this is relevant to know for non-linear right-hand-sides functions).</li>
</ul>
<p>Note: Parabolic terms have not yet been included. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>Solver object of type <a class="el" href="a00202.html" title="Structure containing all solver-specific variables and functions. ">HyPar</a> </td></tr>
    <tr><td class="paramname">m</td><td>MPI object of type <a class="el" href="a00205.html#a00663" title="Structure of MPI-related variables. ">MPIVariables</a> </td></tr>
    <tr><td class="paramname">t</td><td>Current simulation time </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00308_source.html#l00050">50</a> of file <a class="el" href="a00308_source.html">ComputeRHSOperators.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;{</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <a class="code" href="a00202.html">HyPar</a>         *solver = (<a class="code" href="a00202.html">HyPar</a>*)        s;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <a class="code" href="a00205.html#a00663">MPIVariables</a>  *mpi    = (<a class="code" href="a00205.html#a00663">MPIVariables</a>*) m;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <span class="keywordtype">int</span>           i, j, size, ndof;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <span class="keywordtype">double</span>        *f, *f0, *u, *u0, *rhs, *drhs;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  FILE          *fout;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <span class="keywordtype">char</span>          filename[<a class="code" href="a00231.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>];</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  <span class="keywordflow">if</span> (mpi-&gt;<a class="code" href="a00205.html#ae68326adc3b3862f1162832f70727b06">nproc</a> &gt; 1) <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  <span class="keywordtype">int</span> ndims  = solver-&gt;<a class="code" href="a00202.html#a484873c74138512e41bc50d17b7d955a">ndims</a>;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  <span class="keywordtype">int</span> nvars  = solver-&gt;<a class="code" href="a00202.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="keywordtype">int</span> ghosts = solver-&gt;<a class="code" href="a00202.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <span class="keywordtype">int</span> *dim   = solver-&gt;<a class="code" href="a00202.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  <span class="keywordtype">int</span> index[ndims];</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <span class="keywordtype">double</span> epsilon = 1e-6;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <span class="keywordtype">double</span> tolerance = 1e-15;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <span class="comment">/* allocate arrays */</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  size = solver-&gt;<a class="code" href="a00202.html#a20ee1fd00a220b98513127884a5558cf">npoints_local_wghosts</a> * nvars;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  u    = (<span class="keywordtype">double</span>*) calloc (size,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  u0   = (<span class="keywordtype">double</span>*) calloc (size,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  rhs  = (<span class="keywordtype">double</span>*) calloc (size,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  drhs = (<span class="keywordtype">double</span>*) calloc (size,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  ndof = solver-&gt;<a class="code" href="a00202.html#afae6319baba315ac1f0c56505610ed85">npoints_local</a> * nvars;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  f    = (<span class="keywordtype">double</span>*) calloc (ndof,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  f0   = (<span class="keywordtype">double</span>*) calloc (ndof,<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <span class="comment">/* copy the current solution to u0 */</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <a class="code" href="a00229.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>(solver-&gt;<a class="code" href="a00202.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>,u0,size); </div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <span class="comment">/* apply boundary conditions to the solution u0 */</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <a class="code" href="a00231.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00202.html#aa4de7bdc1e62417caf51b9c45184268d">ApplyBoundaryConditions</a>(solver,mpi,u0,NULL,t);<a class="code" href="a00231.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <a class="code" href="a00231.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00202.html#a83d97dfc50e6bfefd0db6503d365d5bd">ApplyIBConditions</a>(solver,mpi,u0,t);<a class="code" href="a00231.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <a class="code" href="a00231.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00248.html#a60ace5964c051fa481e6a1e6f1ef75d7">MPIExchangeBoundariesnD</a>(ndims,nvars,dim,ghosts,mpi,u0); <a class="code" href="a00231.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <span class="comment">/* compute linearized matrix for the hyperbolic FFunction */</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <span class="keywordflow">if</span> (solver-&gt;<a class="code" href="a00202.html#a0d895f9bb0c8a3e79a64dd2379e1f2dd">FFunction</a>) {</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    strcpy(filename,<span class="stringliteral">&quot;Mat_FFunction_&quot;</span>);</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    strcat(filename,solver-&gt;<a class="code" href="a00202.html#a0805db42e429173752189696c3c96909">filename_index</a>);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    strcat(filename,<span class="stringliteral">&quot;.dat&quot;</span>);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    printf(<span class="stringliteral">&quot;ComputeRHSOperators(): Computing linearized matrix operator for FFunction. ndof=%d.\n&quot;</span>,ndof);</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    printf(<span class="stringliteral">&quot;ComputeRHSOperators(): Writing to sparse matrix file %s.\n&quot;</span>,filename);</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    fout = fopen(filename,<span class="stringliteral">&quot;w&quot;</span>);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    fprintf(fout,<span class="stringliteral">&quot;%d\n&quot;</span>,ndof);</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="comment">/* compute the FFunction of u0 */</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <a class="code" href="a00229.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(f0,ndof,0.0);</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <a class="code" href="a00231.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00202.html#aa245f8c9e6af37e47c5867dccbbc208b">HyperbolicFunction</a>(rhs,u0,solver,mpi,t,1,solver-&gt;<a class="code" href="a00202.html#a0d895f9bb0c8a3e79a64dd2379e1f2dd">FFunction</a>,</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                                    solver-&gt;<a class="code" href="a00202.html#a7eb68b9643feb74bd49f3a171b66eef1">Upwind</a>); <a class="code" href="a00231.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <a class="code" href="a00229.html#a1dab5f429ccd03c4a7fbb605d8ef75b6">_ArrayScale1D_</a>(rhs,-1.0,size);</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="comment">/* transfer to an array f0 which as no ghost points */</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <a class="code" href="a00231.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00229.html#ad9b36abcf37c1f675c71da3da16cc8f0">ArrayCopynD</a>(ndims,rhs,f0,dim,ghosts,0,index,nvars); <a class="code" href="a00231.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="keywordflow">for</span> (i=0; i&lt;ndof; i++) {</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;      <span class="comment">/* copy the solution u0 to u */</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;      <a class="code" href="a00229.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>(u0,u,size);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;      <span class="comment">/* find the 1D index p in an array with ghosts points (u),</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment">       * corresponding to index i which assumes no ghost points */</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;      <span class="keywordtype">int</span> ii, p, v;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;      ii = i / nvars;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;      v  = i - ii*nvars;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;      <a class="code" href="a00229.html#a03f49e4d44ae8aca85cb04cfe91e4ce4">_ArrayIndexnD_</a>(ndims,ii,dim,index,0); </div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;      <a class="code" href="a00229.html#afbb862a2fdf5b72b1f9ace42f64b556f">_ArrayIndex1D_</a>(ndims,dim,index,ghosts,p);</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;      <span class="comment">/* add a perturbation */</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;      u[nvars*p+v] += epsilon;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;      <span class="comment">/* apply boundary conditions to the perturbed solution u */</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;      <a class="code" href="a00231.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00202.html#aa4de7bdc1e62417caf51b9c45184268d">ApplyBoundaryConditions</a>(solver,mpi,u,NULL,t);<a class="code" href="a00231.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;      <a class="code" href="a00231.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00202.html#a83d97dfc50e6bfefd0db6503d365d5bd">ApplyIBConditions</a>(solver,mpi,u,t);<a class="code" href="a00231.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;      <a class="code" href="a00231.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00248.html#a60ace5964c051fa481e6a1e6f1ef75d7">MPIExchangeBoundariesnD</a>(ndims,nvars,dim,ghosts,mpi,u); <a class="code" href="a00231.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;      <span class="comment">/* compute the FFunction of u */</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;      <a class="code" href="a00231.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00202.html#aa245f8c9e6af37e47c5867dccbbc208b">HyperbolicFunction</a>(rhs,u,solver,mpi,t,1,solver-&gt;<a class="code" href="a00202.html#a0d895f9bb0c8a3e79a64dd2379e1f2dd">FFunction</a>,</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                                      solver-&gt;<a class="code" href="a00202.html#a7eb68b9643feb74bd49f3a171b66eef1">Upwind</a>); <a class="code" href="a00231.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;      <a class="code" href="a00229.html#a1dab5f429ccd03c4a7fbb605d8ef75b6">_ArrayScale1D_</a>(rhs,-1.0,size);</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;      <span class="comment">/* transfer to an array f which as no ghost points */</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;      <a class="code" href="a00229.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(f,ndof,0.0);</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      <a class="code" href="a00231.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00229.html#ad9b36abcf37c1f675c71da3da16cc8f0">ArrayCopynD</a>(ndims,rhs,f,dim,ghosts,0,index,nvars); <a class="code" href="a00231.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;      <span class="comment">/* subtract f0 from f */</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;      <a class="code" href="a00229.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(f0,-1.0,f,ndof);</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;      <span class="comment">/* f is now espilon*column of the matrix */</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;      <span class="keywordflow">for</span> (j=0; j&lt;ndof; j++) {</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        <span class="keywordtype">double</span> mat_elem = f[j] / epsilon;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        <span class="comment">/* write to file if element is non-zero */</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="a00243.html#adf1be5ccbb7a2522b4f3a64043c72880">absolute</a>(mat_elem) &gt; tolerance) fprintf(fout,<span class="stringliteral">&quot;%5d %5d %+1.16e\n&quot;</span>,j+1,i+1,mat_elem);</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;      }</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    }</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    fclose(fout);</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  }</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <span class="comment">/* compute linearized matrix for the split hyperbolic (FFunction-dFFunction) and dFFunction</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">     functions, if dFFunction is available */</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <span class="keywordflow">if</span> (solver-&gt;<a class="code" href="a00202.html#aa1dd38befc4bb4adda9d456146436b14">dFFunction</a>) {</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    strcpy(filename,<span class="stringliteral">&quot;Mat_FdFFunction_&quot;</span>);</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    strcat(filename,solver-&gt;<a class="code" href="a00202.html#a0805db42e429173752189696c3c96909">filename_index</a>);</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    strcat(filename,<span class="stringliteral">&quot;.dat&quot;</span>);</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    printf(<span class="stringliteral">&quot;ComputeRHSOperators(): Computing linearized matrix operator for (FFunction-dFFunction). ndof=%d.\n&quot;</span>,ndof);</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    printf(<span class="stringliteral">&quot;ComputeRHSOperators(): Writing to sparse matrix file %s.\n&quot;</span>,filename);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    fout = fopen(filename,<span class="stringliteral">&quot;w&quot;</span>);</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    fprintf(fout,<span class="stringliteral">&quot;%d\n&quot;</span>,ndof);</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="comment">/* compute the FFunction of u0 */</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <a class="code" href="a00229.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(f0,ndof,0.0);</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="keywordflow">if</span> (solver-&gt;<a class="code" href="a00202.html#ad607f82c4bfde055613e05272f9afd81">flag_fdf_specified</a>) {</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;      <a class="code" href="a00231.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00202.html#aa245f8c9e6af37e47c5867dccbbc208b">HyperbolicFunction</a>(rhs,u0,solver,mpi,t,1,solver-&gt;<a class="code" href="a00202.html#adcc5e677515d0952ce3ff702c9d85b86">FdFFunction</a>,</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                                      solver-&gt;<a class="code" href="a00202.html#ab06746933e859e829d694505c18258b3">UpwindFdF</a>); <a class="code" href="a00231.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;      <a class="code" href="a00229.html#a1dab5f429ccd03c4a7fbb605d8ef75b6">_ArrayScale1D_</a>(rhs,-1.0,size);</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;      <a class="code" href="a00231.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00202.html#aa245f8c9e6af37e47c5867dccbbc208b">HyperbolicFunction</a>(rhs,u0,solver,mpi,t,1,solver-&gt;<a class="code" href="a00202.html#a0d895f9bb0c8a3e79a64dd2379e1f2dd">FFunction</a>,</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;                                      solver-&gt;<a class="code" href="a00202.html#a7eb68b9643feb74bd49f3a171b66eef1">Upwind</a>); <a class="code" href="a00231.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;      <a class="code" href="a00231.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00202.html#aa245f8c9e6af37e47c5867dccbbc208b">HyperbolicFunction</a>(drhs,u0,solver,mpi,t,0,solver-&gt;<a class="code" href="a00202.html#aa1dd38befc4bb4adda9d456146436b14">dFFunction</a>,</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;                                      solver-&gt;<a class="code" href="a00202.html#a73a85f83072e02bf979234486265b6d3">UpwinddF</a>); <a class="code" href="a00231.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;      <a class="code" href="a00229.html#a1dab5f429ccd03c4a7fbb605d8ef75b6">_ArrayScale1D_</a>(rhs,-1.0,size);</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;      <a class="code" href="a00229.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(drhs,1.0,rhs,size);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    }</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="comment">/* transfer to an array f0 which as no ghost points */</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <a class="code" href="a00231.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00229.html#ad9b36abcf37c1f675c71da3da16cc8f0">ArrayCopynD</a>(ndims,rhs,f0,dim,ghosts,0,index,nvars); <a class="code" href="a00231.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="keywordflow">for</span> (i=0; i&lt;ndof; i++) {</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;      <span class="comment">/* copy the solution u0 to u */</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;      <a class="code" href="a00229.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>(u0,u,size);</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;      <span class="comment">/* find the 1D index p in an array with ghosts points (u),</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment">       * corresponding to index i which assumes no ghost points */</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;      <span class="keywordtype">int</span> ii, p, v;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;      ii = i / nvars;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;      v  = i - ii*nvars;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      <a class="code" href="a00229.html#a03f49e4d44ae8aca85cb04cfe91e4ce4">_ArrayIndexnD_</a>(ndims,ii,dim,index,0); </div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;      <a class="code" href="a00229.html#afbb862a2fdf5b72b1f9ace42f64b556f">_ArrayIndex1D_</a>(ndims,dim,index,ghosts,p);</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;      <span class="comment">/* add a perturbation */</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;      u[nvars*p+v] += epsilon;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;      <span class="comment">/* apply boundary conditions to the perturbed solution u */</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;      <a class="code" href="a00231.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00202.html#aa4de7bdc1e62417caf51b9c45184268d">ApplyBoundaryConditions</a>(solver,mpi,u,NULL,t);<a class="code" href="a00231.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;      <a class="code" href="a00231.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00202.html#a83d97dfc50e6bfefd0db6503d365d5bd">ApplyIBConditions</a>(solver,mpi,u,t);<a class="code" href="a00231.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      <a class="code" href="a00231.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00248.html#a60ace5964c051fa481e6a1e6f1ef75d7">MPIExchangeBoundariesnD</a>(ndims,nvars,dim,ghosts,mpi,u); <a class="code" href="a00231.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;      <span class="comment">/* compute the FFunction of u */</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;      <span class="keywordflow">if</span> (solver-&gt;<a class="code" href="a00202.html#ad607f82c4bfde055613e05272f9afd81">flag_fdf_specified</a>) {</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <a class="code" href="a00231.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00202.html#aa245f8c9e6af37e47c5867dccbbc208b">HyperbolicFunction</a>(rhs,u,solver,mpi,t,1,solver-&gt;<a class="code" href="a00202.html#adcc5e677515d0952ce3ff702c9d85b86">FdFFunction</a>,</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                                        solver-&gt;<a class="code" href="a00202.html#ab06746933e859e829d694505c18258b3">UpwindFdF</a>); <a class="code" href="a00231.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <a class="code" href="a00229.html#a1dab5f429ccd03c4a7fbb605d8ef75b6">_ArrayScale1D_</a>(rhs,-1.0,size);</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        <a class="code" href="a00231.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00202.html#aa245f8c9e6af37e47c5867dccbbc208b">HyperbolicFunction</a>(rhs,u,solver,mpi,t,1,solver-&gt;<a class="code" href="a00202.html#a0d895f9bb0c8a3e79a64dd2379e1f2dd">FFunction</a>,</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                                        solver-&gt;<a class="code" href="a00202.html#a7eb68b9643feb74bd49f3a171b66eef1">Upwind</a>); <a class="code" href="a00231.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        <a class="code" href="a00231.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00202.html#aa245f8c9e6af37e47c5867dccbbc208b">HyperbolicFunction</a>(drhs,u,solver,mpi,t,0,solver-&gt;<a class="code" href="a00202.html#aa1dd38befc4bb4adda9d456146436b14">dFFunction</a>,</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                                        solver-&gt;<a class="code" href="a00202.html#a73a85f83072e02bf979234486265b6d3">UpwinddF</a>); <a class="code" href="a00231.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        <a class="code" href="a00229.html#a1dab5f429ccd03c4a7fbb605d8ef75b6">_ArrayScale1D_</a>(rhs,-1.0,size);</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        <a class="code" href="a00229.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(drhs,1.0,rhs,size);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;      }</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;      <span class="comment">/* transfer to an array f which as no ghost points */</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      <a class="code" href="a00229.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(f,ndof,0.0);</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;      <a class="code" href="a00231.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00229.html#ad9b36abcf37c1f675c71da3da16cc8f0">ArrayCopynD</a>(ndims,rhs,f,dim,ghosts,0,index,nvars); <a class="code" href="a00231.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;      <span class="comment">/* subtract f0 from f */</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;      <a class="code" href="a00229.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(f0,-1.0,f,ndof);</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;      <span class="comment">/* f is now espilon*column of the matrix */</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      <span class="keywordflow">for</span> (j=0; j&lt;ndof; j++) {</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        <span class="keywordtype">double</span> mat_elem = f[j] / epsilon;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        <span class="comment">/* write to file if element is non-zero */</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="a00243.html#adf1be5ccbb7a2522b4f3a64043c72880">absolute</a>(mat_elem) &gt; tolerance) fprintf(fout,<span class="stringliteral">&quot;%5d %5d %+1.16e\n&quot;</span>,j+1,i+1,mat_elem);</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;      }</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    }</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    fclose(fout);</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    strcpy(filename,<span class="stringliteral">&quot;Mat_dFFunction_&quot;</span>);</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    strcat(filename,solver-&gt;<a class="code" href="a00202.html#a0805db42e429173752189696c3c96909">filename_index</a>);</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    strcat(filename,<span class="stringliteral">&quot;.dat&quot;</span>);</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    printf(<span class="stringliteral">&quot;ComputeRHSOperators(): Computing linearized matrix operator for dFFunction. ndof=%d.\n&quot;</span>,ndof);</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    printf(<span class="stringliteral">&quot;ComputeRHSOperators(): Writing to sparse matrix file %s.\n&quot;</span>,filename);</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    fout = fopen(filename,<span class="stringliteral">&quot;w&quot;</span>);</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    fprintf(fout,<span class="stringliteral">&quot;%d\n&quot;</span>,ndof);</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="comment">/* compute the FFunction of u0 */</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <a class="code" href="a00229.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(f0,ndof,0.0);</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <a class="code" href="a00231.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00202.html#aa245f8c9e6af37e47c5867dccbbc208b">HyperbolicFunction</a>(rhs,u0,solver,mpi,t,0,solver-&gt;<a class="code" href="a00202.html#aa1dd38befc4bb4adda9d456146436b14">dFFunction</a>,</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                                    solver-&gt;<a class="code" href="a00202.html#a73a85f83072e02bf979234486265b6d3">UpwinddF</a>); <a class="code" href="a00231.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <a class="code" href="a00229.html#a1dab5f429ccd03c4a7fbb605d8ef75b6">_ArrayScale1D_</a>(rhs,-1.0,size);</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="comment">/* transfer to an array f0 which as no ghost points */</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <a class="code" href="a00231.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00229.html#ad9b36abcf37c1f675c71da3da16cc8f0">ArrayCopynD</a>(ndims,rhs,f0,dim,ghosts,0,index,nvars); <a class="code" href="a00231.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="keywordflow">for</span> (i=0; i&lt;ndof; i++) {</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;      <span class="comment">/* copy the solution u0 to u */</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;      <a class="code" href="a00229.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>(u0,u,size);</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      <span class="comment">/* find the 1D index p in an array with ghosts points (u),</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">       * corresponding to index i which assumes no ghost points */</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;      <span class="keywordtype">int</span> ii, p, v;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;      ii = i / nvars;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;      v  = i - ii*nvars;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;      <a class="code" href="a00229.html#a03f49e4d44ae8aca85cb04cfe91e4ce4">_ArrayIndexnD_</a>(ndims,ii,dim,index,0); </div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;      <a class="code" href="a00229.html#afbb862a2fdf5b72b1f9ace42f64b556f">_ArrayIndex1D_</a>(ndims,dim,index,ghosts,p);</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;      <span class="comment">/* add a perturbation */</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;      u[nvars*p+v] += epsilon;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;      <span class="comment">/* apply boundary conditions to the perturbed solution u */</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;      <a class="code" href="a00231.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00202.html#aa4de7bdc1e62417caf51b9c45184268d">ApplyBoundaryConditions</a>(solver,mpi,u,NULL,t);<a class="code" href="a00231.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;      <a class="code" href="a00231.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00202.html#a83d97dfc50e6bfefd0db6503d365d5bd">ApplyIBConditions</a>(solver,mpi,u,t);<a class="code" href="a00231.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;      <a class="code" href="a00231.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00248.html#a60ace5964c051fa481e6a1e6f1ef75d7">MPIExchangeBoundariesnD</a>(ndims,nvars,dim,ghosts,mpi,u); <a class="code" href="a00231.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;      <span class="comment">/* compute the FFunction of u */</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;      <a class="code" href="a00231.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00202.html#aa245f8c9e6af37e47c5867dccbbc208b">HyperbolicFunction</a>(rhs,u,solver,mpi,t,0,solver-&gt;<a class="code" href="a00202.html#aa1dd38befc4bb4adda9d456146436b14">dFFunction</a>,</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                                      solver-&gt;<a class="code" href="a00202.html#a73a85f83072e02bf979234486265b6d3">UpwinddF</a>); <a class="code" href="a00231.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;      <a class="code" href="a00229.html#a1dab5f429ccd03c4a7fbb605d8ef75b6">_ArrayScale1D_</a>(rhs,-1.0,size);</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;      <span class="comment">/* transfer to an array f which as no ghost points */</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      <a class="code" href="a00229.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(f,ndof,0.0);</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      <a class="code" href="a00231.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00229.html#ad9b36abcf37c1f675c71da3da16cc8f0">ArrayCopynD</a>(ndims,rhs,f,dim,ghosts,0,index,nvars); <a class="code" href="a00231.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;      <span class="comment">/* subtract f0 from f */</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      <a class="code" href="a00229.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(f0,-1.0,f,ndof);</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      <span class="comment">/* f is now espilon*column of the matrix */</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      <span class="keywordflow">for</span> (j=0; j&lt;ndof; j++) {</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        <span class="keywordtype">double</span> mat_elem = f[j] / epsilon;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        <span class="comment">/* write to file if element is non-zero */</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="a00243.html#adf1be5ccbb7a2522b4f3a64043c72880">absolute</a>(mat_elem) &gt; tolerance) fprintf(fout,<span class="stringliteral">&quot;%5d %5d %+1.16e\n&quot;</span>,j+1,i+1,mat_elem);</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      }</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    }</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    fclose(fout);</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  }</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  <span class="comment">/* compute linearized matrix for the source SFunction */</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <span class="keywordflow">if</span> (solver-&gt;<a class="code" href="a00202.html#a1685cd0c6b8c413bdbbe86d8f4475c58">SFunction</a>) {</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    strcpy(filename,<span class="stringliteral">&quot;Mat_SFunction_&quot;</span>);</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    strcat(filename,solver-&gt;<a class="code" href="a00202.html#a0805db42e429173752189696c3c96909">filename_index</a>);</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    strcat(filename,<span class="stringliteral">&quot;.dat&quot;</span>);</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    printf(<span class="stringliteral">&quot;ComputeRHSOperators(): Computing linearized matrix operator for SFunction. ndof=%d.\n&quot;</span>,ndof);</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    printf(<span class="stringliteral">&quot;ComputeRHSOperators(): Writing to sparse matrix file %s.\n&quot;</span>,filename);</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    fout = fopen(filename,<span class="stringliteral">&quot;w&quot;</span>);</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    fprintf(fout,<span class="stringliteral">&quot;%d\n&quot;</span>,ndof);</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="comment">/* compute the FFunction of u0 */</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <a class="code" href="a00229.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(f0,ndof,0.0);</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <a class="code" href="a00231.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00202.html#a662e256e081a2b74f971d02c747892b8">SourceFunction</a>(rhs,u0,solver,mpi,t); <a class="code" href="a00231.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="comment">/* transfer to an array f0 which as no ghost points */</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <a class="code" href="a00231.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00229.html#ad9b36abcf37c1f675c71da3da16cc8f0">ArrayCopynD</a>(ndims,rhs,f0,dim,ghosts,0,index,nvars); <a class="code" href="a00231.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="keywordflow">for</span> (i=0; i&lt;ndof; i++) {</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;      <span class="comment">/* copy the solution u0 to u */</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;      <a class="code" href="a00229.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>(u0,u,size);</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      <span class="comment">/* find the 1D index p in an array with ghosts points (u),</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="comment">       * corresponding to index i which assumes no ghost points */</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;      <span class="keywordtype">int</span> ii, p, v;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;      ii = i / nvars;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;      v  = i - ii*nvars;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      <a class="code" href="a00229.html#a03f49e4d44ae8aca85cb04cfe91e4ce4">_ArrayIndexnD_</a>(ndims,ii,dim,index,0); </div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;      <a class="code" href="a00229.html#afbb862a2fdf5b72b1f9ace42f64b556f">_ArrayIndex1D_</a>(ndims,dim,index,ghosts,p);</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      <span class="comment">/* add a perturbation */</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;      u[nvars*p+v] += epsilon;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      <span class="comment">/* apply boundary conditions to the perturbed solution u */</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;      <a class="code" href="a00231.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00202.html#aa4de7bdc1e62417caf51b9c45184268d">ApplyBoundaryConditions</a>(solver,mpi,u,NULL,t);<a class="code" href="a00231.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;      <a class="code" href="a00231.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00202.html#a83d97dfc50e6bfefd0db6503d365d5bd">ApplyIBConditions</a>(solver,mpi,u,t);<a class="code" href="a00231.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;      <a class="code" href="a00231.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00248.html#a60ace5964c051fa481e6a1e6f1ef75d7">MPIExchangeBoundariesnD</a>(ndims,nvars,dim,ghosts,mpi,u); <a class="code" href="a00231.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      <span class="comment">/* compute the SFunction of u */</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;      <a class="code" href="a00231.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> solver-&gt;<a class="code" href="a00202.html#a662e256e081a2b74f971d02c747892b8">SourceFunction</a>(rhs,u,solver,mpi,t); <a class="code" href="a00231.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      <span class="comment">/* transfer to an array f which as no ghost points */</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;      <a class="code" href="a00229.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a>(f,ndof,0.0);</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      <a class="code" href="a00231.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00229.html#ad9b36abcf37c1f675c71da3da16cc8f0">ArrayCopynD</a>(ndims,rhs,f,dim,ghosts,0,index,nvars); <a class="code" href="a00231.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;      <span class="comment">/* subtract f0 from f */</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      <a class="code" href="a00229.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(f0,-1.0,f,ndof);</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;      <span class="comment">/* f is now espilon*column of the matrix */</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;      <span class="keywordflow">for</span> (j=0; j&lt;ndof; j++) {</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        <span class="keywordtype">double</span> mat_elem = f[j] / epsilon;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        <span class="comment">/* write to file if element is non-zero */</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="a00243.html#adf1be5ccbb7a2522b4f3a64043c72880">absolute</a>(mat_elem) &gt; tolerance) fprintf(fout,<span class="stringliteral">&quot;%5d %5d %+1.16e\n&quot;</span>,j+1,i+1,mat_elem);</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;      }</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    }</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    fclose(fout);</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  }</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  <span class="comment">/* clean up */</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  free(u);</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  free(u0);</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  free(rhs);</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  free(drhs);</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  free(f);</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  free(f0);</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;}</div>
<div class="ttc" id="a00229_html_a1dab5f429ccd03c4a7fbb605d8ef75b6"><div class="ttname"><a href="a00229.html#a1dab5f429ccd03c4a7fbb605d8ef75b6">_ArrayScale1D_</a></div><div class="ttdeci">#define _ArrayScale1D_(x, a, size)</div><div class="ttdef"><b>Definition:</b> <a href="a00229_source.html#l00190">arrayfunctions.h:190</a></div></div>
<div class="ttc" id="a00229_html_a2b2826031c0cd92495ab351d3e599fc5"><div class="ttname"><a href="a00229.html#a2b2826031c0cd92495ab351d3e599fc5">_ArraySetValue_</a></div><div class="ttdeci">#define _ArraySetValue_(x, size, value)</div><div class="ttdef"><b>Definition:</b> <a href="a00229_source.html#l00169">arrayfunctions.h:169</a></div></div>
<div class="ttc" id="a00248_html_a60ace5964c051fa481e6a1e6f1ef75d7"><div class="ttname"><a href="a00248.html#a60ace5964c051fa481e6a1e6f1ef75d7">MPIExchangeBoundariesnD</a></div><div class="ttdeci">int MPIExchangeBoundariesnD(int, int, int *, int, void *, double *)</div><div class="ttdef"><b>Definition:</b> <a href="a00383_source.html#l00042">MPIExchangeBoundariesnD.c:42</a></div></div>
<div class="ttc" id="a00229_html_afbb862a2fdf5b72b1f9ace42f64b556f"><div class="ttname"><a href="a00229.html#afbb862a2fdf5b72b1f9ace42f64b556f">_ArrayIndex1D_</a></div><div class="ttdeci">#define _ArrayIndex1D_(N, imax, i, ghost, index)</div><div class="ttdef"><b>Definition:</b> <a href="a00229_source.html#l00040">arrayfunctions.h:40</a></div></div>
<div class="ttc" id="a00202_html_adcc5e677515d0952ce3ff702c9d85b86"><div class="ttname"><a href="a00202.html#adcc5e677515d0952ce3ff702c9d85b86">HyPar::FdFFunction</a></div><div class="ttdeci">int(* FdFFunction)(double *, double *, int, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00281">hypar.h:281</a></div></div>
<div class="ttc" id="a00229_html_a89e8330d9e06dd0666c50833628a125c"><div class="ttname"><a href="a00229.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a></div><div class="ttdeci">#define _ArrayCopy1D_(x, y, size)</div><div class="ttdef"><b>Definition:</b> <a href="a00229_source.html#l00319">arrayfunctions.h:319</a></div></div>
<div class="ttc" id="a00229_html_a4cd66304bc41a7751842230af3063b62"><div class="ttname"><a href="a00229.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a></div><div class="ttdeci">#define _ArrayAXPY_(x, a, y, size)</div><div class="ttdef"><b>Definition:</b> <a href="a00229_source.html#l00271">arrayfunctions.h:271</a></div></div>
<div class="ttc" id="a00229_html_ad9b36abcf37c1f675c71da3da16cc8f0"><div class="ttname"><a href="a00229.html#ad9b36abcf37c1f675c71da3da16cc8f0">ArrayCopynD</a></div><div class="ttdeci">INLINE int ArrayCopynD(int, const double *, double *, int *, int, int, int *, int)</div><div class="ttdef"><b>Definition:</b> <a href="a00229_source.html#l00410">arrayfunctions.h:410</a></div></div>
<div class="ttc" id="a00202_html_a484873c74138512e41bc50d17b7d955a"><div class="ttname"><a href="a00202.html#a484873c74138512e41bc50d17b7d955a">HyPar::ndims</a></div><div class="ttdeci">int ndims</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00026">hypar.h:26</a></div></div>
<div class="ttc" id="a00231_html_ad6ab74942c9de13cf0b4c12eb0d91780"><div class="ttname"><a href="a00231.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a></div><div class="ttdeci">#define IERR</div><div class="ttdef"><b>Definition:</b> <a href="a00231_source.html#l00016">basic.h:16</a></div></div>
<div class="ttc" id="a00202_html_ad607f82c4bfde055613e05272f9afd81"><div class="ttname"><a href="a00202.html#ad607f82c4bfde055613e05272f9afd81">HyPar::flag_fdf_specified</a></div><div class="ttdeci">int flag_fdf_specified</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00285">hypar.h:285</a></div></div>
<div class="ttc" id="a00202_html_a38e0371f331cecbe63a77fa03e202afe"><div class="ttname"><a href="a00202.html#a38e0371f331cecbe63a77fa03e202afe">HyPar::dim_local</a></div><div class="ttdeci">int * dim_local</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00037">hypar.h:37</a></div></div>
<div class="ttc" id="a00202_html_ab06746933e859e829d694505c18258b3"><div class="ttname"><a href="a00202.html#ab06746933e859e829d694505c18258b3">HyPar::UpwindFdF</a></div><div class="ttdeci">int(* UpwindFdF)(double *, double *, double *, double *, double *, double *, int, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00302">hypar.h:302</a></div></div>
<div class="ttc" id="a00202_html_aafc992b5fa79d5a4036024615d03bce6"><div class="ttname"><a href="a00202.html#aafc992b5fa79d5a4036024615d03bce6">HyPar::ghosts</a></div><div class="ttdeci">int ghosts</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00052">hypar.h:52</a></div></div>
<div class="ttc" id="a00202_html_a20ee1fd00a220b98513127884a5558cf"><div class="ttname"><a href="a00202.html#a20ee1fd00a220b98513127884a5558cf">HyPar::npoints_local_wghosts</a></div><div class="ttdeci">int npoints_local_wghosts</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00042">hypar.h:42</a></div></div>
<div class="ttc" id="a00231_html_add9cf96ae374934d245a1dc1ab697a42"><div class="ttname"><a href="a00231.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a></div><div class="ttdeci">#define CHECKERR(ierr)</div><div class="ttdef"><b>Definition:</b> <a href="a00231_source.html#l00018">basic.h:18</a></div></div>
<div class="ttc" id="a00229_html_a03f49e4d44ae8aca85cb04cfe91e4ce4"><div class="ttname"><a href="a00229.html#a03f49e4d44ae8aca85cb04cfe91e4ce4">_ArrayIndexnD_</a></div><div class="ttdeci">#define _ArrayIndexnD_(N, index, imax, i, ghost)</div><div class="ttdef"><b>Definition:</b> <a href="a00229_source.html#l00021">arrayfunctions.h:21</a></div></div>
<div class="ttc" id="a00202_html_ae8f6d2fd6490d3153cb4133bf183a404"><div class="ttname"><a href="a00202.html#ae8f6d2fd6490d3153cb4133bf183a404">HyPar::nvars</a></div><div class="ttdeci">int nvars</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00029">hypar.h:29</a></div></div>
<div class="ttc" id="a00205_html_a00663"><div class="ttname"><a href="a00205.html#a00663">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a00205_source.html#l00024">mpivars_struct.h:24</a></div></div>
<div class="ttc" id="a00202_html_afae6319baba315ac1f0c56505610ed85"><div class="ttname"><a href="a00202.html#afae6319baba315ac1f0c56505610ed85">HyPar::npoints_local</a></div><div class="ttdeci">int npoints_local</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00042">hypar.h:42</a></div></div>
<div class="ttc" id="a00202_html_a3b6b999a764f1e2ea94bb5f28c7a558c"><div class="ttname"><a href="a00202.html#a3b6b999a764f1e2ea94bb5f28c7a558c">HyPar::u</a></div><div class="ttdeci">double * u</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00116">hypar.h:116</a></div></div>
<div class="ttc" id="a00202_html_aa245f8c9e6af37e47c5867dccbbc208b"><div class="ttname"><a href="a00202.html#aa245f8c9e6af37e47c5867dccbbc208b">HyPar::HyperbolicFunction</a></div><div class="ttdeci">int(* HyperbolicFunction)(double *, double *, void *, void *, double, int, int(*)(double *, double *, int, void *, double), int(*)(double *, double *, double *, double *, double *, double *, int, void *, double))</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00245">hypar.h:245</a></div></div>
<div class="ttc" id="a00231_html_a51efea86a4d76d1259893f606b776573"><div class="ttname"><a href="a00231.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a></div><div class="ttdeci">#define _MAX_STRING_SIZE_</div><div class="ttdef"><b>Definition:</b> <a href="a00231_source.html#l00014">basic.h:14</a></div></div>
<div class="ttc" id="a00202_html_a83d97dfc50e6bfefd0db6503d365d5bd"><div class="ttname"><a href="a00202.html#a83d97dfc50e6bfefd0db6503d365d5bd">HyPar::ApplyIBConditions</a></div><div class="ttdeci">int(* ApplyIBConditions)(void *, void *, double *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00212">hypar.h:212</a></div></div>
<div class="ttc" id="a00205_html_ae68326adc3b3862f1162832f70727b06"><div class="ttname"><a href="a00205.html#ae68326adc3b3862f1162832f70727b06">MPIVariables::nproc</a></div><div class="ttdeci">int nproc</div><div class="ttdef"><b>Definition:</b> <a href="a00205_source.html#l00026">mpivars_struct.h:26</a></div></div>
<div class="ttc" id="a00202_html_a7eb68b9643feb74bd49f3a171b66eef1"><div class="ttname"><a href="a00202.html#a7eb68b9643feb74bd49f3a171b66eef1">HyPar::Upwind</a></div><div class="ttdeci">int(* Upwind)(double *, double *, double *, double *, double *, double *, int, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00290">hypar.h:290</a></div></div>
<div class="ttc" id="a00202_html_a1685cd0c6b8c413bdbbe86d8f4475c58"><div class="ttname"><a href="a00202.html#a1685cd0c6b8c413bdbbe86d8f4475c58">HyPar::SFunction</a></div><div class="ttdeci">int(* SFunction)(double *, double *, void *, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00312">hypar.h:312</a></div></div>
<div class="ttc" id="a00202_html_a73a85f83072e02bf979234486265b6d3"><div class="ttname"><a href="a00202.html#a73a85f83072e02bf979234486265b6d3">HyPar::UpwinddF</a></div><div class="ttdeci">int(* UpwinddF)(double *, double *, double *, double *, double *, double *, int, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00295">hypar.h:295</a></div></div>
<div class="ttc" id="a00202_html_a0d895f9bb0c8a3e79a64dd2379e1f2dd"><div class="ttname"><a href="a00202.html#a0d895f9bb0c8a3e79a64dd2379e1f2dd">HyPar::FFunction</a></div><div class="ttdeci">int(* FFunction)(double *, double *, int, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00271">hypar.h:271</a></div></div>
<div class="ttc" id="a00202_html_a0805db42e429173752189696c3c96909"><div class="ttname"><a href="a00202.html#a0805db42e429173752189696c3c96909">HyPar::filename_index</a></div><div class="ttdeci">char * filename_index</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00194">hypar.h:194</a></div></div>
<div class="ttc" id="a00202_html_aa1dd38befc4bb4adda9d456146436b14"><div class="ttname"><a href="a00202.html#aa1dd38befc4bb4adda9d456146436b14">HyPar::dFFunction</a></div><div class="ttdeci">int(* dFFunction)(double *, double *, int, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00275">hypar.h:275</a></div></div>
<div class="ttc" id="a00202_html_aa4de7bdc1e62417caf51b9c45184268d"><div class="ttname"><a href="a00202.html#aa4de7bdc1e62417caf51b9c45184268d">HyPar::ApplyBoundaryConditions</a></div><div class="ttdeci">int(* ApplyBoundaryConditions)(void *, void *, double *, double *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00209">hypar.h:209</a></div></div>
<div class="ttc" id="a00202_html"><div class="ttname"><a href="a00202.html">HyPar</a></div><div class="ttdoc">Structure containing all solver-specific variables and functions. </div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00023">hypar.h:23</a></div></div>
<div class="ttc" id="a00202_html_a662e256e081a2b74f971d02c747892b8"><div class="ttname"><a href="a00202.html#a662e256e081a2b74f971d02c747892b8">HyPar::SourceFunction</a></div><div class="ttdeci">int(* SourceFunction)(double *, double *, void *, void *, double)</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00254">hypar.h:254</a></div></div>
<div class="ttc" id="a00243_html_adf1be5ccbb7a2522b4f3a64043c72880"><div class="ttname"><a href="a00243.html#adf1be5ccbb7a2522b4f3a64043c72880">absolute</a></div><div class="ttdeci">#define absolute(a)</div><div class="ttdef"><b>Definition:</b> <a href="a00243_source.html#l00032">math_ops.h:32</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a116876aaf447559b6cc9fff36a501843"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int CalculateError </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>m</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Calculate the error in the final solution</p>
<p>Calculates the error in the solution if the exact solution is available. If the exact solution is not available, the errors are reported as zero. The exact solution should be provided in the file "exact.inp" in the same format as the initial solution. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>Solver object of type <a class="el" href="a00202.html" title="Structure containing all solver-specific variables and functions. ">HyPar</a> </td></tr>
    <tr><td class="paramname">m</td><td>MPI object of type <a class="el" href="a00205.html#a00663" title="Structure of MPI-related variables. ">MPIVariables</a> </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00306_source.html#l00025">25</a> of file <a class="el" href="a00306_source.html">CalculateError.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;{</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  <a class="code" href="a00202.html">HyPar</a>         *solver     = (<a class="code" href="a00202.html">HyPar</a>*)        s;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  <a class="code" href="a00205.html#a00663">MPIVariables</a>  *mpi        = (<a class="code" href="a00205.html#a00663">MPIVariables</a>*) m;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  <span class="keywordtype">int</span>           exact_flag  = 0, i, size;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  <span class="keywordtype">double</span>        <a class="code" href="a00646.html#aca1295e3cf52d990f4cd1d5872f1385a">sum</a>         = 0, global_sum = 0;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <span class="keywordtype">double</span>        *uex        = NULL;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  <a class="code" href="a00231.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a>;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  size = solver-&gt;<a class="code" href="a00202.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; solver-&gt;<a class="code" href="a00202.html#a484873c74138512e41bc50d17b7d955a">ndims</a>; i++) </div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    size *= (solver-&gt;<a class="code" href="a00202.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>[i]+2*solver-&gt;<a class="code" href="a00202.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>);</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  uex = (<span class="keywordtype">double</span>*) calloc (size, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  <span class="keywordtype">char</span> fname_root[<a class="code" href="a00231.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>] = <span class="stringliteral">&quot;exact&quot;</span>;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  <span class="keywordflow">if</span> (solver-&gt;<a class="code" href="a00202.html#a9a0e87291e0e8b9c1445e5482e814c92">nsims</a> &gt; 1) {</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="keywordtype">char</span> index[<a class="code" href="a00231.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>];</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <a class="code" href="a00234.html#a3e3ad5aed581d9ae563190c365dadc41">GetStringFromInteger</a>(solver-&gt;<a class="code" href="a00202.html#a34488172a8ec6e0aaa03cbea46092d3a">my_idx</a>, index, (<span class="keywordtype">int</span>)log10(solver-&gt;<a class="code" href="a00202.html#a9a0e87291e0e8b9c1445e5482e814c92">nsims</a>)+1);</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    strcat(fname_root, <span class="stringliteral">&quot;_&quot;</span>);</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    strcat(fname_root, index);</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  }</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> tolerance = 1e-15;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <a class="code" href="a00231.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00306.html#aef6e3464d167cab9e23a9eacb8f62882">ExactSolution</a>( solver,</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;                      mpi,</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;                      uex,</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;                      fname_root,</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;                      &amp;exact_flag ); <a class="code" href="a00231.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <span class="keywordflow">if</span> (!exact_flag) {</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="comment">/* No exact solution */</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <a class="code" href="a00231.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00265.html#aacd05babc2fa0650f3047f955c38319c">TimeError</a>(solver,mpi,NULL); <a class="code" href="a00231.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    solver-&gt;<a class="code" href="a00202.html#aa40f27cb2afa2db0f0468962be8b3679">error</a>[0] = solver-&gt;<a class="code" href="a00202.html#aa40f27cb2afa2db0f0468962be8b3679">error</a>[1] = solver-&gt;<a class="code" href="a00202.html#aa40f27cb2afa2db0f0468962be8b3679">error</a>[2] = -1;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <a class="code" href="a00231.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00265.html#aacd05babc2fa0650f3047f955c38319c">TimeError</a>(solver,mpi,uex); <a class="code" href="a00231.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="comment">/* calculate solution norms (for relative error) */</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="keywordtype">double</span> solution_norm[3] = {0.0,0.0,0.0};</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="comment">/* L1 */</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    sum = <a class="code" href="a00229.html#a60a3d838d95d860a21de20936f7bb910">ArraySumAbsnD</a>   (solver-&gt;<a class="code" href="a00202.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00202.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00202.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;                           solver-&gt;<a class="code" href="a00202.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,solver-&gt;<a class="code" href="a00202.html#a95e9e0f8a692321b83a2e0ce2789c485">index</a>,uex);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    global_sum = 0; <a class="code" href="a00248.html#abd61f932b070ee84262d9d98b6dd854f">MPISum_double</a>(&amp;global_sum,&amp;sum,1,&amp;mpi-&gt;<a class="code" href="a00205.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    solution_norm[0] = global_sum/((double)solver-&gt;<a class="code" href="a00202.html#a4e67f54563a3c4ff005dfaf0130f957c">npoints_global</a>);</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="comment">/* L2 */</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    sum = <a class="code" href="a00229.html#a8c279db0af78d8ff386cf1a023a405dd">ArraySumSquarenD</a>(solver-&gt;<a class="code" href="a00202.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00202.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00202.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                           solver-&gt;<a class="code" href="a00202.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,solver-&gt;<a class="code" href="a00202.html#a95e9e0f8a692321b83a2e0ce2789c485">index</a>,uex);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    global_sum = 0; <a class="code" href="a00248.html#abd61f932b070ee84262d9d98b6dd854f">MPISum_double</a>(&amp;global_sum,&amp;sum,1,&amp;mpi-&gt;<a class="code" href="a00205.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    solution_norm[1] = sqrt(global_sum/((<span class="keywordtype">double</span>)solver-&gt;<a class="code" href="a00202.html#a4e67f54563a3c4ff005dfaf0130f957c">npoints_global</a>));</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="comment">/* Linf */</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    sum = <a class="code" href="a00229.html#ac20bd4916c6169956e5bf80777c6ab8f">ArrayMaxnD</a>      (solver-&gt;<a class="code" href="a00202.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00202.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00202.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                           solver-&gt;<a class="code" href="a00202.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,solver-&gt;<a class="code" href="a00202.html#a95e9e0f8a692321b83a2e0ce2789c485">index</a>,uex);</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    global_sum = 0; <a class="code" href="a00248.html#a33aa37e0050ec72dadb8d63851df51ec">MPIMax_double</a>(&amp;global_sum,&amp;sum,1,&amp;mpi-&gt;<a class="code" href="a00205.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    solution_norm[2] = global_sum;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="comment">/* compute error = difference between exact and numerical solution */</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <a class="code" href="a00229.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00202.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>,-1.0,uex,size);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="comment">/* calculate L1 norm of error */</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    sum = <a class="code" href="a00229.html#a60a3d838d95d860a21de20936f7bb910">ArraySumAbsnD</a>   (solver-&gt;<a class="code" href="a00202.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00202.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00202.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                           solver-&gt;<a class="code" href="a00202.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,solver-&gt;<a class="code" href="a00202.html#a95e9e0f8a692321b83a2e0ce2789c485">index</a>,uex);</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    global_sum = 0; <a class="code" href="a00248.html#abd61f932b070ee84262d9d98b6dd854f">MPISum_double</a>(&amp;global_sum,&amp;sum,1,&amp;mpi-&gt;<a class="code" href="a00205.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    solver-&gt;<a class="code" href="a00202.html#aa40f27cb2afa2db0f0468962be8b3679">error</a>[0] = global_sum/((double)solver-&gt;<a class="code" href="a00202.html#a4e67f54563a3c4ff005dfaf0130f957c">npoints_global</a>);</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="comment">/* calculate L2 norm of error */</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    sum = <a class="code" href="a00229.html#a8c279db0af78d8ff386cf1a023a405dd">ArraySumSquarenD</a>(solver-&gt;<a class="code" href="a00202.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00202.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00202.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                           solver-&gt;<a class="code" href="a00202.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,solver-&gt;<a class="code" href="a00202.html#a95e9e0f8a692321b83a2e0ce2789c485">index</a>,uex);</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    global_sum = 0; <a class="code" href="a00248.html#abd61f932b070ee84262d9d98b6dd854f">MPISum_double</a>(&amp;global_sum,&amp;sum,1,&amp;mpi-&gt;<a class="code" href="a00205.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    solver-&gt;<a class="code" href="a00202.html#aa40f27cb2afa2db0f0468962be8b3679">error</a>[1] = sqrt(global_sum/((<span class="keywordtype">double</span>)solver-&gt;<a class="code" href="a00202.html#a4e67f54563a3c4ff005dfaf0130f957c">npoints_global</a>));</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="comment">/* calculate Linf norm of error */</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    sum = <a class="code" href="a00229.html#ac20bd4916c6169956e5bf80777c6ab8f">ArrayMaxnD</a>      (solver-&gt;<a class="code" href="a00202.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,solver-&gt;<a class="code" href="a00202.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,solver-&gt;<a class="code" href="a00202.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                           solver-&gt;<a class="code" href="a00202.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,solver-&gt;<a class="code" href="a00202.html#a95e9e0f8a692321b83a2e0ce2789c485">index</a>,uex);</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    global_sum = 0; <a class="code" href="a00248.html#a33aa37e0050ec72dadb8d63851df51ec">MPIMax_double</a>(&amp;global_sum,&amp;sum,1,&amp;mpi-&gt;<a class="code" href="a00205.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    solver-&gt;<a class="code" href="a00202.html#aa40f27cb2afa2db0f0468962be8b3679">error</a>[2] = global_sum;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="comment">/* </span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">      decide whether to normalize and report relative errors, </span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">      or report absolute errors.</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">    */</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="keywordflow">if</span> (    (solution_norm[0] &gt; tolerance) </div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        &amp;&amp;  (solution_norm[1] &gt; tolerance) </div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        &amp;&amp;  (solution_norm[2] &gt; tolerance) ) {</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;      solver-&gt;<a class="code" href="a00202.html#aa40f27cb2afa2db0f0468962be8b3679">error</a>[0] /= solution_norm[0];</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;      solver-&gt;<a class="code" href="a00202.html#aa40f27cb2afa2db0f0468962be8b3679">error</a>[1] /= solution_norm[1];</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;      solver-&gt;<a class="code" href="a00202.html#aa40f27cb2afa2db0f0468962be8b3679">error</a>[2] /= solution_norm[2];</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    }</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  }</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  free(uex);</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;}</div>
<div class="ttc" id="a00248_html_a33aa37e0050ec72dadb8d63851df51ec"><div class="ttname"><a href="a00248.html#a33aa37e0050ec72dadb8d63851df51ec">MPIMax_double</a></div><div class="ttdeci">int MPIMax_double(double *, double *, int, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00391_source.html#l00038">MPIMax.c:38</a></div></div>
<div class="ttc" id="a00234_html_a3e3ad5aed581d9ae563190c365dadc41"><div class="ttname"><a href="a00234.html#a3e3ad5aed581d9ae563190c365dadc41">GetStringFromInteger</a></div><div class="ttdeci">void GetStringFromInteger(int, char *, int)</div><div class="ttdef"><b>Definition:</b> <a href="a00296_source.html#l00015">CommonFunctions.c:15</a></div></div>
<div class="ttc" id="a00231_html_a68f50121fb9a7daeaf60e50cdef82ef3"><div class="ttname"><a href="a00231.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a></div><div class="ttdeci">#define _DECLARE_IERR_</div><div class="ttdef"><b>Definition:</b> <a href="a00231_source.html#l00017">basic.h:17</a></div></div>
<div class="ttc" id="a00306_html_aef6e3464d167cab9e23a9eacb8f62882"><div class="ttname"><a href="a00306.html#aef6e3464d167cab9e23a9eacb8f62882">ExactSolution</a></div><div class="ttdeci">int ExactSolution(void *, void *, double *, char *, int *)</div><div class="ttdef"><b>Definition:</b> <a href="a00309_source.html#l00016">ExactSolution.c:16</a></div></div>
<div class="ttc" id="a00229_html_a4cd66304bc41a7751842230af3063b62"><div class="ttname"><a href="a00229.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a></div><div class="ttdeci">#define _ArrayAXPY_(x, a, y, size)</div><div class="ttdef"><b>Definition:</b> <a href="a00229_source.html#l00271">arrayfunctions.h:271</a></div></div>
<div class="ttc" id="a00202_html_a484873c74138512e41bc50d17b7d955a"><div class="ttname"><a href="a00202.html#a484873c74138512e41bc50d17b7d955a">HyPar::ndims</a></div><div class="ttdeci">int ndims</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00026">hypar.h:26</a></div></div>
<div class="ttc" id="a00231_html_ad6ab74942c9de13cf0b4c12eb0d91780"><div class="ttname"><a href="a00231.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a></div><div class="ttdeci">#define IERR</div><div class="ttdef"><b>Definition:</b> <a href="a00231_source.html#l00016">basic.h:16</a></div></div>
<div class="ttc" id="a00202_html_a34488172a8ec6e0aaa03cbea46092d3a"><div class="ttname"><a href="a00202.html#a34488172a8ec6e0aaa03cbea46092d3a">HyPar::my_idx</a></div><div class="ttdeci">int my_idx</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00061">hypar.h:61</a></div></div>
<div class="ttc" id="a00202_html_a38e0371f331cecbe63a77fa03e202afe"><div class="ttname"><a href="a00202.html#a38e0371f331cecbe63a77fa03e202afe">HyPar::dim_local</a></div><div class="ttdeci">int * dim_local</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00037">hypar.h:37</a></div></div>
<div class="ttc" id="a00229_html_ac20bd4916c6169956e5bf80777c6ab8f"><div class="ttname"><a href="a00229.html#ac20bd4916c6169956e5bf80777c6ab8f">ArrayMaxnD</a></div><div class="ttdeci">INLINE double ArrayMaxnD(int, int, int *, int, int *, double *)</div><div class="ttdef"><b>Definition:</b> <a href="a00229_source.html#l00486">arrayfunctions.h:486</a></div></div>
<div class="ttc" id="a00202_html_aa40f27cb2afa2db0f0468962be8b3679"><div class="ttname"><a href="a00202.html#aa40f27cb2afa2db0f0468962be8b3679">HyPar::error</a></div><div class="ttdeci">double error[3]</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00366">hypar.h:366</a></div></div>
<div class="ttc" id="a00202_html_aafc992b5fa79d5a4036024615d03bce6"><div class="ttname"><a href="a00202.html#aafc992b5fa79d5a4036024615d03bce6">HyPar::ghosts</a></div><div class="ttdeci">int ghosts</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00052">hypar.h:52</a></div></div>
<div class="ttc" id="a00231_html_add9cf96ae374934d245a1dc1ab697a42"><div class="ttname"><a href="a00231.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a></div><div class="ttdeci">#define CHECKERR(ierr)</div><div class="ttdef"><b>Definition:</b> <a href="a00231_source.html#l00018">basic.h:18</a></div></div>
<div class="ttc" id="a00202_html_a9a0e87291e0e8b9c1445e5482e814c92"><div class="ttname"><a href="a00202.html#a9a0e87291e0e8b9c1445e5482e814c92">HyPar::nsims</a></div><div class="ttdeci">int nsims</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00064">hypar.h:64</a></div></div>
<div class="ttc" id="a00202_html_ae8f6d2fd6490d3153cb4133bf183a404"><div class="ttname"><a href="a00202.html#ae8f6d2fd6490d3153cb4133bf183a404">HyPar::nvars</a></div><div class="ttdeci">int nvars</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00029">hypar.h:29</a></div></div>
<div class="ttc" id="a00202_html_a4e67f54563a3c4ff005dfaf0130f957c"><div class="ttname"><a href="a00202.html#a4e67f54563a3c4ff005dfaf0130f957c">HyPar::npoints_global</a></div><div class="ttdeci">int npoints_global</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00040">hypar.h:40</a></div></div>
<div class="ttc" id="a00229_html_a60a3d838d95d860a21de20936f7bb910"><div class="ttname"><a href="a00229.html#a60a3d838d95d860a21de20936f7bb910">ArraySumAbsnD</a></div><div class="ttdeci">INLINE double ArraySumAbsnD(int, int, int *, int, int *, double *)</div><div class="ttdef"><b>Definition:</b> <a href="a00229_source.html#l00510">arrayfunctions.h:510</a></div></div>
<div class="ttc" id="a00205_html_a00663"><div class="ttname"><a href="a00205.html#a00663">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a00205_source.html#l00024">mpivars_struct.h:24</a></div></div>
<div class="ttc" id="a00202_html_a3b6b999a764f1e2ea94bb5f28c7a558c"><div class="ttname"><a href="a00202.html#a3b6b999a764f1e2ea94bb5f28c7a558c">HyPar::u</a></div><div class="ttdeci">double * u</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00116">hypar.h:116</a></div></div>
<div class="ttc" id="a00646_html_aca1295e3cf52d990f4cd1d5872f1385a"><div class="ttname"><a href="a00646.html#aca1295e3cf52d990f4cd1d5872f1385a">StdVecOps::sum</a></div><div class="ttdeci">long sum(const std::vector&lt; int &gt; &amp;a_iv)</div><div class="ttdef"><b>Definition:</b> <a href="a00264_source.html#l00018">std_vec_ops.h:18</a></div></div>
<div class="ttc" id="a00231_html_a51efea86a4d76d1259893f606b776573"><div class="ttname"><a href="a00231.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a></div><div class="ttdeci">#define _MAX_STRING_SIZE_</div><div class="ttdef"><b>Definition:</b> <a href="a00231_source.html#l00014">basic.h:14</a></div></div>
<div class="ttc" id="a00248_html_abd61f932b070ee84262d9d98b6dd854f"><div class="ttname"><a href="a00248.html#abd61f932b070ee84262d9d98b6dd854f">MPISum_double</a></div><div class="ttdeci">int MPISum_double(double *, double *, int, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00398_source.html#l00039">MPISum.c:39</a></div></div>
<div class="ttc" id="a00265_html_aacd05babc2fa0650f3047f955c38319c"><div class="ttname"><a href="a00265.html#aacd05babc2fa0650f3047f955c38319c">TimeError</a></div><div class="ttdeci">int TimeError(void *, void *, double *)</div><div class="ttdef"><b>Definition:</b> <a href="a00624_source.html#l00027">TimeError.c:27</a></div></div>
<div class="ttc" id="a00205_html_adad7a6f85831f3ac84d854b6c80aef43"><div class="ttname"><a href="a00205.html#adad7a6f85831f3ac84d854b6c80aef43">MPIVariables::world</a></div><div class="ttdeci">MPI_Comm world</div><div class="ttdef"><b>Definition:</b> <a href="a00205_source.html#l00037">mpivars_struct.h:37</a></div></div>
<div class="ttc" id="a00229_html_a8c279db0af78d8ff386cf1a023a405dd"><div class="ttname"><a href="a00229.html#a8c279db0af78d8ff386cf1a023a405dd">ArraySumSquarenD</a></div><div class="ttdeci">INLINE double ArraySumSquarenD(int, int, int *, int, int *, double *)</div><div class="ttdef"><b>Definition:</b> <a href="a00229_source.html#l00529">arrayfunctions.h:529</a></div></div>
<div class="ttc" id="a00202_html"><div class="ttname"><a href="a00202.html">HyPar</a></div><div class="ttdoc">Structure containing all solver-specific variables and functions. </div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00023">hypar.h:23</a></div></div>
<div class="ttc" id="a00202_html_a95e9e0f8a692321b83a2e0ce2789c485"><div class="ttname"><a href="a00202.html#a95e9e0f8a692321b83a2e0ce2789c485">HyPar::index</a></div><div class="ttdeci">int * index</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00102">hypar.h:102</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5981de613724cb667e98aa872157534e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int OutputSolution </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nsims</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Write solutions to file</p>
<p>Write out the solution to file </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>Array of simulation objects of type <a class="el" href="a00218.html#a00667" title="Structure defining a simulation. ">SimulationObject</a> </td></tr>
    <tr><td class="paramname">nsims</td><td>Number of simulation objects </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00601_source.html#l00026">26</a> of file <a class="el" href="a00601_source.html">OutputSolution.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;{</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  <a class="code" href="a00218.html#a00667">SimulationObject</a>* simobj = (<a class="code" href="a00218.html#a00667">SimulationObject</a>*) s;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  <span class="keywordtype">int</span> ns;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  <a class="code" href="a00231.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a>;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <span class="keywordflow">for</span> (ns = 0; ns &lt; nsims; ns++) {</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <a class="code" href="a00202.html">HyPar</a>*        solver = &amp;(simobj[ns].<a class="code" href="a00218.html#a523947ce4fa7128c4c767163953253b9">solver</a>);</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <a class="code" href="a00205.html#a00663">MPIVariables</a>* mpi    = &amp;(simobj[ns].<a class="code" href="a00218.html#a4afd2c7b3eb8fda452474ebdbe71c8c0">mpi</a>);</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="comment">/* if WriteOutput() is NULL, then return */</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="keywordflow">if</span> (!solver-&gt;<a class="code" href="a00202.html#a9018a1befab4079332620f40375a9661">WriteOutput</a>) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="comment">/* time integration module may have auxiliary arrays to write out, so get them */</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="keywordtype">int</span> NSolutions = 0;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <a class="code" href="a00231.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00265.html#a9bff7fe5ca4249dd82bfad78a1fa09dd">TimeGetAuxSolutions</a>(&amp;NSolutions,NULL,solver,-1,ns); <a class="code" href="a00231.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="keywordflow">if</span> (NSolutions &gt; 10) NSolutions = 10;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="keywordtype">int</span>  nu;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="keywordtype">char</span> fname_root[<a class="code" href="a00231.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>];</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="keywordtype">char</span> aux_fname_root[<a class="code" href="a00231.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>];</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    strcpy(fname_root, solver-&gt;<a class="code" href="a00202.html#a2f63f9a875bb76e6107cb2e7c725d935">op_fname_root</a>);</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    strcpy(aux_fname_root, solver-&gt;<a class="code" href="a00202.html#a5d741833915983fdcb695f262a73ae7e">aux_op_fname_root</a>);</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="keywordflow">if</span> (nsims &gt; 1) {</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;      <span class="keywordtype">char</span> index[<a class="code" href="a00231.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>];</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;      <a class="code" href="a00234.html#a3e3ad5aed581d9ae563190c365dadc41">GetStringFromInteger</a>(ns, index, (<span class="keywordtype">int</span>)log10(nsims)+1);</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;      strcat(fname_root, <span class="stringliteral">&quot;_&quot;</span>);</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;      strcat(fname_root, index);</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;      strcat(aux_fname_root, <span class="stringliteral">&quot;_&quot;</span>);</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;      strcat(aux_fname_root, index);</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    }</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="keywordflow">for</span> (nu=0; nu&lt;NSolutions; nu++) {</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;      <span class="keywordtype">double</span>  *uaux = NULL;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;      <a class="code" href="a00231.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00265.html#a9bff7fe5ca4249dd82bfad78a1fa09dd">TimeGetAuxSolutions</a>(&amp;NSolutions,&amp;uaux,solver,nu,ns); <a class="code" href="a00231.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;      <a class="code" href="a00231.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00239.html#aaf888c739c5200d9c58a7154347069b0">WriteArray</a>(  solver-&gt;<a class="code" href="a00202.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;                        solver-&gt;<a class="code" href="a00202.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;                        solver-&gt;<a class="code" href="a00202.html#aa989ebb755986852177779cdf7bd8c85">dim_global</a>,</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;                        solver-&gt;<a class="code" href="a00202.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;                        solver-&gt;<a class="code" href="a00202.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;                        solver-&gt;<a class="code" href="a00202.html#a711aad4cbe735871dd9e91ab575c878b">x</a>,</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;                        uaux,</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                        solver,</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;                        mpi,</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                        aux_fname_root ); <a class="code" href="a00231.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;      aux_fname_root[2]++;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    }</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="preprocessor">#if defined(HAVE_CUDA)</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span> (solver-&gt;<a class="code" href="a00202.html#ae4ab67b8e83747d09dc53c42e218eb4e">use_gpu</a>) {</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;      <span class="comment">/* Copy values from GPU memory to CPU memory for writing. */</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;      <a class="code" href="a00230.html#ac87405a3a13250d12c0f033f29a47bab">gpuMemcpy</a>(solver-&gt;<a class="code" href="a00202.html#a711aad4cbe735871dd9e91ab575c878b">x</a>, solver-&gt;<a class="code" href="a00202.html#a12356f3dd3ff93b8a46d248bf1f074e7">gpu_x</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)*solver-&gt;<a class="code" href="a00202.html#aec1dee03c858e0d3910c40c209890ab0">size_x</a>, <a class="code" href="a00230.html#ad3729453a5f50a2a289e41900432368aa5e83a902b81b823a48c8a81680640e35">gpuMemcpyDeviceToHost</a>);</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="preprocessor">#ifdef CUDA_VAR_ORDERDING_AOS</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="preprocessor"></span>      <a class="code" href="a00230.html#ac87405a3a13250d12c0f033f29a47bab">gpuMemcpy</a>(  solver-&gt;<a class="code" href="a00202.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>, </div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;                  solver-&gt;<a class="code" href="a00202.html#ae750cf429003a5174e431a8505bf1dcb">gpu_u</a>, </div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;                  <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)*solver-&gt;<a class="code" href="a00202.html#a3a6d36520a0a04118dafe25c0f5e70b1">ndof_cells_wghosts</a>, </div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                  <a class="code" href="a00230.html#ad3729453a5f50a2a289e41900432368aa5e83a902b81b823a48c8a81680640e35">gpuMemcpyDeviceToHost</a> );</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="preprocessor"></span>      <span class="keywordtype">double</span> *h_u = (<span class="keywordtype">double</span> *) malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)*solver-&gt;<a class="code" href="a00202.html#a3a6d36520a0a04118dafe25c0f5e70b1">ndof_cells_wghosts</a>);</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;      <a class="code" href="a00230.html#ac87405a3a13250d12c0f033f29a47bab">gpuMemcpy</a>(h_u, solver-&gt;<a class="code" href="a00202.html#ae750cf429003a5174e431a8505bf1dcb">gpu_u</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)*solver-&gt;<a class="code" href="a00202.html#a3a6d36520a0a04118dafe25c0f5e70b1">ndof_cells_wghosts</a>, <a class="code" href="a00230.html#ad3729453a5f50a2a289e41900432368aa5e83a902b81b823a48c8a81680640e35">gpuMemcpyDeviceToHost</a>);</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;solver-&gt;<a class="code" href="a00202.html#a20ee1fd00a220b98513127884a5558cf">npoints_local_wghosts</a>; i++) {</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> v=0; v&lt;solver-&gt;<a class="code" href="a00202.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>; v++) {</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;          solver-&gt;<a class="code" href="a00202.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>[i*solver-&gt;<a class="code" href="a00202.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>+v] = h_u[i+v*solver-&gt;<a class="code" href="a00202.html#a20ee1fd00a220b98513127884a5558cf">npoints_local_wghosts</a>];</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        }</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;      }</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;      free(h_u);</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="preprocessor"></span>    }</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <a class="code" href="a00231.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a> <a class="code" href="a00239.html#aaf888c739c5200d9c58a7154347069b0">WriteArray</a>(  solver-&gt;<a class="code" href="a00202.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                      solver-&gt;<a class="code" href="a00202.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                      solver-&gt;<a class="code" href="a00202.html#aa989ebb755986852177779cdf7bd8c85">dim_global</a>,</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                      solver-&gt;<a class="code" href="a00202.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                      solver-&gt;<a class="code" href="a00202.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                      solver-&gt;<a class="code" href="a00202.html#a711aad4cbe735871dd9e91ab575c878b">x</a>,</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                      solver-&gt;<a class="code" href="a00202.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>,</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;                      solver,</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                      mpi,</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                      fname_root ); <a class="code" href="a00231.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a>(ierr);</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="comment">/* increment the index string, if required */</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="keywordflow">if</span> ((!strcmp(solver-&gt;<a class="code" href="a00202.html#a5f89e286a9eaffdb66d966fa6a290d3f">output_mode</a>,<span class="stringliteral">&quot;serial&quot;</span>)) &amp;&amp; (!strcmp(solver-&gt;<a class="code" href="a00202.html#a4e93cb107e180ef982b74cef7726b70f">op_overwrite</a>,<span class="stringliteral">&quot;no&quot;</span>))) {</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;      <a class="code" href="a00312.html#a9fda82ed752188f3af821e2c30f63c21">IncrementFilenameIndex</a>(solver-&gt;<a class="code" href="a00202.html#a0805db42e429173752189696c3c96909">filename_index</a>,solver-&gt;<a class="code" href="a00202.html#af474ca4577de91b658e4399ad0a6d7b3">index_length</a>);</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    }</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  }</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  <span class="keywordflow">return</span>(0);</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;}</div>
<div class="ttc" id="a00202_html_a3a6d36520a0a04118dafe25c0f5e70b1"><div class="ttname"><a href="a00202.html#a3a6d36520a0a04118dafe25c0f5e70b1">HyPar::ndof_cells_wghosts</a></div><div class="ttdeci">int ndof_cells_wghosts</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00047">hypar.h:47</a></div></div>
<div class="ttc" id="a00234_html_a3e3ad5aed581d9ae563190c365dadc41"><div class="ttname"><a href="a00234.html#a3e3ad5aed581d9ae563190c365dadc41">GetStringFromInteger</a></div><div class="ttdeci">void GetStringFromInteger(int, char *, int)</div><div class="ttdef"><b>Definition:</b> <a href="a00296_source.html#l00015">CommonFunctions.c:15</a></div></div>
<div class="ttc" id="a00202_html_a9018a1befab4079332620f40375a9661"><div class="ttname"><a href="a00202.html#a9018a1befab4079332620f40375a9661">HyPar::WriteOutput</a></div><div class="ttdeci">int(* WriteOutput)(int, int, int *, double *, double *, char *, int *)</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00206">hypar.h:206</a></div></div>
<div class="ttc" id="a00218_html_a00667"><div class="ttname"><a href="a00218.html#a00667">SimulationObject</a></div><div class="ttdoc">Structure defining a simulation. </div><div class="ttdef"><b>Definition:</b> <a href="a00218_source.html#l00023">simulation_object.h:23</a></div></div>
<div class="ttc" id="a00202_html_ae4ab67b8e83747d09dc53c42e218eb4e"><div class="ttname"><a href="a00202.html#ae4ab67b8e83747d09dc53c42e218eb4e">HyPar::use_gpu</a></div><div class="ttdeci">int use_gpu</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00444">hypar.h:444</a></div></div>
<div class="ttc" id="a00202_html_aa989ebb755986852177779cdf7bd8c85"><div class="ttname"><a href="a00202.html#aa989ebb755986852177779cdf7bd8c85">HyPar::dim_global</a></div><div class="ttdeci">int * dim_global</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00033">hypar.h:33</a></div></div>
<div class="ttc" id="a00231_html_a68f50121fb9a7daeaf60e50cdef82ef3"><div class="ttname"><a href="a00231.html#a68f50121fb9a7daeaf60e50cdef82ef3">_DECLARE_IERR_</a></div><div class="ttdeci">#define _DECLARE_IERR_</div><div class="ttdef"><b>Definition:</b> <a href="a00231_source.html#l00017">basic.h:17</a></div></div>
<div class="ttc" id="a00202_html_aec1dee03c858e0d3910c40c209890ab0"><div class="ttname"><a href="a00202.html#aec1dee03c858e0d3910c40c209890ab0">HyPar::size_x</a></div><div class="ttdeci">int size_x</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00048">hypar.h:48</a></div></div>
<div class="ttc" id="a00202_html_a711aad4cbe735871dd9e91ab575c878b"><div class="ttname"><a href="a00202.html#a711aad4cbe735871dd9e91ab575c878b">HyPar::x</a></div><div class="ttdeci">double * x</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00107">hypar.h:107</a></div></div>
<div class="ttc" id="a00202_html_a484873c74138512e41bc50d17b7d955a"><div class="ttname"><a href="a00202.html#a484873c74138512e41bc50d17b7d955a">HyPar::ndims</a></div><div class="ttdeci">int ndims</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00026">hypar.h:26</a></div></div>
<div class="ttc" id="a00231_html_ad6ab74942c9de13cf0b4c12eb0d91780"><div class="ttname"><a href="a00231.html#ad6ab74942c9de13cf0b4c12eb0d91780">IERR</a></div><div class="ttdeci">#define IERR</div><div class="ttdef"><b>Definition:</b> <a href="a00231_source.html#l00016">basic.h:16</a></div></div>
<div class="ttc" id="a00202_html_a5f89e286a9eaffdb66d966fa6a290d3f"><div class="ttname"><a href="a00202.html#a5f89e286a9eaffdb66d966fa6a290d3f">HyPar::output_mode</a></div><div class="ttdeci">char output_mode[_MAX_STRING_SIZE_]</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00183">hypar.h:183</a></div></div>
<div class="ttc" id="a00218_html_a4afd2c7b3eb8fda452474ebdbe71c8c0"><div class="ttname"><a href="a00218.html#a4afd2c7b3eb8fda452474ebdbe71c8c0">SimulationObject::mpi</a></div><div class="ttdeci">MPIVariables mpi</div><div class="ttdef"><b>Definition:</b> <a href="a00218_source.html#l00025">simulation_object.h:25</a></div></div>
<div class="ttc" id="a00202_html_a38e0371f331cecbe63a77fa03e202afe"><div class="ttname"><a href="a00202.html#a38e0371f331cecbe63a77fa03e202afe">HyPar::dim_local</a></div><div class="ttdeci">int * dim_local</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00037">hypar.h:37</a></div></div>
<div class="ttc" id="a00202_html_aafc992b5fa79d5a4036024615d03bce6"><div class="ttname"><a href="a00202.html#aafc992b5fa79d5a4036024615d03bce6">HyPar::ghosts</a></div><div class="ttdeci">int ghosts</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00052">hypar.h:52</a></div></div>
<div class="ttc" id="a00202_html_a20ee1fd00a220b98513127884a5558cf"><div class="ttname"><a href="a00202.html#a20ee1fd00a220b98513127884a5558cf">HyPar::npoints_local_wghosts</a></div><div class="ttdeci">int npoints_local_wghosts</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00042">hypar.h:42</a></div></div>
<div class="ttc" id="a00231_html_add9cf96ae374934d245a1dc1ab697a42"><div class="ttname"><a href="a00231.html#add9cf96ae374934d245a1dc1ab697a42">CHECKERR</a></div><div class="ttdeci">#define CHECKERR(ierr)</div><div class="ttdef"><b>Definition:</b> <a href="a00231_source.html#l00018">basic.h:18</a></div></div>
<div class="ttc" id="a00202_html_a5d741833915983fdcb695f262a73ae7e"><div class="ttname"><a href="a00202.html#a5d741833915983fdcb695f262a73ae7e">HyPar::aux_op_fname_root</a></div><div class="ttdeci">char aux_op_fname_root[_MAX_STRING_SIZE_]</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00203">hypar.h:203</a></div></div>
<div class="ttc" id="a00230_html_ad3729453a5f50a2a289e41900432368aa5e83a902b81b823a48c8a81680640e35"><div class="ttname"><a href="a00230.html#ad3729453a5f50a2a289e41900432368aa5e83a902b81b823a48c8a81680640e35">gpuMemcpyDeviceToHost</a></div><div class="ttdef"><b>Definition:</b> <a href="a00230_source.html#l00017">arrayfunctions_gpu.h:17</a></div></div>
<div class="ttc" id="a00202_html_ae8f6d2fd6490d3153cb4133bf183a404"><div class="ttname"><a href="a00202.html#ae8f6d2fd6490d3153cb4133bf183a404">HyPar::nvars</a></div><div class="ttdeci">int nvars</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00029">hypar.h:29</a></div></div>
<div class="ttc" id="a00202_html_a12356f3dd3ff93b8a46d248bf1f074e7"><div class="ttname"><a href="a00202.html#a12356f3dd3ff93b8a46d248bf1f074e7">HyPar::gpu_x</a></div><div class="ttdeci">double * gpu_x</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00452">hypar.h:452</a></div></div>
<div class="ttc" id="a00205_html_a00663"><div class="ttname"><a href="a00205.html#a00663">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a00205_source.html#l00024">mpivars_struct.h:24</a></div></div>
<div class="ttc" id="a00312_html_a9fda82ed752188f3af821e2c30f63c21"><div class="ttname"><a href="a00312.html#a9fda82ed752188f3af821e2c30f63c21">IncrementFilenameIndex</a></div><div class="ttdeci">void IncrementFilenameIndex(char *f, int len)</div><div class="ttdef"><b>Definition:</b> <a href="a00312_source.html#l00046">IncrementFilename.c:46</a></div></div>
<div class="ttc" id="a00265_html_a9bff7fe5ca4249dd82bfad78a1fa09dd"><div class="ttname"><a href="a00265.html#a9bff7fe5ca4249dd82bfad78a1fa09dd">TimeGetAuxSolutions</a></div><div class="ttdeci">int TimeGetAuxSolutions(int *, double **, void *, int, int)</div><div class="ttdef"><b>Definition:</b> <a href="a00628_source.html#l00029">TimeGetAuxSolutions.c:29</a></div></div>
<div class="ttc" id="a00202_html_a3b6b999a764f1e2ea94bb5f28c7a558c"><div class="ttname"><a href="a00202.html#a3b6b999a764f1e2ea94bb5f28c7a558c">HyPar::u</a></div><div class="ttdeci">double * u</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00116">hypar.h:116</a></div></div>
<div class="ttc" id="a00202_html_ae750cf429003a5174e431a8505bf1dcb"><div class="ttname"><a href="a00202.html#ae750cf429003a5174e431a8505bf1dcb">HyPar::gpu_u</a></div><div class="ttdeci">double * gpu_u</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00454">hypar.h:454</a></div></div>
<div class="ttc" id="a00202_html_a4e93cb107e180ef982b74cef7726b70f"><div class="ttname"><a href="a00202.html#a4e93cb107e180ef982b74cef7726b70f">HyPar::op_overwrite</a></div><div class="ttdeci">char op_overwrite[_MAX_STRING_SIZE_]</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00191">hypar.h:191</a></div></div>
<div class="ttc" id="a00231_html_a51efea86a4d76d1259893f606b776573"><div class="ttname"><a href="a00231.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a></div><div class="ttdeci">#define _MAX_STRING_SIZE_</div><div class="ttdef"><b>Definition:</b> <a href="a00231_source.html#l00014">basic.h:14</a></div></div>
<div class="ttc" id="a00239_html_aaf888c739c5200d9c58a7154347069b0"><div class="ttname"><a href="a00239.html#aaf888c739c5200d9c58a7154347069b0">WriteArray</a></div><div class="ttdeci">int WriteArray(int, int, int *, int *, int, double *, double *, void *, void *, char *)</div><div class="ttdef"><b>Definition:</b> <a href="a00366_source.html#l00027">WriteArray.c:27</a></div></div>
<div class="ttc" id="a00202_html_af474ca4577de91b658e4399ad0a6d7b3"><div class="ttname"><a href="a00202.html#af474ca4577de91b658e4399ad0a6d7b3">HyPar::index_length</a></div><div class="ttdeci">int index_length</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00196">hypar.h:196</a></div></div>
<div class="ttc" id="a00230_html_ac87405a3a13250d12c0f033f29a47bab"><div class="ttname"><a href="a00230.html#ac87405a3a13250d12c0f033f29a47bab">gpuMemcpy</a></div><div class="ttdeci">void gpuMemcpy(void *, const void *, size_t, enum gpuMemcpyKind)</div><div class="ttdef"><b>Definition:</b> <a href="a00270_source.html#l00094">ArrayImplementations_GPU.cu:94</a></div></div>
<div class="ttc" id="a00202_html_a0805db42e429173752189696c3c96909"><div class="ttname"><a href="a00202.html#a0805db42e429173752189696c3c96909">HyPar::filename_index</a></div><div class="ttdeci">char * filename_index</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00194">hypar.h:194</a></div></div>
<div class="ttc" id="a00202_html"><div class="ttname"><a href="a00202.html">HyPar</a></div><div class="ttdoc">Structure containing all solver-specific variables and functions. </div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00023">hypar.h:23</a></div></div>
<div class="ttc" id="a00202_html_a2f63f9a875bb76e6107cb2e7c725d935"><div class="ttname"><a href="a00202.html#a2f63f9a875bb76e6107cb2e7c725d935">HyPar::op_fname_root</a></div><div class="ttdeci">char op_fname_root[_MAX_STRING_SIZE_]</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00201">hypar.h:201</a></div></div>
<div class="ttc" id="a00218_html_a523947ce4fa7128c4c767163953253b9"><div class="ttname"><a href="a00218.html#a523947ce4fa7128c4c767163953253b9">SimulationObject::solver</a></div><div class="ttdeci">HyPar solver</div><div class="ttdef"><b>Definition:</b> <a href="a00218_source.html#l00026">simulation_object.h:26</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="abf45c2d1c16e7b6f6f48ffd421c68c7c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ResetFilenameIndex </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>f</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Reset filename index</p>
<p>Resets the index to "0000..." of a desired length. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">f</td><td>Character string representing the integer </td></tr>
    <tr><td class="paramname">len</td><td>Length of the string </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00312_source.html#l00064">64</a> of file <a class="el" href="a00312_source.html">IncrementFilename.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;{</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; len; i++) {</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    f[i] = <span class="charliteral">&#39;0&#39;</span>;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  }</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aa0fa2c66e04e9f6d84039bedc6400765"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int CalculateROMDiff </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>m</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Calculate the diff of PDE and ROM solutions</p>
<p>Calculates the L1, L2, &amp; Linf norms of the diff between the PDE solution and the predicted solution by libROM. error in the solution if the exact solution is </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>Solver object of type <a class="el" href="a00202.html" title="Structure containing all solver-specific variables and functions. ">HyPar</a> </td></tr>
    <tr><td class="paramname">m</td><td>MPI object of type <a class="el" href="a00205.html#a00663" title="Structure of MPI-related variables. ">MPIVariables</a> </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00307_source.html#l00024">24</a> of file <a class="el" href="a00307_source.html">CalculateROMDiff.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;{</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  <a class="code" href="a00202.html">HyPar</a>* solver = (<a class="code" href="a00202.html">HyPar</a>*) s;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  <a class="code" href="a00205.html#a00663">MPIVariables</a>* mpi = (<a class="code" href="a00205.html#a00663">MPIVariables</a>*) m;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  <span class="keywordtype">double</span> <a class="code" href="a00646.html#aca1295e3cf52d990f4cd1d5872f1385a">sum</a> = 0, global_sum = 0;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> tolerance = 1e-15;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  <span class="keywordtype">int</span> size = solver-&gt;<a class="code" href="a00202.html#a20ee1fd00a220b98513127884a5558cf">npoints_local_wghosts</a> * solver-&gt;<a class="code" href="a00202.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <span class="keywordtype">double</span>* u_diff = (<span class="keywordtype">double</span>*) calloc (size, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  <span class="comment">/* calculate solution norms (for relative error) */</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  <span class="keywordtype">double</span> solution_norm[3] = {0.0,0.0,0.0};</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <span class="comment">/* L1 */</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  sum = <a class="code" href="a00229.html#a60a3d838d95d860a21de20936f7bb910">ArraySumAbsnD</a> ( solver-&gt;<a class="code" href="a00202.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;                        solver-&gt;<a class="code" href="a00202.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;                        solver-&gt;<a class="code" href="a00202.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;                        solver-&gt;<a class="code" href="a00202.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;                        solver-&gt;<a class="code" href="a00202.html#a95e9e0f8a692321b83a2e0ce2789c485">index</a>,</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;                        solver-&gt;<a class="code" href="a00202.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a> );</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  global_sum = 0; <a class="code" href="a00248.html#abd61f932b070ee84262d9d98b6dd854f">MPISum_double</a>(&amp;global_sum,&amp;sum,1,&amp;mpi-&gt;<a class="code" href="a00205.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  solution_norm[0] = global_sum/((double)solver-&gt;<a class="code" href="a00202.html#a4e67f54563a3c4ff005dfaf0130f957c">npoints_global</a>);</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  <span class="comment">/* L2 */</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  sum = <a class="code" href="a00229.html#a8c279db0af78d8ff386cf1a023a405dd">ArraySumSquarenD</a>  ( solver-&gt;<a class="code" href="a00202.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;                            solver-&gt;<a class="code" href="a00202.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;                            solver-&gt;<a class="code" href="a00202.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;                            solver-&gt;<a class="code" href="a00202.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;                            solver-&gt;<a class="code" href="a00202.html#a95e9e0f8a692321b83a2e0ce2789c485">index</a>,</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;                            solver-&gt;<a class="code" href="a00202.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a> );</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  global_sum = 0; <a class="code" href="a00248.html#abd61f932b070ee84262d9d98b6dd854f">MPISum_double</a>(&amp;global_sum,&amp;sum,1,&amp;mpi-&gt;<a class="code" href="a00205.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  solution_norm[1] = sqrt(global_sum/((<span class="keywordtype">double</span>)solver-&gt;<a class="code" href="a00202.html#a4e67f54563a3c4ff005dfaf0130f957c">npoints_global</a>));</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <span class="comment">/* Linf */</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  sum = <a class="code" href="a00229.html#ac20bd4916c6169956e5bf80777c6ab8f">ArrayMaxnD</a>  ( solver-&gt;<a class="code" href="a00202.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;                      solver-&gt;<a class="code" href="a00202.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;                      solver-&gt;<a class="code" href="a00202.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;                      solver-&gt;<a class="code" href="a00202.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;                      solver-&gt;<a class="code" href="a00202.html#a95e9e0f8a692321b83a2e0ce2789c485">index</a></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;                      ,solver-&gt;<a class="code" href="a00202.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>  );</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  global_sum = 0; <a class="code" href="a00248.html#a33aa37e0050ec72dadb8d63851df51ec">MPIMax_double</a>(&amp;global_sum,&amp;sum,1,&amp;mpi-&gt;<a class="code" href="a00205.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  solution_norm[2] = global_sum;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  <span class="comment">/* set u_diff to PDE solution */</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <a class="code" href="a00229.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a>(solver-&gt;<a class="code" href="a00202.html#a3b6b999a764f1e2ea94bb5f28c7a558c">u</a>, u_diff, size);</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <span class="comment">/* subtract the ROM solutions */</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  <a class="code" href="a00229.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a>(solver-&gt;<a class="code" href="a00202.html#aac11b2a653ffaeac4b35057431f1b981">u_rom_predicted</a>, -1.0, u_diff, size);</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <span class="comment">/* calculate L1 norm of error */</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  sum = <a class="code" href="a00229.html#a60a3d838d95d860a21de20936f7bb910">ArraySumAbsnD</a> ( solver-&gt;<a class="code" href="a00202.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;                        solver-&gt;<a class="code" href="a00202.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                        solver-&gt;<a class="code" href="a00202.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;                        solver-&gt;<a class="code" href="a00202.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                        solver-&gt;<a class="code" href="a00202.html#a95e9e0f8a692321b83a2e0ce2789c485">index</a>,</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;                        u_diff  );</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  global_sum = 0; <a class="code" href="a00248.html#abd61f932b070ee84262d9d98b6dd854f">MPISum_double</a>(&amp;global_sum,&amp;sum,1,&amp;mpi-&gt;<a class="code" href="a00205.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  solver-&gt;<a class="code" href="a00202.html#aaacee284a041d53cf335ae299d5eb929">rom_diff_norms</a>[0] = global_sum/((double)solver-&gt;<a class="code" href="a00202.html#a4e67f54563a3c4ff005dfaf0130f957c">npoints_global</a>);</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <span class="comment">/* calculate L2 norm of error */</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  sum = <a class="code" href="a00229.html#a8c279db0af78d8ff386cf1a023a405dd">ArraySumSquarenD</a>  ( solver-&gt;<a class="code" href="a00202.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;                            solver-&gt;<a class="code" href="a00202.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                            solver-&gt;<a class="code" href="a00202.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;                            solver-&gt;<a class="code" href="a00202.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;                            solver-&gt;<a class="code" href="a00202.html#a95e9e0f8a692321b83a2e0ce2789c485">index</a>,</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;                            u_diff  );</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  global_sum = 0; <a class="code" href="a00248.html#abd61f932b070ee84262d9d98b6dd854f">MPISum_double</a>(&amp;global_sum,&amp;sum,1,&amp;mpi-&gt;<a class="code" href="a00205.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  solver-&gt;<a class="code" href="a00202.html#aaacee284a041d53cf335ae299d5eb929">rom_diff_norms</a>[1] = sqrt(global_sum/((<span class="keywordtype">double</span>)solver-&gt;<a class="code" href="a00202.html#a4e67f54563a3c4ff005dfaf0130f957c">npoints_global</a>));</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <span class="comment">/* calculate Linf norm of error */</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  sum = <a class="code" href="a00229.html#ac20bd4916c6169956e5bf80777c6ab8f">ArrayMaxnD</a>  ( solver-&gt;<a class="code" href="a00202.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;                      solver-&gt;<a class="code" href="a00202.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                      solver-&gt;<a class="code" href="a00202.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                      solver-&gt;<a class="code" href="a00202.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                      solver-&gt;<a class="code" href="a00202.html#a95e9e0f8a692321b83a2e0ce2789c485">index</a>,</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;                      u_diff  );</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  global_sum = 0; <a class="code" href="a00248.html#a33aa37e0050ec72dadb8d63851df51ec">MPIMax_double</a>(&amp;global_sum,&amp;sum,1,&amp;mpi-&gt;<a class="code" href="a00205.html#adad7a6f85831f3ac84d854b6c80aef43">world</a>);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  solver-&gt;<a class="code" href="a00202.html#aaacee284a041d53cf335ae299d5eb929">rom_diff_norms</a>[2] = global_sum;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <span class="comment">/* decide whether to normalize and report relative diff norms, </span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">    or report absolute diff norms. */</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <span class="keywordflow">if</span> (    (solution_norm[0] &gt; tolerance) </div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;      &amp;&amp;  (solution_norm[1] &gt; tolerance) </div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;      &amp;&amp;  (solution_norm[2] &gt; tolerance) ) {</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    solver-&gt;<a class="code" href="a00202.html#aaacee284a041d53cf335ae299d5eb929">rom_diff_norms</a>[0] /= solution_norm[0];</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    solver-&gt;<a class="code" href="a00202.html#aaacee284a041d53cf335ae299d5eb929">rom_diff_norms</a>[1] /= solution_norm[1];</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    solver-&gt;<a class="code" href="a00202.html#aaacee284a041d53cf335ae299d5eb929">rom_diff_norms</a>[2] /= solution_norm[2];</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  }</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  free(u_diff);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;}</div>
<div class="ttc" id="a00248_html_a33aa37e0050ec72dadb8d63851df51ec"><div class="ttname"><a href="a00248.html#a33aa37e0050ec72dadb8d63851df51ec">MPIMax_double</a></div><div class="ttdeci">int MPIMax_double(double *, double *, int, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00391_source.html#l00038">MPIMax.c:38</a></div></div>
<div class="ttc" id="a00229_html_a89e8330d9e06dd0666c50833628a125c"><div class="ttname"><a href="a00229.html#a89e8330d9e06dd0666c50833628a125c">_ArrayCopy1D_</a></div><div class="ttdeci">#define _ArrayCopy1D_(x, y, size)</div><div class="ttdef"><b>Definition:</b> <a href="a00229_source.html#l00319">arrayfunctions.h:319</a></div></div>
<div class="ttc" id="a00202_html_aac11b2a653ffaeac4b35057431f1b981"><div class="ttname"><a href="a00202.html#aac11b2a653ffaeac4b35057431f1b981">HyPar::u_rom_predicted</a></div><div class="ttdeci">double * u_rom_predicted</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00398">hypar.h:398</a></div></div>
<div class="ttc" id="a00229_html_a4cd66304bc41a7751842230af3063b62"><div class="ttname"><a href="a00229.html#a4cd66304bc41a7751842230af3063b62">_ArrayAXPY_</a></div><div class="ttdeci">#define _ArrayAXPY_(x, a, y, size)</div><div class="ttdef"><b>Definition:</b> <a href="a00229_source.html#l00271">arrayfunctions.h:271</a></div></div>
<div class="ttc" id="a00202_html_a484873c74138512e41bc50d17b7d955a"><div class="ttname"><a href="a00202.html#a484873c74138512e41bc50d17b7d955a">HyPar::ndims</a></div><div class="ttdeci">int ndims</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00026">hypar.h:26</a></div></div>
<div class="ttc" id="a00202_html_a38e0371f331cecbe63a77fa03e202afe"><div class="ttname"><a href="a00202.html#a38e0371f331cecbe63a77fa03e202afe">HyPar::dim_local</a></div><div class="ttdeci">int * dim_local</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00037">hypar.h:37</a></div></div>
<div class="ttc" id="a00229_html_ac20bd4916c6169956e5bf80777c6ab8f"><div class="ttname"><a href="a00229.html#ac20bd4916c6169956e5bf80777c6ab8f">ArrayMaxnD</a></div><div class="ttdeci">INLINE double ArrayMaxnD(int, int, int *, int, int *, double *)</div><div class="ttdef"><b>Definition:</b> <a href="a00229_source.html#l00486">arrayfunctions.h:486</a></div></div>
<div class="ttc" id="a00202_html_aaacee284a041d53cf335ae299d5eb929"><div class="ttname"><a href="a00202.html#aaacee284a041d53cf335ae299d5eb929">HyPar::rom_diff_norms</a></div><div class="ttdeci">double rom_diff_norms[3]</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00400">hypar.h:400</a></div></div>
<div class="ttc" id="a00202_html_aafc992b5fa79d5a4036024615d03bce6"><div class="ttname"><a href="a00202.html#aafc992b5fa79d5a4036024615d03bce6">HyPar::ghosts</a></div><div class="ttdeci">int ghosts</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00052">hypar.h:52</a></div></div>
<div class="ttc" id="a00202_html_a20ee1fd00a220b98513127884a5558cf"><div class="ttname"><a href="a00202.html#a20ee1fd00a220b98513127884a5558cf">HyPar::npoints_local_wghosts</a></div><div class="ttdeci">int npoints_local_wghosts</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00042">hypar.h:42</a></div></div>
<div class="ttc" id="a00202_html_ae8f6d2fd6490d3153cb4133bf183a404"><div class="ttname"><a href="a00202.html#ae8f6d2fd6490d3153cb4133bf183a404">HyPar::nvars</a></div><div class="ttdeci">int nvars</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00029">hypar.h:29</a></div></div>
<div class="ttc" id="a00202_html_a4e67f54563a3c4ff005dfaf0130f957c"><div class="ttname"><a href="a00202.html#a4e67f54563a3c4ff005dfaf0130f957c">HyPar::npoints_global</a></div><div class="ttdeci">int npoints_global</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00040">hypar.h:40</a></div></div>
<div class="ttc" id="a00229_html_a60a3d838d95d860a21de20936f7bb910"><div class="ttname"><a href="a00229.html#a60a3d838d95d860a21de20936f7bb910">ArraySumAbsnD</a></div><div class="ttdeci">INLINE double ArraySumAbsnD(int, int, int *, int, int *, double *)</div><div class="ttdef"><b>Definition:</b> <a href="a00229_source.html#l00510">arrayfunctions.h:510</a></div></div>
<div class="ttc" id="a00205_html_a00663"><div class="ttname"><a href="a00205.html#a00663">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a00205_source.html#l00024">mpivars_struct.h:24</a></div></div>
<div class="ttc" id="a00202_html_a3b6b999a764f1e2ea94bb5f28c7a558c"><div class="ttname"><a href="a00202.html#a3b6b999a764f1e2ea94bb5f28c7a558c">HyPar::u</a></div><div class="ttdeci">double * u</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00116">hypar.h:116</a></div></div>
<div class="ttc" id="a00646_html_aca1295e3cf52d990f4cd1d5872f1385a"><div class="ttname"><a href="a00646.html#aca1295e3cf52d990f4cd1d5872f1385a">StdVecOps::sum</a></div><div class="ttdeci">long sum(const std::vector&lt; int &gt; &amp;a_iv)</div><div class="ttdef"><b>Definition:</b> <a href="a00264_source.html#l00018">std_vec_ops.h:18</a></div></div>
<div class="ttc" id="a00248_html_abd61f932b070ee84262d9d98b6dd854f"><div class="ttname"><a href="a00248.html#abd61f932b070ee84262d9d98b6dd854f">MPISum_double</a></div><div class="ttdeci">int MPISum_double(double *, double *, int, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00398_source.html#l00039">MPISum.c:39</a></div></div>
<div class="ttc" id="a00205_html_adad7a6f85831f3ac84d854b6c80aef43"><div class="ttname"><a href="a00205.html#adad7a6f85831f3ac84d854b6c80aef43">MPIVariables::world</a></div><div class="ttdeci">MPI_Comm world</div><div class="ttdef"><b>Definition:</b> <a href="a00205_source.html#l00037">mpivars_struct.h:37</a></div></div>
<div class="ttc" id="a00229_html_a8c279db0af78d8ff386cf1a023a405dd"><div class="ttname"><a href="a00229.html#a8c279db0af78d8ff386cf1a023a405dd">ArraySumSquarenD</a></div><div class="ttdeci">INLINE double ArraySumSquarenD(int, int, int *, int, int *, double *)</div><div class="ttdef"><b>Definition:</b> <a href="a00229_source.html#l00529">arrayfunctions.h:529</a></div></div>
<div class="ttc" id="a00202_html"><div class="ttname"><a href="a00202.html">HyPar</a></div><div class="ttdoc">Structure containing all solver-specific variables and functions. </div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00023">hypar.h:23</a></div></div>
<div class="ttc" id="a00202_html_a95e9e0f8a692321b83a2e0ce2789c485"><div class="ttname"><a href="a00202.html#a95e9e0f8a692321b83a2e0ce2789c485">HyPar::index</a></div><div class="ttdeci">int * index</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00102">hypar.h:102</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a0f058c8fed21156da5f1f64c828b5b39"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int OutputROMSolution </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nsims</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Write ROM solutions to file</p>
<p>Write out the ROM solution to file </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>Array of simulation objects of type <a class="el" href="a00218.html#a00667" title="Structure defining a simulation. ">SimulationObject</a> </td></tr>
    <tr><td class="paramname">nsims</td><td>Number of simulation objects </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00600_source.html#l00024">24</a> of file <a class="el" href="a00600_source.html">OutputROMSolution.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;{</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  <a class="code" href="a00218.html#a00667">SimulationObject</a>* simobj = (<a class="code" href="a00218.html#a00667">SimulationObject</a>*) s;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  <span class="keywordtype">int</span> ns;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  <span class="keywordflow">for</span> (ns = 0; ns &lt; nsims; ns++) {</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <a class="code" href="a00202.html">HyPar</a>*        solver = &amp;(simobj[ns].<a class="code" href="a00218.html#a523947ce4fa7128c4c767163953253b9">solver</a>);</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <a class="code" href="a00205.html#a00663">MPIVariables</a>* mpi    = &amp;(simobj[ns].<a class="code" href="a00218.html#a4afd2c7b3eb8fda452474ebdbe71c8c0">mpi</a>);</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    </div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="comment">/* if WriteOutput() is NULL, then return */</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="keywordflow">if</span> (!solver-&gt;<a class="code" href="a00202.html#a9018a1befab4079332620f40375a9661">WriteOutput</a>) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  </div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <span class="keywordtype">char</span> fname_root[<a class="code" href="a00231.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>];</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    strcpy(fname_root, solver-&gt;<a class="code" href="a00202.html#af5db0aad0268af0ba82e1281d44bb73a">op_rom_fname_root</a>);</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="keywordflow">if</span> (nsims &gt; 1) {</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;      <span class="keywordtype">char</span> index[<a class="code" href="a00231.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>];</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;      <a class="code" href="a00234.html#a3e3ad5aed581d9ae563190c365dadc41">GetStringFromInteger</a>(ns, index, (<span class="keywordtype">int</span>)log10(nsims)+1);</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;      strcat(fname_root, <span class="stringliteral">&quot;_&quot;</span>);</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;      strcat(fname_root, index);</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    }</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  </div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <a class="code" href="a00239.html#aaf888c739c5200d9c58a7154347069b0">WriteArray</a>( solver-&gt;<a class="code" href="a00202.html#a484873c74138512e41bc50d17b7d955a">ndims</a>,</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;                solver-&gt;<a class="code" href="a00202.html#ae8f6d2fd6490d3153cb4133bf183a404">nvars</a>,</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;                solver-&gt;<a class="code" href="a00202.html#aa989ebb755986852177779cdf7bd8c85">dim_global</a>,</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;                solver-&gt;<a class="code" href="a00202.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;                solver-&gt;<a class="code" href="a00202.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;                solver-&gt;<a class="code" href="a00202.html#a711aad4cbe735871dd9e91ab575c878b">x</a>,</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;                solver-&gt;<a class="code" href="a00202.html#aac11b2a653ffaeac4b35057431f1b981">u_rom_predicted</a>,</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;                solver,</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;                mpi,</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;                fname_root );</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="comment">/* increment the index string, if required */</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="keywordflow">if</span> ((!strcmp(solver-&gt;<a class="code" href="a00202.html#a5f89e286a9eaffdb66d966fa6a290d3f">output_mode</a>,<span class="stringliteral">&quot;serial&quot;</span>)) &amp;&amp; (!strcmp(solver-&gt;<a class="code" href="a00202.html#a4e93cb107e180ef982b74cef7726b70f">op_overwrite</a>,<span class="stringliteral">&quot;no&quot;</span>))) {</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;      <a class="code" href="a00312.html#a9fda82ed752188f3af821e2c30f63c21">IncrementFilenameIndex</a>(solver-&gt;<a class="code" href="a00202.html#a0805db42e429173752189696c3c96909">filename_index</a>,solver-&gt;<a class="code" href="a00202.html#af474ca4577de91b658e4399ad0a6d7b3">index_length</a>);</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    }</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  }</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  </div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;}</div>
<div class="ttc" id="a00202_html_af5db0aad0268af0ba82e1281d44bb73a"><div class="ttname"><a href="a00202.html#af5db0aad0268af0ba82e1281d44bb73a">HyPar::op_rom_fname_root</a></div><div class="ttdeci">char op_rom_fname_root[_MAX_STRING_SIZE_]</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00402">hypar.h:402</a></div></div>
<div class="ttc" id="a00234_html_a3e3ad5aed581d9ae563190c365dadc41"><div class="ttname"><a href="a00234.html#a3e3ad5aed581d9ae563190c365dadc41">GetStringFromInteger</a></div><div class="ttdeci">void GetStringFromInteger(int, char *, int)</div><div class="ttdef"><b>Definition:</b> <a href="a00296_source.html#l00015">CommonFunctions.c:15</a></div></div>
<div class="ttc" id="a00202_html_a9018a1befab4079332620f40375a9661"><div class="ttname"><a href="a00202.html#a9018a1befab4079332620f40375a9661">HyPar::WriteOutput</a></div><div class="ttdeci">int(* WriteOutput)(int, int, int *, double *, double *, char *, int *)</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00206">hypar.h:206</a></div></div>
<div class="ttc" id="a00218_html_a00667"><div class="ttname"><a href="a00218.html#a00667">SimulationObject</a></div><div class="ttdoc">Structure defining a simulation. </div><div class="ttdef"><b>Definition:</b> <a href="a00218_source.html#l00023">simulation_object.h:23</a></div></div>
<div class="ttc" id="a00202_html_aa989ebb755986852177779cdf7bd8c85"><div class="ttname"><a href="a00202.html#aa989ebb755986852177779cdf7bd8c85">HyPar::dim_global</a></div><div class="ttdeci">int * dim_global</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00033">hypar.h:33</a></div></div>
<div class="ttc" id="a00202_html_aac11b2a653ffaeac4b35057431f1b981"><div class="ttname"><a href="a00202.html#aac11b2a653ffaeac4b35057431f1b981">HyPar::u_rom_predicted</a></div><div class="ttdeci">double * u_rom_predicted</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00398">hypar.h:398</a></div></div>
<div class="ttc" id="a00202_html_a711aad4cbe735871dd9e91ab575c878b"><div class="ttname"><a href="a00202.html#a711aad4cbe735871dd9e91ab575c878b">HyPar::x</a></div><div class="ttdeci">double * x</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00107">hypar.h:107</a></div></div>
<div class="ttc" id="a00202_html_a484873c74138512e41bc50d17b7d955a"><div class="ttname"><a href="a00202.html#a484873c74138512e41bc50d17b7d955a">HyPar::ndims</a></div><div class="ttdeci">int ndims</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00026">hypar.h:26</a></div></div>
<div class="ttc" id="a00202_html_a5f89e286a9eaffdb66d966fa6a290d3f"><div class="ttname"><a href="a00202.html#a5f89e286a9eaffdb66d966fa6a290d3f">HyPar::output_mode</a></div><div class="ttdeci">char output_mode[_MAX_STRING_SIZE_]</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00183">hypar.h:183</a></div></div>
<div class="ttc" id="a00218_html_a4afd2c7b3eb8fda452474ebdbe71c8c0"><div class="ttname"><a href="a00218.html#a4afd2c7b3eb8fda452474ebdbe71c8c0">SimulationObject::mpi</a></div><div class="ttdeci">MPIVariables mpi</div><div class="ttdef"><b>Definition:</b> <a href="a00218_source.html#l00025">simulation_object.h:25</a></div></div>
<div class="ttc" id="a00202_html_a38e0371f331cecbe63a77fa03e202afe"><div class="ttname"><a href="a00202.html#a38e0371f331cecbe63a77fa03e202afe">HyPar::dim_local</a></div><div class="ttdeci">int * dim_local</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00037">hypar.h:37</a></div></div>
<div class="ttc" id="a00202_html_aafc992b5fa79d5a4036024615d03bce6"><div class="ttname"><a href="a00202.html#aafc992b5fa79d5a4036024615d03bce6">HyPar::ghosts</a></div><div class="ttdeci">int ghosts</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00052">hypar.h:52</a></div></div>
<div class="ttc" id="a00202_html_ae8f6d2fd6490d3153cb4133bf183a404"><div class="ttname"><a href="a00202.html#ae8f6d2fd6490d3153cb4133bf183a404">HyPar::nvars</a></div><div class="ttdeci">int nvars</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00029">hypar.h:29</a></div></div>
<div class="ttc" id="a00205_html_a00663"><div class="ttname"><a href="a00205.html#a00663">MPIVariables</a></div><div class="ttdoc">Structure of MPI-related variables. </div><div class="ttdef"><b>Definition:</b> <a href="a00205_source.html#l00024">mpivars_struct.h:24</a></div></div>
<div class="ttc" id="a00312_html_a9fda82ed752188f3af821e2c30f63c21"><div class="ttname"><a href="a00312.html#a9fda82ed752188f3af821e2c30f63c21">IncrementFilenameIndex</a></div><div class="ttdeci">void IncrementFilenameIndex(char *f, int len)</div><div class="ttdef"><b>Definition:</b> <a href="a00312_source.html#l00046">IncrementFilename.c:46</a></div></div>
<div class="ttc" id="a00202_html_a4e93cb107e180ef982b74cef7726b70f"><div class="ttname"><a href="a00202.html#a4e93cb107e180ef982b74cef7726b70f">HyPar::op_overwrite</a></div><div class="ttdeci">char op_overwrite[_MAX_STRING_SIZE_]</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00191">hypar.h:191</a></div></div>
<div class="ttc" id="a00231_html_a51efea86a4d76d1259893f606b776573"><div class="ttname"><a href="a00231.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a></div><div class="ttdeci">#define _MAX_STRING_SIZE_</div><div class="ttdef"><b>Definition:</b> <a href="a00231_source.html#l00014">basic.h:14</a></div></div>
<div class="ttc" id="a00239_html_aaf888c739c5200d9c58a7154347069b0"><div class="ttname"><a href="a00239.html#aaf888c739c5200d9c58a7154347069b0">WriteArray</a></div><div class="ttdeci">int WriteArray(int, int, int *, int *, int, double *, double *, void *, void *, char *)</div><div class="ttdef"><b>Definition:</b> <a href="a00366_source.html#l00027">WriteArray.c:27</a></div></div>
<div class="ttc" id="a00202_html_af474ca4577de91b658e4399ad0a6d7b3"><div class="ttname"><a href="a00202.html#af474ca4577de91b658e4399ad0a6d7b3">HyPar::index_length</a></div><div class="ttdeci">int index_length</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00196">hypar.h:196</a></div></div>
<div class="ttc" id="a00202_html_a0805db42e429173752189696c3c96909"><div class="ttname"><a href="a00202.html#a0805db42e429173752189696c3c96909">HyPar::filename_index</a></div><div class="ttdeci">char * filename_index</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00194">hypar.h:194</a></div></div>
<div class="ttc" id="a00202_html"><div class="ttname"><a href="a00202.html">HyPar</a></div><div class="ttdoc">Structure containing all solver-specific variables and functions. </div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00023">hypar.h:23</a></div></div>
<div class="ttc" id="a00218_html_a523947ce4fa7128c4c767163953253b9"><div class="ttname"><a href="a00218.html#a523947ce4fa7128c4c767163953253b9">SimulationObject::solver</a></div><div class="ttdeci">HyPar solver</div><div class="ttdef"><b>Definition:</b> <a href="a00218_source.html#l00026">simulation_object.h:26</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7252344719299385bb387a001b2a3a38"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int Solve </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nsims</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>rank</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nproc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function integrates the semi-discrete ODE (obtained from discretizing the PDE in space) using natively implemented time integration methods. It initializes the time integration object, iterates the simulation for the required number of time steps, and calculates the errors. After the specified number of iterations, it writes out some information to the screen and the solution to a file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>Array of simulation objects of type <a class="el" href="a00218.html#a00667" title="Structure defining a simulation. ">SimulationObject</a> </td></tr>
    <tr><td class="paramname">nsims</td><td>number of simulation objects </td></tr>
    <tr><td class="paramname">rank</td><td>MPI rank of this process </td></tr>
    <tr><td class="paramname">nproc</td><td>Number of MPI processes </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a00605_source.html#l00037">37</a> of file <a class="el" href="a00605_source.html">Solve.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;{</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  <a class="code" href="a00218.html#a00667">SimulationObject</a>* sim = (<a class="code" href="a00218.html#a00667">SimulationObject</a>*) s;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  <span class="comment">/* make sure none of the simulation objects sent in the array </span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">   * are &quot;barebones&quot; type */</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ns = 0; ns &lt; nsims; ns++) {</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="keywordflow">if</span> (sim[ns].is_barebones == 1) {</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;      fprintf(stderr, <span class="stringliteral">&quot;Error in Solve(): simulation object %d on rank %d is barebones!\n&quot;</span>,</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;              ns, rank );</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;      <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    }</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  }</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  <span class="comment">/* write out iblank to file for visualization */</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ns = 0; ns &lt; nsims; ns++) {</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="keywordflow">if</span> (sim[ns].solver.flag_ib) {</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;      <span class="keywordtype">char</span> fname_root[<a class="code" href="a00231.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>] = <span class="stringliteral">&quot;iblank&quot;</span>;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;      <span class="keywordflow">if</span> (nsims &gt; 1) {</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        <span class="keywordtype">char</span> index[<a class="code" href="a00231.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a>];</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        <a class="code" href="a00234.html#a3e3ad5aed581d9ae563190c365dadc41">GetStringFromInteger</a>(ns, index, (<span class="keywordtype">int</span>)log10((nsims)+1));</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        strcat(fname_root, <span class="stringliteral">&quot;_&quot;</span>);</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        strcat(fname_root, index);</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;      }</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;      <a class="code" href="a00239.html#aaf888c739c5200d9c58a7154347069b0">WriteArray</a>( sim[ns].solver.ndims,</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;                  1,</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;                  sim[ns].<a class="code" href="a00218.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00202.html#aa989ebb755986852177779cdf7bd8c85">dim_global</a>,</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;                  sim[ns].<a class="code" href="a00218.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00202.html#a38e0371f331cecbe63a77fa03e202afe">dim_local</a>,</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;                  sim[ns].<a class="code" href="a00218.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00202.html#aafc992b5fa79d5a4036024615d03bce6">ghosts</a>,</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;                  sim[ns].<a class="code" href="a00218.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00202.html#a711aad4cbe735871dd9e91ab575c878b">x</a>,</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;                  sim[ns].<a class="code" href="a00218.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00202.html#a267ef7e03dbe9dd4440dee2fdf48619a">iblank</a>,</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                  &amp;(sim[ns].<a class="code" href="a00218.html#a523947ce4fa7128c4c767163953253b9">solver</a>),</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;                  &amp;(sim[ns].<a class="code" href="a00218.html#a4afd2c7b3eb8fda452474ebdbe71c8c0">mpi</a>),</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                  fname_root );</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    }</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  }</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="preprocessor">#ifdef with_librom</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span> (!rank) printf(<span class="stringliteral">&quot;Setting up libROM interface.\n&quot;</span>);</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <a class="code" href="a00203.html">libROMInterface</a> rom_interface( sim, nsims, rank, nproc, sim[0].solver.dt );</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <span class="keyword">const</span> std::string&amp; rom_mode( rom_interface.mode() );</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  std::vector&lt;double&gt; op_times_arr(0);</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="preprocessor">#ifdef with_librom</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span> ((rom_mode == <a class="code" href="a00241.html#a8d7f058ce028038a98a49ad28176390e">_ROM_MODE_TRAIN_</a>) || (rom_mode == <a class="code" href="a00241.html#a28e9ddc4d69c4a09fda0f0f39726ba16">_ROM_MODE_NONE_</a>)) {</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="preprocessor"></span>    <span class="comment">/* Define and initialize the time-integration object */</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <a class="code" href="a00221.html">TimeIntegration</a> TS;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="keywordflow">if</span> (!rank) printf(<span class="stringliteral">&quot;Setting up time integration.\n&quot;</span>);</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <a class="code" href="a00265.html#a2ca35809be0e351ff2ad94532c2c0d68">TimeInitialize</a>(sim, nsims, rank, nproc, &amp;TS);</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="keywordtype">double</span> ti_runtime = 0.0;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="keywordflow">if</span> (!rank) printf(<span class="stringliteral">&quot;Solving in time (from %d to %d iterations)\n&quot;</span>,TS.<a class="code" href="a00221.html#aafb41b96563d9966e8e9f458751f2960">restart_iter</a>,TS.<a class="code" href="a00221.html#af0d8e0d5d3de3869b941b66b6caaf964">n_iter</a>);</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="keywordflow">for</span> (TS.<a class="code" href="a00221.html#aab6f168571c2073e01e240524b8a3da0">iter</a> = TS.<a class="code" href="a00221.html#aafb41b96563d9966e8e9f458751f2960">restart_iter</a>; TS.<a class="code" href="a00221.html#aab6f168571c2073e01e240524b8a3da0">iter</a> &lt; TS.<a class="code" href="a00221.html#af0d8e0d5d3de3869b941b66b6caaf964">n_iter</a>; TS.<a class="code" href="a00221.html#aab6f168571c2073e01e240524b8a3da0">iter</a>++) {</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  </div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;      <span class="comment">/* Write initial solution to file if this is the first iteration */</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;      <span class="keywordflow">if</span> (!TS.<a class="code" href="a00221.html#aab6f168571c2073e01e240524b8a3da0">iter</a>) { </div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ns = 0; ns &lt; nsims; ns++) {</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;          <span class="keywordflow">if</span> (sim[ns].solver.PhysicsOutput) {</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;            sim[ns].<a class="code" href="a00218.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00202.html#ab4c55736e92f7d72f04b8a957d82b054">PhysicsOutput</a>( &amp;(sim[ns].solver),</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                                          &amp;(sim[ns].mpi) );</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;          }</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        }</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        <a class="code" href="a00411.html#a5981de613724cb667e98aa872157534e">OutputSolution</a>(sim, nsims); </div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="preprocessor">#ifdef with_librom</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="preprocessor"></span>        op_times_arr.push_back(TS.<a class="code" href="a00221.html#a28e4e78c0bf258662bef21d26c51fc0b">waqt</a>);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="preprocessor"></span>      }</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="preprocessor">#ifdef with_librom</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="preprocessor"></span>      <span class="keywordflow">if</span> ((rom_mode == <a class="code" href="a00241.html#a8d7f058ce028038a98a49ad28176390e">_ROM_MODE_TRAIN_</a>) &amp;&amp; (TS.<a class="code" href="a00221.html#aab6f168571c2073e01e240524b8a3da0">iter</a>%rom_interface.samplingFrequency() == 0)) {</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        rom_interface.takeSample( sim, TS.<a class="code" href="a00221.html#a28e4e78c0bf258662bef21d26c51fc0b">waqt</a> );</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;      }</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="preprocessor"></span>  </div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;      <span class="comment">/* Call pre-step function */</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;      <a class="code" href="a00265.html#a2afba6dcdd13eb929ad4cb54a71eb470">TimePreStep</a> (&amp;TS);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="preprocessor">#ifdef compute_rhs_operators</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="preprocessor"></span>      <span class="comment">/* compute and write (to file) matrix operators representing the right-hand side */</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">//      if (((TS.iter+1)%solver-&gt;file_op_iter == 0) || (!TS.iter)) </span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">//        { ComputeRHSOperators(solver,mpi,TS.waqt);</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="preprocessor"></span>  </div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;      <span class="comment">/* Step in time */</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;      <a class="code" href="a00265.html#acb00956b2e195653e3f8107b1ab1dc4d">TimeStep</a> (&amp;TS);</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  </div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;      <span class="comment">/* Call post-step function */</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;      <a class="code" href="a00265.html#a25f8d76bc92804608cd299e63e23291c">TimePostStep</a> (&amp;TS);</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  </div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;      ti_runtime += TS.<a class="code" href="a00221.html#a92c7025356b89f3eb44829e9cb9f0b91">iter_wctime</a>;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  </div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      <span class="comment">/* Print information to screen */</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;      <a class="code" href="a00265.html#aa1ffb2050f4788b7c49b4576a9fe52ca">TimePrintStep</a>(&amp;TS);</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  </div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;      <span class="comment">/* Write intermediate solution to file */</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;      <span class="keywordflow">if</span> (      ((TS.<a class="code" href="a00221.html#aab6f168571c2073e01e240524b8a3da0">iter</a>+1)%sim[0].<a class="code" href="a00218.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00202.html#a6ff746b30ee55a3bbb9f3306c145f27a">file_op_iter</a> == 0) </div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;            &amp;&amp;  ((TS.<a class="code" href="a00221.html#aab6f168571c2073e01e240524b8a3da0">iter</a>+1) &lt; TS.<a class="code" href="a00221.html#af0d8e0d5d3de3869b941b66b6caaf964">n_iter</a>) ) { </div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ns = 0; ns &lt; nsims; ns++) {</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;          <span class="keywordflow">if</span> (sim[ns].solver.PhysicsOutput) {</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;            sim[ns].<a class="code" href="a00218.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00202.html#ab4c55736e92f7d72f04b8a957d82b054">PhysicsOutput</a>( &amp;(sim[ns].solver),</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                                          &amp;(sim[ns].mpi) );</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;          }</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        }</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <a class="code" href="a00411.html#a5981de613724cb667e98aa872157534e">OutputSolution</a>(sim, nsims); </div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="preprocessor">#ifdef with_librom</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="preprocessor"></span>        op_times_arr.push_back(TS.<a class="code" href="a00221.html#a28e4e78c0bf258662bef21d26c51fc0b">waqt</a>);</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="preprocessor"></span>      }</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  </div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    }</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  </div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keywordtype">double</span> t_final = TS.<a class="code" href="a00221.html#a28e4e78c0bf258662bef21d26c51fc0b">waqt</a>;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <a class="code" href="a00265.html#a85984dec08cd43570151a625ab62f8d9">TimeCleanup</a>(&amp;TS);</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="keywordflow">if</span> (!rank) {</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      printf( <span class="stringliteral">&quot;Completed time integration (Final time: %f), total wctime: %f (seconds).\n&quot;</span>,</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;              t_final, ti_runtime );</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;      <span class="keywordflow">if</span> (nsims &gt; 1) printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    }</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="comment">/* calculate error if exact solution has been provided */</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ns = 0; ns &lt; nsims; ns++) {</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;      <a class="code" href="a00306.html#a52e8c83d9dad55f9a6b967e63dc5f4bc">CalculateError</a>(&amp;(sim[ns].solver),</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                     &amp;(sim[ns].mpi) );</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    }</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="comment">/* write a final solution file */</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ns = 0; ns &lt; nsims; ns++) {</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;      <span class="keywordflow">if</span> (sim[ns].solver.PhysicsOutput) {</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        sim[ns].<a class="code" href="a00218.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00202.html#ab4c55736e92f7d72f04b8a957d82b054">PhysicsOutput</a>( &amp;(sim[ns].solver),</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                                      &amp;(sim[ns].mpi) );</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      }</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    }</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <a class="code" href="a00411.html#a5981de613724cb667e98aa872157534e">OutputSolution</a>(sim, nsims); </div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="preprocessor">#ifdef with_librom</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="preprocessor"></span>    op_times_arr.push_back(TS.<a class="code" href="a00221.html#a28e4e78c0bf258662bef21d26c51fc0b">waqt</a>);</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ns = 0; ns &lt; nsims; ns++) {</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;      <a class="code" href="a00312.html#ad22799259c966d7dcc526452eaf7e855">ResetFilenameIndex</a>( sim[ns].solver.filename_index, </div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                          sim[ns].<a class="code" href="a00218.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00202.html#af474ca4577de91b658e4399ad0a6d7b3">index_length</a> );</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    }</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  </div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="keywordflow">if</span> (rom_interface.mode() == <a class="code" href="a00241.html#a8d7f058ce028038a98a49ad28176390e">_ROM_MODE_TRAIN_</a>) {</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  </div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;      rom_interface.train();</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      <span class="keywordflow">if</span> (!rank) printf(<span class="stringliteral">&quot;libROM: total training wallclock time: %f (seconds).\n&quot;</span>, </div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                        rom_interface.trainWallclockTime() );</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;      <span class="keywordtype">double</span> total_rom_predict_time = 0;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iter = 0; iter &lt; op_times_arr.size(); iter++) {</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  </div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        <span class="keywordtype">double</span> waqt = op_times_arr[iter];</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  </div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        rom_interface.predict(sim, waqt);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        <span class="keywordflow">if</span> (!rank) printf(  <span class="stringliteral">&quot;libROM: Predicted solution at time %1.4e using ROM, wallclock time: %f.\n&quot;</span>, </div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                            waqt, rom_interface.predictWallclockTime() );</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        total_rom_predict_time += rom_interface.predictWallclockTime();</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  </div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        <span class="comment">/* calculate diff between ROM and PDE solutions */</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        <span class="keywordflow">if</span> (iter == (op_times_arr.size()-1)) {</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;          <span class="keywordflow">if</span> (!rank) printf(<span class="stringliteral">&quot;libROM:   Calculating diff between PDE and ROM solutions.\n&quot;</span>);</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ns = 0; ns &lt; nsims; ns++) {</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;            <a class="code" href="a00307.html#accb3d8778a793486e72e06f817ef16fc">CalculateROMDiff</a>(  &amp;(sim[ns].solver),</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                               &amp;(sim[ns].mpi) );</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;          }</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        }</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        <span class="comment">/* write the ROM solution to file */</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        <a class="code" href="a00600.html#a11343894048fd842093253bbbb407700">OutputROMSolution</a>(sim, nsims); </div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  </div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;      }</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      <span class="keywordflow">if</span> (!rank) {</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        printf( <span class="stringliteral">&quot;libROM: total prediction/query wallclock time: %f (seconds).\n&quot;</span>,</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                total_rom_predict_time );</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;      }</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;      rom_interface.saveROM();</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ns = 0; ns &lt; nsims; ns++) {</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        sim[ns].<a class="code" href="a00218.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00202.html#aaacee284a041d53cf335ae299d5eb929">rom_diff_norms</a>[0]</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;          = sim[ns].<a class="code" href="a00218.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00202.html#aaacee284a041d53cf335ae299d5eb929">rom_diff_norms</a>[1]</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;          = sim[ns].<a class="code" href="a00218.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00202.html#aaacee284a041d53cf335ae299d5eb929">rom_diff_norms</a>[2]</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;          = -1;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;      }</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    }</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rom_mode == <a class="code" href="a00241.html#a3035c57e07a432c8274e63259a0d506d">_ROM_MODE_PREDICT_</a>) {</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ns = 0; ns &lt; nsims; ns++) {</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;      sim[ns].<a class="code" href="a00218.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00202.html#aaacee284a041d53cf335ae299d5eb929">rom_diff_norms</a>[0]</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        = sim[ns].<a class="code" href="a00218.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00202.html#aaacee284a041d53cf335ae299d5eb929">rom_diff_norms</a>[1]</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        = sim[ns].<a class="code" href="a00218.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00202.html#aaacee284a041d53cf335ae299d5eb929">rom_diff_norms</a>[2]</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        = -1;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;      strcpy(sim[ns].solver.ConservationCheck,<span class="stringliteral">&quot;no&quot;</span>);</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    }</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    rom_interface.loadROM();</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    rom_interface.projectInitialSolution(sim);</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    {</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      <span class="keywordtype">int</span> start_iter = sim[0].<a class="code" href="a00218.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00202.html#aafb41b96563d9966e8e9f458751f2960">restart_iter</a>;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      <span class="keywordtype">int</span> n_iter = sim[0].<a class="code" href="a00218.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00202.html#af0d8e0d5d3de3869b941b66b6caaf964">n_iter</a>;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      <span class="keywordtype">double</span> dt = sim[0].<a class="code" href="a00218.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00202.html#a03e28be41881b703c836edbfe9b51b17">dt</a>;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  </div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;      <span class="keywordtype">double</span> cur_time = start_iter * dt;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;      op_times_arr.push_back(cur_time);</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  </div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iter = start_iter; iter &lt; n_iter; iter++) {</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        cur_time += dt;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        <span class="keywordflow">if</span> (    ( (iter+1)%sim[0].solver.file_op_iter == 0)</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;            &amp;&amp;  ( (iter+1) &lt; n_iter) ) {</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;          op_times_arr.push_back(cur_time);</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        }</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      }</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  </div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;      <span class="keywordtype">double</span> t_final = n_iter*dt;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      op_times_arr.push_back(t_final);</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    }</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="keywordtype">double</span> total_rom_predict_time = 0;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iter = 0; iter &lt; op_times_arr.size(); iter++) {</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  </div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;      <span class="keywordtype">double</span> waqt = op_times_arr[iter];</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  </div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;      rom_interface.predict(sim, waqt);</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;      <span class="keywordflow">if</span> (!rank) printf(  <span class="stringliteral">&quot;libROM: Predicted solution at time %1.4e using ROM, wallclock time: %f.\n&quot;</span>, </div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                          waqt, rom_interface.predictWallclockTime() );</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;      total_rom_predict_time += rom_interface.predictWallclockTime();</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  </div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;      <span class="comment">/* write the solution to file */</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ns = 0; ns &lt; nsims; ns++) {</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        <span class="keywordflow">if</span> (sim[ns].solver.PhysicsOutput) {</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;          sim[ns].<a class="code" href="a00218.html#a523947ce4fa7128c4c767163953253b9">solver</a>.<a class="code" href="a00202.html#ab4c55736e92f7d72f04b8a957d82b054">PhysicsOutput</a>( &amp;(sim[ns].solver),</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                                        &amp;(sim[ns].mpi) );</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        }</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      }</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;      <a class="code" href="a00411.html#a5981de613724cb667e98aa872157534e">OutputSolution</a>(sim, nsims); </div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  </div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    }</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="comment">/* calculate error if exact solution has been provided */</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ns = 0; ns &lt; nsims; ns++) {</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;      <a class="code" href="a00306.html#a52e8c83d9dad55f9a6b967e63dc5f4bc">CalculateError</a>(&amp;(sim[ns].solver),</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                     &amp;(sim[ns].mpi) );</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    }</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="keywordflow">if</span> (!rank) {</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      printf( <span class="stringliteral">&quot;libROM: total prediction/query wallclock time: %f (seconds).\n&quot;</span>,</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;              total_rom_predict_time );</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    }</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  }</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;}</div>
<div class="ttc" id="a00221_html_a92c7025356b89f3eb44829e9cb9f0b91"><div class="ttname"><a href="a00221.html#a92c7025356b89f3eb44829e9cb9f0b91">TimeIntegration::iter_wctime</a></div><div class="ttdeci">double iter_wctime</div><div class="ttdef"><b>Definition:</b> <a href="a00197_source.html#l00105">timeintegration_struct.h:105</a></div></div>
<div class="ttc" id="a00234_html_a3e3ad5aed581d9ae563190c365dadc41"><div class="ttname"><a href="a00234.html#a3e3ad5aed581d9ae563190c365dadc41">GetStringFromInteger</a></div><div class="ttdeci">void GetStringFromInteger(int, char *, int)</div><div class="ttdef"><b>Definition:</b> <a href="a00296_source.html#l00015">CommonFunctions.c:15</a></div></div>
<div class="ttc" id="a00203_html"><div class="ttname"><a href="a00203.html">libROMInterface</a></div><div class="ttdoc">Class implementing interface with libROM. </div><div class="ttdef"><b>Definition:</b> <a href="a00241_source.html#l00045">librom_interface.h:45</a></div></div>
<div class="ttc" id="a00218_html_a00667"><div class="ttname"><a href="a00218.html#a00667">SimulationObject</a></div><div class="ttdoc">Structure defining a simulation. </div><div class="ttdef"><b>Definition:</b> <a href="a00218_source.html#l00023">simulation_object.h:23</a></div></div>
<div class="ttc" id="a00202_html_a6ff746b30ee55a3bbb9f3306c145f27a"><div class="ttname"><a href="a00202.html#a6ff746b30ee55a3bbb9f3306c145f27a">HyPar::file_op_iter</a></div><div class="ttdeci">int file_op_iter</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00171">hypar.h:171</a></div></div>
<div class="ttc" id="a00202_html_aa989ebb755986852177779cdf7bd8c85"><div class="ttname"><a href="a00202.html#aa989ebb755986852177779cdf7bd8c85">HyPar::dim_global</a></div><div class="ttdeci">int * dim_global</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00033">hypar.h:33</a></div></div>
<div class="ttc" id="a00221_html"><div class="ttname"><a href="a00221.html">TimeIntegration</a></div><div class="ttdoc">Structure of variables/parameters and function pointers for time integration. </div><div class="ttdef"><b>Definition:</b> <a href="a00197_source.html#l00029">timeintegration_struct.h:29</a></div></div>
<div class="ttc" id="a00312_html_ad22799259c966d7dcc526452eaf7e855"><div class="ttname"><a href="a00312.html#ad22799259c966d7dcc526452eaf7e855">ResetFilenameIndex</a></div><div class="ttdeci">void ResetFilenameIndex(char *f, int len)</div><div class="ttdef"><b>Definition:</b> <a href="a00312_source.html#l00064">IncrementFilename.c:64</a></div></div>
<div class="ttc" id="a00265_html_a2ca35809be0e351ff2ad94532c2c0d68"><div class="ttname"><a href="a00265.html#a2ca35809be0e351ff2ad94532c2c0d68">TimeInitialize</a></div><div class="ttdeci">int TimeInitialize(void *, int, int, int, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00632_source.html#l00028">TimeInitialize.c:28</a></div></div>
<div class="ttc" id="a00202_html_a711aad4cbe735871dd9e91ab575c878b"><div class="ttname"><a href="a00202.html#a711aad4cbe735871dd9e91ab575c878b">HyPar::x</a></div><div class="ttdeci">double * x</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00107">hypar.h:107</a></div></div>
<div class="ttc" id="a00265_html_a25f8d76bc92804608cd299e63e23291c"><div class="ttname"><a href="a00265.html#a25f8d76bc92804608cd299e63e23291c">TimePostStep</a></div><div class="ttdeci">int TimePostStep(void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00633_source.html#l00028">TimePostStep.c:28</a></div></div>
<div class="ttc" id="a00218_html_a4afd2c7b3eb8fda452474ebdbe71c8c0"><div class="ttname"><a href="a00218.html#a4afd2c7b3eb8fda452474ebdbe71c8c0">SimulationObject::mpi</a></div><div class="ttdeci">MPIVariables mpi</div><div class="ttdef"><b>Definition:</b> <a href="a00218_source.html#l00025">simulation_object.h:25</a></div></div>
<div class="ttc" id="a00265_html_a2afba6dcdd13eb929ad4cb54a71eb470"><div class="ttname"><a href="a00265.html#a2afba6dcdd13eb929ad4cb54a71eb470">TimePreStep</a></div><div class="ttdeci">int TimePreStep(void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00634_source.html#l00022">TimePreStep.c:22</a></div></div>
<div class="ttc" id="a00202_html_a38e0371f331cecbe63a77fa03e202afe"><div class="ttname"><a href="a00202.html#a38e0371f331cecbe63a77fa03e202afe">HyPar::dim_local</a></div><div class="ttdeci">int * dim_local</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00037">hypar.h:37</a></div></div>
<div class="ttc" id="a00241_html_a3035c57e07a432c8274e63259a0d506d"><div class="ttname"><a href="a00241.html#a3035c57e07a432c8274e63259a0d506d">_ROM_MODE_PREDICT_</a></div><div class="ttdeci">#define _ROM_MODE_PREDICT_</div><div class="ttdef"><b>Definition:</b> <a href="a00241_source.html#l00016">librom_interface.h:16</a></div></div>
<div class="ttc" id="a00202_html_aaacee284a041d53cf335ae299d5eb929"><div class="ttname"><a href="a00202.html#aaacee284a041d53cf335ae299d5eb929">HyPar::rom_diff_norms</a></div><div class="ttdeci">double rom_diff_norms[3]</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00400">hypar.h:400</a></div></div>
<div class="ttc" id="a00265_html_aa1ffb2050f4788b7c49b4576a9fe52ca"><div class="ttname"><a href="a00265.html#aa1ffb2050f4788b7c49b4576a9fe52ca">TimePrintStep</a></div><div class="ttdeci">int TimePrintStep(void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00635_source.html#l00016">TimePrintStep.c:16</a></div></div>
<div class="ttc" id="a00202_html_aafc992b5fa79d5a4036024615d03bce6"><div class="ttname"><a href="a00202.html#aafc992b5fa79d5a4036024615d03bce6">HyPar::ghosts</a></div><div class="ttdeci">int ghosts</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00052">hypar.h:52</a></div></div>
<div class="ttc" id="a00202_html_ab4c55736e92f7d72f04b8a957d82b054"><div class="ttname"><a href="a00202.html#ab4c55736e92f7d72f04b8a957d82b054">HyPar::PhysicsOutput</a></div><div class="ttdeci">int(* PhysicsOutput)(void *, void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00342">hypar.h:342</a></div></div>
<div class="ttc" id="a00241_html_a8d7f058ce028038a98a49ad28176390e"><div class="ttname"><a href="a00241.html#a8d7f058ce028038a98a49ad28176390e">_ROM_MODE_TRAIN_</a></div><div class="ttdeci">#define _ROM_MODE_TRAIN_</div><div class="ttdef"><b>Definition:</b> <a href="a00241_source.html#l00014">librom_interface.h:14</a></div></div>
<div class="ttc" id="a00307_html_accb3d8778a793486e72e06f817ef16fc"><div class="ttname"><a href="a00307.html#accb3d8778a793486e72e06f817ef16fc">CalculateROMDiff</a></div><div class="ttdeci">int CalculateROMDiff(void *s, void *m)</div><div class="ttdef"><b>Definition:</b> <a href="a00307_source.html#l00024">CalculateROMDiff.c:24</a></div></div>
<div class="ttc" id="a00202_html_af0d8e0d5d3de3869b941b66b6caaf964"><div class="ttname"><a href="a00202.html#af0d8e0d5d3de3869b941b66b6caaf964">HyPar::n_iter</a></div><div class="ttdeci">int n_iter</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00055">hypar.h:55</a></div></div>
<div class="ttc" id="a00221_html_a28e4e78c0bf258662bef21d26c51fc0b"><div class="ttname"><a href="a00221.html#a28e4e78c0bf258662bef21d26c51fc0b">TimeIntegration::waqt</a></div><div class="ttdeci">double waqt</div><div class="ttdef"><b>Definition:</b> <a href="a00197_source.html#l00037">timeintegration_struct.h:37</a></div></div>
<div class="ttc" id="a00231_html_a51efea86a4d76d1259893f606b776573"><div class="ttname"><a href="a00231.html#a51efea86a4d76d1259893f606b776573">_MAX_STRING_SIZE_</a></div><div class="ttdeci">#define _MAX_STRING_SIZE_</div><div class="ttdef"><b>Definition:</b> <a href="a00231_source.html#l00014">basic.h:14</a></div></div>
<div class="ttc" id="a00265_html_acb00956b2e195653e3f8107b1ab1dc4d"><div class="ttname"><a href="a00265.html#acb00956b2e195653e3f8107b1ab1dc4d">TimeStep</a></div><div class="ttdeci">int TimeStep(void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00638_source.html#l00013">TimeStep.c:13</a></div></div>
<div class="ttc" id="a00239_html_aaf888c739c5200d9c58a7154347069b0"><div class="ttname"><a href="a00239.html#aaf888c739c5200d9c58a7154347069b0">WriteArray</a></div><div class="ttdeci">int WriteArray(int, int, int *, int *, int, double *, double *, void *, void *, char *)</div><div class="ttdef"><b>Definition:</b> <a href="a00366_source.html#l00027">WriteArray.c:27</a></div></div>
<div class="ttc" id="a00202_html_af474ca4577de91b658e4399ad0a6d7b3"><div class="ttname"><a href="a00202.html#af474ca4577de91b658e4399ad0a6d7b3">HyPar::index_length</a></div><div class="ttdeci">int index_length</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00196">hypar.h:196</a></div></div>
<div class="ttc" id="a00221_html_aafb41b96563d9966e8e9f458751f2960"><div class="ttname"><a href="a00221.html#aafb41b96563d9966e8e9f458751f2960">TimeIntegration::restart_iter</a></div><div class="ttdeci">int restart_iter</div><div class="ttdef"><b>Definition:</b> <a href="a00197_source.html#l00035">timeintegration_struct.h:35</a></div></div>
<div class="ttc" id="a00221_html_aab6f168571c2073e01e240524b8a3da0"><div class="ttname"><a href="a00221.html#aab6f168571c2073e01e240524b8a3da0">TimeIntegration::iter</a></div><div class="ttdeci">int iter</div><div class="ttdef"><b>Definition:</b> <a href="a00197_source.html#l00031">timeintegration_struct.h:31</a></div></div>
<div class="ttc" id="a00411_html_a5981de613724cb667e98aa872157534e"><div class="ttname"><a href="a00411.html#a5981de613724cb667e98aa872157534e">OutputSolution</a></div><div class="ttdeci">int OutputSolution(void *, int)</div><div class="ttdef"><b>Definition:</b> <a href="a00601_source.html#l00026">OutputSolution.c:26</a></div></div>
<div class="ttc" id="a00202_html_a03e28be41881b703c836edbfe9b51b17"><div class="ttname"><a href="a00202.html#a03e28be41881b703c836edbfe9b51b17">HyPar::dt</a></div><div class="ttdeci">double dt</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00067">hypar.h:67</a></div></div>
<div class="ttc" id="a00306_html_a52e8c83d9dad55f9a6b967e63dc5f4bc"><div class="ttname"><a href="a00306.html#a52e8c83d9dad55f9a6b967e63dc5f4bc">CalculateError</a></div><div class="ttdeci">int CalculateError(void *s, void *m)</div><div class="ttdef"><b>Definition:</b> <a href="a00306_source.html#l00025">CalculateError.c:25</a></div></div>
<div class="ttc" id="a00202_html_aafb41b96563d9966e8e9f458751f2960"><div class="ttname"><a href="a00202.html#aafb41b96563d9966e8e9f458751f2960">HyPar::restart_iter</a></div><div class="ttdeci">int restart_iter</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00058">hypar.h:58</a></div></div>
<div class="ttc" id="a00202_html_a267ef7e03dbe9dd4440dee2fdf48619a"><div class="ttname"><a href="a00202.html#a267ef7e03dbe9dd4440dee2fdf48619a">HyPar::iblank</a></div><div class="ttdeci">double * iblank</div><div class="ttdef"><b>Definition:</b> <a href="a00238_source.html#l00431">hypar.h:431</a></div></div>
<div class="ttc" id="a00265_html_a85984dec08cd43570151a625ab62f8d9"><div class="ttname"><a href="a00265.html#a85984dec08cd43570151a625ab62f8d9">TimeCleanup</a></div><div class="ttdeci">int TimeCleanup(void *)</div><div class="ttdef"><b>Definition:</b> <a href="a00623_source.html#l00018">TimeCleanup.c:18</a></div></div>
<div class="ttc" id="a00241_html_a28e9ddc4d69c4a09fda0f0f39726ba16"><div class="ttname"><a href="a00241.html#a28e9ddc4d69c4a09fda0f0f39726ba16">_ROM_MODE_NONE_</a></div><div class="ttdeci">#define _ROM_MODE_NONE_</div><div class="ttdef"><b>Definition:</b> <a href="a00241_source.html#l00012">librom_interface.h:12</a></div></div>
<div class="ttc" id="a00221_html_af0d8e0d5d3de3869b941b66b6caaf964"><div class="ttname"><a href="a00221.html#af0d8e0d5d3de3869b941b66b6caaf964">TimeIntegration::n_iter</a></div><div class="ttdeci">int n_iter</div><div class="ttdef"><b>Definition:</b> <a href="a00197_source.html#l00033">timeintegration_struct.h:33</a></div></div>
<div class="ttc" id="a00218_html_a523947ce4fa7128c4c767163953253b9"><div class="ttname"><a href="a00218.html#a523947ce4fa7128c4c767163953253b9">SimulationObject::solver</a></div><div class="ttdeci">HyPar solver</div><div class="ttdef"><b>Definition:</b> <a href="a00218_source.html#l00026">simulation_object.h:26</a></div></div>
<div class="ttc" id="a00600_html_a11343894048fd842093253bbbb407700"><div class="ttname"><a href="a00600.html#a11343894048fd842093253bbbb407700">OutputROMSolution</a></div><div class="ttdeci">int OutputROMSolution(void *s, int nsims)</div><div class="ttdef"><b>Definition:</b> <a href="a00600_source.html#l00024">OutputROMSolution.c:24</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">
var sc_project=10897352; 
var sc_invisible=1; 
var sc_security="83042f57"; 
var scJsHost = (("https:" == document.location.protocol) ?
"https://secure." : "http://www.");
document.write("<sc"+"ript type='text/javascript' src='" +
scJsHost+
"statcounter.com/counter/counter.js'></"+"script>");
</script>
<noscript><div class="statcounter"><a title="website
statistics" href="http://statcounter.com/"
target="_blank"><img class="statcounter"
src="//c.statcounter.com/10897352/0/83042f57/1/"
alt="website statistics"></a></div></noscript>
<!-- End of StatCounter Code for Default Guide -->
